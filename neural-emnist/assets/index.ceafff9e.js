const p=function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerpolicy&&(s.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?s.credentials="include":a.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(a){if(a.ep)return;a.ep=!0;const s=t(a);fetch(a.href,s)}};p();function noop(){}function run$1(e){return e()}function blank_object(){return Object.create(null)}function run_all(e){e.forEach(run$1)}function is_function(e){return typeof e=="function"}function safe_not_equal(e,r){return e!=e?r==r:e!==r||e&&typeof e=="object"||typeof e=="function"}function is_empty(e){return Object.keys(e).length===0}function null_to_empty(e){return e==null?"":e}function append(e,r){e.appendChild(r)}function insert$1(e,r,t){e.insertBefore(r,t||null)}function detach(e){e.parentNode.removeChild(e)}function destroy_each(e,r){for(let t=0;t<e.length;t+=1)e[t]&&e[t].d(r)}function element(e){return document.createElement(e)}function text(e){return document.createTextNode(e)}function space(){return text(" ")}function listen(e,r,t,n){return e.addEventListener(r,t,n),()=>e.removeEventListener(r,t,n)}function attr(e,r,t){t==null?e.removeAttribute(r):e.getAttribute(r)!==t&&e.setAttribute(r,t)}function to_number(e){return e===""?null:+e}function children(e){return Array.from(e.childNodes)}function set_data(e,r){r=""+r,e.wholeText!==r&&(e.data=r)}function set_input_value(e,r){e.value=r==null?"":r}function set_style(e,r,t,n){t===null?e.style.removeProperty(r):e.style.setProperty(r,t,n?"important":"")}let current_component;function set_current_component(e){current_component=e}function get_current_component(){if(!current_component)throw new Error("Function called outside component initialization");return current_component}function onMount(e){get_current_component().$$.on_mount.push(e)}const dirty_components=[],binding_callbacks=[],render_callbacks=[],flush_callbacks=[],resolved_promise=Promise.resolve();let update_scheduled=!1;function schedule_update(){update_scheduled||(update_scheduled=!0,resolved_promise.then(flush))}function add_render_callback(e){render_callbacks.push(e)}function add_flush_callback(e){flush_callbacks.push(e)}const seen_callbacks=new Set;let flushidx=0;function flush(){const e=current_component;do{for(;flushidx<dirty_components.length;){const r=dirty_components[flushidx];flushidx++,set_current_component(r),update(r.$$)}for(set_current_component(null),dirty_components.length=0,flushidx=0;binding_callbacks.length;)binding_callbacks.pop()();for(let r=0;r<render_callbacks.length;r+=1){const t=render_callbacks[r];seen_callbacks.has(t)||(seen_callbacks.add(t),t())}render_callbacks.length=0}while(dirty_components.length);for(;flush_callbacks.length;)flush_callbacks.pop()();update_scheduled=!1,seen_callbacks.clear(),set_current_component(e)}function update(e){if(e.fragment!==null){e.update(),run_all(e.before_update);const r=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,r),e.after_update.forEach(add_render_callback)}}const outroing=new Set;let outros;function transition_in(e,r){e&&e.i&&(outroing.delete(e),e.i(r))}function transition_out(e,r,t,n){if(e&&e.o){if(outroing.has(e))return;outroing.add(e),outros.c.push(()=>{outroing.delete(e),n&&(t&&e.d(1),n())}),e.o(r)}else n&&n()}function bind(e,r,t){const n=e.$$.props[r];n!==void 0&&(e.$$.bound[n]=t,t(e.$$.ctx[n]))}function create_component(e){e&&e.c()}function mount_component(e,r,t,n){const{fragment:a,on_mount:s,on_destroy:o,after_update:l}=e.$$;a&&a.m(r,t),n||add_render_callback(()=>{const f=s.map(run$1).filter(is_function);o?o.push(...f):run_all(f),e.$$.on_mount=[]}),l.forEach(add_render_callback)}function destroy_component(e,r){const t=e.$$;t.fragment!==null&&(run_all(t.on_destroy),t.fragment&&t.fragment.d(r),t.on_destroy=t.fragment=null,t.ctx=[])}function make_dirty(e,r){e.$$.dirty[0]===-1&&(dirty_components.push(e),schedule_update(),e.$$.dirty.fill(0)),e.$$.dirty[r/31|0]|=1<<r%31}function init$1(e,r,t,n,a,s,o,l=[-1]){const f=current_component;set_current_component(e);const h=e.$$={fragment:null,ctx:null,props:s,update:noop,not_equal:a,bound:blank_object(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(r.context||(f?f.$$.context:[])),callbacks:blank_object(),dirty:l,skip_bound:!1,root:r.target||f.$$.root};o&&o(h.root);let c=!1;if(h.ctx=t?t(e,r.props||{},(u,d,...g)=>{const m=g.length?g[0]:d;return h.ctx&&a(h.ctx[u],h.ctx[u]=m)&&(!h.skip_bound&&h.bound[u]&&h.bound[u](m),c&&make_dirty(e,u)),d}):[],h.update(),c=!0,run_all(h.before_update),h.fragment=n?n(h.ctx):!1,r.target){if(r.hydrate){const u=children(r.target);h.fragment&&h.fragment.l(u),u.forEach(detach)}else h.fragment&&h.fragment.c();r.intro&&transition_in(e.$$.fragment),mount_component(e,r.target,r.anchor,r.customElement),flush()}set_current_component(f)}class SvelteComponent{$destroy(){destroy_component(this,1),this.$destroy=noop}$on(r,t){const n=this.$$.callbacks[r]||(this.$$.callbacks[r]=[]);return n.push(t),()=>{const a=n.indexOf(t);a!==-1&&n.splice(a,1)}}$set(r){this.$$set&&!is_empty(r)&&(this.$$.skip_bound=!0,this.$$set(r),this.$$.skip_bound=!1)}}const bitMethods={getBit(e){return this.data[getSlot(e)]&1<<getShift(e)?1:0},setBit(e){this.data[getSlot(e)]|=1<<getShift(e)},clearBit(e){this.data[getSlot(e)]&=~(1<<getShift(e))},toggleBit(e){this.data[getSlot(e)]^=1<<getShift(e)},getBitXY(e,r){return e>=this.width||r>=this.height?0:this.getBit(r*this.width+e)},setBitXY(e,r){this.setBit(r*this.width+e)},clearBitXY(e,r){this.clearBit(r*this.width+e)},toggleBitXY(e,r){this.toggleBit(r*this.width+e)}};function getSlot(e){return e>>3}function getShift(e){return 7-(e&7)}function setBitMethods(e){for(const r in bitMethods)e.prototype[r]=bitMethods[r]}function checkProcessable(e,r={}){let{bitDepth:t,alpha:n,colorModel:a,components:s,channels:o}=r;if(typeof e!="string"||e.length===0)throw new TypeError("processName must be a string");if(t&&(Array.isArray(t)||(t=[t]),!t.includes(this.bitDepth)))throw new TypeError(`The process: ${e} can only be applied if bit depth is in: ${t}`);if(n&&(Array.isArray(n)||(n=[n]),!n.includes(this.alpha)))throw new TypeError(`The process: ${e} can only be applied if alpha is in: ${n}`);if(a&&(Array.isArray(a)||(a=[a]),!a.includes(this.colorModel)))throw new TypeError(`The process: ${e} can only be applied if color model is in: ${a}`);if(s&&(Array.isArray(s)||(s=[s]),!s.includes(this.components))){let l=`The process: ${e} can only be applied if the number of components is in: ${s}`;throw s.length===1&&s[0]===1?new TypeError(`${l}.\rYou should transform your image using "image.grey()" before applying the algorithm.`):new TypeError(l)}if(o&&(Array.isArray(o)||(o=[o]),!o.includes(this.channels)))throw new TypeError(`The process: ${e} can only be applied if the number of channels is in: ${o}`)}function createBlob(e,r){e=e||[],r=r||{},typeof r=="string"&&(r={type:r});try{return new Blob(e,r)}catch(s){if(s.name!=="TypeError")throw s;for(var t=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,n=new t,a=0;a<e.length;a+=1)n.append(e[a]);return n.getBlob(r.type)}}function dataURLToBlob(e){var r=e.match(/data:([^;]+)/)[1],t=e.replace(/^[^,]+,/,""),n=binaryStringToArrayBuffer(atob(t));return createBlob([n],{type:r})}function canvasToBlob(e,r,t){return typeof e.toBlob=="function"?new Promise(function(n){e.toBlob(n,r,t)}):Promise.resolve(dataURLToBlob(e.toDataURL(r,t)))}function binaryStringToArrayBuffer(e){for(var r=e.length,t=new ArrayBuffer(r),n=new Uint8Array(t),a=-1;++a<r;)n[a]=e.charCodeAt(a);return t}var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getAugmentedNamespace(e){var r=e.default;if(typeof r=="function"){var t=function(){return r.apply(this,arguments)};t.prototype=r.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var a=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,a.get?a:{enumerable:!0,get:function(){return e[n]}})}),t}(function(e){if(e.TextEncoder&&e.TextDecoder)return!1;function r(n="utf-8"){if(n!=="utf-8")throw new RangeError(`Failed to construct 'TextEncoder': The encoding label provided ('${n}') is invalid.`)}Object.defineProperty(r.prototype,"encoding",{value:"utf-8"}),r.prototype.encode=function(n,a={stream:!1}){if(a.stream)throw new Error("Failed to encode: the 'stream' option is unsupported.");let s=0;const o=n.length;let l=0,f=Math.max(32,o+(o>>1)+7),h=new Uint8Array(f>>3<<3);for(;s<o;){let c=n.charCodeAt(s++);if(c>=55296&&c<=56319){if(s<o){const u=n.charCodeAt(s);(u&64512)===56320&&(++s,c=((c&1023)<<10)+(u&1023)+65536)}if(c>=55296&&c<=56319)continue}if(l+4>h.length){f+=8,f*=1+s/n.length*2,f=f>>3<<3;const u=new Uint8Array(f);u.set(h),h=u}if((c&4294967168)===0){h[l++]=c;continue}else if((c&4294965248)===0)h[l++]=c>>6&31|192;else if((c&4294901760)===0)h[l++]=c>>12&15|224,h[l++]=c>>6&63|128;else if((c&4292870144)===0)h[l++]=c>>18&7|240,h[l++]=c>>12&63|128,h[l++]=c>>6&63|128;else continue;h[l++]=c&63|128}return h.slice(0,l)};function t(n="utf-8",a={fatal:!1}){if(n!=="utf-8")throw new RangeError(`Failed to construct 'TextDecoder': The encoding label provided ('${n}') is invalid.`);if(a.fatal)throw new Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}Object.defineProperty(t.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(t.prototype,"fatal",{value:!1}),Object.defineProperty(t.prototype,"ignoreBOM",{value:!1}),t.prototype.decode=function(n,a={stream:!1}){if(a.stream)throw new Error("Failed to decode: the 'stream' option is unsupported.");const s=new Uint8Array(n);let o=0;const l=s.length,f=[];for(;o<l;){const h=s[o++];if(h===0)break;if((h&128)===0)f.push(h);else if((h&224)===192){const c=s[o++]&63;f.push((h&31)<<6|c)}else if((h&240)===224){const c=s[o++]&63,u=s[o++]&63;f.push((h&31)<<12|c<<6|u)}else if((h&248)===240){const c=s[o++]&63,u=s[o++]&63,d=s[o++]&63;let g=(h&7)<<18|c<<12|u<<6|d;g>65535&&(g-=65536,f.push(g>>>10&1023|55296),g=56320|g&1023),f.push(g)}}return String.fromCharCode.apply(null,f)},e.TextEncoder=r,e.TextDecoder=t})(typeof window<"u"?window:typeof self<"u"?self:globalThis);function decode$5(e,r="utf8"){return new TextDecoder(r).decode(e)}const encoder$1=new TextEncoder;function encode$3(e){return encoder$1.encode(e)}const defaultByteLength$1=1024*8,hostBigEndian=(()=>{const e=new Uint8Array(4),r=new Uint32Array(e.buffer);return!((r[0]=1)&e[0])})(),typedArrays={int8:Int8Array,uint8:Uint8Array,int16:Int16Array,uint16:Uint16Array,int32:Int32Array,uint32:Uint32Array,uint64:BigUint64Array,int64:BigInt64Array,float32:Float32Array,float64:Float64Array};class IOBuffer$4{constructor(r=defaultByteLength$1,t={}){let n=!1;typeof r=="number"?r=new ArrayBuffer(r):(n=!0,this.lastWrittenByte=r.byteLength);const a=t.offset?t.offset>>>0:0,s=r.byteLength-a;let o=a;(ArrayBuffer.isView(r)||r instanceof IOBuffer$4)&&(r.byteLength!==r.buffer.byteLength&&(o=r.byteOffset+a),r=r.buffer),n?this.lastWrittenByte=s:this.lastWrittenByte=0,this.buffer=r,this.length=s,this.byteLength=s,this.byteOffset=o,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,o,s),this._mark=0,this._marks=[]}available(r=1){return this.offset+r<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(r=1){return this.offset+=r,this}back(r=1){return this.offset-=r,this}seek(r){return this.offset=r,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const r=this._marks.pop();if(r===void 0)throw new Error("Mark stack empty");return this.seek(r),this}rewind(){return this.offset=0,this}ensureAvailable(r=1){if(!this.available(r)){const n=(this.offset+r)*2,a=new Uint8Array(n);a.set(new Uint8Array(this.buffer)),this.buffer=a.buffer,this.length=this.byteLength=n,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(r=1){return this.readArray(r,"uint8")}readArray(r,t){const n=typedArrays[t].BYTES_PER_ELEMENT*r,a=this.byteOffset+this.offset,s=this.buffer.slice(a,a+n);if(this.littleEndian===hostBigEndian&&t!=="uint8"&&t!=="int8"){const l=new Uint8Array(this.buffer.slice(a,a+n));l.reverse();const f=new typedArrays[t](l.buffer);return this.offset+=n,f.reverse(),f}const o=new typedArrays[t](s);return this.offset+=n,o}readInt16(){const r=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,r}readUint16(){const r=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,r}readInt32(){const r=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,r}readUint32(){const r=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,r}readFloat32(){const r=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,r}readFloat64(){const r=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,r}readBigInt64(){const r=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,r}readBigUint64(){const r=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,r}readChar(){return String.fromCharCode(this.readInt8())}readChars(r=1){let t="";for(let n=0;n<r;n++)t+=this.readChar();return t}readUtf8(r=1){return decode$5(this.readBytes(r))}decodeText(r=1,t="utf-8"){return decode$5(this.readBytes(r),t)}writeBoolean(r){return this.writeUint8(r?255:0),this}writeInt8(r){return this.ensureAvailable(1),this._data.setInt8(this.offset++,r),this._updateLastWrittenByte(),this}writeUint8(r){return this.ensureAvailable(1),this._data.setUint8(this.offset++,r),this._updateLastWrittenByte(),this}writeByte(r){return this.writeUint8(r)}writeBytes(r){this.ensureAvailable(r.length);for(let t=0;t<r.length;t++)this._data.setUint8(this.offset++,r[t]);return this._updateLastWrittenByte(),this}writeInt16(r){return this.ensureAvailable(2),this._data.setInt16(this.offset,r,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(r){return this.ensureAvailable(2),this._data.setUint16(this.offset,r,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(r){return this.ensureAvailable(4),this._data.setInt32(this.offset,r,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(r){return this.ensureAvailable(4),this._data.setUint32(this.offset,r,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(r){return this.ensureAvailable(4),this._data.setFloat32(this.offset,r,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(r){return this.ensureAvailable(8),this._data.setFloat64(this.offset,r,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(r){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,r,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(r){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,r,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(r){return this.writeUint8(r.charCodeAt(0))}writeChars(r){for(let t=0;t<r.length;t++)this.writeUint8(r.charCodeAt(t));return this}writeUtf8(r){return this.writeBytes(encode$3(r))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}const IOBuffer$5=Object.freeze(Object.defineProperty({__proto__:null,IOBuffer:IOBuffer$4},Symbol.toStringTag,{value:"Module"})),require$$0$3=getAugmentedNamespace(IOBuffer$5);var constants$4={BITMAPV5HEADER:{LogicalColorSpace:{LCS_CALIBRATED_RGB:0,LCS_sRGB:1934772034,LCS_WINDOWS_COLOR_SPACE:1466527264},Compression:{BI_RGB:0,BI_RLE8:1,BI_RLE4:2,BI_BITFIELDS:3,BI_JPEG:4,BI_PNG:5,BI_CMYK:11,BI_CMYKRLE8:12,BI_CMYKRLE4:13},GamutMappingIntent:{LCS_GM_ABS_COLORIMETRIC:8,LCS_GM_BUSINESS:1,LCS_GM_GRAPHICS:2,LCS_GM_IMAGES:4}}};const{IOBuffer:IOBuffer$3}=require$$0$3,constants$3=constants$4,tableLeft=[];for(let e=0;e<=8;e++)tableLeft.push(255<<e);class BMPEncoder extends IOBuffer$3{constructor(r){if(r.bitDepth!==1)throw new Error("Only bitDepth of 1 is supported");if(!r.height||!r.width)throw new Error("ImageData width and height are required");super(r.data),this.width=r.width,this.height=r.height,this.bitDepth=r.bitDepth,this.channels=r.channels,this.components=r.components}encode(){this.encoded=new IOBuffer$3,this.encoded.skip(14),this.writeBitmapV5Header(),this.writeColorTable();const r=this.encoded.offset;return this.writePixelArray(),this.encoded.rewind(),this.writeBitmapFileHeader(r),this.encoded.toArray()}writePixelArray(){let r=this.encoded;const t=Math.floor((this.bitDepth*this.width+31)/32)*4,n=Math.ceil(this.bitDepth*this.width/8),a=t-n,s=this.bitDepth*this.width%8,o=s===0?0:8-s,l=t*this.height;let f,h,c=0,u=0,d=8;r.mark(),h=this.readUint8();for(let g=this.height-1;g>=0;g--){const m=g===0;r.reset(),r.skip(g*t);for(let w=0;w<n;w++){const v=w===n-1;u<=o&&v?(r.writeByte(h<<u),(o===0||o===u)&&!m&&(f=h,h=this.readByte())):u===0?(f=h,h=this.readUint8(),r.writeByte(f)):(f=h,h=this.readUint8(),r.writeByte(f<<u&tableLeft[u]|h>>d)),v&&(c+=s||0,r.skip(a),u=c%8,d=8-u)}}t>n&&(r.reset(),r.skip(l-1),r.writeUint8(0))}writeColorTable(){this.encoded.writeUint32(0).writeUint32(16777215)}writeBitmapFileHeader(r){this.encoded.writeChars("BM").writeInt32(this.encoded.lastWrittenByte).writeUint16(0).writeUint16(0).writeUint32(r)}writeBitmapV5Header(){const t=Math.floor((this.bitDepth*this.width+31)/32)*4*this.height;this.encoded.writeUint32(124).writeInt32(this.width).writeInt32(this.height).writeUint16(1).writeUint16(this.bitDepth).writeUint32(constants$3.BITMAPV5HEADER.Compression.BI_RGB).writeUint32(t).writeInt32(0).writeInt32(0).writeUint32(Math.pow(2,this.bitDepth)).writeUint32(Math.pow(2,this.bitDepth)).writeUint32(4278190080).writeUint32(16711680).writeUint32(65280).writeUint32(255).writeUint32(constants$3.BITMAPV5HEADER.LogicalColorSpace.LCS_sRGB).skip(36).skip(12).writeUint32(constants$3.BITMAPV5HEADER.GamutMappingIntent.LCS_GM_IMAGES).skip(12)}}var BMPEncoder_1=BMPEncoder;const Encoder=BMPEncoder_1;var encode$2=function(r){return new Encoder(r).encode()};/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const Z_FIXED$1=4,Z_BINARY=0,Z_TEXT=1,Z_UNKNOWN$1=2;function zero$1(e){let r=e.length;for(;--r>=0;)e[r]=0}const STORED_BLOCK=0,STATIC_TREES=1,DYN_TREES=2,MIN_MATCH$1=3,MAX_MATCH$1=258,LENGTH_CODES$1=29,LITERALS$1=256,L_CODES$1=LITERALS$1+1+LENGTH_CODES$1,D_CODES$1=30,BL_CODES$1=19,HEAP_SIZE$1=2*L_CODES$1+1,MAX_BITS$1=15,Buf_size=16,MAX_BL_BITS=7,END_BLOCK=256,REP_3_6=16,REPZ_3_10=17,REPZ_11_138=18,extra_lbits=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),extra_dbits=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),extra_blbits=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),bl_order=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),DIST_CODE_LEN=512,static_ltree=new Array((L_CODES$1+2)*2);zero$1(static_ltree);const static_dtree=new Array(D_CODES$1*2);zero$1(static_dtree);const _dist_code=new Array(DIST_CODE_LEN);zero$1(_dist_code);const _length_code=new Array(MAX_MATCH$1-MIN_MATCH$1+1);zero$1(_length_code);const base_length=new Array(LENGTH_CODES$1);zero$1(base_length);const base_dist=new Array(D_CODES$1);zero$1(base_dist);function StaticTreeDesc(e,r,t,n,a){this.static_tree=e,this.extra_bits=r,this.extra_base=t,this.elems=n,this.max_length=a,this.has_stree=e&&e.length}let static_l_desc,static_d_desc,static_bl_desc;function TreeDesc(e,r){this.dyn_tree=e,this.max_code=0,this.stat_desc=r}const d_code=e=>e<256?_dist_code[e]:_dist_code[256+(e>>>7)],put_short=(e,r)=>{e.pending_buf[e.pending++]=r&255,e.pending_buf[e.pending++]=r>>>8&255},send_bits=(e,r,t)=>{e.bi_valid>Buf_size-t?(e.bi_buf|=r<<e.bi_valid&65535,put_short(e,e.bi_buf),e.bi_buf=r>>Buf_size-e.bi_valid,e.bi_valid+=t-Buf_size):(e.bi_buf|=r<<e.bi_valid&65535,e.bi_valid+=t)},send_code=(e,r,t)=>{send_bits(e,t[r*2],t[r*2+1])},bi_reverse=(e,r)=>{let t=0;do t|=e&1,e>>>=1,t<<=1;while(--r>0);return t>>>1},bi_flush=e=>{e.bi_valid===16?(put_short(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=e.bi_buf&255,e.bi_buf>>=8,e.bi_valid-=8)},gen_bitlen=(e,r)=>{const t=r.dyn_tree,n=r.max_code,a=r.stat_desc.static_tree,s=r.stat_desc.has_stree,o=r.stat_desc.extra_bits,l=r.stat_desc.extra_base,f=r.stat_desc.max_length;let h,c,u,d,g,m,w=0;for(d=0;d<=MAX_BITS$1;d++)e.bl_count[d]=0;for(t[e.heap[e.heap_max]*2+1]=0,h=e.heap_max+1;h<HEAP_SIZE$1;h++)c=e.heap[h],d=t[t[c*2+1]*2+1]+1,d>f&&(d=f,w++),t[c*2+1]=d,!(c>n)&&(e.bl_count[d]++,g=0,c>=l&&(g=o[c-l]),m=t[c*2],e.opt_len+=m*(d+g),s&&(e.static_len+=m*(a[c*2+1]+g)));if(w!==0){do{for(d=f-1;e.bl_count[d]===0;)d--;e.bl_count[d]--,e.bl_count[d+1]+=2,e.bl_count[f]--,w-=2}while(w>0);for(d=f;d!==0;d--)for(c=e.bl_count[d];c!==0;)u=e.heap[--h],!(u>n)&&(t[u*2+1]!==d&&(e.opt_len+=(d-t[u*2+1])*t[u*2],t[u*2+1]=d),c--)}},gen_codes=(e,r,t)=>{const n=new Array(MAX_BITS$1+1);let a=0,s,o;for(s=1;s<=MAX_BITS$1;s++)a=a+t[s-1]<<1,n[s]=a;for(o=0;o<=r;o++){let l=e[o*2+1];l!==0&&(e[o*2]=bi_reverse(n[l]++,l))}},tr_static_init=()=>{let e,r,t,n,a;const s=new Array(MAX_BITS$1+1);for(t=0,n=0;n<LENGTH_CODES$1-1;n++)for(base_length[n]=t,e=0;e<1<<extra_lbits[n];e++)_length_code[t++]=n;for(_length_code[t-1]=n,a=0,n=0;n<16;n++)for(base_dist[n]=a,e=0;e<1<<extra_dbits[n];e++)_dist_code[a++]=n;for(a>>=7;n<D_CODES$1;n++)for(base_dist[n]=a<<7,e=0;e<1<<extra_dbits[n]-7;e++)_dist_code[256+a++]=n;for(r=0;r<=MAX_BITS$1;r++)s[r]=0;for(e=0;e<=143;)static_ltree[e*2+1]=8,e++,s[8]++;for(;e<=255;)static_ltree[e*2+1]=9,e++,s[9]++;for(;e<=279;)static_ltree[e*2+1]=7,e++,s[7]++;for(;e<=287;)static_ltree[e*2+1]=8,e++,s[8]++;for(gen_codes(static_ltree,L_CODES$1+1,s),e=0;e<D_CODES$1;e++)static_dtree[e*2+1]=5,static_dtree[e*2]=bi_reverse(e,5);static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS$1+1,L_CODES$1,MAX_BITS$1),static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES$1,MAX_BITS$1),static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES$1,MAX_BL_BITS)},init_block=e=>{let r;for(r=0;r<L_CODES$1;r++)e.dyn_ltree[r*2]=0;for(r=0;r<D_CODES$1;r++)e.dyn_dtree[r*2]=0;for(r=0;r<BL_CODES$1;r++)e.bl_tree[r*2]=0;e.dyn_ltree[END_BLOCK*2]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},bi_windup=e=>{e.bi_valid>8?put_short(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},smaller=(e,r,t,n)=>{const a=r*2,s=t*2;return e[a]<e[s]||e[a]===e[s]&&n[r]<=n[t]},pqdownheap=(e,r,t)=>{const n=e.heap[t];let a=t<<1;for(;a<=e.heap_len&&(a<e.heap_len&&smaller(r,e.heap[a+1],e.heap[a],e.depth)&&a++,!smaller(r,n,e.heap[a],e.depth));)e.heap[t]=e.heap[a],t=a,a<<=1;e.heap[t]=n},compress_block=(e,r,t)=>{let n,a,s=0,o,l;if(e.sym_next!==0)do n=e.pending_buf[e.sym_buf+s++]&255,n+=(e.pending_buf[e.sym_buf+s++]&255)<<8,a=e.pending_buf[e.sym_buf+s++],n===0?send_code(e,a,r):(o=_length_code[a],send_code(e,o+LITERALS$1+1,r),l=extra_lbits[o],l!==0&&(a-=base_length[o],send_bits(e,a,l)),n--,o=d_code(n),send_code(e,o,t),l=extra_dbits[o],l!==0&&(n-=base_dist[o],send_bits(e,n,l)));while(s<e.sym_next);send_code(e,END_BLOCK,r)},build_tree=(e,r)=>{const t=r.dyn_tree,n=r.stat_desc.static_tree,a=r.stat_desc.has_stree,s=r.stat_desc.elems;let o,l,f=-1,h;for(e.heap_len=0,e.heap_max=HEAP_SIZE$1,o=0;o<s;o++)t[o*2]!==0?(e.heap[++e.heap_len]=f=o,e.depth[o]=0):t[o*2+1]=0;for(;e.heap_len<2;)h=e.heap[++e.heap_len]=f<2?++f:0,t[h*2]=1,e.depth[h]=0,e.opt_len--,a&&(e.static_len-=n[h*2+1]);for(r.max_code=f,o=e.heap_len>>1;o>=1;o--)pqdownheap(e,t,o);h=s;do o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],pqdownheap(e,t,1),l=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=l,t[h*2]=t[o*2]+t[l*2],e.depth[h]=(e.depth[o]>=e.depth[l]?e.depth[o]:e.depth[l])+1,t[o*2+1]=t[l*2+1]=h,e.heap[1]=h++,pqdownheap(e,t,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],gen_bitlen(e,r),gen_codes(t,f,e.bl_count)},scan_tree=(e,r,t)=>{let n,a=-1,s,o=r[0*2+1],l=0,f=7,h=4;for(o===0&&(f=138,h=3),r[(t+1)*2+1]=65535,n=0;n<=t;n++)s=o,o=r[(n+1)*2+1],!(++l<f&&s===o)&&(l<h?e.bl_tree[s*2]+=l:s!==0?(s!==a&&e.bl_tree[s*2]++,e.bl_tree[REP_3_6*2]++):l<=10?e.bl_tree[REPZ_3_10*2]++:e.bl_tree[REPZ_11_138*2]++,l=0,a=s,o===0?(f=138,h=3):s===o?(f=6,h=3):(f=7,h=4))},send_tree=(e,r,t)=>{let n,a=-1,s,o=r[0*2+1],l=0,f=7,h=4;for(o===0&&(f=138,h=3),n=0;n<=t;n++)if(s=o,o=r[(n+1)*2+1],!(++l<f&&s===o)){if(l<h)do send_code(e,s,e.bl_tree);while(--l!==0);else s!==0?(s!==a&&(send_code(e,s,e.bl_tree),l--),send_code(e,REP_3_6,e.bl_tree),send_bits(e,l-3,2)):l<=10?(send_code(e,REPZ_3_10,e.bl_tree),send_bits(e,l-3,3)):(send_code(e,REPZ_11_138,e.bl_tree),send_bits(e,l-11,7));l=0,a=s,o===0?(f=138,h=3):s===o?(f=6,h=3):(f=7,h=4)}},build_bl_tree=e=>{let r;for(scan_tree(e,e.dyn_ltree,e.l_desc.max_code),scan_tree(e,e.dyn_dtree,e.d_desc.max_code),build_tree(e,e.bl_desc),r=BL_CODES$1-1;r>=3&&e.bl_tree[bl_order[r]*2+1]===0;r--);return e.opt_len+=3*(r+1)+5+5+4,r},send_all_trees=(e,r,t,n)=>{let a;for(send_bits(e,r-257,5),send_bits(e,t-1,5),send_bits(e,n-4,4),a=0;a<n;a++)send_bits(e,e.bl_tree[bl_order[a]*2+1],3);send_tree(e,e.dyn_ltree,r-1),send_tree(e,e.dyn_dtree,t-1)},detect_data_type=e=>{let r=4093624447,t;for(t=0;t<=31;t++,r>>>=1)if(r&1&&e.dyn_ltree[t*2]!==0)return Z_BINARY;if(e.dyn_ltree[9*2]!==0||e.dyn_ltree[10*2]!==0||e.dyn_ltree[13*2]!==0)return Z_TEXT;for(t=32;t<LITERALS$1;t++)if(e.dyn_ltree[t*2]!==0)return Z_TEXT;return Z_BINARY};let static_init_done=!1;const _tr_init$1=e=>{static_init_done||(tr_static_init(),static_init_done=!0),e.l_desc=new TreeDesc(e.dyn_ltree,static_l_desc),e.d_desc=new TreeDesc(e.dyn_dtree,static_d_desc),e.bl_desc=new TreeDesc(e.bl_tree,static_bl_desc),e.bi_buf=0,e.bi_valid=0,init_block(e)},_tr_stored_block$1=(e,r,t,n)=>{send_bits(e,(STORED_BLOCK<<1)+(n?1:0),3),bi_windup(e),put_short(e,t),put_short(e,~t),t&&e.pending_buf.set(e.window.subarray(r,r+t),e.pending),e.pending+=t},_tr_align$1=e=>{send_bits(e,STATIC_TREES<<1,3),send_code(e,END_BLOCK,static_ltree),bi_flush(e)},_tr_flush_block$1=(e,r,t,n)=>{let a,s,o=0;e.level>0?(e.strm.data_type===Z_UNKNOWN$1&&(e.strm.data_type=detect_data_type(e)),build_tree(e,e.l_desc),build_tree(e,e.d_desc),o=build_bl_tree(e),a=e.opt_len+3+7>>>3,s=e.static_len+3+7>>>3,s<=a&&(a=s)):a=s=t+5,t+4<=a&&r!==-1?_tr_stored_block$1(e,r,t,n):e.strategy===Z_FIXED$1||s===a?(send_bits(e,(STATIC_TREES<<1)+(n?1:0),3),compress_block(e,static_ltree,static_dtree)):(send_bits(e,(DYN_TREES<<1)+(n?1:0),3),send_all_trees(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),compress_block(e,e.dyn_ltree,e.dyn_dtree)),init_block(e),n&&bi_windup(e)},_tr_tally$1=(e,r,t)=>(e.pending_buf[e.sym_buf+e.sym_next++]=r,e.pending_buf[e.sym_buf+e.sym_next++]=r>>8,e.pending_buf[e.sym_buf+e.sym_next++]=t,r===0?e.dyn_ltree[t*2]++:(e.matches++,r--,e.dyn_ltree[(_length_code[t]+LITERALS$1+1)*2]++,e.dyn_dtree[d_code(r)*2]++),e.sym_next===e.sym_end);var _tr_init_1=_tr_init$1,_tr_stored_block_1=_tr_stored_block$1,_tr_flush_block_1=_tr_flush_block$1,_tr_tally_1=_tr_tally$1,_tr_align_1=_tr_align$1,trees={_tr_init:_tr_init_1,_tr_stored_block:_tr_stored_block_1,_tr_flush_block:_tr_flush_block_1,_tr_tally:_tr_tally_1,_tr_align:_tr_align_1};const adler32=(e,r,t,n)=>{let a=e&65535|0,s=e>>>16&65535|0,o=0;for(;t!==0;){o=t>2e3?2e3:t,t-=o;do a=a+r[n++]|0,s=s+a|0;while(--o);a%=65521,s%=65521}return a|s<<16|0};var adler32_1=adler32;const makeTable=()=>{let e,r=[];for(var t=0;t<256;t++){e=t;for(var n=0;n<8;n++)e=e&1?3988292384^e>>>1:e>>>1;r[t]=e}return r},crcTable$1=new Uint32Array(makeTable()),crc32=(e,r,t,n)=>{const a=crcTable$1,s=n+t;e^=-1;for(let o=n;o<s;o++)e=e>>>8^a[(e^r[o])&255];return e^-1};var crc32_1=crc32,messages={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},constants$2={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init,_tr_stored_block,_tr_flush_block,_tr_tally,_tr_align}=trees,{Z_NO_FLUSH:Z_NO_FLUSH$2,Z_PARTIAL_FLUSH,Z_FULL_FLUSH:Z_FULL_FLUSH$1,Z_FINISH:Z_FINISH$3,Z_BLOCK:Z_BLOCK$1,Z_OK:Z_OK$3,Z_STREAM_END:Z_STREAM_END$3,Z_STREAM_ERROR:Z_STREAM_ERROR$2,Z_DATA_ERROR:Z_DATA_ERROR$2,Z_BUF_ERROR:Z_BUF_ERROR$1,Z_DEFAULT_COMPRESSION:Z_DEFAULT_COMPRESSION$1,Z_FILTERED,Z_HUFFMAN_ONLY,Z_RLE,Z_FIXED,Z_DEFAULT_STRATEGY:Z_DEFAULT_STRATEGY$1,Z_UNKNOWN,Z_DEFLATED:Z_DEFLATED$2}=constants$2,MAX_MEM_LEVEL=9,MAX_WBITS$1=15,DEF_MEM_LEVEL=8,LENGTH_CODES=29,LITERALS=256,L_CODES=LITERALS+1+LENGTH_CODES,D_CODES=30,BL_CODES=19,HEAP_SIZE=2*L_CODES+1,MAX_BITS=15,MIN_MATCH=3,MAX_MATCH=258,MIN_LOOKAHEAD=MAX_MATCH+MIN_MATCH+1,PRESET_DICT=32,INIT_STATE=42,GZIP_STATE=57,EXTRA_STATE=69,NAME_STATE=73,COMMENT_STATE=91,HCRC_STATE=103,BUSY_STATE=113,FINISH_STATE=666,BS_NEED_MORE=1,BS_BLOCK_DONE=2,BS_FINISH_STARTED=3,BS_FINISH_DONE=4,OS_CODE=3,err=(e,r)=>(e.msg=messages[r],r),rank=e=>e*2-(e>4?9:0),zero=e=>{let r=e.length;for(;--r>=0;)e[r]=0},slide_hash=e=>{let r,t,n,a=e.w_size;r=e.hash_size,n=r;do t=e.head[--n],e.head[n]=t>=a?t-a:0;while(--r);r=a,n=r;do t=e.prev[--n],e.prev[n]=t>=a?t-a:0;while(--r)};let HASH_ZLIB=(e,r,t)=>(r<<e.hash_shift^t)&e.hash_mask,HASH=HASH_ZLIB;const flush_pending=e=>{const r=e.state;let t=r.pending;t>e.avail_out&&(t=e.avail_out),t!==0&&(e.output.set(r.pending_buf.subarray(r.pending_out,r.pending_out+t),e.next_out),e.next_out+=t,r.pending_out+=t,e.total_out+=t,e.avail_out-=t,r.pending-=t,r.pending===0&&(r.pending_out=0))},flush_block_only=(e,r)=>{_tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,r),e.block_start=e.strstart,flush_pending(e.strm)},put_byte=(e,r)=>{e.pending_buf[e.pending++]=r},putShortMSB=(e,r)=>{e.pending_buf[e.pending++]=r>>>8&255,e.pending_buf[e.pending++]=r&255},read_buf=(e,r,t,n)=>{let a=e.avail_in;return a>n&&(a=n),a===0?0:(e.avail_in-=a,r.set(e.input.subarray(e.next_in,e.next_in+a),t),e.state.wrap===1?e.adler=adler32_1(e.adler,r,a,t):e.state.wrap===2&&(e.adler=crc32_1(e.adler,r,a,t)),e.next_in+=a,e.total_in+=a,a)},longest_match=(e,r)=>{let t=e.max_chain_length,n=e.strstart,a,s,o=e.prev_length,l=e.nice_match;const f=e.strstart>e.w_size-MIN_LOOKAHEAD?e.strstart-(e.w_size-MIN_LOOKAHEAD):0,h=e.window,c=e.w_mask,u=e.prev,d=e.strstart+MAX_MATCH;let g=h[n+o-1],m=h[n+o];e.prev_length>=e.good_match&&(t>>=2),l>e.lookahead&&(l=e.lookahead);do if(a=r,!(h[a+o]!==m||h[a+o-1]!==g||h[a]!==h[n]||h[++a]!==h[n+1])){n+=2,a++;do;while(h[++n]===h[++a]&&h[++n]===h[++a]&&h[++n]===h[++a]&&h[++n]===h[++a]&&h[++n]===h[++a]&&h[++n]===h[++a]&&h[++n]===h[++a]&&h[++n]===h[++a]&&n<d);if(s=MAX_MATCH-(d-n),n=d-MAX_MATCH,s>o){if(e.match_start=r,o=s,s>=l)break;g=h[n+o-1],m=h[n+o]}}while((r=u[r&c])>f&&--t!==0);return o<=e.lookahead?o:e.lookahead},fill_window=e=>{const r=e.w_size;let t,n,a;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=r+(r-MIN_LOOKAHEAD)&&(e.window.set(e.window.subarray(r,r+r-n),0),e.match_start-=r,e.strstart-=r,e.block_start-=r,e.insert>e.strstart&&(e.insert=e.strstart),slide_hash(e),n+=r),e.strm.avail_in===0)break;if(t=read_buf(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=t,e.lookahead+e.insert>=MIN_MATCH)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=HASH(e,e.ins_h,e.window[a+1]);e.insert&&(e.ins_h=HASH(e,e.ins_h,e.window[a+MIN_MATCH-1]),e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<MIN_MATCH)););}while(e.lookahead<MIN_LOOKAHEAD&&e.strm.avail_in!==0)},deflate_stored=(e,r)=>{let t=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,n,a,s,o=0,l=e.strm.avail_in;do{if(n=65535,s=e.bi_valid+42>>3,e.strm.avail_out<s||(s=e.strm.avail_out-s,a=e.strstart-e.block_start,n>a+e.strm.avail_in&&(n=a+e.strm.avail_in),n>s&&(n=s),n<t&&(n===0&&r!==Z_FINISH$3||r===Z_NO_FLUSH$2||n!==a+e.strm.avail_in)))break;o=r===Z_FINISH$3&&n===a+e.strm.avail_in?1:0,_tr_stored_block(e,0,0,o),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,flush_pending(e.strm),a&&(a>n&&(a=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+a),e.strm.next_out),e.strm.next_out+=a,e.strm.avail_out-=a,e.strm.total_out+=a,e.block_start+=a,n-=a),n&&(read_buf(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(o===0);return l-=e.strm.avail_in,l&&(l>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=l&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-l,e.strm.next_in),e.strstart),e.strstart+=l,e.insert+=l>e.w_size-e.insert?e.w_size-e.insert:l),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),o?BS_FINISH_DONE:r!==Z_NO_FLUSH$2&&r!==Z_FINISH$3&&e.strm.avail_in===0&&e.strstart===e.block_start?BS_BLOCK_DONE:(s=e.window_size-e.strstart,e.strm.avail_in>s&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,s+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),s>e.strm.avail_in&&(s=e.strm.avail_in),s&&(read_buf(e.strm,e.window,e.strstart,s),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.high_water<e.strstart&&(e.high_water=e.strstart),s=e.bi_valid+42>>3,s=e.pending_buf_size-s>65535?65535:e.pending_buf_size-s,t=s>e.w_size?e.w_size:s,a=e.strstart-e.block_start,(a>=t||(a||r===Z_FINISH$3)&&r!==Z_NO_FLUSH$2&&e.strm.avail_in===0&&a<=s)&&(n=a>s?s:a,o=r===Z_FINISH$3&&e.strm.avail_in===0&&n===a?1:0,_tr_stored_block(e,e.block_start,n,o),e.block_start+=n,flush_pending(e.strm)),o?BS_FINISH_STARTED:BS_NEED_MORE)},deflate_fast=(e,r)=>{let t,n;for(;;){if(e.lookahead<MIN_LOOKAHEAD){if(fill_window(e),e.lookahead<MIN_LOOKAHEAD&&r===Z_NO_FLUSH$2)return BS_NEED_MORE;if(e.lookahead===0)break}if(t=0,e.lookahead>=MIN_MATCH&&(e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+MIN_MATCH-1]),t=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),t!==0&&e.strstart-t<=e.w_size-MIN_LOOKAHEAD&&(e.match_length=longest_match(e,t)),e.match_length>=MIN_MATCH)if(n=_tr_tally(e,e.strstart-e.match_start,e.match_length-MIN_MATCH),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=MIN_MATCH){e.match_length--;do e.strstart++,e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+MIN_MATCH-1]),t=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!==0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+1]);else n=_tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(flush_block_only(e,!1),e.strm.avail_out===0))return BS_NEED_MORE}return e.insert=e.strstart<MIN_MATCH-1?e.strstart:MIN_MATCH-1,r===Z_FINISH$3?(flush_block_only(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):e.sym_next&&(flush_block_only(e,!1),e.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_slow=(e,r)=>{let t,n,a;for(;;){if(e.lookahead<MIN_LOOKAHEAD){if(fill_window(e),e.lookahead<MIN_LOOKAHEAD&&r===Z_NO_FLUSH$2)return BS_NEED_MORE;if(e.lookahead===0)break}if(t=0,e.lookahead>=MIN_MATCH&&(e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+MIN_MATCH-1]),t=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=MIN_MATCH-1,t!==0&&e.prev_length<e.max_lazy_match&&e.strstart-t<=e.w_size-MIN_LOOKAHEAD&&(e.match_length=longest_match(e,t),e.match_length<=5&&(e.strategy===Z_FILTERED||e.match_length===MIN_MATCH&&e.strstart-e.match_start>4096)&&(e.match_length=MIN_MATCH-1)),e.prev_length>=MIN_MATCH&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-MIN_MATCH,n=_tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-MIN_MATCH),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=a&&(e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+MIN_MATCH-1]),t=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!==0);if(e.match_available=0,e.match_length=MIN_MATCH-1,e.strstart++,n&&(flush_block_only(e,!1),e.strm.avail_out===0))return BS_NEED_MORE}else if(e.match_available){if(n=_tr_tally(e,0,e.window[e.strstart-1]),n&&flush_block_only(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return BS_NEED_MORE}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=_tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<MIN_MATCH-1?e.strstart:MIN_MATCH-1,r===Z_FINISH$3?(flush_block_only(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):e.sym_next&&(flush_block_only(e,!1),e.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_rle=(e,r)=>{let t,n,a,s;const o=e.window;for(;;){if(e.lookahead<=MAX_MATCH){if(fill_window(e),e.lookahead<=MAX_MATCH&&r===Z_NO_FLUSH$2)return BS_NEED_MORE;if(e.lookahead===0)break}if(e.match_length=0,e.lookahead>=MIN_MATCH&&e.strstart>0&&(a=e.strstart-1,n=o[a],n===o[++a]&&n===o[++a]&&n===o[++a])){s=e.strstart+MAX_MATCH;do;while(n===o[++a]&&n===o[++a]&&n===o[++a]&&n===o[++a]&&n===o[++a]&&n===o[++a]&&n===o[++a]&&n===o[++a]&&a<s);e.match_length=MAX_MATCH-(s-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=MIN_MATCH?(t=_tr_tally(e,1,e.match_length-MIN_MATCH),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(t=_tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),t&&(flush_block_only(e,!1),e.strm.avail_out===0))return BS_NEED_MORE}return e.insert=0,r===Z_FINISH$3?(flush_block_only(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):e.sym_next&&(flush_block_only(e,!1),e.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_huff=(e,r)=>{let t;for(;;){if(e.lookahead===0&&(fill_window(e),e.lookahead===0)){if(r===Z_NO_FLUSH$2)return BS_NEED_MORE;break}if(e.match_length=0,t=_tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,t&&(flush_block_only(e,!1),e.strm.avail_out===0))return BS_NEED_MORE}return e.insert=0,r===Z_FINISH$3?(flush_block_only(e,!0),e.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):e.sym_next&&(flush_block_only(e,!1),e.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE};function Config(e,r,t,n,a){this.good_length=e,this.max_lazy=r,this.nice_length=t,this.max_chain=n,this.func=a}const configuration_table=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)],lm_init=e=>{e.window_size=2*e.w_size,zero(e.head),e.max_lazy_match=configuration_table[e.level].max_lazy,e.good_match=configuration_table[e.level].good_length,e.nice_match=configuration_table[e.level].nice_length,e.max_chain_length=configuration_table[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=MIN_MATCH-1,e.match_available=0,e.ins_h=0};function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z_DEFLATED$2,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(HEAP_SIZE*2),this.dyn_dtree=new Uint16Array((2*D_CODES+1)*2),this.bl_tree=new Uint16Array((2*BL_CODES+1)*2),zero(this.dyn_ltree),zero(this.dyn_dtree),zero(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(MAX_BITS+1),this.heap=new Uint16Array(2*L_CODES+1),zero(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*L_CODES+1),zero(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const deflateStateCheck=e=>{if(!e)return 1;const r=e.state;return!r||r.strm!==e||r.status!==INIT_STATE&&r.status!==GZIP_STATE&&r.status!==EXTRA_STATE&&r.status!==NAME_STATE&&r.status!==COMMENT_STATE&&r.status!==HCRC_STATE&&r.status!==BUSY_STATE&&r.status!==FINISH_STATE?1:0},deflateResetKeep=e=>{if(deflateStateCheck(e))return err(e,Z_STREAM_ERROR$2);e.total_in=e.total_out=0,e.data_type=Z_UNKNOWN;const r=e.state;return r.pending=0,r.pending_out=0,r.wrap<0&&(r.wrap=-r.wrap),r.status=r.wrap===2?GZIP_STATE:r.wrap?INIT_STATE:BUSY_STATE,e.adler=r.wrap===2?0:1,r.last_flush=-2,_tr_init(r),Z_OK$3},deflateReset=e=>{const r=deflateResetKeep(e);return r===Z_OK$3&&lm_init(e.state),r},deflateSetHeader=(e,r)=>deflateStateCheck(e)||e.state.wrap!==2?Z_STREAM_ERROR$2:(e.state.gzhead=r,Z_OK$3),deflateInit2=(e,r,t,n,a,s)=>{if(!e)return Z_STREAM_ERROR$2;let o=1;if(r===Z_DEFAULT_COMPRESSION$1&&(r=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),a<1||a>MAX_MEM_LEVEL||t!==Z_DEFLATED$2||n<8||n>15||r<0||r>9||s<0||s>Z_FIXED||n===8&&o!==1)return err(e,Z_STREAM_ERROR$2);n===8&&(n=9);const l=new DeflateState;return e.state=l,l.strm=e,l.status=INIT_STATE,l.wrap=o,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+MIN_MATCH-1)/MIN_MATCH),l.window=new Uint8Array(l.w_size*2),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=l.lit_bufsize*4,l.pending_buf=new Uint8Array(l.pending_buf_size),l.sym_buf=l.lit_bufsize,l.sym_end=(l.lit_bufsize-1)*3,l.level=r,l.strategy=s,l.method=t,deflateReset(e)},deflateInit=(e,r)=>deflateInit2(e,r,Z_DEFLATED$2,MAX_WBITS$1,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY$1),deflate$2=(e,r)=>{if(deflateStateCheck(e)||r>Z_BLOCK$1||r<0)return e?err(e,Z_STREAM_ERROR$2):Z_STREAM_ERROR$2;const t=e.state;if(!e.output||e.avail_in!==0&&!e.input||t.status===FINISH_STATE&&r!==Z_FINISH$3)return err(e,e.avail_out===0?Z_BUF_ERROR$1:Z_STREAM_ERROR$2);const n=t.last_flush;if(t.last_flush=r,t.pending!==0){if(flush_pending(e),e.avail_out===0)return t.last_flush=-1,Z_OK$3}else if(e.avail_in===0&&rank(r)<=rank(n)&&r!==Z_FINISH$3)return err(e,Z_BUF_ERROR$1);if(t.status===FINISH_STATE&&e.avail_in!==0)return err(e,Z_BUF_ERROR$1);if(t.status===INIT_STATE&&t.wrap===0&&(t.status=BUSY_STATE),t.status===INIT_STATE){let a=Z_DEFLATED$2+(t.w_bits-8<<4)<<8,s=-1;if(t.strategy>=Z_HUFFMAN_ONLY||t.level<2?s=0:t.level<6?s=1:t.level===6?s=2:s=3,a|=s<<6,t.strstart!==0&&(a|=PRESET_DICT),a+=31-a%31,putShortMSB(t,a),t.strstart!==0&&(putShortMSB(t,e.adler>>>16),putShortMSB(t,e.adler&65535)),e.adler=1,t.status=BUSY_STATE,flush_pending(e),t.pending!==0)return t.last_flush=-1,Z_OK$3}if(t.status===GZIP_STATE){if(e.adler=0,put_byte(t,31),put_byte(t,139),put_byte(t,8),t.gzhead)put_byte(t,(t.gzhead.text?1:0)+(t.gzhead.hcrc?2:0)+(t.gzhead.extra?4:0)+(t.gzhead.name?8:0)+(t.gzhead.comment?16:0)),put_byte(t,t.gzhead.time&255),put_byte(t,t.gzhead.time>>8&255),put_byte(t,t.gzhead.time>>16&255),put_byte(t,t.gzhead.time>>24&255),put_byte(t,t.level===9?2:t.strategy>=Z_HUFFMAN_ONLY||t.level<2?4:0),put_byte(t,t.gzhead.os&255),t.gzhead.extra&&t.gzhead.extra.length&&(put_byte(t,t.gzhead.extra.length&255),put_byte(t,t.gzhead.extra.length>>8&255)),t.gzhead.hcrc&&(e.adler=crc32_1(e.adler,t.pending_buf,t.pending,0)),t.gzindex=0,t.status=EXTRA_STATE;else if(put_byte(t,0),put_byte(t,0),put_byte(t,0),put_byte(t,0),put_byte(t,0),put_byte(t,t.level===9?2:t.strategy>=Z_HUFFMAN_ONLY||t.level<2?4:0),put_byte(t,OS_CODE),t.status=BUSY_STATE,flush_pending(e),t.pending!==0)return t.last_flush=-1,Z_OK$3}if(t.status===EXTRA_STATE){if(t.gzhead.extra){let a=t.pending,s=(t.gzhead.extra.length&65535)-t.gzindex;for(;t.pending+s>t.pending_buf_size;){let l=t.pending_buf_size-t.pending;if(t.pending_buf.set(t.gzhead.extra.subarray(t.gzindex,t.gzindex+l),t.pending),t.pending=t.pending_buf_size,t.gzhead.hcrc&&t.pending>a&&(e.adler=crc32_1(e.adler,t.pending_buf,t.pending-a,a)),t.gzindex+=l,flush_pending(e),t.pending!==0)return t.last_flush=-1,Z_OK$3;a=0,s-=l}let o=new Uint8Array(t.gzhead.extra);t.pending_buf.set(o.subarray(t.gzindex,t.gzindex+s),t.pending),t.pending+=s,t.gzhead.hcrc&&t.pending>a&&(e.adler=crc32_1(e.adler,t.pending_buf,t.pending-a,a)),t.gzindex=0}t.status=NAME_STATE}if(t.status===NAME_STATE){if(t.gzhead.name){let a=t.pending,s;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>a&&(e.adler=crc32_1(e.adler,t.pending_buf,t.pending-a,a)),flush_pending(e),t.pending!==0)return t.last_flush=-1,Z_OK$3;a=0}t.gzindex<t.gzhead.name.length?s=t.gzhead.name.charCodeAt(t.gzindex++)&255:s=0,put_byte(t,s)}while(s!==0);t.gzhead.hcrc&&t.pending>a&&(e.adler=crc32_1(e.adler,t.pending_buf,t.pending-a,a)),t.gzindex=0}t.status=COMMENT_STATE}if(t.status===COMMENT_STATE){if(t.gzhead.comment){let a=t.pending,s;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>a&&(e.adler=crc32_1(e.adler,t.pending_buf,t.pending-a,a)),flush_pending(e),t.pending!==0)return t.last_flush=-1,Z_OK$3;a=0}t.gzindex<t.gzhead.comment.length?s=t.gzhead.comment.charCodeAt(t.gzindex++)&255:s=0,put_byte(t,s)}while(s!==0);t.gzhead.hcrc&&t.pending>a&&(e.adler=crc32_1(e.adler,t.pending_buf,t.pending-a,a))}t.status=HCRC_STATE}if(t.status===HCRC_STATE){if(t.gzhead.hcrc){if(t.pending+2>t.pending_buf_size&&(flush_pending(e),t.pending!==0))return t.last_flush=-1,Z_OK$3;put_byte(t,e.adler&255),put_byte(t,e.adler>>8&255),e.adler=0}if(t.status=BUSY_STATE,flush_pending(e),t.pending!==0)return t.last_flush=-1,Z_OK$3}if(e.avail_in!==0||t.lookahead!==0||r!==Z_NO_FLUSH$2&&t.status!==FINISH_STATE){let a=t.level===0?deflate_stored(t,r):t.strategy===Z_HUFFMAN_ONLY?deflate_huff(t,r):t.strategy===Z_RLE?deflate_rle(t,r):configuration_table[t.level].func(t,r);if((a===BS_FINISH_STARTED||a===BS_FINISH_DONE)&&(t.status=FINISH_STATE),a===BS_NEED_MORE||a===BS_FINISH_STARTED)return e.avail_out===0&&(t.last_flush=-1),Z_OK$3;if(a===BS_BLOCK_DONE&&(r===Z_PARTIAL_FLUSH?_tr_align(t):r!==Z_BLOCK$1&&(_tr_stored_block(t,0,0,!1),r===Z_FULL_FLUSH$1&&(zero(t.head),t.lookahead===0&&(t.strstart=0,t.block_start=0,t.insert=0))),flush_pending(e),e.avail_out===0))return t.last_flush=-1,Z_OK$3}return r!==Z_FINISH$3?Z_OK$3:t.wrap<=0?Z_STREAM_END$3:(t.wrap===2?(put_byte(t,e.adler&255),put_byte(t,e.adler>>8&255),put_byte(t,e.adler>>16&255),put_byte(t,e.adler>>24&255),put_byte(t,e.total_in&255),put_byte(t,e.total_in>>8&255),put_byte(t,e.total_in>>16&255),put_byte(t,e.total_in>>24&255)):(putShortMSB(t,e.adler>>>16),putShortMSB(t,e.adler&65535)),flush_pending(e),t.wrap>0&&(t.wrap=-t.wrap),t.pending!==0?Z_OK$3:Z_STREAM_END$3)},deflateEnd=e=>{if(deflateStateCheck(e))return Z_STREAM_ERROR$2;const r=e.state.status;return e.state=null,r===BUSY_STATE?err(e,Z_DATA_ERROR$2):Z_OK$3},deflateSetDictionary=(e,r)=>{let t=r.length;if(deflateStateCheck(e))return Z_STREAM_ERROR$2;const n=e.state,a=n.wrap;if(a===2||a===1&&n.status!==INIT_STATE||n.lookahead)return Z_STREAM_ERROR$2;if(a===1&&(e.adler=adler32_1(e.adler,r,t,0)),n.wrap=0,t>=n.w_size){a===0&&(zero(n.head),n.strstart=0,n.block_start=0,n.insert=0);let f=new Uint8Array(n.w_size);f.set(r.subarray(t-n.w_size,t),0),r=f,t=n.w_size}const s=e.avail_in,o=e.next_in,l=e.input;for(e.avail_in=t,e.next_in=0,e.input=r,fill_window(n);n.lookahead>=MIN_MATCH;){let f=n.strstart,h=n.lookahead-(MIN_MATCH-1);do n.ins_h=HASH(n,n.ins_h,n.window[f+MIN_MATCH-1]),n.prev[f&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=f,f++;while(--h);n.strstart=f,n.lookahead=MIN_MATCH-1,fill_window(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=MIN_MATCH-1,n.match_available=0,e.next_in=o,e.input=l,e.avail_in=s,n.wrap=a,Z_OK$3};var deflateInit_1=deflateInit,deflateInit2_1=deflateInit2,deflateReset_1=deflateReset,deflateResetKeep_1=deflateResetKeep,deflateSetHeader_1=deflateSetHeader,deflate_2$1=deflate$2,deflateEnd_1=deflateEnd,deflateSetDictionary_1=deflateSetDictionary,deflateInfo="pako deflate (from Nodeca project)",deflate_1$2={deflateInit:deflateInit_1,deflateInit2:deflateInit2_1,deflateReset:deflateReset_1,deflateResetKeep:deflateResetKeep_1,deflateSetHeader:deflateSetHeader_1,deflate:deflate_2$1,deflateEnd:deflateEnd_1,deflateSetDictionary:deflateSetDictionary_1,deflateInfo};const _has=(e,r)=>Object.prototype.hasOwnProperty.call(e,r);var assign=function(e){const r=Array.prototype.slice.call(arguments,1);for(;r.length;){const t=r.shift();if(!!t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(const n in t)_has(t,n)&&(e[n]=t[n])}}return e},flattenChunks=e=>{let r=0;for(let n=0,a=e.length;n<a;n++)r+=e[n].length;const t=new Uint8Array(r);for(let n=0,a=0,s=e.length;n<s;n++){let o=e[n];t.set(o,a),a+=o.length}return t},common={assign,flattenChunks};let STR_APPLY_UIA_OK=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{STR_APPLY_UIA_OK=!1}const _utf8len=new Uint8Array(256);for(let e=0;e<256;e++)_utf8len[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;_utf8len[254]=_utf8len[254]=1;var string2buf=e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let r,t,n,a,s,o=e.length,l=0;for(a=0;a<o;a++)t=e.charCodeAt(a),(t&64512)===55296&&a+1<o&&(n=e.charCodeAt(a+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),a++)),l+=t<128?1:t<2048?2:t<65536?3:4;for(r=new Uint8Array(l),s=0,a=0;s<l;a++)t=e.charCodeAt(a),(t&64512)===55296&&a+1<o&&(n=e.charCodeAt(a+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),a++)),t<128?r[s++]=t:t<2048?(r[s++]=192|t>>>6,r[s++]=128|t&63):t<65536?(r[s++]=224|t>>>12,r[s++]=128|t>>>6&63,r[s++]=128|t&63):(r[s++]=240|t>>>18,r[s++]=128|t>>>12&63,r[s++]=128|t>>>6&63,r[s++]=128|t&63);return r};const buf2binstring=(e,r)=>{if(r<65534&&e.subarray&&STR_APPLY_UIA_OK)return String.fromCharCode.apply(null,e.length===r?e:e.subarray(0,r));let t="";for(let n=0;n<r;n++)t+=String.fromCharCode(e[n]);return t};var buf2string=(e,r)=>{const t=r||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,r));let n,a;const s=new Array(t*2);for(a=0,n=0;n<t;){let o=e[n++];if(o<128){s[a++]=o;continue}let l=_utf8len[o];if(l>4){s[a++]=65533,n+=l-1;continue}for(o&=l===2?31:l===3?15:7;l>1&&n<t;)o=o<<6|e[n++]&63,l--;if(l>1){s[a++]=65533;continue}o<65536?s[a++]=o:(o-=65536,s[a++]=55296|o>>10&1023,s[a++]=56320|o&1023)}return buf2binstring(s,a)},utf8border=(e,r)=>{r=r||e.length,r>e.length&&(r=e.length);let t=r-1;for(;t>=0&&(e[t]&192)===128;)t--;return t<0||t===0?r:t+_utf8len[e[t]]>r?t:r},strings={string2buf,buf2string,utf8border};function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var zstream=ZStream;const toString$1$1=Object.prototype.toString,{Z_NO_FLUSH:Z_NO_FLUSH$1,Z_SYNC_FLUSH,Z_FULL_FLUSH,Z_FINISH:Z_FINISH$2,Z_OK:Z_OK$2,Z_STREAM_END:Z_STREAM_END$2,Z_DEFAULT_COMPRESSION,Z_DEFAULT_STRATEGY,Z_DEFLATED:Z_DEFLATED$1}=constants$2;function Deflate$1(e){this.options=common.assign({level:Z_DEFAULT_COMPRESSION,method:Z_DEFLATED$1,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z_DEFAULT_STRATEGY},e||{});let r=this.options;r.raw&&r.windowBits>0?r.windowBits=-r.windowBits:r.gzip&&r.windowBits>0&&r.windowBits<16&&(r.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;let t=deflate_1$2.deflateInit2(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(t!==Z_OK$2)throw new Error(messages[t]);if(r.header&&deflate_1$2.deflateSetHeader(this.strm,r.header),r.dictionary){let n;if(typeof r.dictionary=="string"?n=strings.string2buf(r.dictionary):toString$1$1.call(r.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(r.dictionary):n=r.dictionary,t=deflate_1$2.deflateSetDictionary(this.strm,n),t!==Z_OK$2)throw new Error(messages[t]);this._dict_set=!0}}Deflate$1.prototype.push=function(e,r){const t=this.strm,n=this.options.chunkSize;let a,s;if(this.ended)return!1;for(r===~~r?s=r:s=r===!0?Z_FINISH$2:Z_NO_FLUSH$1,typeof e=="string"?t.input=strings.string2buf(e):toString$1$1.call(e)==="[object ArrayBuffer]"?t.input=new Uint8Array(e):t.input=e,t.next_in=0,t.avail_in=t.input.length;;){if(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),(s===Z_SYNC_FLUSH||s===Z_FULL_FLUSH)&&t.avail_out<=6){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(a=deflate_1$2.deflate(t,s),a===Z_STREAM_END$2)return t.next_out>0&&this.onData(t.output.subarray(0,t.next_out)),a=deflate_1$2.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===Z_OK$2;if(t.avail_out===0){this.onData(t.output);continue}if(s>0&&t.next_out>0){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(t.avail_in===0)break}return!0};Deflate$1.prototype.onData=function(e){this.chunks.push(e)};Deflate$1.prototype.onEnd=function(e){e===Z_OK$2&&(this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function deflate$1(e,r){const t=new Deflate$1(r);if(t.push(e,!0),t.err)throw t.msg||messages[t.err];return t.result}function deflateRaw$1(e,r){return r=r||{},r.raw=!0,deflate$1(e,r)}function gzip$1(e,r){return r=r||{},r.gzip=!0,deflate$1(e,r)}var Deflate_1$1=Deflate$1,deflate_2=deflate$1,deflateRaw_1$1=deflateRaw$1,gzip_1$1=gzip$1,constants$1=constants$2,deflate_1$1={Deflate:Deflate_1$1,deflate:deflate_2,deflateRaw:deflateRaw_1$1,gzip:gzip_1$1,constants:constants$1};const BAD$1=16209,TYPE$1=16191;var inffast=function(r,t){let n,a,s,o,l,f,h,c,u,d,g,m,w,v,x,S,y,_,E,R,T,M,I,b;const k=r.state;n=r.next_in,I=r.input,a=n+(r.avail_in-5),s=r.next_out,b=r.output,o=s-(t-r.avail_out),l=s+(r.avail_out-257),f=k.dmax,h=k.wsize,c=k.whave,u=k.wnext,d=k.window,g=k.hold,m=k.bits,w=k.lencode,v=k.distcode,x=(1<<k.lenbits)-1,S=(1<<k.distbits)-1;e:do{m<15&&(g+=I[n++]<<m,m+=8,g+=I[n++]<<m,m+=8),y=w[g&x];t:for(;;){if(_=y>>>24,g>>>=_,m-=_,_=y>>>16&255,_===0)b[s++]=y&65535;else if(_&16){E=y&65535,_&=15,_&&(m<_&&(g+=I[n++]<<m,m+=8),E+=g&(1<<_)-1,g>>>=_,m-=_),m<15&&(g+=I[n++]<<m,m+=8,g+=I[n++]<<m,m+=8),y=v[g&S];r:for(;;){if(_=y>>>24,g>>>=_,m-=_,_=y>>>16&255,_&16){if(R=y&65535,_&=15,m<_&&(g+=I[n++]<<m,m+=8,m<_&&(g+=I[n++]<<m,m+=8)),R+=g&(1<<_)-1,R>f){r.msg="invalid distance too far back",k.mode=BAD$1;break e}if(g>>>=_,m-=_,_=s-o,R>_){if(_=R-_,_>c&&k.sane){r.msg="invalid distance too far back",k.mode=BAD$1;break e}if(T=0,M=d,u===0){if(T+=h-_,_<E){E-=_;do b[s++]=d[T++];while(--_);T=s-R,M=b}}else if(u<_){if(T+=h+u-_,_-=u,_<E){E-=_;do b[s++]=d[T++];while(--_);if(T=0,u<E){_=u,E-=_;do b[s++]=d[T++];while(--_);T=s-R,M=b}}}else if(T+=u-_,_<E){E-=_;do b[s++]=d[T++];while(--_);T=s-R,M=b}for(;E>2;)b[s++]=M[T++],b[s++]=M[T++],b[s++]=M[T++],E-=3;E&&(b[s++]=M[T++],E>1&&(b[s++]=M[T++]))}else{T=s-R;do b[s++]=b[T++],b[s++]=b[T++],b[s++]=b[T++],E-=3;while(E>2);E&&(b[s++]=b[T++],E>1&&(b[s++]=b[T++]))}}else if((_&64)===0){y=v[(y&65535)+(g&(1<<_)-1)];continue r}else{r.msg="invalid distance code",k.mode=BAD$1;break e}break}}else if((_&64)===0){y=w[(y&65535)+(g&(1<<_)-1)];continue t}else if(_&32){k.mode=TYPE$1;break e}else{r.msg="invalid literal/length code",k.mode=BAD$1;break e}break}}while(n<a&&s<l);E=m>>3,n-=E,m-=E<<3,g&=(1<<m)-1,r.next_in=n,r.next_out=s,r.avail_in=n<a?5+(a-n):5-(n-a),r.avail_out=s<l?257+(l-s):257-(s-l),k.hold=g,k.bits=m};const MAXBITS=15,ENOUGH_LENS$1=852,ENOUGH_DISTS$1=592,CODES$1=0,LENS$1=1,DISTS$1=2,lbase=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),lext=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),dbase=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),dext=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),inflate_table=(e,r,t,n,a,s,o,l)=>{const f=l.bits;let h=0,c=0,u=0,d=0,g=0,m=0,w=0,v=0,x=0,S=0,y,_,E,R,T,M=null,I;const b=new Uint16Array(MAXBITS+1),k=new Uint16Array(MAXBITS+1);let D=null,$,P,O;for(h=0;h<=MAXBITS;h++)b[h]=0;for(c=0;c<n;c++)b[r[t+c]]++;for(g=f,d=MAXBITS;d>=1&&b[d]===0;d--);if(g>d&&(g=d),d===0)return a[s++]=1<<24|64<<16|0,a[s++]=1<<24|64<<16|0,l.bits=1,0;for(u=1;u<d&&b[u]===0;u++);for(g<u&&(g=u),v=1,h=1;h<=MAXBITS;h++)if(v<<=1,v-=b[h],v<0)return-1;if(v>0&&(e===CODES$1||d!==1))return-1;for(k[1]=0,h=1;h<MAXBITS;h++)k[h+1]=k[h]+b[h];for(c=0;c<n;c++)r[t+c]!==0&&(o[k[r[t+c]]++]=c);if(e===CODES$1?(M=D=o,I=20):e===LENS$1?(M=lbase,D=lext,I=257):(M=dbase,D=dext,I=0),S=0,c=0,h=u,T=s,m=g,w=0,E=-1,x=1<<g,R=x-1,e===LENS$1&&x>ENOUGH_LENS$1||e===DISTS$1&&x>ENOUGH_DISTS$1)return 1;for(;;){$=h-w,o[c]+1<I?(P=0,O=o[c]):o[c]>=I?(P=D[o[c]-I],O=M[o[c]-I]):(P=32+64,O=0),y=1<<h-w,_=1<<m,u=_;do _-=y,a[T+(S>>w)+_]=$<<24|P<<16|O|0;while(_!==0);for(y=1<<h-1;S&y;)y>>=1;if(y!==0?(S&=y-1,S+=y):S=0,c++,--b[h]===0){if(h===d)break;h=r[t+o[c]]}if(h>g&&(S&R)!==E){for(w===0&&(w=g),T+=u,m=h-w,v=1<<m;m+w<d&&(v-=b[m+w],!(v<=0));)m++,v<<=1;if(x+=1<<m,e===LENS$1&&x>ENOUGH_LENS$1||e===DISTS$1&&x>ENOUGH_DISTS$1)return 1;E=S&R,a[E]=g<<24|m<<16|T-s|0}}return S!==0&&(a[T+S]=h-w<<24|64<<16|0),l.bits=g,0};var inftrees=inflate_table;const CODES=0,LENS=1,DISTS=2,{Z_FINISH:Z_FINISH$1,Z_BLOCK,Z_TREES,Z_OK:Z_OK$1,Z_STREAM_END:Z_STREAM_END$1,Z_NEED_DICT:Z_NEED_DICT$1,Z_STREAM_ERROR:Z_STREAM_ERROR$1,Z_DATA_ERROR:Z_DATA_ERROR$1,Z_MEM_ERROR:Z_MEM_ERROR$1,Z_BUF_ERROR,Z_DEFLATED}=constants$2,HEAD=16180,FLAGS=16181,TIME=16182,OS=16183,EXLEN=16184,EXTRA=16185,NAME=16186,COMMENT=16187,HCRC=16188,DICTID=16189,DICT=16190,TYPE=16191,TYPEDO=16192,STORED=16193,COPY_=16194,COPY=16195,TABLE=16196,LENLENS=16197,CODELENS=16198,LEN_=16199,LEN=16200,LENEXT=16201,DIST=16202,DISTEXT=16203,MATCH=16204,LIT=16205,CHECK=16206,LENGTH=16207,DONE=16208,BAD=16209,MEM=16210,SYNC=16211,ENOUGH_LENS=852,ENOUGH_DISTS=592,MAX_WBITS=15,DEF_WBITS=MAX_WBITS,zswap32=e=>(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24);function InflateState(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const inflateStateCheck=e=>{if(!e)return 1;const r=e.state;return!r||r.strm!==e||r.mode<HEAD||r.mode>SYNC?1:0},inflateResetKeep=e=>{if(inflateStateCheck(e))return Z_STREAM_ERROR$1;const r=e.state;return e.total_in=e.total_out=r.total=0,e.msg="",r.wrap&&(e.adler=r.wrap&1),r.mode=HEAD,r.last=0,r.havedict=0,r.flags=-1,r.dmax=32768,r.head=null,r.hold=0,r.bits=0,r.lencode=r.lendyn=new Int32Array(ENOUGH_LENS),r.distcode=r.distdyn=new Int32Array(ENOUGH_DISTS),r.sane=1,r.back=-1,Z_OK$1},inflateReset=e=>{if(inflateStateCheck(e))return Z_STREAM_ERROR$1;const r=e.state;return r.wsize=0,r.whave=0,r.wnext=0,inflateResetKeep(e)},inflateReset2=(e,r)=>{let t;if(inflateStateCheck(e))return Z_STREAM_ERROR$1;const n=e.state;return r<0?(t=0,r=-r):(t=(r>>4)+5,r<48&&(r&=15)),r&&(r<8||r>15)?Z_STREAM_ERROR$1:(n.window!==null&&n.wbits!==r&&(n.window=null),n.wrap=t,n.wbits=r,inflateReset(e))},inflateInit2=(e,r)=>{if(!e)return Z_STREAM_ERROR$1;const t=new InflateState;e.state=t,t.strm=e,t.window=null,t.mode=HEAD;const n=inflateReset2(e,r);return n!==Z_OK$1&&(e.state=null),n},inflateInit=e=>inflateInit2(e,DEF_WBITS);let virgin=!0,lenfix,distfix;const fixedtables=e=>{if(virgin){lenfix=new Int32Array(512),distfix=new Int32Array(32);let r=0;for(;r<144;)e.lens[r++]=8;for(;r<256;)e.lens[r++]=9;for(;r<280;)e.lens[r++]=7;for(;r<288;)e.lens[r++]=8;for(inftrees(LENS,e.lens,0,288,lenfix,0,e.work,{bits:9}),r=0;r<32;)e.lens[r++]=5;inftrees(DISTS,e.lens,0,32,distfix,0,e.work,{bits:5}),virgin=!1}e.lencode=lenfix,e.lenbits=9,e.distcode=distfix,e.distbits=5},updatewindow=(e,r,t,n)=>{let a;const s=e.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),n>=s.wsize?(s.window.set(r.subarray(t-s.wsize,t),0),s.wnext=0,s.whave=s.wsize):(a=s.wsize-s.wnext,a>n&&(a=n),s.window.set(r.subarray(t-n,t-n+a),s.wnext),n-=a,n?(s.window.set(r.subarray(t-n,t),0),s.wnext=n,s.whave=s.wsize):(s.wnext+=a,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=a))),0},inflate$2=(e,r)=>{let t,n,a,s,o,l,f,h,c,u,d,g,m,w,v=0,x,S,y,_,E,R,T,M;const I=new Uint8Array(4);let b,k;const D=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(inflateStateCheck(e)||!e.output||!e.input&&e.avail_in!==0)return Z_STREAM_ERROR$1;t=e.state,t.mode===TYPE&&(t.mode=TYPEDO),o=e.next_out,a=e.output,f=e.avail_out,s=e.next_in,n=e.input,l=e.avail_in,h=t.hold,c=t.bits,u=l,d=f,M=Z_OK$1;e:for(;;)switch(t.mode){case HEAD:if(t.wrap===0){t.mode=TYPEDO;break}for(;c<16;){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}if(t.wrap&2&&h===35615){t.wbits===0&&(t.wbits=15),t.check=0,I[0]=h&255,I[1]=h>>>8&255,t.check=crc32_1(t.check,I,2,0),h=0,c=0,t.mode=FLAGS;break}if(t.head&&(t.head.done=!1),!(t.wrap&1)||(((h&255)<<8)+(h>>8))%31){e.msg="incorrect header check",t.mode=BAD;break}if((h&15)!==Z_DEFLATED){e.msg="unknown compression method",t.mode=BAD;break}if(h>>>=4,c-=4,T=(h&15)+8,t.wbits===0&&(t.wbits=T),T>15||T>t.wbits){e.msg="invalid window size",t.mode=BAD;break}t.dmax=1<<t.wbits,t.flags=0,e.adler=t.check=1,t.mode=h&512?DICTID:TYPE,h=0,c=0;break;case FLAGS:for(;c<16;){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}if(t.flags=h,(t.flags&255)!==Z_DEFLATED){e.msg="unknown compression method",t.mode=BAD;break}if(t.flags&57344){e.msg="unknown header flags set",t.mode=BAD;break}t.head&&(t.head.text=h>>8&1),t.flags&512&&t.wrap&4&&(I[0]=h&255,I[1]=h>>>8&255,t.check=crc32_1(t.check,I,2,0)),h=0,c=0,t.mode=TIME;case TIME:for(;c<32;){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}t.head&&(t.head.time=h),t.flags&512&&t.wrap&4&&(I[0]=h&255,I[1]=h>>>8&255,I[2]=h>>>16&255,I[3]=h>>>24&255,t.check=crc32_1(t.check,I,4,0)),h=0,c=0,t.mode=OS;case OS:for(;c<16;){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}t.head&&(t.head.xflags=h&255,t.head.os=h>>8),t.flags&512&&t.wrap&4&&(I[0]=h&255,I[1]=h>>>8&255,t.check=crc32_1(t.check,I,2,0)),h=0,c=0,t.mode=EXLEN;case EXLEN:if(t.flags&1024){for(;c<16;){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}t.length=h,t.head&&(t.head.extra_len=h),t.flags&512&&t.wrap&4&&(I[0]=h&255,I[1]=h>>>8&255,t.check=crc32_1(t.check,I,2,0)),h=0,c=0}else t.head&&(t.head.extra=null);t.mode=EXTRA;case EXTRA:if(t.flags&1024&&(g=t.length,g>l&&(g=l),g&&(t.head&&(T=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(n.subarray(s,s+g),T)),t.flags&512&&t.wrap&4&&(t.check=crc32_1(t.check,n,g,s)),l-=g,s+=g,t.length-=g),t.length))break e;t.length=0,t.mode=NAME;case NAME:if(t.flags&2048){if(l===0)break e;g=0;do T=n[s+g++],t.head&&T&&t.length<65536&&(t.head.name+=String.fromCharCode(T));while(T&&g<l);if(t.flags&512&&t.wrap&4&&(t.check=crc32_1(t.check,n,g,s)),l-=g,s+=g,T)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=COMMENT;case COMMENT:if(t.flags&4096){if(l===0)break e;g=0;do T=n[s+g++],t.head&&T&&t.length<65536&&(t.head.comment+=String.fromCharCode(T));while(T&&g<l);if(t.flags&512&&t.wrap&4&&(t.check=crc32_1(t.check,n,g,s)),l-=g,s+=g,T)break e}else t.head&&(t.head.comment=null);t.mode=HCRC;case HCRC:if(t.flags&512){for(;c<16;){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}if(t.wrap&4&&h!==(t.check&65535)){e.msg="header crc mismatch",t.mode=BAD;break}h=0,c=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),e.adler=t.check=0,t.mode=TYPE;break;case DICTID:for(;c<32;){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}e.adler=t.check=zswap32(h),h=0,c=0,t.mode=DICT;case DICT:if(t.havedict===0)return e.next_out=o,e.avail_out=f,e.next_in=s,e.avail_in=l,t.hold=h,t.bits=c,Z_NEED_DICT$1;e.adler=t.check=1,t.mode=TYPE;case TYPE:if(r===Z_BLOCK||r===Z_TREES)break e;case TYPEDO:if(t.last){h>>>=c&7,c-=c&7,t.mode=CHECK;break}for(;c<3;){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}switch(t.last=h&1,h>>>=1,c-=1,h&3){case 0:t.mode=STORED;break;case 1:if(fixedtables(t),t.mode=LEN_,r===Z_TREES){h>>>=2,c-=2;break e}break;case 2:t.mode=TABLE;break;case 3:e.msg="invalid block type",t.mode=BAD}h>>>=2,c-=2;break;case STORED:for(h>>>=c&7,c-=c&7;c<32;){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}if((h&65535)!==(h>>>16^65535)){e.msg="invalid stored block lengths",t.mode=BAD;break}if(t.length=h&65535,h=0,c=0,t.mode=COPY_,r===Z_TREES)break e;case COPY_:t.mode=COPY;case COPY:if(g=t.length,g){if(g>l&&(g=l),g>f&&(g=f),g===0)break e;a.set(n.subarray(s,s+g),o),l-=g,s+=g,f-=g,o+=g,t.length-=g;break}t.mode=TYPE;break;case TABLE:for(;c<14;){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}if(t.nlen=(h&31)+257,h>>>=5,c-=5,t.ndist=(h&31)+1,h>>>=5,c-=5,t.ncode=(h&15)+4,h>>>=4,c-=4,t.nlen>286||t.ndist>30){e.msg="too many length or distance symbols",t.mode=BAD;break}t.have=0,t.mode=LENLENS;case LENLENS:for(;t.have<t.ncode;){for(;c<3;){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}t.lens[D[t.have++]]=h&7,h>>>=3,c-=3}for(;t.have<19;)t.lens[D[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,b={bits:t.lenbits},M=inftrees(CODES,t.lens,0,19,t.lencode,0,t.work,b),t.lenbits=b.bits,M){e.msg="invalid code lengths set",t.mode=BAD;break}t.have=0,t.mode=CODELENS;case CODELENS:for(;t.have<t.nlen+t.ndist;){for(;v=t.lencode[h&(1<<t.lenbits)-1],x=v>>>24,S=v>>>16&255,y=v&65535,!(x<=c);){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}if(y<16)h>>>=x,c-=x,t.lens[t.have++]=y;else{if(y===16){for(k=x+2;c<k;){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}if(h>>>=x,c-=x,t.have===0){e.msg="invalid bit length repeat",t.mode=BAD;break}T=t.lens[t.have-1],g=3+(h&3),h>>>=2,c-=2}else if(y===17){for(k=x+3;c<k;){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}h>>>=x,c-=x,T=0,g=3+(h&7),h>>>=3,c-=3}else{for(k=x+7;c<k;){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}h>>>=x,c-=x,T=0,g=11+(h&127),h>>>=7,c-=7}if(t.have+g>t.nlen+t.ndist){e.msg="invalid bit length repeat",t.mode=BAD;break}for(;g--;)t.lens[t.have++]=T}}if(t.mode===BAD)break;if(t.lens[256]===0){e.msg="invalid code -- missing end-of-block",t.mode=BAD;break}if(t.lenbits=9,b={bits:t.lenbits},M=inftrees(LENS,t.lens,0,t.nlen,t.lencode,0,t.work,b),t.lenbits=b.bits,M){e.msg="invalid literal/lengths set",t.mode=BAD;break}if(t.distbits=6,t.distcode=t.distdyn,b={bits:t.distbits},M=inftrees(DISTS,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,b),t.distbits=b.bits,M){e.msg="invalid distances set",t.mode=BAD;break}if(t.mode=LEN_,r===Z_TREES)break e;case LEN_:t.mode=LEN;case LEN:if(l>=6&&f>=258){e.next_out=o,e.avail_out=f,e.next_in=s,e.avail_in=l,t.hold=h,t.bits=c,inffast(e,d),o=e.next_out,a=e.output,f=e.avail_out,s=e.next_in,n=e.input,l=e.avail_in,h=t.hold,c=t.bits,t.mode===TYPE&&(t.back=-1);break}for(t.back=0;v=t.lencode[h&(1<<t.lenbits)-1],x=v>>>24,S=v>>>16&255,y=v&65535,!(x<=c);){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}if(S&&(S&240)===0){for(_=x,E=S,R=y;v=t.lencode[R+((h&(1<<_+E)-1)>>_)],x=v>>>24,S=v>>>16&255,y=v&65535,!(_+x<=c);){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}h>>>=_,c-=_,t.back+=_}if(h>>>=x,c-=x,t.back+=x,t.length=y,S===0){t.mode=LIT;break}if(S&32){t.back=-1,t.mode=TYPE;break}if(S&64){e.msg="invalid literal/length code",t.mode=BAD;break}t.extra=S&15,t.mode=LENEXT;case LENEXT:if(t.extra){for(k=t.extra;c<k;){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}t.length+=h&(1<<t.extra)-1,h>>>=t.extra,c-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=DIST;case DIST:for(;v=t.distcode[h&(1<<t.distbits)-1],x=v>>>24,S=v>>>16&255,y=v&65535,!(x<=c);){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}if((S&240)===0){for(_=x,E=S,R=y;v=t.distcode[R+((h&(1<<_+E)-1)>>_)],x=v>>>24,S=v>>>16&255,y=v&65535,!(_+x<=c);){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}h>>>=_,c-=_,t.back+=_}if(h>>>=x,c-=x,t.back+=x,S&64){e.msg="invalid distance code",t.mode=BAD;break}t.offset=y,t.extra=S&15,t.mode=DISTEXT;case DISTEXT:if(t.extra){for(k=t.extra;c<k;){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}t.offset+=h&(1<<t.extra)-1,h>>>=t.extra,c-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){e.msg="invalid distance too far back",t.mode=BAD;break}t.mode=MATCH;case MATCH:if(f===0)break e;if(g=d-f,t.offset>g){if(g=t.offset-g,g>t.whave&&t.sane){e.msg="invalid distance too far back",t.mode=BAD;break}g>t.wnext?(g-=t.wnext,m=t.wsize-g):m=t.wnext-g,g>t.length&&(g=t.length),w=t.window}else w=a,m=o-t.offset,g=t.length;g>f&&(g=f),f-=g,t.length-=g;do a[o++]=w[m++];while(--g);t.length===0&&(t.mode=LEN);break;case LIT:if(f===0)break e;a[o++]=t.length,f--,t.mode=LEN;break;case CHECK:if(t.wrap){for(;c<32;){if(l===0)break e;l--,h|=n[s++]<<c,c+=8}if(d-=f,e.total_out+=d,t.total+=d,t.wrap&4&&d&&(e.adler=t.check=t.flags?crc32_1(t.check,a,d,o-d):adler32_1(t.check,a,d,o-d)),d=f,t.wrap&4&&(t.flags?h:zswap32(h))!==t.check){e.msg="incorrect data check",t.mode=BAD;break}h=0,c=0}t.mode=LENGTH;case LENGTH:if(t.wrap&&t.flags){for(;c<32;){if(l===0)break e;l--,h+=n[s++]<<c,c+=8}if(t.wrap&4&&h!==(t.total&4294967295)){e.msg="incorrect length check",t.mode=BAD;break}h=0,c=0}t.mode=DONE;case DONE:M=Z_STREAM_END$1;break e;case BAD:M=Z_DATA_ERROR$1;break e;case MEM:return Z_MEM_ERROR$1;case SYNC:default:return Z_STREAM_ERROR$1}return e.next_out=o,e.avail_out=f,e.next_in=s,e.avail_in=l,t.hold=h,t.bits=c,(t.wsize||d!==e.avail_out&&t.mode<BAD&&(t.mode<CHECK||r!==Z_FINISH$1))&&updatewindow(e,e.output,e.next_out,d-e.avail_out),u-=e.avail_in,d-=e.avail_out,e.total_in+=u,e.total_out+=d,t.total+=d,t.wrap&4&&d&&(e.adler=t.check=t.flags?crc32_1(t.check,a,d,e.next_out-d):adler32_1(t.check,a,d,e.next_out-d)),e.data_type=t.bits+(t.last?64:0)+(t.mode===TYPE?128:0)+(t.mode===LEN_||t.mode===COPY_?256:0),(u===0&&d===0||r===Z_FINISH$1)&&M===Z_OK$1&&(M=Z_BUF_ERROR),M},inflateEnd=e=>{if(inflateStateCheck(e))return Z_STREAM_ERROR$1;let r=e.state;return r.window&&(r.window=null),e.state=null,Z_OK$1},inflateGetHeader=(e,r)=>{if(inflateStateCheck(e))return Z_STREAM_ERROR$1;const t=e.state;return(t.wrap&2)===0?Z_STREAM_ERROR$1:(t.head=r,r.done=!1,Z_OK$1)},inflateSetDictionary=(e,r)=>{const t=r.length;let n,a,s;return inflateStateCheck(e)||(n=e.state,n.wrap!==0&&n.mode!==DICT)?Z_STREAM_ERROR$1:n.mode===DICT&&(a=1,a=adler32_1(a,r,t,0),a!==n.check)?Z_DATA_ERROR$1:(s=updatewindow(e,r,t,t),s?(n.mode=MEM,Z_MEM_ERROR$1):(n.havedict=1,Z_OK$1))};var inflateReset_1=inflateReset,inflateReset2_1=inflateReset2,inflateResetKeep_1=inflateResetKeep,inflateInit_1=inflateInit,inflateInit2_1=inflateInit2,inflate_2$1=inflate$2,inflateEnd_1=inflateEnd,inflateGetHeader_1=inflateGetHeader,inflateSetDictionary_1=inflateSetDictionary,inflateInfo="pako inflate (from Nodeca project)",inflate_1$2={inflateReset:inflateReset_1,inflateReset2:inflateReset2_1,inflateResetKeep:inflateResetKeep_1,inflateInit:inflateInit_1,inflateInit2:inflateInit2_1,inflate:inflate_2$1,inflateEnd:inflateEnd_1,inflateGetHeader:inflateGetHeader_1,inflateSetDictionary:inflateSetDictionary_1,inflateInfo};function GZheader(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var gzheader=GZheader;const toString$2=Object.prototype.toString,{Z_NO_FLUSH,Z_FINISH,Z_OK,Z_STREAM_END,Z_NEED_DICT,Z_STREAM_ERROR,Z_DATA_ERROR,Z_MEM_ERROR}=constants$2;function Inflate$1(e){this.options=common.assign({chunkSize:1024*64,windowBits:15,to:""},e||{});const r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,r.windowBits===0&&(r.windowBits=-15)),r.windowBits>=0&&r.windowBits<16&&!(e&&e.windowBits)&&(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&(r.windowBits&15)===0&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;let t=inflate_1$2.inflateInit2(this.strm,r.windowBits);if(t!==Z_OK)throw new Error(messages[t]);if(this.header=new gzheader,inflate_1$2.inflateGetHeader(this.strm,this.header),r.dictionary&&(typeof r.dictionary=="string"?r.dictionary=strings.string2buf(r.dictionary):toString$2.call(r.dictionary)==="[object ArrayBuffer]"&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw&&(t=inflate_1$2.inflateSetDictionary(this.strm,r.dictionary),t!==Z_OK)))throw new Error(messages[t])}Inflate$1.prototype.push=function(e,r){const t=this.strm,n=this.options.chunkSize,a=this.options.dictionary;let s,o,l;if(this.ended)return!1;for(r===~~r?o=r:o=r===!0?Z_FINISH:Z_NO_FLUSH,toString$2.call(e)==="[object ArrayBuffer]"?t.input=new Uint8Array(e):t.input=e,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),s=inflate_1$2.inflate(t,o),s===Z_NEED_DICT&&a&&(s=inflate_1$2.inflateSetDictionary(t,a),s===Z_OK?s=inflate_1$2.inflate(t,o):s===Z_DATA_ERROR&&(s=Z_NEED_DICT));t.avail_in>0&&s===Z_STREAM_END&&t.state.wrap>0&&e[t.next_in]!==0;)inflate_1$2.inflateReset(t),s=inflate_1$2.inflate(t,o);switch(s){case Z_STREAM_ERROR:case Z_DATA_ERROR:case Z_NEED_DICT:case Z_MEM_ERROR:return this.onEnd(s),this.ended=!0,!1}if(l=t.avail_out,t.next_out&&(t.avail_out===0||s===Z_STREAM_END))if(this.options.to==="string"){let f=strings.utf8border(t.output,t.next_out),h=t.next_out-f,c=strings.buf2string(t.output,f);t.next_out=h,t.avail_out=n-h,h&&t.output.set(t.output.subarray(f,f+h),0),this.onData(c)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(s===Z_OK&&l===0)){if(s===Z_STREAM_END)return s=inflate_1$2.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(t.avail_in===0)break}}return!0};Inflate$1.prototype.onData=function(e){this.chunks.push(e)};Inflate$1.prototype.onEnd=function(e){e===Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function inflate$1(e,r){const t=new Inflate$1(r);if(t.push(e),t.err)throw t.msg||messages[t.err];return t.result}function inflateRaw$1(e,r){return r=r||{},r.raw=!0,inflate$1(e,r)}var Inflate_1$1=Inflate$1,inflate_2=inflate$1,inflateRaw_1$1=inflateRaw$1,ungzip$1=inflate$1,constants=constants$2,inflate_1$1={Inflate:Inflate_1$1,inflate:inflate_2,inflateRaw:inflateRaw_1$1,ungzip:ungzip$1,constants};const{Deflate,deflate,deflateRaw,gzip}=deflate_1$1,{Inflate,inflate,inflateRaw,ungzip}=inflate_1$1;var deflate_1=deflate,Inflate_1=Inflate,inflate_1=inflate;const pngSignature=[137,80,78,71,13,10,26,10],crcTable=[];for(let e=0;e<256;e++){let r=e;for(let t=0;t<8;t++)r&1?r=3988292384^r>>>1:r=r>>>1;crcTable[e]=r}const initialCrc=4294967295;function updateCrc(e,r,t){let n=e;for(let a=0;a<t;a++)n=crcTable[(n^r[a])&255]^n>>>8;return n}function crc(e,r){return(updateCrc(initialCrc,e,r)^initialCrc)>>>0}var ColorType;(function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.GREYSCALE=0]="GREYSCALE",e[e.TRUECOLOUR=2]="TRUECOLOUR",e[e.INDEXED_COLOUR=3]="INDEXED_COLOUR",e[e.GREYSCALE_ALPHA=4]="GREYSCALE_ALPHA",e[e.TRUECOLOUR_ALPHA=6]="TRUECOLOUR_ALPHA"})(ColorType||(ColorType={}));var CompressionMethod;(function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.DEFLATE=0]="DEFLATE"})(CompressionMethod||(CompressionMethod={}));var FilterMethod;(function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.ADAPTIVE=0]="ADAPTIVE"})(FilterMethod||(FilterMethod={}));var InterlaceMethod;(function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.NO_INTERLACE=0]="NO_INTERLACE",e[e.ADAM7=1]="ADAM7"})(InterlaceMethod||(InterlaceMethod={}));const empty=new Uint8Array(0),NULL="\0",uint16=new Uint16Array([255]),uint8=new Uint8Array(uint16.buffer),osIsLittleEndian=uint8[0]===255;class PngDecoder extends IOBuffer$4{constructor(r,t={}){super(r);const{checkCrc:n=!1}=t;this._checkCrc=n,this._inflator=new Inflate_1,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._end=!1,this._hasPalette=!1,this._palette=[],this._compressionMethod=CompressionMethod.UNKNOWN,this._filterMethod=FilterMethod.UNKNOWN,this._interlaceMethod=InterlaceMethod.UNKNOWN,this._colorType=-1,this.setBigEndian()}decode(){for(this.decodeSignature();!this._end;)this.decodeChunk();return this.decodeImage(),this._png}decodeSignature(){for(let r=0;r<pngSignature.length;r++)if(this.readUint8()!==pngSignature[r])throw new Error(`wrong PNG signature. Byte at ${r} should be ${pngSignature[r]}.`)}decodeChunk(){const r=this.readUint32(),t=this.readChars(4),n=this.offset;switch(t){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(r);break;case"IDAT":this.decodeIDAT(r);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(r);break;case"iCCP":this.decodeiCCP(r);break;case"tEXt":this.decodetEXt(r);break;case"pHYs":this.decodepHYs();break;default:this.skip(r);break}if(this.offset-n!==r)throw new Error(`Length mismatch while decoding chunk ${t}`);if(this._checkCrc){const a=this.readUint32(),s=r+4,o=crc(new Uint8Array(this.buffer,this.byteOffset+this.offset-s-4,s),s);if(o!==a)throw new Error(`CRC mismatch for chunk ${t}. Expected ${a}, found ${o}`)}else this.skip(4)}decodeIHDR(){const r=this._png;r.width=this.readUint32(),r.height=this.readUint32(),r.depth=checkBitDepth(this.readUint8());const t=this.readUint8();this._colorType=t;let n;switch(t){case ColorType.GREYSCALE:n=1;break;case ColorType.TRUECOLOUR:n=3;break;case ColorType.INDEXED_COLOUR:n=1;break;case ColorType.GREYSCALE_ALPHA:n=2;break;case ColorType.TRUECOLOUR_ALPHA:n=4;break;default:throw new Error(`Unknown color type: ${t}`)}if(this._png.channels=n,this._compressionMethod=this.readUint8(),this._compressionMethod!==CompressionMethod.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodePLTE(r){if(r%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${r}`);const t=r/3;this._hasPalette=!0;const n=[];this._palette=n;for(let a=0;a<t;a++)n.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(r){this._inflator.push(new Uint8Array(this.buffer,this.offset+this.byteOffset,r)),this.skip(r)}decodetRNS(r){if(this._colorType===3){if(r>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${r} vs ${this._palette.length})`);let t=0;for(;t<r;t++){const n=this.readByte();this._palette[t].push(n)}for(;t<this._palette.length;t++)this._palette[t].push(255)}}decodeiCCP(r){let t="",n;for(;(n=this.readChar())!==NULL;)t+=n;const a=this.readUint8();if(a!==CompressionMethod.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${a}`);const s=this.readBytes(r-t.length-2);this._png.iccEmbeddedProfile={name:t,profile:inflate_1(s)}}decodetEXt(r){let t="",n;for(;(n=this.readChar())!==NULL;)t+=n;this._png.text[t]=this.readChars(r-t.length-1)}decodepHYs(){const r=this.readUint32(),t=this.readUint32(),n=this.readByte();this._png.resolution={x:r,y:t,unit:n}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const r=this._inflator.result;if(this._filterMethod!==FilterMethod.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===InterlaceMethod.NO_INTERLACE)this.decodeInterlaceNull(r);else throw new Error(`Interlace method ${this._interlaceMethod} not supported`)}decodeInterlaceNull(r){const t=this._png.height,n=this._png.channels*this._png.depth/8,a=this._png.width*n,s=new Uint8Array(this._png.height*a);let o=empty,l=0,f,h;for(let c=0;c<t;c++){switch(f=r.subarray(l+1,l+1+a),h=s.subarray(c*a,(c+1)*a),r[l]){case 0:unfilterNone(f,h,a);break;case 1:unfilterSub(f,h,a,n);break;case 2:unfilterUp(f,h,o,a);break;case 3:unfilterAverage(f,h,o,a,n);break;case 4:unfilterPaeth(f,h,o,a,n);break;default:throw new Error(`Unsupported filter: ${r[l]}`)}o=h,l+=a+1}if(this._hasPalette&&(this._png.palette=this._palette),this._png.depth===16){const c=new Uint16Array(s.buffer);if(osIsLittleEndian)for(let u=0;u<c.length;u++)c[u]=swap16(c[u]);this._png.data=c}else this._png.data=s}}function unfilterNone(e,r,t){for(let n=0;n<t;n++)r[n]=e[n]}function unfilterSub(e,r,t,n){let a=0;for(;a<n;a++)r[a]=e[a];for(;a<t;a++)r[a]=e[a]+r[a-n]&255}function unfilterUp(e,r,t,n){let a=0;if(t.length===0)for(;a<n;a++)r[a]=e[a];else for(;a<n;a++)r[a]=e[a]+t[a]&255}function unfilterAverage(e,r,t,n,a){let s=0;if(t.length===0){for(;s<a;s++)r[s]=e[s];for(;s<n;s++)r[s]=e[s]+(r[s-a]>>1)&255}else{for(;s<a;s++)r[s]=e[s]+(t[s]>>1)&255;for(;s<n;s++)r[s]=e[s]+(r[s-a]+t[s]>>1)&255}}function unfilterPaeth(e,r,t,n,a){let s=0;if(t.length===0){for(;s<a;s++)r[s]=e[s];for(;s<n;s++)r[s]=e[s]+r[s-a]&255}else{for(;s<a;s++)r[s]=e[s]+t[s]&255;for(;s<n;s++)r[s]=e[s]+paethPredictor(r[s-a],t[s],t[s-a])&255}}function paethPredictor(e,r,t){const n=e+r-t,a=Math.abs(n-e),s=Math.abs(n-r),o=Math.abs(n-t);return a<=s&&a<=o?e:s<=o?r:t}function swap16(e){return(e&255)<<8|e>>8&255}function checkBitDepth(e){if(e!==1&&e!==2&&e!==4&&e!==8&&e!==16)throw new Error(`invalid bit depth: ${e}`);return e}const defaultZlibOptions={level:3};class PngEncoder extends IOBuffer$4{constructor(r,t={}){super(),this._colorType=ColorType.UNKNOWN,this._zlibOptions=Object.assign({},defaultZlibOptions,t.zlib),this._png=this._checkData(r),this.setBigEndian()}encode(){return this.encodeSignature(),this.encodeIHDR(),this.encodeData(),this.encodeIEND(),this.toArray()}encodeSignature(){this.writeBytes(pngSignature)}encodeIHDR(){this.writeUint32(13),this.writeChars("IHDR"),this.writeUint32(this._png.width),this.writeUint32(this._png.height),this.writeByte(this._png.depth),this.writeByte(this._colorType),this.writeByte(CompressionMethod.DEFLATE),this.writeByte(FilterMethod.ADAPTIVE),this.writeByte(InterlaceMethod.NO_INTERLACE),this.writeCrc(17)}encodeIEND(){this.writeUint32(0),this.writeChars("IEND"),this.writeCrc(4)}encodeIDAT(r){this.writeUint32(r.length),this.writeChars("IDAT"),this.writeBytes(r),this.writeCrc(r.length+4)}encodeData(){const{width:r,height:t,channels:n,depth:a,data:s}=this._png,o=n*r,l=new IOBuffer$4().setBigEndian();let f=0;for(let u=0;u<t;u++)if(l.writeByte(0),a===8)f=writeDataBytes(s,l,o,f);else if(a===16)f=writeDataUint16(s,l,o,f);else throw new Error("unreachable");const h=l.toArray(),c=deflate_1(h,this._zlibOptions);this.encodeIDAT(c)}_checkData(r){const{colorType:t,channels:n,depth:a}=getColorType(r),s={width:checkInteger(r.width,"width"),height:checkInteger(r.height,"height"),channels:n,data:r.data,depth:a,text:{}};this._colorType=t;const o=s.width*s.height*n;if(s.data.length!==o)throw new RangeError(`wrong data size. Found ${s.data.length}, expected ${o}`);return s}writeCrc(r){this.writeUint32(crc(new Uint8Array(this.buffer,this.byteOffset+this.offset-r,r),r))}}function checkInteger(e,r){if(Number.isInteger(e)&&e>0)return e;throw new TypeError(`${r} must be a positive integer`)}function getColorType(e){const{channels:r=4,depth:t=8}=e;if(r!==4&&r!==3&&r!==2&&r!==1)throw new RangeError(`unsupported number of channels: ${r}`);if(t!==8&&t!==16)throw new RangeError(`unsupported bit depth: ${t}`);const n={channels:r,depth:t,colorType:ColorType.UNKNOWN};switch(r){case 4:n.colorType=ColorType.TRUECOLOUR_ALPHA;break;case 3:n.colorType=ColorType.TRUECOLOUR;break;case 1:n.colorType=ColorType.GREYSCALE;break;case 2:n.colorType=ColorType.GREYSCALE_ALPHA;break;default:throw new Error("unsupported number of channels")}return n}function writeDataBytes(e,r,t,n){for(let a=0;a<t;a++)r.writeByte(e[n++]);return n}function writeDataUint16(e,r,t,n){for(let a=0;a<t;a++)r.writeUint16(e[n++]);return n}var ResolutionUnitSpecifier;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.METRE=1]="METRE"})(ResolutionUnitSpecifier||(ResolutionUnitSpecifier={}));function decodePng(e,r){return new PngDecoder(e,r).decode()}function encodePng$1(e,r){return new PngEncoder(e,r).encode()}var encoder={exports:{}};(function(e){function r(n){var a=Math.floor,s=new Array(64),o=new Array(64),l=new Array(64),f=new Array(64),h,c,u,d,g=new Array(65535),m=new Array(65535),w=new Array(64),v=new Array(64),x=[],S=0,y=7,_=new Array(64),E=new Array(64),R=new Array(64),T=new Array(256),M=new Array(2048),I,b=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],k=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],D=[0,1,2,3,4,5,6,7,8,9,10,11],$=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],P=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],O=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],ee=[0,1,2,3,4,5,6,7,8,9,10,11],q=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],z=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function W(F){for(var re=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],fe=0;fe<64;fe++){var he=a((re[fe]*F+50)/100);he<1?he=1:he>255&&(he=255),s[b[fe]]=he}for(var X=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],ke=0;ke<64;ke++){var Me=a((X[ke]*F+50)/100);Me<1?Me=1:Me>255&&(Me=255),o[b[ke]]=Me}for(var ie=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],oe=0,ue=0;ue<8;ue++)for(var ne=0;ne<8;ne++)l[oe]=1/(s[b[oe]]*ie[ue]*ie[ne]*8),f[oe]=1/(o[b[oe]]*ie[ue]*ie[ne]*8),oe++}function H(F,re){for(var fe=0,he=0,X=new Array,ke=1;ke<=16;ke++){for(var Me=1;Me<=F[ke];Me++)X[re[he]]=[],X[re[he]][0]=fe,X[re[he]][1]=ke,he++,fe++;fe*=2}return X}function se(){h=H(k,D),c=H(O,ee),u=H($,P),d=H(q,z)}function N(){for(var F=1,re=2,fe=1;fe<=15;fe++){for(var he=F;he<re;he++)m[32767+he]=fe,g[32767+he]=[],g[32767+he][1]=fe,g[32767+he][0]=he;for(var X=-(re-1);X<=-F;X++)m[32767+X]=fe,g[32767+X]=[],g[32767+X][1]=fe,g[32767+X][0]=re-1+X;F<<=1,re<<=1}}function Y(){for(var F=0;F<256;F++)M[F]=19595*F,M[F+256>>0]=38470*F,M[F+512>>0]=7471*F+32768,M[F+768>>0]=-11059*F,M[F+1024>>0]=-21709*F,M[F+1280>>0]=32768*F+8421375,M[F+1536>>0]=-27439*F,M[F+1792>>0]=-5329*F}function L(F){for(var re=F[0],fe=F[1]-1;fe>=0;)re&1<<fe&&(S|=1<<y),fe--,y--,y<0&&(S==255?(U(255),U(0)):U(S),y=7,S=0)}function U(F){x.push(F)}function G(F){U(F>>8&255),U(F&255)}function te(F,re){var fe,he,X,ke,Me,ie,oe,ue,ne=0,we,_e=8,le=64;for(we=0;we<_e;++we){fe=F[ne],he=F[ne+1],X=F[ne+2],ke=F[ne+3],Me=F[ne+4],ie=F[ne+5],oe=F[ne+6],ue=F[ne+7];var Ee=fe+ue,Q=fe-ue,ye=he+oe,Ae=he-oe,Ie=X+ie,Pe=X-ie,Ge=ke+Me,He=ke-Me,Fe=Ee+Ge,je=Ee-Ge,Ue=ye+Ie,Ne=ye-Ie;F[ne]=Fe+Ue,F[ne+4]=Fe-Ue;var ze=(Ne+je)*.707106781;F[ne+2]=je+ze,F[ne+6]=je-ze,Fe=He+Pe,Ue=Pe+Ae,Ne=Ae+Q;var Ve=(Fe-Ne)*.382683433,A=.5411961*Fe+Ve,C=1.306562965*Ne+Ve,B=Ue*.707106781,j=Q+B,J=Q-B;F[ne+5]=J+A,F[ne+3]=J-A,F[ne+1]=j+C,F[ne+7]=j-C,ne+=8}for(ne=0,we=0;we<_e;++we){fe=F[ne],he=F[ne+8],X=F[ne+16],ke=F[ne+24],Me=F[ne+32],ie=F[ne+40],oe=F[ne+48],ue=F[ne+56];var ae=fe+ue,De=fe-ue,Se=he+oe,Te=he-oe,Ce=X+ie,Ke=X-ie,Re=ke+Me,Xe=ke-Me,$e=ae+Re,Oe=ae-Re,Be=Se+Ce,Ye=Se-Ce;F[ne]=$e+Be,F[ne+32]=$e-Be;var Ze=(Ye+Oe)*.707106781;F[ne+16]=Oe+Ze,F[ne+48]=Oe-Ze,$e=Xe+Ke,Be=Ke+Te,Ye=Te+De;var Le=($e-Ye)*.382683433,qe=.5411961*$e+Le,Qe=1.306562965*Ye+Le,Je=Be*.707106781,et=De+Je,tt=De-Je;F[ne+40]=tt+qe,F[ne+24]=tt-qe,F[ne+8]=et+Qe,F[ne+56]=et-Qe,ne++}var We;for(we=0;we<le;++we)We=F[we]*re[we],w[we]=We>0?We+.5|0:We-.5|0;return w}function de(){G(65504),G(16),U(74),U(70),U(73),U(70),U(0),U(1),U(1),U(0),G(1),G(1),U(0),U(0)}function Z(F){if(!!F){G(65505),F[0]===69&&F[1]===120&&F[2]===105&&F[3]===102?G(F.length+2):(G(F.length+5+2),U(69),U(120),U(105),U(102),U(0));for(var re=0;re<F.length;re++)U(F[re])}}function ge(F,re){G(65472),G(17),U(8),G(re),G(F),U(3),U(1),U(17),U(0),U(2),U(17),U(1),U(3),U(17),U(1)}function ce(){G(65499),G(132),U(0);for(var F=0;F<64;F++)U(s[F]);U(1);for(var re=0;re<64;re++)U(o[re])}function ve(){G(65476),G(418),U(0);for(var F=0;F<16;F++)U(k[F+1]);for(var re=0;re<=11;re++)U(D[re]);U(16);for(var fe=0;fe<16;fe++)U($[fe+1]);for(var he=0;he<=161;he++)U(P[he]);U(1);for(var X=0;X<16;X++)U(O[X+1]);for(var ke=0;ke<=11;ke++)U(ee[ke]);U(17);for(var Me=0;Me<16;Me++)U(q[Me+1]);for(var ie=0;ie<=161;ie++)U(z[ie])}function be(F){typeof F>"u"||F.constructor!==Array||F.forEach(re=>{if(typeof re=="string"){G(65534);var fe=re.length;G(fe+2);var he;for(he=0;he<fe;he++)U(re.charCodeAt(he))}})}function K(){G(65498),G(12),U(3),U(1),U(0),U(2),U(17),U(3),U(17),U(0),U(63),U(0)}function V(F,re,fe,he,X){for(var ke=X[0],Me=X[240],ie,oe=16,ue=63,ne=64,we=te(F,re),_e=0;_e<ne;++_e)v[b[_e]]=we[_e];var le=v[0]-fe;fe=v[0],le==0?L(he[0]):(ie=32767+le,L(he[m[ie]]),L(g[ie]));for(var Ee=63;Ee>0&&v[Ee]==0;Ee--);if(Ee==0)return L(ke),fe;for(var Q=1,ye;Q<=Ee;){for(var Ae=Q;v[Q]==0&&Q<=Ee;++Q);var Ie=Q-Ae;if(Ie>=oe){ye=Ie>>4;for(var Pe=1;Pe<=ye;++Pe)L(Me);Ie=Ie&15}ie=32767+v[Q],L(X[(Ie<<4)+m[ie]]),L(g[ie]),Q++}return Ee!=ue&&L(ke),fe}function pe(){for(var F=String.fromCharCode,re=0;re<256;re++)T[re]=F(re)}this.encode=function(F,re){new Date().getTime(),re&&me(re),x=new Array,S=0,y=7,G(65496),de(),be(F.comments),Z(F.exifBuffer),ce(),ge(F.width,F.height),ve(),K();var fe=0,he=0,X=0;S=0,y=7,this.encode.displayName="_encode_";for(var ke=F.data,Me=F.width,ie=F.height,oe=Me*4,ue,ne=0,we,_e,le,Ee,Q,ye,Ae,Ie;ne<ie;){for(ue=0;ue<oe;){for(Ee=oe*ne+ue,Q=Ee,ye=-1,Ae=0,Ie=0;Ie<64;Ie++)Ae=Ie>>3,ye=(Ie&7)*4,Q=Ee+Ae*oe+ye,ne+Ae>=ie&&(Q-=oe*(ne+1+Ae-ie)),ue+ye>=oe&&(Q-=ue+ye-oe+4),we=ke[Q++],_e=ke[Q++],le=ke[Q++],_[Ie]=(M[we]+M[_e+256>>0]+M[le+512>>0]>>16)-128,E[Ie]=(M[we+768>>0]+M[_e+1024>>0]+M[le+1280>>0]>>16)-128,R[Ie]=(M[we+1280>>0]+M[_e+1536>>0]+M[le+1792>>0]>>16)-128;fe=V(_,l,fe,h,u),he=V(E,f,he,c,d),X=V(R,f,X,c,d),ue+=32}ne+=8}if(y>=0){var Pe=[];Pe[1]=y+1,Pe[0]=(1<<y+1)-1,L(Pe)}return G(65497),Buffer.from(x)};function me(F){if(F<=0&&(F=1),F>100&&(F=100),I!=F){var re=0;F<50?re=Math.floor(5e3/F):re=Math.floor(200-F*2),W(re),I=F}}function xe(){var F=new Date().getTime();n||(n=50),pe(),se(),N(),Y(),me(n),new Date().getTime()-F}xe()}e.exports=t;function t(n,a){typeof a>"u"&&(a=50);var s=new r(a),o=s.encode(n,a);return{data:o,width:n.width,height:n.height}}})(encoder);var decoder={exports:{}};(function(e){var r=function(){var a=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),s=4017,o=799,l=3406,f=2276,h=1567,c=3784,u=5793,d=2896;function g(){}function m(E,R){for(var T=0,M=[],I,b,k=16;k>0&&!E[k-1];)k--;M.push({children:[],index:0});var D=M[0],$;for(I=0;I<k;I++){for(b=0;b<E[I];b++){for(D=M.pop(),D.children[D.index]=R[T];D.index>0;){if(M.length===0)throw new Error("Could not recreate Huffman Table");D=M.pop()}for(D.index++,M.push(D);M.length<=I;)M.push($={children:[],index:0}),D.children[D.index]=$.children,D=$;T++}I+1<k&&(M.push($={children:[],index:0}),D.children[D.index]=$.children,D=$)}return M[0].children}function w(E,R,T,M,I,b,k,D,$,P){T.precision,T.samplesPerLine,T.scanLines;var O=T.mcusPerLine,ee=T.progressive;T.maxH,T.maxV;var q=R,z=0,W=0;function H(){if(W>0)return W--,z>>W&1;if(z=E[R++],z==255){var ie=E[R++];if(ie)throw new Error("unexpected marker: "+(z<<8|ie).toString(16))}return W=7,z>>>7}function se(ie){for(var oe=ie,ue;(ue=H())!==null;){if(oe=oe[ue],typeof oe=="number")return oe;if(typeof oe!="object")throw new Error("invalid huffman sequence")}return null}function N(ie){for(var oe=0;ie>0;){var ue=H();if(ue===null)return;oe=oe<<1|ue,ie--}return oe}function Y(ie){var oe=N(ie);return oe>=1<<ie-1?oe:oe+(-1<<ie)+1}function L(ie,oe){var ue=se(ie.huffmanTableDC),ne=ue===0?0:Y(ue);oe[0]=ie.pred+=ne;for(var we=1;we<64;){var _e=se(ie.huffmanTableAC),le=_e&15,Ee=_e>>4;if(le===0){if(Ee<15)break;we+=16;continue}we+=Ee;var Q=a[we];oe[Q]=Y(le),we++}}function U(ie,oe){var ue=se(ie.huffmanTableDC),ne=ue===0?0:Y(ue)<<$;oe[0]=ie.pred+=ne}function G(ie,oe){oe[0]|=H()<<$}var te=0;function de(ie,oe){if(te>0){te--;return}for(var ue=b,ne=k;ue<=ne;){var we=se(ie.huffmanTableAC),_e=we&15,le=we>>4;if(_e===0){if(le<15){te=N(le)+(1<<le)-1;break}ue+=16;continue}ue+=le;var Ee=a[ue];oe[Ee]=Y(_e)*(1<<$),ue++}}var Z=0,ge;function ce(ie,oe){for(var ue=b,ne=k,we=0;ue<=ne;){var _e=a[ue],le=oe[_e]<0?-1:1;switch(Z){case 0:var Ee=se(ie.huffmanTableAC),Q=Ee&15,we=Ee>>4;if(Q===0)we<15?(te=N(we)+(1<<we),Z=4):(we=16,Z=1);else{if(Q!==1)throw new Error("invalid ACn encoding");ge=Y(Q),Z=we?2:3}continue;case 1:case 2:oe[_e]?oe[_e]+=(H()<<$)*le:(we--,we===0&&(Z=Z==2?3:0));break;case 3:oe[_e]?oe[_e]+=(H()<<$)*le:(oe[_e]=ge<<$,Z=0);break;case 4:oe[_e]&&(oe[_e]+=(H()<<$)*le);break}ue++}Z===4&&(te--,te===0&&(Z=0))}function ve(ie,oe,ue,ne,we){var _e=ue/O|0,le=ue%O,Ee=_e*ie.v+ne,Q=le*ie.h+we;ie.blocks[Ee]===void 0&&P.tolerantDecoding||oe(ie,ie.blocks[Ee][Q])}function be(ie,oe,ue){var ne=ue/ie.blocksPerLine|0,we=ue%ie.blocksPerLine;ie.blocks[ne]===void 0&&P.tolerantDecoding||oe(ie,ie.blocks[ne][we])}var K=M.length,V,pe,me,xe,F,re;ee?b===0?re=D===0?U:G:re=D===0?de:ce:re=L;var fe=0,he,X;K==1?X=M[0].blocksPerLine*M[0].blocksPerColumn:X=O*T.mcusPerColumn,I||(I=X);for(var ke,Me;fe<X;){for(pe=0;pe<K;pe++)M[pe].pred=0;if(te=0,K==1)for(V=M[0],F=0;F<I;F++)be(V,re,fe),fe++;else for(F=0;F<I;F++){for(pe=0;pe<K;pe++)for(V=M[pe],ke=V.h,Me=V.v,me=0;me<Me;me++)for(xe=0;xe<ke;xe++)ve(V,re,fe,me,xe);if(fe++,fe===X)break}if(fe===X)do{if(E[R]===255&&E[R+1]!==0)break;R+=1}while(R<E.length-2);if(W=0,he=E[R]<<8|E[R+1],he<65280)throw new Error("marker was not found");if(he>=65488&&he<=65495)R+=2;else break}return R-q}function v(E,R){var T=[],M=R.blocksPerLine,I=R.blocksPerColumn,b=M<<3,k=new Int32Array(64),D=new Uint8Array(64);function $(N,Y,L){var U=R.quantizationTable,G,te,de,Z,ge,ce,ve,be,K,V=L,pe;for(pe=0;pe<64;pe++)V[pe]=N[pe]*U[pe];for(pe=0;pe<8;++pe){var me=8*pe;if(V[1+me]==0&&V[2+me]==0&&V[3+me]==0&&V[4+me]==0&&V[5+me]==0&&V[6+me]==0&&V[7+me]==0){K=u*V[0+me]+512>>10,V[0+me]=K,V[1+me]=K,V[2+me]=K,V[3+me]=K,V[4+me]=K,V[5+me]=K,V[6+me]=K,V[7+me]=K;continue}G=u*V[0+me]+128>>8,te=u*V[4+me]+128>>8,de=V[2+me],Z=V[6+me],ge=d*(V[1+me]-V[7+me])+128>>8,be=d*(V[1+me]+V[7+me])+128>>8,ce=V[3+me]<<4,ve=V[5+me]<<4,K=G-te+1>>1,G=G+te+1>>1,te=K,K=de*c+Z*h+128>>8,de=de*h-Z*c+128>>8,Z=K,K=ge-ve+1>>1,ge=ge+ve+1>>1,ve=K,K=be+ce+1>>1,ce=be-ce+1>>1,be=K,K=G-Z+1>>1,G=G+Z+1>>1,Z=K,K=te-de+1>>1,te=te+de+1>>1,de=K,K=ge*f+be*l+2048>>12,ge=ge*l-be*f+2048>>12,be=K,K=ce*o+ve*s+2048>>12,ce=ce*s-ve*o+2048>>12,ve=K,V[0+me]=G+be,V[7+me]=G-be,V[1+me]=te+ve,V[6+me]=te-ve,V[2+me]=de+ce,V[5+me]=de-ce,V[3+me]=Z+ge,V[4+me]=Z-ge}for(pe=0;pe<8;++pe){var xe=pe;if(V[8+xe]==0&&V[16+xe]==0&&V[24+xe]==0&&V[32+xe]==0&&V[40+xe]==0&&V[48+xe]==0&&V[56+xe]==0){K=u*L[pe+0]+8192>>14,V[0+xe]=K,V[8+xe]=K,V[16+xe]=K,V[24+xe]=K,V[32+xe]=K,V[40+xe]=K,V[48+xe]=K,V[56+xe]=K;continue}G=u*V[0+xe]+2048>>12,te=u*V[32+xe]+2048>>12,de=V[16+xe],Z=V[48+xe],ge=d*(V[8+xe]-V[56+xe])+2048>>12,be=d*(V[8+xe]+V[56+xe])+2048>>12,ce=V[24+xe],ve=V[40+xe],K=G-te+1>>1,G=G+te+1>>1,te=K,K=de*c+Z*h+2048>>12,de=de*h-Z*c+2048>>12,Z=K,K=ge-ve+1>>1,ge=ge+ve+1>>1,ve=K,K=be+ce+1>>1,ce=be-ce+1>>1,be=K,K=G-Z+1>>1,G=G+Z+1>>1,Z=K,K=te-de+1>>1,te=te+de+1>>1,de=K,K=ge*f+be*l+2048>>12,ge=ge*l-be*f+2048>>12,be=K,K=ce*o+ve*s+2048>>12,ce=ce*s-ve*o+2048>>12,ve=K,V[0+xe]=G+be,V[56+xe]=G-be,V[8+xe]=te+ve,V[48+xe]=te-ve,V[16+xe]=de+ce,V[40+xe]=de-ce,V[24+xe]=Z+ge,V[32+xe]=Z-ge}for(pe=0;pe<64;++pe){var F=128+(V[pe]+8>>4);Y[pe]=F<0?0:F>255?255:F}}_(b*I*8);for(var P,O,ee=0;ee<I;ee++){var q=ee<<3;for(P=0;P<8;P++)T.push(new Uint8Array(b));for(var z=0;z<M;z++){$(R.blocks[ee][z],D,k);var W=0,H=z<<3;for(O=0;O<8;O++){var se=T[q+O];for(P=0;P<8;P++)se[H+P]=D[W++]}}}return T}function x(E){return E<0?0:E>255?255:E}g.prototype={load:function(R){var T=new XMLHttpRequest;T.open("GET",R,!0),T.responseType="arraybuffer",T.onload=function(){var M=new Uint8Array(T.response||T.mozResponseArrayBuffer);this.parse(M),this.onload&&this.onload()}.bind(this),T.send(null)},parse:function(R){var T=this.opts.maxResolutionInMP*1e3*1e3,M=0;R.length;function I(){var le=R[M]<<8|R[M+1];return M+=2,le}function b(){var le=I(),Ee=R.subarray(M,M+le-2);return M+=Ee.length,Ee}function k(le){var Ee=1,Q=1,ye,Ae;for(Ae in le.components)le.components.hasOwnProperty(Ae)&&(ye=le.components[Ae],Ee<ye.h&&(Ee=ye.h),Q<ye.v&&(Q=ye.v));var Ie=Math.ceil(le.samplesPerLine/8/Ee),Pe=Math.ceil(le.scanLines/8/Q);for(Ae in le.components)if(le.components.hasOwnProperty(Ae)){ye=le.components[Ae];var Ge=Math.ceil(Math.ceil(le.samplesPerLine/8)*ye.h/Ee),He=Math.ceil(Math.ceil(le.scanLines/8)*ye.v/Q),Fe=Ie*ye.h,je=Pe*ye.v,Ue=je*Fe,Ne=[];_(Ue*256);for(var ze=0;ze<je;ze++){for(var Ve=[],A=0;A<Fe;A++)Ve.push(new Int32Array(64));Ne.push(Ve)}ye.blocksPerLine=Ge,ye.blocksPerColumn=He,ye.blocks=Ne}le.maxH=Ee,le.maxV=Q,le.mcusPerLine=Ie,le.mcusPerColumn=Pe}var D=null,$=null,P,O,ee=[],q=[],z=[],W=[],H=I(),se=-1;if(this.comments=[],H!=65496)throw new Error("SOI not found");for(H=I();H!=65497;){var N,Y;switch(H){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var L=b();if(H===65534){var U=String.fromCharCode.apply(null,L);this.comments.push(U)}H===65504&&L[0]===74&&L[1]===70&&L[2]===73&&L[3]===70&&L[4]===0&&(D={version:{major:L[5],minor:L[6]},densityUnits:L[7],xDensity:L[8]<<8|L[9],yDensity:L[10]<<8|L[11],thumbWidth:L[12],thumbHeight:L[13],thumbData:L.subarray(14,14+3*L[12]*L[13])}),H===65505&&L[0]===69&&L[1]===120&&L[2]===105&&L[3]===102&&L[4]===0&&(this.exifBuffer=L.subarray(5,L.length)),H===65518&&L[0]===65&&L[1]===100&&L[2]===111&&L[3]===98&&L[4]===101&&L[5]===0&&($={version:L[6],flags0:L[7]<<8|L[8],flags1:L[9]<<8|L[10],transformCode:L[11]});break;case 65499:for(var G=I(),te=G+M-2;M<te;){var de=R[M++];_(256);var Z=new Int32Array(64);if(de>>4===0)for(Y=0;Y<64;Y++){var ge=a[Y];Z[ge]=R[M++]}else if(de>>4===1)for(Y=0;Y<64;Y++){var ge=a[Y];Z[ge]=I()}else throw new Error("DQT: invalid table spec");ee[de&15]=Z}break;case 65472:case 65473:case 65474:I(),P={},P.extended=H===65473,P.progressive=H===65474,P.precision=R[M++],P.scanLines=I(),P.samplesPerLine=I(),P.components={},P.componentsOrder=[];var ce=P.scanLines*P.samplesPerLine;if(ce>T){var ve=Math.ceil((ce-T)/1e6);throw new Error(`maxResolutionInMP limit exceeded by ${ve}MP`)}var be=R[M++],K;for(N=0;N<be;N++){K=R[M];var V=R[M+1]>>4,pe=R[M+1]&15,me=R[M+2];if(V<=0||pe<=0)throw new Error("Invalid sampling factor, expected values above 0");P.componentsOrder.push(K),P.components[K]={h:V,v:pe,quantizationIdx:me},M+=3}k(P),q.push(P);break;case 65476:var xe=I();for(N=2;N<xe;){var F=R[M++],re=new Uint8Array(16),fe=0;for(Y=0;Y<16;Y++,M++)fe+=re[Y]=R[M];_(16+fe);var he=new Uint8Array(fe);for(Y=0;Y<fe;Y++,M++)he[Y]=R[M];N+=17+fe,(F>>4===0?W:z)[F&15]=m(re,he)}break;case 65501:I(),O=I();break;case 65500:I(),I();break;case 65498:I();var X=R[M++],ke=[],Me;for(N=0;N<X;N++){Me=P.components[R[M++]];var ie=R[M++];Me.huffmanTableDC=W[ie>>4],Me.huffmanTableAC=z[ie&15],ke.push(Me)}var oe=R[M++],ue=R[M++],ne=R[M++],we=w(R,M,P,ke,O,oe,ue,ne>>4,ne&15,this.opts);M+=we;break;case 65535:R[M]!==255&&M--;break;default:if(R[M-3]==255&&R[M-2]>=192&&R[M-2]<=254){M-=3;break}else if(H===224||H==225){if(se!==-1)throw new Error(`first unknown JPEG marker at offset ${se.toString(16)}, second unknown JPEG marker ${H.toString(16)} at offset ${(M-1).toString(16)}`);se=M-1;const le=I();if(R[M+le-2]===255){M+=le-2;break}}throw new Error("unknown JPEG marker "+H.toString(16))}H=I()}if(q.length!=1)throw new Error("only single frame JPEGs supported");for(var N=0;N<q.length;N++){var _e=q[N].components;for(var Y in _e)_e[Y].quantizationTable=ee[_e[Y].quantizationIdx],delete _e[Y].quantizationIdx}this.width=P.samplesPerLine,this.height=P.scanLines,this.jfif=D,this.adobe=$,this.components=[];for(var N=0;N<P.componentsOrder.length;N++){var Me=P.components[P.componentsOrder[N]];this.components.push({lines:v(P,Me),scaleX:Me.h/P.maxH,scaleY:Me.v/P.maxV})}},getData:function(R,T){var M=this.width/R,I=this.height/T,b,k,D,$,P,O,ee,q,z,W,H=0,se,N,Y,L,U,G,te,de,Z,ge,ce,ve=R*T*this.components.length;_(ve);var be=new Uint8Array(ve);switch(this.components.length){case 1:for(b=this.components[0],W=0;W<T;W++)for(P=b.lines[0|W*b.scaleY*I],z=0;z<R;z++)se=P[0|z*b.scaleX*M],be[H++]=se;break;case 2:for(b=this.components[0],k=this.components[1],W=0;W<T;W++)for(P=b.lines[0|W*b.scaleY*I],O=k.lines[0|W*k.scaleY*I],z=0;z<R;z++)se=P[0|z*b.scaleX*M],be[H++]=se,se=O[0|z*k.scaleX*M],be[H++]=se;break;case 3:for(ce=!0,this.adobe&&this.adobe.transformCode?ce=!0:typeof this.opts.colorTransform<"u"&&(ce=!!this.opts.colorTransform),b=this.components[0],k=this.components[1],D=this.components[2],W=0;W<T;W++)for(P=b.lines[0|W*b.scaleY*I],O=k.lines[0|W*k.scaleY*I],ee=D.lines[0|W*D.scaleY*I],z=0;z<R;z++)ce?(se=P[0|z*b.scaleX*M],N=O[0|z*k.scaleX*M],Y=ee[0|z*D.scaleX*M],de=x(se+1.402*(Y-128)),Z=x(se-.3441363*(N-128)-.71413636*(Y-128)),ge=x(se+1.772*(N-128))):(de=P[0|z*b.scaleX*M],Z=O[0|z*k.scaleX*M],ge=ee[0|z*D.scaleX*M]),be[H++]=de,be[H++]=Z,be[H++]=ge;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 components)");for(ce=!1,this.adobe&&this.adobe.transformCode?ce=!0:typeof this.opts.colorTransform<"u"&&(ce=!!this.opts.colorTransform),b=this.components[0],k=this.components[1],D=this.components[2],$=this.components[3],W=0;W<T;W++)for(P=b.lines[0|W*b.scaleY*I],O=k.lines[0|W*k.scaleY*I],ee=D.lines[0|W*D.scaleY*I],q=$.lines[0|W*$.scaleY*I],z=0;z<R;z++)ce?(se=P[0|z*b.scaleX*M],N=O[0|z*k.scaleX*M],Y=ee[0|z*D.scaleX*M],L=q[0|z*$.scaleX*M],U=255-x(se+1.402*(Y-128)),G=255-x(se-.3441363*(N-128)-.71413636*(Y-128)),te=255-x(se+1.772*(N-128))):(U=P[0|z*b.scaleX*M],G=O[0|z*k.scaleX*M],te=ee[0|z*D.scaleX*M],L=q[0|z*$.scaleX*M]),be[H++]=255-U,be[H++]=255-G,be[H++]=255-te,be[H++]=255-L;break;default:throw new Error("Unsupported color mode")}return be},copyToImageData:function(R,T){var M=R.width,I=R.height,b=R.data,k=this.getData(M,I),D=0,$=0,P,O,ee,q,z,W,H,se,N;switch(this.components.length){case 1:for(O=0;O<I;O++)for(P=0;P<M;P++)ee=k[D++],b[$++]=ee,b[$++]=ee,b[$++]=ee,T&&(b[$++]=255);break;case 3:for(O=0;O<I;O++)for(P=0;P<M;P++)H=k[D++],se=k[D++],N=k[D++],b[$++]=H,b[$++]=se,b[$++]=N,T&&(b[$++]=255);break;case 4:for(O=0;O<I;O++)for(P=0;P<M;P++)z=k[D++],W=k[D++],ee=k[D++],q=k[D++],H=255-x(z*(1-q/255)+q),se=255-x(W*(1-q/255)+q),N=255-x(ee*(1-q/255)+q),b[$++]=H,b[$++]=se,b[$++]=N,T&&(b[$++]=255);break;default:throw new Error("Unsupported color mode")}}};var S=0,y=0;function _(E=0){var R=S+E;if(R>y){var T=Math.ceil((R-y)/1024/1024);throw new Error(`maxMemoryUsageInMB limit exceeded by at least ${T}MB`)}S=R}return g.resetMaxMemoryUsage=function(E){S=0,y=E},g.getBytesAllocated=function(){return S},g.requestMemoryAllocation=_,g}();e.exports=t;function t(n,a={}){var s={colorTransform:void 0,useTArray:!1,formatAsRGBA:!0,tolerantDecoding:!0,maxResolutionInMP:100,maxMemoryUsageInMB:512},o={...s,...a},l=new Uint8Array(n),f=new r;f.opts=o,r.resetMaxMemoryUsage(o.maxMemoryUsageInMB*1024*1024),f.parse(l);var h=o.formatAsRGBA?4:3,c=f.width*f.height*h;try{r.requestMemoryAllocation(c);var u={width:f.width,height:f.height,exifBuffer:f.exifBuffer,data:o.useTArray?new Uint8Array(c):Buffer.alloc(c)};f.comments.length>0&&(u.comments=f.comments)}catch(d){throw d instanceof RangeError?new Error("Could not allocate enough memory for the image. Required: "+c):d instanceof ReferenceError&&d.message==="Buffer is not defined"?new Error("Buffer is not globally defined in this environment. Consider setting useTArray to true"):d}return f.copyToImageData(u,o.formatAsRGBA),u}})(decoder);var encode$1=encoder.exports,decode$4=decoder.exports,jpegJs={encode:encode$1,decode:decode$4};let chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup=new Uint8Array(256);for(let e=0;e<chars.length;e++)lookup[chars.charCodeAt(e)]=e;function encode(e){let r,t=e.length,n="";for(r=0;r<t;r+=3)n+=chars[e[r]>>2],n+=chars[(e[r]&3)<<4|e[r+1]>>4],n+=chars[(e[r+1]&15)<<2|e[r+2]>>6],n+=chars[e[r+2]&63];return t%3===2?n=`${n.substring(0,n.length-1)}=`:t%3===1&&(n=`${n.substring(0,n.length-2)}==`),n}function decode$3(e){let r=e.length*.75,t=e.length,n=0,a,s,o,l;e[e.length-1]==="="&&(r--,e[e.length-2]==="="&&r--);const f=new Uint8Array(r);for(let h=0;h<t;h+=4)a=lookup[e.charCodeAt(h)],s=lookup[e.charCodeAt(h+1)],o=lookup[e.charCodeAt(h+2)],l=lookup[e.charCodeAt(h+3)],f[n++]=a<<2|s>>4,f[n++]=(s&15)<<4|o>>2,f[n++]=(o&3)<<6|l&63;return f}function toBase64URL(e,r){const t=encode(e);return`data:${r};base64,${t}`}const ImageData=self.ImageData,DOMImage=self.Image;function createCanvas(e,r){let t=self.document.createElement("canvas");return t.width=e,t.height=r,t}function fetchBinary(e,{withCredentials:r=!1}={}){return new Promise(function(t,n){let a=new self.XMLHttpRequest;a.open("GET",e,!0),a.responseType="arraybuffer",a.withCredentials=r,a.onload=function(s){this.status!==200?n(s):t(this.response)},a.onerror=n,a.send()})}function createWriteStream(){throw new Error("createWriteStream does not exist in the browser")}function writeFile(){throw new Error("writeFile does not exist in the browser")}function getType(e){return e.includes("/")||(e=`image/${e}`),e}function encodeJpeg(e,r={}){const t={width:e.width,height:e.height,data:e.getRGBAData()};return jpegJs.encode(t,r.quality).data}function encodePng(e,r){const t={width:e.width,height:e.height,channels:e.channels,depth:e.bitDepth,data:e.data};return(t.depth===1||t.depth===32)&&(t.depth=8,t.channels=4,t.data=e.getRGBAData()),encodePng$1(t,r)}const exportMethods={save(e,r={}){const{useCanvas:t=!1,encoder:n=void 0}=r;let{format:a}=r;if(!a){const s=/\.(?<format>[a-zA-Z]+)$/.exec(e);s&&(a=s.groups.format.toLowerCase())}if(!a)throw new Error("file format not provided");return new Promise((s,o)=>{let l,f;switch(a.toLowerCase()){case"png":{t?l=this.getCanvas().pngStream():f=encodePng(this,n);break}case"jpg":case"jpeg":t?l=this.getCanvas().jpegStream():f=encodeJpeg(this,n);break;case"bmp":f=encode$2(this,n);break;default:throw new RangeError(`invalid output format: ${a}`)}if(l){let h=createWriteStream();h.on("finish",s),h.on("error",o),l.pipe(h)}else f&&writeFile()})},toDataURL(e="image/png",r={}){typeof e=="object"&&(r=e,e="image/png");const{useCanvas:t=!1,encoder:n=void 0}=r;e=getType(e);function a(s,o){const l=s(o,n);return toBase64URL(l,e)}return e==="image/bmp"?a(encode$2,this):e==="image/png"&&!t?a(encodePng,this):e==="image/jpeg"&&!t?a(encodeJpeg,this):this.getCanvas().toDataURL(e)},toBuffer(e={}){const{format:r="png",encoder:t=void 0}=e;switch(r.toLowerCase()){case"png":return encodePng(this,t);case"jpeg":case"jpg":return encodeJpeg(this,t);case"bmp":return encode$2(this,t);default:throw new RangeError(`invalid output format: ${r}`)}},toBase64(e="image/png",r={}){if(r.async)return this.toDataURL(e,r).then(function(t){return t.substring(t.indexOf(",")+1)});{const t=this.toDataURL(e,r);return t.substring(t.indexOf(",")+1)}},toBlob(e="image/png",r=.8){return canvasToBlob(this.getCanvas(),e,r)},getCanvas(){const e=new ImageData(this.getRGBAData({clamped:!0}),this.width,this.height);let r=createCanvas(this.width,this.height);return r.getContext("2d").putImageData(e,0,0),r}};function setExportMethods(e){for(const r in exportMethods)e.prototype[r]=exportMethods[r]}var hasOwn$1={exports:{}};const name="has-own",version="1.0.1",description="A safer .hasOwnProperty() - hasOwn(name, obj)",main$1="index.js",scripts={test:"make test"},author="Aaron Heckmann <aaron.heckmann+github@gmail.com>",license="MIT",repository={type:"git",url:"git://github.com/aheckmann/has-own.git"},homepage="https://github.com/aheckmann/has-own/",devDependencies={mocha:"^6.2.2"},require$$0$2={name,version,description,main:main$1,scripts,author,license,repository,homepage,devDependencies};(function(e,r){var t=Object.prototype.hasOwnProperty;e.exports=r=function(a,s){return t.call(s,a)},r.version=require$$0$2.version})(hasOwn$1,hasOwn$1.exports);const hasOwn=hasOwn$1.exports;let computedPropertyDescriptor$1={configurable:!0,enumerable:!1,get:void 0};function extendMethod(e,r,t={}){let{inPlace:n=!1,returnThis:a=!0,partialArgs:s=[]}=t;return n?Image$1.prototype[e]=function(...o){this.computed=null;let l=r.apply(this,[...s,...o]);return a?this:l}:Image$1.prototype[e]=function(...o){return r.apply(this,[...s,...o])},Image$1}function extendProperty(e,r,t={}){let{partialArgs:n=[]}=t;return computedPropertyDescriptor$1.get=function(){if(this.computed===null)this.computed={};else if(hasOwn(e,this.computed))return this.computed[e];let a=r.apply(this,n);return this.computed[e]=a,a},Object.defineProperty(Image$1.prototype,e,computedPropertyDescriptor$1),Image$1}const GREY$1="GREY",RGB$1="RGB",HSL="HSL",HSV="HSV",CMYK$1="CMYK",ColorModel=Object.freeze(Object.defineProperty({__proto__:null,GREY:GREY$1,RGB:RGB$1,HSL,HSV,CMYK:CMYK$1},Symbol.toStringTag,{value:"Module"}));function getRGBAData(e={}){const{clamped:r}=e;this.checkProcessable("getRGBAData",{components:[1,3],bitDepth:[1,8,16,32]});const t=this.width*this.height*4;let n=r?new Uint8ClampedArray(t):new Uint8Array(t);return this.bitDepth===1?fillDataFromBinary(this,n):this.bitDepth===32?(this.checkProcessable("getRGBAData",{alpha:0}),this.components===1?fillDataFromGrey32(this,n):this.components===3&&(this.checkProcessable("getRGBAData",{colorModel:[RGB$1]}),fillDataFromRGB32(this,n))):this.components===1?fillDataFromGrey(this,n):this.components===3&&(this.checkProcessable("getRGBAData",{colorModel:[RGB$1]}),fillDataFromRGB(this,n)),this.alpha===1?(this.checkProcessable("getRGBAData",{bitDepth:[8,16]}),copyAlpha(this,n)):fillAlpha(this,n),n}function fillDataFromBinary(e,r){for(let t=0;t<e.size;t++){const n=e.getBit(t);r[t*4]=n*255,r[t*4+1]=n*255,r[t*4+2]=n*255}}function fillDataFromGrey32(e,r){const t=e.min[0],a=e.max[0]-t;for(let s=0;s<e.size;s++){const o=Math.floor(255*(e.data[s]-t)/a);r[s*4]=o,r[s*4+1]=o,r[s*4+2]=o}}function fillDataFromRGB32(e,r){const t=Math.min(...e.min),a=Math.max(...e.max)-t;for(let s=0;s<e.size;s++){const o=Math.floor(255*(e.data[s*3]-t)/a),l=Math.floor(255*(e.data[s*3+1]-t)/a),f=Math.floor(255*(e.data[s*3+2]-t)/a);r[s*4]=o,r[s*4+1]=l,r[s*4+2]=f}}function fillDataFromGrey(e,r){for(let t=0;t<e.size;t++)r[t*4]=e.data[t*e.channels]>>>e.bitDepth-8,r[t*4+1]=e.data[t*e.channels]>>>e.bitDepth-8,r[t*4+2]=e.data[t*e.channels]>>>e.bitDepth-8}function fillDataFromRGB(e,r){for(let t=0;t<e.size;t++)r[t*4]=e.data[t*e.channels]>>>e.bitDepth-8,r[t*4+1]=e.data[t*e.channels+1]>>>e.bitDepth-8,r[t*4+2]=e.data[t*e.channels+2]>>>e.bitDepth-8}function copyAlpha(e,r){for(let t=0;t<e.size;t++)r[t*4+3]=e.data[t*e.channels+e.components]>>e.bitDepth-8}function fillAlpha(e,r){for(let t=0;t<e.size;t++)r[t*4+3]=255}const BINARY="BINARY",GREY="GREY",GREYA="GREYA",RGB="RGB",RGBA="RGBA",CMYK="CMYK",CMYKA="CMYKA",kinds={};kinds[BINARY]={components:1,alpha:0,bitDepth:1,colorModel:GREY$1};kinds[GREYA]={components:1,alpha:1,bitDepth:8,colorModel:GREY$1};kinds[GREY]={components:1,alpha:0,bitDepth:8,colorModel:GREY$1};kinds[RGBA]={components:3,alpha:1,bitDepth:8,colorModel:RGB$1};kinds[RGB]={components:3,alpha:0,bitDepth:8,colorModel:RGB$1};kinds[CMYK]={components:4,alpha:0,bitDepth:8,colorModel:CMYK$1};kinds[CMYKA]={components:4,alpha:1,bitDepth:8,colorModel:CMYK$1};function getKind(e){const r=kinds[e];if(!r)throw new RangeError(`invalid image kind: ${e}`);return r}const validBitDepth=[1,8,16,32];function verifyKindDefinition(e){const{components:r,alpha:t,bitDepth:n,colorModel:a}=e;if(!Number.isInteger(r)||r<=0)throw new RangeError(`invalid components: ${r}. Must be a positive integer`);if(t!==0&&t!==1&&typeof t!="boolean")throw new TypeError(`invalid alpha: ${t}: must be a boolean, 0 or 1`);if(!validBitDepth.includes(n))throw new RangeError(`invalid bitDepth: ${n}. Must be one of ${validBitDepth.join(", ")}`);if(!ColorModel[a])throw new RangeError(`invalid colorModel: ${a}. Must be one of ${Object.keys(ColorModel).join(", ")}`)}function getTheoreticalPixelArraySize(e,r,t){let n=r*e;return t===1&&(n=Math.ceil(n/8)),n}function createPixelArray(e,r,t,n,a,s){const o=n*e;let l;switch(a){case 1:l=new Uint8Array(Math.ceil(o/8));break;case 8:l=new Uint8Array(o);break;case 16:l=new Uint16Array(o);break;case 32:l=new Float32Array(o);break;default:throw new Error(`Cannot create pixel array for bit depth ${a}`)}if(t)for(let f=r;f<l.length;f+=n)l[f]=s;return l}const defaultByteLength=1024*8,charArray=[];class IOBuffer$2{constructor(r,t){t=t||{},r===void 0&&(r=defaultByteLength),typeof r=="number"&&(r=new ArrayBuffer(r));let n=r.byteLength;const a=t.offset?t.offset>>>0:0;r.buffer&&(n=r.byteLength-a,r.byteLength!==r.buffer.byteLength?r=r.buffer.slice(r.byteOffset+a,r.byteOffset+r.byteLength):a?r=r.buffer.slice(a):r=r.buffer),this.buffer=r,this.length=n,this.byteLength=n,this.byteOffset=0,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer),this._increment=n||defaultByteLength,this._mark=0}available(r){return r===void 0&&(r=1),this.offset+r<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){this.littleEndian=!0}isBigEndian(){return!this.littleEndian}setBigEndian(){this.littleEndian=!1}skip(r){r===void 0&&(r=1),this.offset+=r}seek(r){this.offset=r}mark(){this._mark=this.offset}reset(){this.offset=this._mark}rewind(){this.offset=0}ensureAvailable(r){if(r===void 0&&(r=1),!this.available(r)){const t=this._increment+this._increment;this._increment=t;const n=this.length+t,a=new Uint8Array(n);a.set(new Uint8Array(this.buffer)),this.buffer=a.buffer,this.length=n,this._data=new DataView(this.buffer)}}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(r){r===void 0&&(r=1);for(var t=new Uint8Array(r),n=0;n<r;n++)t[n]=this.readByte();return t}readInt16(){var r=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,r}readUint16(){var r=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,r}readInt32(){var r=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,r}readUint32(){var r=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,r}readFloat32(){var r=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,r}readFloat64(){var r=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,r}readChar(){return String.fromCharCode(this.readInt8())}readChars(r){r===void 0&&(r=1),charArray.length=r;for(var t=0;t<r;t++)charArray[t]=this.readChar();return charArray.join("")}writeBoolean(r){this.writeUint8(r?255:0)}writeInt8(r){this.ensureAvailable(1),this._data.setInt8(this.offset++,r)}writeUint8(r){this.ensureAvailable(1),this._data.setUint8(this.offset++,r)}writeByte(r){this.writeUint8(r)}writeBytes(r){this.ensureAvailable(r.length);for(var t=0;t<r.length;t++)this._data.setUint8(this.offset++,r[t])}writeInt16(r){this.ensureAvailable(2),this._data.setInt16(this.offset,r,this.littleEndian),this.offset+=2}writeUint16(r){this.ensureAvailable(2),this._data.setUint16(this.offset,r,this.littleEndian),this.offset+=2}writeInt32(r){this.ensureAvailable(4),this._data.setInt32(this.offset,r,this.littleEndian),this.offset+=4}writeUint32(r){this.ensureAvailable(4),this._data.setUint32(this.offset,r,this.littleEndian),this.offset+=4}writeFloat32(r){this.ensureAvailable(4),this._data.setFloat32(this.offset,r,this.littleEndian),this.offset+=4}writeFloat64(r){this.ensureAvailable(8),this._data.setFloat64(this.offset,r,this.littleEndian),this.offset+=8}writeChar(r){this.writeUint8(r.charCodeAt(0))}writeChars(r){for(var t=0;t<r.length;t++)this.writeUint8(r.charCodeAt(t))}toArray(){return new Uint8Array(this.buffer,0,this.offset)}}var IOBuffer_1=IOBuffer$2,src$4={};const tagsById$5={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},tagsByName$5={};for(var i$2 in tagsById$5)tagsByName$5[tagsById$5[i$2]]=i$2;var standard$1={tagsById:tagsById$5,tagsByName:tagsByName$5};const tagsById$4={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},tagsByName$4={};for(var i$1 in tagsById$4)tagsByName$4[tagsById$4[i$1]]=i$1;var exif$1={tagsById:tagsById$4,tagsByName:tagsByName$4};const tagsById$3={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},tagsByName$3={};for(var i in tagsById$3)tagsByName$3[tagsById$3[i]]=i;var gps$1={tagsById:tagsById$3,tagsByName:tagsByName$3};const tags$1={standard:standard$1,exif:exif$1,gps:gps$1};class IFD$2{constructor(r){if(!r)throw new Error("missing kind");this.data=null,this.fields=new Map,this.kind=r,this._map=null}get(r){if(typeof r=="number")return this.fields.get(r);if(typeof r=="string")return this.fields.get(tags$1[this.kind].tagsByName[r]);throw new Error("expected a number or string")}get map(){if(!this._map){this._map={};const t=tags$1[this.kind].tagsById;for(var r of this.fields.keys())t[r]&&(this._map[t[r]]=this.fields.get(r))}return this._map}}var ifd=IFD$2;const Ifd=ifd,dateTimeRegex$1=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;class TiffIfd$1 extends Ifd{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){var r=new Date,t=dateTimeRegex$1.exec(this.dateTime);return r.setFullYear(t[1],t[2]-1,t[3]),r.setHours(t[4],t[5],t[6]),r}get newSubfileType(){return this.get(254)}get imageWidth(){return this.get(256)}get imageLength(){return this.get(257)}get bitsPerSample(){return this.get(258)}get compression(){return this.get(259)||1}get type(){return this.get(262)}get fillOrder(){return this.get(266)||1}get documentName(){return this.get(269)}get imageDescription(){return this.get(270)}get stripOffsets(){return alwaysArray$1(this.get(273))}get orientation(){return this.get(274)}get samplesPerPixel(){return this.get(277)}get rowsPerStrip(){return this.get(278)}get stripByteCounts(){return alwaysArray$1(this.get(279))}get minSampleValue(){return this.get(280)||0}get maxSampleValue(){return this.get(281)||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get(282)}get yResolution(){return this.get(283)}get planarConfiguration(){return this.get(284)||1}get resolutionUnit(){return this.get(296)||2}get dateTime(){return this.get(306)}get predictor(){return this.get(317)||1}get sampleFormat(){return this.get(339)||1}get sMinSampleValue(){return this.get(340)||this.minSampleValue}get sMaxSampleValue(){return this.get(341)||this.maxSampleValue}}function alwaysArray$1(e){return typeof e=="number"?[e]:e}var tiffIfd=TiffIfd$1,ifdValue={},types$1=new Map([[1,[1,readByte$1]],[2,[1,readASCII$1]],[3,[2,readShort$1]],[4,[4,readLong$1]],[5,[8,readRational$1]],[6,[1,readSByte$1]],[7,[1,readByte$1]],[8,[2,readSShort$1]],[9,[4,readSLong$1]],[10,[8,readSRational$1]],[11,[4,readFloat$1]],[12,[8,readDouble$1]]]);ifdValue.getByteLength=function(e,r){return types$1.get(e)[0]*r};ifdValue.readData=function(e,r,t){return types$1.get(r)[1](e,t)};function readByte$1(e,r){if(r===1)return e.readUint8();for(var t=new Uint8Array(r),n=0;n<r;n++)t[n]=e.readUint8();return t}function readASCII$1(e,r){for(var t=[],n="",a=0;a<r;a++){var s=String.fromCharCode(e.readUint8());s==="\0"?(t.push(n),n=""):n+=s}return t.length===1?t[0]:t}function readShort$1(e,r){if(r===1)return e.readUint16();for(var t=new Uint16Array(r),n=0;n<r;n++)t[n]=e.readUint16();return t}function readLong$1(e,r){if(r===1)return e.readUint32();for(var t=new Uint32Array(r),n=0;n<r;n++)t[n]=e.readUint32();return t}function readRational$1(e,r){if(r===1)return e.readUint32()/e.readUint32();for(var t=new Array(r),n=0;n<r;n++)t[n]=e.readUint32()/e.readUint32();return t}function readSByte$1(e,r){if(r===1)return e.readInt8();for(var t=new Int8Array(r),n=0;n<r;n++)t[n]=e.readInt8();return t}function readSShort$1(e,r){if(r===1)return e.readInt16();for(var t=new Int16Array(r),n=0;n<r;n++)t[n]=e.readInt16();return t}function readSLong$1(e,r){if(r===1)return e.readInt32();for(var t=new Int32Array(r),n=0;n<r;n++)t[n]=e.readInt32();return t}function readSRational$1(e,r){if(r===1)return e.readInt32()/e.readInt32();for(var t=new Array(r),n=0;n<r;n++)t[n]=e.readInt32()/e.readInt32();return t}function readFloat$1(e,r){if(r===1)return e.readFloat32();for(var t=new Float32Array(r),n=0;n<r;n++)t[n]=e.readFloat32();return t}function readDouble$1(e,r){if(r===1)return e.readFloat64();for(var t=new Float64Array(r),n=0;n<r;n++)t[n]=e.readFloat64();return t}const IOBuffer$1=IOBuffer_1,IFD$1=ifd,TiffIFD=tiffIfd,IFDValue=ifdValue,defaultOptions$d={ignoreImageData:!1,onlyFirst:!1};class TIFFDecoder$2 extends IOBuffer$1{constructor(r,t){super(r,t),this._nextIFD=0}decode(r){r=Object.assign({},defaultOptions$d,r);const t=[];for(this.decodeHeader();this._nextIFD;)if(t.push(this.decodeIFD(r)),r.onlyFirst)return t[0];return t}decodeHeader(){let r=this.readUint16();if(r===18761)this.setLittleEndian();else if(r===19789)this.setBigEndian();else throw new Error("invalid byte order: 0x"+r.toString(16));if(r=this.readUint16(),r!==42)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(r){this.seek(this._nextIFD);var t;r.kind?t=new IFD$1(r.kind):t=new TiffIFD;const n=this.readUint16();for(var a=0;a<n;a++)this.decodeIFDEntry(t);return r.ignoreImageData||this.decodeImageData(t),this._nextIFD=this.readUint32(),t}decodeIFDEntry(r){const t=this.offset,n=this.readUint16(),a=this.readUint16(),s=this.readUint32();if(a<1||a>12){this.skip(4);return}IFDValue.getByteLength(a,s)>4&&this.seek(this.readUint32());const l=IFDValue.readData(this,a,s);if(r.fields.set(n,l),n===34665||n===34853){let f=this.offset,h;n===34665?h="exif":n===34853&&(h="gps"),this._nextIFD=l,r[h]=this.decodeIFD({kind:h,ignoreImageData:!0}),this.offset=f}this.seek(t),this.skip(12)}decodeImageData(r){const t=r.orientation;switch(t&&t!==1&&unsupported$1("orientation",t),r.type){case 1:case 2:this.readStripData(r);break;default:unsupported$1("image type",r.type);break}}readStripData(r){const t=r.width,n=r.height,a=validateBitDepth(r.bitsPerSample),s=r.sampleFormat;let o=t*n;const l=getDataArray$1(o,1,a,s),f=r.compression,c=r.rowsPerStrip*t,u=r.stripOffsets,d=r.stripByteCounts;for(var g=0,m=0;m<u.length;m++){var w=this.getStripData(f,u[m],d[m]),v=o>c?c:o;o-=v,a===8?g=fill8bit$1(l,w,g,v):a===16?g=fill16bit$1(l,w,g,v,this.isLittleEndian()):a===32&&s===3?g=fillFloat32$1(l,w,g,v,this.isLittleEndian()):unsupported$1("bitDepth",a)}r.data=l}getStripData(r,t,n){switch(r){case 1:return new DataView(this.buffer,t,n);case 2:case 32773:return unsupported$1("Compression",r);default:throw new Error("invalid compression: "+r)}}}var tiffDecoder=TIFFDecoder$2;function getDataArray$1(e,r,t,n){return t===8?new Uint8Array(e*r):t===16?new Uint16Array(e*r):t===32&&n===3?new Float32Array(e*r):unsupported$1("bit depth / sample format",t+" / "+n)}function fill8bit$1(e,r,t,n){for(var a=0;a<n;a++)e[t++]=r.getUint8(a);return t}function fill16bit$1(e,r,t,n,a){for(var s=0;s<n*2;s+=2)e[t++]=r.getUint16(s,a);return t}function fillFloat32$1(e,r,t,n,a){for(var s=0;s<n*4;s+=4)e[t++]=r.getFloat32(s,a);return t}function unsupported$1(e,r){throw new Error("Unsupported "+e+": "+r)}function validateBitDepth(e){if(e.length){const t=e;e=t[0];for(var r=0;r<t.length;r++)t[r]!==e&&unsupported$1("bit depth",t)}return e}const TIFFDecoder$1=tiffDecoder;var decode$2=function(r,t){return new TIFFDecoder$1(r,t).decode(t)};src$4.decode=decode$2;const IOBuffer=IOBuffer_1,tiff=src$4;function decode$1(e){const r=new IOBuffer(e),t={};if(r.setBigEndian(),r.readUint16()!==65496)throw new Error("SOI marker not found. Not a valid JPEG file");if(r.readUint16()===65505){r.readUint16();const s=r.readBytes(6);if(s[0]===69&&s[1]===120&&s[2]===105&&s[3]===102&&s[4]===0&&s[5]===0){const o=tiff.decode(r,{onlyFirst:!0,ignoreImageData:!0,offset:r.offset});t.exif=o}}return t}var decode_1=decode$1,decode=decode_1,imageType$1={exports:{}},fileType$1={exports:{}};(function(module){const toBytes=e=>[...e].map(r=>r.charCodeAt(0)),xpiZipFilename=toBytes("META-INF/mozilla.rsa"),oxmlContentTypes=toBytes("[Content_Types].xml"),oxmlRels=toBytes("_rels/.rels");function readUInt64LE(e,r=0){let t=e[r],n=1,a=0;for(;++a<8;)n*=256,t+=e[r+a]*n;return t}const fileType=e=>{if(!(e instanceof Uint8Array||e instanceof ArrayBuffer||Buffer.isBuffer(e)))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof e}\``);const r=e instanceof Uint8Array?e:new Uint8Array(e);if(!(r&&r.length>1))return null;const t=(a,s)=>{s=Object.assign({offset:0},s);for(let o=0;o<a.length;o++)if(s.mask){if(a[o]!==(s.mask[o]&r[o+s.offset]))return!1}else if(a[o]!==r[o+s.offset])return!1;return!0},n=(a,s)=>t(toBytes(a),s);if(t([255,216,255]))return{ext:"jpg",mime:"image/jpeg"};if(t([137,80,78,71,13,10,26,10]))return{ext:"png",mime:"image/png"};if(t([71,73,70]))return{ext:"gif",mime:"image/gif"};if(t([87,69,66,80],{offset:8}))return{ext:"webp",mime:"image/webp"};if(t([70,76,73,70]))return{ext:"flif",mime:"image/flif"};if((t([73,73,42,0])||t([77,77,0,42]))&&t([67,82],{offset:8}))return{ext:"cr2",mime:"image/x-canon-cr2"};if(t([73,73,42,0])||t([77,77,0,42]))return{ext:"tif",mime:"image/tiff"};if(t([66,77]))return{ext:"bmp",mime:"image/bmp"};if(t([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(t([56,66,80,83]))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(t([80,75,3,4])){if(t([109,105,109,101,116,121,112,101,97,112,112,108,105,99,97,116,105,111,110,47,101,112,117,98,43,122,105,112],{offset:30}))return{ext:"epub",mime:"application/epub+zip"};if(t(xpiZipFilename,{offset:30}))return{ext:"xpi",mime:"application/x-xpinstall"};if(n("mimetypeapplication/vnd.oasis.opendocument.text",{offset:30}))return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};if(n("mimetypeapplication/vnd.oasis.opendocument.spreadsheet",{offset:30}))return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};if(n("mimetypeapplication/vnd.oasis.opendocument.presentation",{offset:30}))return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"};const a=(f,h=0)=>f.findIndex((c,u,d)=>u>=h&&d[u]===80&&d[u+1]===75&&d[u+2]===3&&d[u+3]===4);let s=0,o=!1,l=null;do{const f=s+30;if(o||(o=t(oxmlContentTypes,{offset:f})||t(oxmlRels,{offset:f})),l||(n("word/",{offset:f})?l={ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}:n("ppt/",{offset:f})?l={ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"}:n("xl/",{offset:f})&&(l={ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})),o&&l)return l;s=a(r,f)}while(s>=0);if(l)return l}if(t([80,75])&&(r[2]===3||r[2]===5||r[2]===7)&&(r[3]===4||r[3]===6||r[3]===8))return{ext:"zip",mime:"application/zip"};if(t([117,115,116,97,114],{offset:257}))return{ext:"tar",mime:"application/x-tar"};if(t([82,97,114,33,26,7])&&(r[6]===0||r[6]===1))return{ext:"rar",mime:"application/x-rar-compressed"};if(t([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(t([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(t([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(t([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(t([51,103,112,53])||t([0,0,0])&&t([102,116,121,112],{offset:4})&&(t([109,112,52,49],{offset:8})||t([109,112,52,50],{offset:8})||t([105,115,111,109],{offset:8})||t([105,115,111,50],{offset:8})||t([109,109,112,52],{offset:8})||t([77,52,86],{offset:8})||t([100,97,115,104],{offset:8})))return{ext:"mp4",mime:"video/mp4"};if(t([77,84,104,100]))return{ext:"mid",mime:"audio/midi"};if(t([26,69,223,163])){const a=r.subarray(4,4100),s=a.findIndex((o,l,f)=>f[l]===66&&f[l+1]===130);if(s!==-1){const o=s+3,l=f=>[...f].every((h,c)=>a[o+c]===h.charCodeAt(0));if(l("matroska"))return{ext:"mkv",mime:"video/x-matroska"};if(l("webm"))return{ext:"webm",mime:"video/webm"}}}if(t([0,0,0,20,102,116,121,112,113,116,32,32])||t([102,114,101,101],{offset:4})||t([102,116,121,112,113,116,32,32],{offset:4})||t([109,100,97,116],{offset:4})||t([109,111,111,118],{offset:4})||t([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(t([82,73,70,70])){if(t([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(t([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(t([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(t([48,38,178,117,142,102,207,17,166,217])){let a=30;do{const s=readUInt64LE(r,a+16);if(t([145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101],{offset:a})){if(t([64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43],{offset:a+24}))return{ext:"wma",mime:"audio/x-ms-wma"};if(t([192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43],{offset:a+24}))return{ext:"wmv",mime:"video/x-ms-asf"};break}a+=s}while(a+24<=r.length);return{ext:"asf",mime:"application/vnd.ms-asf"}}if(t([0,0,1,186])||t([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(t([102,116,121,112,51,103],{offset:4}))return{ext:"3gp",mime:"video/3gpp"};for(let a=0;a<2&&a<r.length-16;a++){if(t([73,68,51],{offset:a})||t([255,226],{offset:a,mask:[255,226]}))return{ext:"mp3",mime:"audio/mpeg"};if(t([255,228],{offset:a,mask:[255,228]}))return{ext:"mp2",mime:"audio/mpeg"};if(t([255,248],{offset:a,mask:[255,252]}))return{ext:"mp2",mime:"audio/mpeg"};if(t([255,240],{offset:a,mask:[255,252]}))return{ext:"mp4",mime:"audio/mpeg"}}if(t([102,116,121,112,77,52,65],{offset:4}))return{ext:"m4a",mime:"audio/mp4"};if(t([79,112,117,115,72,101,97,100],{offset:28}))return{ext:"opus",mime:"audio/opus"};if(t([79,103,103,83]))return t([128,116,104,101,111,114,97],{offset:28})?{ext:"ogv",mime:"video/ogg"}:t([1,118,105,100,101,111,0],{offset:28})?{ext:"ogm",mime:"video/ogg"}:t([127,70,76,65,67],{offset:28})?{ext:"oga",mime:"audio/ogg"}:t([83,112,101,101,120,32,32],{offset:28})?{ext:"spx",mime:"audio/ogg"}:t([1,118,111,114,98,105,115],{offset:28})?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"};if(t([102,76,97,67]))return{ext:"flac",mime:"audio/x-flac"};if(t([77,65,67,32]))return{ext:"ape",mime:"audio/ape"};if(t([119,118,112,107]))return{ext:"wv",mime:"audio/wavpack"};if(t([35,33,65,77,82,10]))return{ext:"amr",mime:"audio/amr"};if(t([37,80,68,70]))return{ext:"pdf",mime:"application/pdf"};if(t([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if((r[0]===67||r[0]===70)&&t([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(t([123,92,114,116,102]))return{ext:"rtf",mime:"application/rtf"};if(t([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(t([119,79,70,70])&&(t([0,1,0,0],{offset:4})||t([79,84,84,79],{offset:4})))return{ext:"woff",mime:"font/woff"};if(t([119,79,70,50])&&(t([0,1,0,0],{offset:4})||t([79,84,84,79],{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(t([76,80],{offset:34})&&(t([0,0,1],{offset:8})||t([1,0,2],{offset:8})||t([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(t([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(t([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(t([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(t([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(t([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(t([37,33]))return{ext:"ps",mime:"application/postscript"};if(t([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(t([83,81,76,105]))return{ext:"sqlite",mime:"application/x-sqlite3"};if(t([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(t([67,114,50,52]))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(t([77,83,67,70])||t([73,83,99,40]))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(t([33,60,97,114,99,104,62,10,100,101,98,105,97,110,45,98,105,110,97,114,121]))return{ext:"deb",mime:"application/x-deb"};if(t([33,60,97,114,99,104,62]))return{ext:"ar",mime:"application/x-unix-archive"};if(t([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(t([31,160])||t([31,157]))return{ext:"Z",mime:"application/x-compress"};if(t([76,90,73,80]))return{ext:"lz",mime:"application/x-lzip"};if(t([208,207,17,224,161,177,26,225]))return{ext:"msi",mime:"application/x-msi"};if(t([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(t([71],{offset:4})&&(t([71],{offset:192})||t([71],{offset:196})))return{ext:"mts",mime:"video/mp2t"};if(t([66,76,69,78,68,69,82]))return{ext:"blend",mime:"application/x-blender"};if(t([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(t([0,0,0,12,106,80,32,32,13,10,135,10])){if(t([106,112,50,32],{offset:20}))return{ext:"jp2",mime:"image/jp2"};if(t([106,112,120,32],{offset:20}))return{ext:"jpx",mime:"image/jpx"};if(t([106,112,109,32],{offset:20}))return{ext:"jpm",mime:"image/jpm"};if(t([109,106,112,50],{offset:20}))return{ext:"mj2",mime:"image/mj2"}}if(t([70,79,82,77]))return{ext:"aif",mime:"audio/aiff"};if(n("<?xml "))return{ext:"xml",mime:"application/xml"};if(t([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(t([102,116,121,112],{offset:4})){if(t([109,105,102,49],{offset:8}))return{ext:"heic",mime:"image/heif"};if(t([109,115,102,49],{offset:8}))return{ext:"heic",mime:"image/heif-sequence"};if(t([104,101,105,99],{offset:8})||t([104,101,105,120],{offset:8}))return{ext:"heic",mime:"image/heic"};if(t([104,101,118,99],{offset:8})||t([104,101,118,120],{offset:8}))return{ext:"heic",mime:"image/heic-sequence"}}return t([171,75,84,88,32,49,49,187,13,10,26,10])?{ext:"ktx",mime:"image/ktx"}:t([68,73,67,77],{offset:128})?{ext:"dcm",mime:"application/dicom"}:t([77,80,43])?{ext:"mpc",mime:"audio/x-musepack"}:t([77,80,67,75])?{ext:"mpc",mime:"audio/x-musepack"}:t([66,69,71,73,78,58])?{ext:"ics",mime:"text/calendar"}:t([103,108,84,70,2,0,0,0])?{ext:"glb",mime:"model/gltf-binary"}:t([212,195,178,161])||t([161,178,195,212])?{ext:"pcap",mime:"application/vnd.tcpdump.pcap"}:null};module.exports=fileType,module.exports.default=fileType,Object.defineProperty(fileType,"minimumBytes",{value:4100}),module.exports.stream=readableStream=>new Promise((resolve,reject)=>{const stream=eval("require")("stream");readableStream.once("readable",()=>{const e=new stream.PassThrough,r=readableStream.read(module.exports.minimumBytes)||readableStream.read();try{e.fileType=fileType(r)}catch(t){reject(t)}readableStream.unshift(r),stream.pipeline?resolve(stream.pipeline(readableStream,e,()=>{})):resolve(readableStream.pipe(e))})})})(fileType$1);const fileType=fileType$1.exports,imageExts=new Set(["jpg","png","gif","webp","flif","cr2","tif","bmp","jxr","psd","ico","bpg","jp2","jpm","jpx","heic","cur","dcm"]),imageType=e=>{const r=fileType(e);return imageExts.has(r&&r.ext)?r:null};imageType$1.exports=imageType;imageType$1.exports.default=imageType;Object.defineProperty(imageType,"minimumBytes",{value:fileType.minimumBytes});function guessStripByteCounts(e){if(e.compression!==1)throw new Error("missing mandatory StripByteCounts field in compressed image");const r=e.rowsPerStrip*e.width*e.samplesPerPixel*(e.bitsPerSample/8);return new Array(e.stripOffsets.length).fill(r)}function applyHorizontalDifferencing8Bit(e,r,t){let n=0;for(;n<e.length;){for(let a=t;a<r*t;a+=t)for(let s=0;s<t;s++)e[n+a+s]=e[n+a+s]+e[n+a-(t-s)]&255;n+=r*t}}function applyHorizontalDifferencing16Bit(e,r,t){let n=0;for(;n<e.length;){for(let a=t;a<r*t;a+=t)for(let s=0;s<t;s++)e[n+a+s]=e[n+a+s]+e[n+a-(t-s)]&65535;n+=r*t}}const tagsById$2={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},tagsByName$2={};for(let e in tagsById$2)tagsByName$2[tagsById$2[e]]=Number(e);const exif=Object.freeze(Object.defineProperty({__proto__:null,tagsById:tagsById$2,tagsByName:tagsByName$2},Symbol.toStringTag,{value:"Module"})),tagsById$1={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},tagsByName$1={};for(let e in tagsById$1)tagsByName$1[tagsById$1[e]]=Number(e);const gps=Object.freeze(Object.defineProperty({__proto__:null,tagsById:tagsById$1,tagsByName:tagsByName$1},Symbol.toStringTag,{value:"Module"})),tagsById={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},tagsByName={};for(let e in tagsById)tagsByName[tagsById[e]]=Number(e);const standard=Object.freeze(Object.defineProperty({__proto__:null,tagsById,tagsByName},Symbol.toStringTag,{value:"Module"})),tags={standard,exif,gps};class IFD{constructor(r){if(!r)throw new Error("missing kind");this.data=new Uint8Array,this.fields=new Map,this.kind=r,this._hasMap=!1,this._map={}}get(r){if(typeof r=="number")return this.fields.get(r);if(typeof r=="string")return this.fields.get(tags[this.kind].tagsByName[r]);throw new Error("expected a number or string")}get map(){if(!this._hasMap){const r=tags[this.kind].tagsById;for(let t of this.fields.keys())r[t]&&(this._map[r[t]]=this.fields.get(t));this._hasMap=!0}return this._map}}let types=new Map([[1,[1,readByte]],[2,[1,readASCII]],[3,[2,readShort]],[4,[4,readLong]],[5,[8,readRational]],[6,[1,readSByte]],[7,[1,readByte]],[8,[2,readSShort]],[9,[4,readSLong]],[10,[8,readSRational]],[11,[4,readFloat]],[12,[8,readDouble]]]);function getByteLength(e,r){const t=types.get(e);if(!t)throw new Error(`type not found: ${e}`);return t[0]*r}function readData(e,r,t){const n=types.get(r);if(!n)throw new Error(`type not found: ${r}`);return n[1](e,t)}function readByte(e,r){if(r===1)return e.readUint8();let t=new Uint8Array(r);for(let n=0;n<r;n++)t[n]=e.readUint8();return t}function readASCII(e,r){let t=[],n="";for(let a=0;a<r;a++){let s=String.fromCharCode(e.readUint8());s==="\0"?(t.push(n),n=""):n+=s}return t.length===1?t[0]:t}function readShort(e,r){if(r===1)return e.readUint16();let t=new Uint16Array(r);for(let n=0;n<r;n++)t[n]=e.readUint16();return t}function readLong(e,r){if(r===1)return e.readUint32();let t=new Uint32Array(r);for(let n=0;n<r;n++)t[n]=e.readUint32();return t}function readRational(e,r){if(r===1)return e.readUint32()/e.readUint32();let t=new Array(r);for(let n=0;n<r;n++)t[n]=e.readUint32()/e.readUint32();return t}function readSByte(e,r){if(r===1)return e.readInt8();let t=new Int8Array(r);for(let n=0;n<r;n++)t[n]=e.readInt8();return t}function readSShort(e,r){if(r===1)return e.readInt16();let t=new Int16Array(r);for(let n=0;n<r;n++)t[n]=e.readInt16();return t}function readSLong(e,r){if(r===1)return e.readInt32();let t=new Int32Array(r);for(let n=0;n<r;n++)t[n]=e.readInt32();return t}function readSRational(e,r){if(r===1)return e.readInt32()/e.readInt32();let t=new Array(r);for(let n=0;n<r;n++)t[n]=e.readInt32()/e.readInt32();return t}function readFloat(e,r){if(r===1)return e.readFloat32();let t=new Float32Array(r);for(let n=0;n<r;n++)t[n]=e.readFloat32();return t}function readDouble(e,r){if(r===1)return e.readFloat64();let t=new Float64Array(r);for(let n=0;n<r;n++)t[n]=e.readFloat64();return t}const CLEAR_CODE=256,EOI_CODE=257,TABLE_START=258,MIN_BIT_LENGTH=9;let stringTable=[];function initializeStringTable(){if(stringTable.length===0){for(let r=0;r<256;r++)stringTable.push([r]);const e=[];for(let r=256;r<4096;r++)stringTable.push(e)}}const andTable=[511,1023,2047,4095],bitJumps=[0,0,0,0,0,0,0,0,0,511,1023,2047,4095];class LzwDecoder{constructor(r){this.nextData=0,this.nextBits=0,this.bytePointer=0,this.tableLength=TABLE_START,this.currentBitLength=MIN_BIT_LENGTH,this.stripArray=new Uint8Array(r.buffer,r.byteOffset,r.byteLength),this.outData=new IOBuffer$4(r.byteLength),this.initializeTable()}decode(){let r=0,t=0;for(;(r=this.getNextCode())!==EOI_CODE;)if(r===CLEAR_CODE){if(this.initializeTable(),r=this.getNextCode(),r===EOI_CODE)break;this.writeString(this.stringFromCode(r)),t=r}else if(this.isInTable(r))this.writeString(this.stringFromCode(r)),this.addStringToTable(this.stringFromCode(t).concat(this.stringFromCode(r)[0])),t=r;else{const a=this.stringFromCode(t).concat(this.stringFromCode(t)[0]);this.writeString(a),this.addStringToTable(a),t=r}const n=this.outData.toArray();return new DataView(n.buffer,n.byteOffset,n.byteLength)}initializeTable(){initializeStringTable(),this.tableLength=TABLE_START,this.currentBitLength=MIN_BIT_LENGTH}writeString(r){this.outData.writeBytes(r)}stringFromCode(r){return stringTable[r]}isInTable(r){return r<this.tableLength}addStringToTable(r){if(stringTable[this.tableLength++]=r,stringTable.length>4096)throw stringTable=[],new Error("LZW decoding error. Please open an issue at https://github.com/image-js/tiff/issues/new/choose (include a test image).");this.tableLength===bitJumps[this.currentBitLength]&&this.currentBitLength++}getNextCode(){this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8,this.nextBits<this.currentBitLength&&(this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8);const r=this.nextData>>this.nextBits-this.currentBitLength&andTable[this.currentBitLength-9];return this.nextBits-=this.currentBitLength,this.bytePointer>this.stripArray.length?257:r}}function decompressLzw(e){return new LzwDecoder(e).decode()}const dateTimeRegex=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;class TiffIfd extends IFD{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){let r=new Date,t=dateTimeRegex.exec(this.dateTime);if(t===null)throw new Error(`invalid dateTime: ${this.dateTime}`);return r.setFullYear(Number(t[1]),Number(t[2])-1,Number(t[3])),r.setHours(Number(t[4]),Number(t[5]),Number(t[6])),r}get newSubfileType(){return this.get("NewSubfileType")}get imageWidth(){return this.get("ImageWidth")}get imageLength(){return this.get("ImageLength")}get bitsPerSample(){const r=this.get("BitsPerSample");return r&&typeof r!="number"?r[0]:r}get alpha(){const r=this.extraSamples;return r?r[0]!==0:!1}get associatedAlpha(){const r=this.extraSamples;return r?r[0]===1:!1}get extraSamples(){return alwaysArray(this.get("ExtraSamples"))}get compression(){return this.get("Compression")||1}get type(){return this.get("PhotometricInterpretation")}get fillOrder(){return this.get("FillOrder")||1}get documentName(){return this.get("DocumentName")}get imageDescription(){return this.get("ImageDescription")}get stripOffsets(){return alwaysArray(this.get("StripOffsets"))}get orientation(){return this.get("Orientation")}get samplesPerPixel(){return this.get("SamplesPerPixel")||1}get rowsPerStrip(){return this.get("RowsPerStrip")}get stripByteCounts(){return alwaysArray(this.get("StripByteCounts"))}get minSampleValue(){return this.get("MinSampleValue")||0}get maxSampleValue(){return this.get("MaxSampleValue")||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get("XResolution")}get yResolution(){return this.get("YResolution")}get planarConfiguration(){return this.get("PlanarConfiguration")||1}get resolutionUnit(){return this.get("ResolutionUnit")||2}get dateTime(){return this.get("DateTime")}get predictor(){return this.get("Predictor")||1}get sampleFormat(){return this.get("SampleFormat")||1}get sMinSampleValue(){return this.get("SMinSampleValue")||this.minSampleValue}get sMaxSampleValue(){return this.get("SMaxSampleValue")||this.maxSampleValue}get palette(){const r=2**this.bitsPerSample,t=this.get("ColorMap");if(!t)return;if(t.length!==3*r)throw new Error(`ColorMap size must be ${r}`);const n=[];for(let a=0;a<r;a++)n.push([t[a],t[a+r],t[a+2*r]]);return n}}function alwaysArray(e){return typeof e=="number"?[e]:e}function decompressZlib(e){const r=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),t=inflate_1(r);return new DataView(t.buffer,t.byteOffset,t.byteLength)}const defaultOptions$c={ignoreImageData:!1,onlyFirst:!1};class TIFFDecoder extends IOBuffer$4{constructor(r){super(r),this._nextIFD=0}get isMultiPage(){let r=0;for(this.decodeHeader();this._nextIFD;)if(r++,this.decodeIFD({ignoreImageData:!0},!0),r===2)return!0;if(r===1)return!1;throw unsupported("ifdCount",r)}get pageCount(){let r=0;for(this.decodeHeader();this._nextIFD;)r++,this.decodeIFD({ignoreImageData:!0},!0);if(r>0)return r;throw unsupported("ifdCount",r)}decode(r={}){r=Object.assign({},defaultOptions$c,r);const t=[];for(this.decodeHeader();this._nextIFD;)if(t.push(this.decodeIFD(r,!0)),r.onlyFirst)return[t[0]];return t}decodeHeader(){const r=this.readUint16();if(r===18761)this.setLittleEndian();else if(r===19789)this.setBigEndian();else throw new Error(`invalid byte order: 0x${r.toString(16)}`);if(this.readUint16()!==42)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(r,t){this.seek(this._nextIFD);let n;if(t)n=new TiffIfd;else{if(!r.kind)throw new Error("kind is missing");n=new IFD(r.kind)}const a=this.readUint16();for(let s=0;s<a;s++)this.decodeIFDEntry(n);if(!r.ignoreImageData){if(!(n instanceof TiffIfd))throw new Error("must be a tiff ifd");this.decodeImageData(n)}return this._nextIFD=this.readUint32(),n}decodeIFDEntry(r){const t=this.offset,n=this.readUint16(),a=this.readUint16(),s=this.readUint32();if(a<1||a>12){this.skip(4);return}getByteLength(a,s)>4&&this.seek(this.readUint32());const l=readData(this,a,s);if(r.fields.set(n,l),n===34665||n===34853){let f=this.offset,h="exif";n===34665?h="exif":n===34853&&(h="gps"),this._nextIFD=l,r[h]=this.decodeIFD({kind:h,ignoreImageData:!0},!1),this.offset=f}this.seek(t),this.skip(12)}decodeImageData(r){const t=r.orientation;if(t&&t!==1)throw unsupported("orientation",t);switch(r.type){case 0:case 1:case 2:case 3:this.readStripData(r);break;default:throw unsupported("image type",r.type)}if(this.applyPredictor(r),this.convertAlpha(r),r.type===0){const n=r.bitsPerSample,a=Math.pow(2,n)-1;for(let s=0;s<r.data.length;s++)r.data[s]=a-r.data[s]}}readStripData(r){const t=r.width,n=r.height,a=r.bitsPerSample,s=r.sampleFormat,o=t*n*r.samplesPerPixel,l=getDataArray(o,a,s),h=r.rowsPerStrip*t*r.samplesPerPixel,c=r.stripOffsets,u=r.stripByteCounts||guessStripByteCounts(r);let d=o,g=0;for(let m=0;m<c.length;m++){let w=new DataView(this.buffer,this.byteOffset+c[m],u[m]),v=d>h?h:d;d-=v;let x=w;switch(r.compression){case 1:break;case 5:{x=decompressLzw(w);break}case 8:{x=decompressZlib(w);break}case 2:throw unsupported("Compression","CCITT Group 3");case 32773:throw unsupported("Compression","PackBits");default:throw unsupported("Compression",r.compression)}g=this.fillUncompressed(a,s,l,x,g,v)}r.data=l}fillUncompressed(r,t,n,a,s,o){if(r===8)return fill8bit(n,a,s,o);if(r===16)return fill16bit(n,a,s,o,this.isLittleEndian());if(r===32&&t===3)return fillFloat32(n,a,s,o,this.isLittleEndian());throw unsupported("bitDepth",r)}applyPredictor(r){const t=r.bitsPerSample;switch(r.predictor){case 1:break;case 2:{if(t===8)applyHorizontalDifferencing8Bit(r.data,r.width,r.components);else if(t===16)applyHorizontalDifferencing16Bit(r.data,r.width,r.components);else throw new Error(`Horizontal differencing is only supported for images with a bit depth of ${t}`);break}default:throw new Error(`invalid predictor: ${r.predictor}`)}}convertAlpha(r){if(r.alpha&&r.associatedAlpha){const{data:t,components:n,maxSampleValue:a}=r;for(let s=0;s<t.length;s+=n){const o=t[s+n-1];for(let l=0;l<n-1;l++)t[s+l]=Math.round(t[s+l]*a/o)}}}}function getDataArray(e,r,t){if(r===8)return new Uint8Array(e);if(r===16)return new Uint16Array(e);if(r===32&&t===3)return new Float32Array(e);throw unsupported("bit depth / sample format",`${r} / ${t}`)}function fill8bit(e,r,t,n){for(let a=0;a<n;a++)e[t++]=r.getUint8(a);return t}function fill16bit(e,r,t,n,a){for(let s=0;s<n*2;s+=2)e[t++]=r.getUint16(s,a);return t}function fillFloat32(e,r,t,n,a){for(let s=0;s<n*4;s+=4)e[t++]=r.getFloat32(s,a);return t}function unsupported(e,r){return new Error(`Unsupported ${e}: ${r}`)}function decodeTIFF(e,r){return new TIFFDecoder(e).decode(r)}function matchAndCrop(e={}){let{algorithm:r="matchToPrevious",ignoreBorder:t=[0,0]}=e;this.checkProcessable("matchAndCrop",{bitDepth:[8,16]});let n=r==="matchToPrevious",a=this[0],s=[];s[0]={position:[0,0],image:this[0]};let o=[0,0];for(let d=1;d<this.length;d++){let g=a.getBestMatch(this[d],{border:t});s[d]={position:[g[0]+o[0],g[1]+o[1]],image:this[d]},n&&(o[0]+=g[0],o[1]+=g[1],a=this[d])}let l=0,f=0,h=0,c=0;for(let d=0;d<s.length;d++){let g=s[d];g.position[0]>l&&(l=g.position[0]),g.position[0]<f&&(f=g.position[0]),g.position[1]>h&&(h=g.position[1]),g.position[1]<c&&(c=g.position[1])}f=0-f,c=0-c;for(let d=0;d<s.length;d++){let g=s[d];g.crop=g.image.crop({x:l-g.position[0],y:h-g.position[1],width:a.width-f-l,height:a.height-c-h})}let u=[];for(let d=0;d<s.length;d++)u[d]=s[d].crop;return new Stack(u)}function min$2(){this.checkProcessable("min",{bitDepth:[8,16]});let e=this[0].min;for(let r=1;r<this.length;r++)for(let t=0;t<e.length;t++)e[t]=Math.min(e[t],this[r].min[t]);return e}function max$2(){this.checkProcessable("min",{bitDepth:[8,16]});let e=this[0].max;for(let r=1;r<this.length;r++)for(let t=0;t<e.length;t++)e[t]=Math.max(e[t],this[r].max[t]);return e}function median$2(e){let r=e.reduce((o,l)=>o+l);if(r===0)throw new Error("unreachable");let t=0,n=0,a=r/2,s;for(;;){if(e[t]>0){if(s!==void 0)return(s+t)/2;if(n+=e[t],n>a)return t;n===a&&(s=t)}t++}}function mean$2(e){let r=0,t=0;for(let n=0;n<e.length;n++)r+=e[n],t+=e[n]*n;return r===0?0:t/r}function median$1(){this.checkProcessable("median",{bitDepth:[8,16]});let e=this.getHistograms({maxSlots:this[0].maxValue+1}),r=new Array(e.length);for(let t=0;t<e.length;t++){let n=e[t];r[t]=median$2(n)}return r}function histogram(e){this.checkProcessable("min",{bitDepth:[8,16]});let r=this[0].getHistogram(e);for(let t=1;t<this.length;t++){let n=this[t].getHistogram(e);for(let a=0;a<r.length;a++)r[a]+=n[a]}return r}function histograms(e){this.checkProcessable("min",{bitDepth:[8,16]});let r=this[0].getHistograms(e),t=r[0].length;for(let n=1;n<this.length;n++){let a=this[n].getHistograms(e);for(let s=0;s<r.length;s++)for(let o=0;o<t;o++)r[s][o]+=a[s][o]}return r}function averageImage(){this.checkProcessable("averageImage",{bitDepth:[8,16]});let e=new Uint32Array(this[0].data.length);for(let n=0;n<this.length;n++){let a=this[n];for(let s=0;s<this[0].data.length;s++)e[s]+=a.data[s]}let r=Image$1.createFrom(this[0]),t=r.data;for(let n=0;n<this[0].data.length;n++)t[n]=e[n]/this.length;return r}function maxImage(){this.checkProcessable("max",{bitDepth:[8,16]});let e=Image$1.createFrom(this[0]);e.data.fill(0);for(const r of this)for(let t=0;t<e.data.length;t++)e.data[t]=Math.max(r.data[t],e.data[t]);return e}function minImage(){this.checkProcessable("max",{bitDepth:[8,16]});let e=Image$1.createFrom(this[0]);e.data.fill(e.maxValue);for(const r of this)for(let t=0;t<e.data.length;t++)e.data[t]=Math.min(r.data[t],e.data[t]);return e}function extend$2(e){e.extendMethod("matchAndCrop",matchAndCrop),e.extendMethod("getMin",min$2),e.extendMethod("getMax",max$2),e.extendMethod("getMedian",median$1),e.extendMethod("getHistogram",histogram),e.extendMethod("getHistograms",histograms),e.extendMethod("getAverage",averageImage),e.extendMethod("getAverageImage",averageImage),e.extendMethod("getMaxImage",maxImage),e.extendMethod("getMinImage",minImage)}let computedPropertyDescriptor={configurable:!0,enumerable:!1,get:void 0};class Stack extends Array{constructor(r){if(Array.isArray(r)){super(r.length);for(let t=0;t<r.length;t++)this[t]=r[t]}else typeof r=="number"?super(r):super();this.computed=null}static load(r){return Promise.all(r.map(Image$1.load)).then(t=>new Stack(t))}static extendMethod(r,t,n={}){let{inPlace:a=!1,returnThis:s=!0,partialArgs:o=[]}=n;return a?Stack.prototype[r]=function(...l){this.computed=null;let f=t.apply(this,[...o,...l]);return s?this:f}:Stack.prototype[r]=function(...l){return t.apply(this,[...o,...l])},Stack}static extendProperty(r,t,n={}){let{partialArgs:a=[]}=n;return computedPropertyDescriptor.get=function(){if(this.computed===null)this.computed={};else if(hasOwn(r,this.computed))return this.computed[r];let s=t.apply(this,a);return this.computed[r]=s,s},Object.defineProperty(Stack.prototype,r,computedPropertyDescriptor),Stack}checkProcessable(r,t={}){if(typeof r!="string")throw new TypeError("checkProcessable requires as first parameter the processName (a string)");if(this.size===0)throw new TypeError(`The process: ${r} can not be applied on an empty stack`);this[0].checkProcessable(r,t);for(let n=1;n<this.length;n++){if((t.sameSize===void 0||t.sameSize)&&this[0].width!==this[n].width)throw new TypeError(`The process: ${r} can not be applied if width is not identical in all images`);if((t.sameSize===void 0||t.sameSize)&&this[0].height!==this[n].height)throw new TypeError(`The process: ${r} can not be applied if height is not identical in all images`);if((t.sameAlpha===void 0||t.sameAlpha)&&this[0].alpha!==this[n].alpha)throw new TypeError(`The process: ${r} can not be applied if alpha is not identical in all images`);if((t.sameBitDepth===void 0||t.sameBitDepth)&&this[0].bitDepth!==this[n].bitDepth)throw new TypeError(`The process: ${r} can not be applied if bitDepth is not identical in all images`);if((t.sameColorModel===void 0||t.sameColorModel)&&this[0].colorModel!==this[n].colorModel)throw new TypeError(`The process: ${r} can not be applied if colorModel is not identical in all images`);if((t.sameNumberChannels===void 0||t.sameNumberChannels)&&this[0].channels!==this[n].channels)throw new TypeError(`The process: ${r} can not be applied if channels is not identical in all images`)}}}Array[Symbol.species]||(Stack.prototype.map=function(e,r){if(typeof e!="function")throw new TypeError(`${e} is not a function`);let t=new Stack(this.length);for(let n=0;n<this.length;n++)t[n]=e.call(r,this[n],n,this);return t});extend$2(Stack);const isDataURL=/^data:[a-z]+\/(?:[a-z]+);base64,/;function load$1(e,r){if(typeof e=="string")return loadURL(e,r);if(e instanceof ArrayBuffer)return Promise.resolve(loadBinary(new Uint8Array(e),void 0,r&&r.ignorePalette));if(e.buffer)return Promise.resolve(loadBinary(e,void 0,r&&r.ignorePalette));throw new Error('argument to "load" must be a string or buffer.')}function loadBinary(e,r,t){const n=imageType$1.exports(e);if(n)switch(n.mime){case"image/png":return loadPNG(e);case"image/jpeg":return loadJPEG(e);case"image/tiff":return loadTIFF(e,t);default:return loadGeneric(a(n.mime))}return loadGeneric(a("application/octet-stream"));function a(s){return r||toBase64URL(e,s)}}function loadURL(e,r){const t=e.slice(0,64).match(isDataURL);let n;return t!==null?n=Promise.resolve(decode$3(e.slice(t[0].length))):n=fetchBinary(e,r),n.then(a=>{const s=new Uint8Array(a);return loadBinary(s,t?e:void 0,r&&r.ignorePalette)})}function loadPNG(e){const r=decodePng(e);let t=r.channels,n,a=0;return t===2||t===4?(n=t-1,a=1):n=t,r.palette?loadPNGFromPalette(r):new Image$1(r.width,r.height,r.data,{components:n,alpha:a,bitDepth:r.depth})}function loadPNGFromPalette(e){const r=e.width*e.height,t=e.palette[0].length,n=new Uint8Array(r*t),a=8/e.depth,s=e.depth<8?a:1,o=parseInt("1".repeat(e.depth),2),l=t===4;let f=0;for(let h=0;h<r;h++){const c=Math.floor(h/s);let u=e.data[c];e.depth<8&&(u=u>>>e.depth*(a-1-h%a)&o);const d=e.palette[u];n[f++]=d[0],n[f++]=d[1],n[f++]=d[2],l&&(n[f++]=d[3])}return new Image$1(e.width,e.height,n,{components:3,alpha:l,bitDepth:8})}function loadJPEG(e){const r=decode(e);let t;r.exif&&(t=getMetadata(r.exif));const n=jpegJs.decode(e,{useTArray:!0,maxMemoryUsageInMB:1024});let a=new Image$1(n.width,n.height,n.data,{meta:t});if(t&&t.tiff.tags.Orientation){const s=t.tiff.tags.Orientation;s>2&&(a=a.rotate({3:180,4:180,5:90,6:90,7:270,8:270}[s])),[2,4,5,7].includes(s)&&(a=a.flipX())}return a}function loadTIFF(e,r){let t=decodeTIFF(e);return t.length===1?getImageFromIFD(t[0],r):new Stack(t.map(function(n){return getImageFromIFD(n,r)}))}function getMetadata(e){const r={tiff:{fields:e.fields,tags:e.map}};return e.exif&&(r.exif=e.exif),e.gps&&(r.gps=e.gps),r}function getImageFromIFD(e,r){if(!r&&e.type===3){const t=new Uint16Array(3*e.width*e.height),n=e.palette;let a=0;for(let s=0;s<e.data.length;s++){const o=e.data[s],l=n[o];t[a++]=l[0],t[a++]=l[1],t[a++]=l[2]}return new Image$1(e.width,e.height,t,{components:3,alpha:e.alpha,colorModel:RGB$1,bitDepth:16,meta:getMetadata(e)})}else return new Image$1(e.width,e.height,e.data,{components:e.type===2?3:1,alpha:e.alpha,colorModel:e.type===2?RGB$1:GREY$1,bitDepth:e.bitsPerSample.length?e.bitsPerSample[0]:e.bitsPerSample,meta:getMetadata(e)})}function loadGeneric(e,r){return r=r||{},new Promise(function(t,n){let a=new DOMImage;a.onload=function(){let s=a.width,o=a.height,f=createCanvas(s,o).getContext("2d");f.drawImage(a,0,0,s,o);let h=f.getImageData(0,0,s,o).data;t(new Image$1(s,o,h,r))},a.onerror=function(){n(new Error(`Could not load ${e}`))},a.src=e})}const valueMethods={getValueXY(e,r,t){return this.data[(r*this.width+e)*this.channels+t]},setValueXY(e,r,t,n){return this.data[(r*this.width+e)*this.channels+t]=n,this.computed=null,this},getValue(e,r){return this.data[e*this.channels+r]},setValue(e,r,t){return this.data[e*this.channels+r]=t,this.computed=null,this},getPixelXY(e,r){return this.getPixel(r*this.width+e)},setPixelXY(e,r,t){return this.setPixel(r*this.width+e,t)},getPixel(e){const r=new Array(this.channels),t=e*this.channels;for(let n=0;n<this.channels;n++)r[n]=this.data[t+n];return r},setPixel(e,r){const t=e*this.channels;for(let n=0;n<r.length;n++)this.data[t+n]=r[n];return this.computed=null,this}};function setValueMethods(e){for(const r in valueMethods)e.prototype[r]=valueMethods[r]}function getImageParameters(e){return{width:e.width,height:e.height,components:e.components,alpha:e.alpha,colorModel:e.colorModel,bitDepth:e.bitDepth}}function getOutputImage(e,r,t,n={}){const{out:a}=r;if(a===void 0)return n.copy?e.clone():Image$1.createFrom(e,t);{if(!Image$1.isImage(a))throw new TypeError("out must be an Image object");const s=Object.assign(getImageParameters(e),t);for(const o in s)if(a[o]!==s[o])throw new RangeError(`cannot use out. Its ${o} must be "${s[o]}" (found "${a[o]}")`);return a}}function getOutputImageOrInPlace(e,r,t){if(r.inPlace!==void 0&&typeof r.inPlace!="boolean")throw new TypeError("inPlace option must be a boolean");if(r.inPlace){if(r.out!==void 0)throw new TypeError("out option must not be set if inPlace option is true");return e}return getOutputImage(e,r,null,t)}function abs(e={}){this.checkProcessable("abs",{bitDepth:[32]});const r=getOutputImageOrInPlace(this,e);return absolute(this,r),r}function absolute(e,r){for(let t=0;t<e.data.length;t++)r.data[t]=Math.abs(e.data[t])}function copyAlphaChannel(e,r){if(e.alpha===1&&r.alpha===1)for(let t=0;t<e.size;t++)r.data[t*r.channels+r.components]=e.data[t*e.channels+e.components]}function invert(e={}){this.checkProcessable("invert",{bitDepth:[1,8,16]});const r=getOutputImageOrInPlace(this,e);return this.bitDepth===1?invertBinary(this,r):(invertColor(this,r),this!==r&&copyAlphaChannel(this,r)),r}function invertBinary(e,r){for(let t=0;t<e.data.length;t++)r.data[t]=~e.data[t]}function invertColor(e,r){for(let t=0;t<e.data.length;t+=e.channels)for(let n=0;n<e.components;n++)r.data[t+n]=e.maxValue-e.data[t+n]}function flipX(){this.checkProcessable("flipX",{bitDepth:[8,16]});for(let e=0;e<this.height;e++){let r=e*this.width*this.channels;for(let t=0;t<Math.floor(this.width/2);t++){let n=t*this.channels+r,a=(this.width-t-1)*this.channels+r;for(let s=0;s<this.channels;s++){let o=this.data[n+s];this.data[n+s]=this.data[a+s],this.data[a+s]=o}}}return this}function flipY(){this.checkProcessable("flipY",{bitDepth:[8,16]});for(let e=0;e<Math.floor(this.height/2);e++)for(let r=0;r<this.width;r++){let t=r*this.channels+e*this.width*this.channels,n=r*this.channels+(this.height-1-e)*this.channels*this.width;for(let a=0;a<this.channels;a++){let s=this.data[t+a];this.data[t+a]=this.data[n+a],this.data[n+a]=s}}return this}function blurFilter(e={}){const{radius:r=1}=e;if(r<1)throw new Error("radius must be greater than 1");const t=2*r+1,n=new Array(t);for(let a=0;a<t;a++){n[a]=new Array(t);for(let s=0;s<t;s++)n[a][s]=1/(t*t)}return this.convolution(n)}var medianQuickselect_min={exports:{}};(function(e){(function(){function r(a){for(var s=0,o=a.length-1,l=void 0,f=void 0,h=void 0,c=n(s,o);;){if(o<=s)return a[c];if(o==s+1)return a[s]>a[o]&&t(a,s,o),a[c];for(l=n(s,o),a[l]>a[o]&&t(a,l,o),a[s]>a[o]&&t(a,s,o),a[l]>a[s]&&t(a,l,s),t(a,l,s+1),f=s+1,h=o;;){do f++;while(a[s]>a[f]);do h--;while(a[h]>a[s]);if(h<f)break;t(a,f,h)}t(a,s,h),h<=c&&(s=f),h>=c&&(o=h-1)}}var t=function(s,o,l){var f;return f=[s[l],s[o]],s[o]=f[0],s[l]=f[1],f},n=function(s,o){return~~((s+o)/2)};e.exports?e.exports=r:window.median=r})()})(medianQuickselect_min);const quickSelectMedian=medianQuickselect_min.exports;function validateArrayOfChannels(e,r={}){let{channels:t,allowAlpha:n,defaultAlpha:a}=r;return typeof n!="boolean"&&(n=!0),typeof t>"u"?allChannels(e,a):validateChannels(e,t,n)}function allChannels(e,r){let t=r?e.channels:e.components,n=new Array(t);for(let a=0;a<t;a++)n[a]=a;return n}function validateChannels(e,r,t){Array.isArray(r)||(r=[r]);for(let n=0;n<r.length;n++)r[n]=validateChannel(e,r[n],t);return r}function validateChannel(e,r,t=!0){if(r===void 0)throw new RangeError(`validateChannel : the channel has to be >=0 and <${e.channels}`);if(typeof r=="string"){switch(e.colorModel){case GREY$1:break;case RGB$1:if("rgb".includes(r))switch(r){case"r":r=0;break;case"g":r=1;break;case"b":r=2;break}break;case HSL:if("hsl".includes(r))switch(r){case"h":r=0;break;case"s":r=1;break;case"l":r=2;break}break;case HSV:if("hsv".includes(r))switch(r){case"h":r=0;break;case"s":r=1;break;case"v":r=2;break}break;case CMYK$1:if("cmyk".includes(r))switch(r){case"c":r=0;break;case"m":r=1;break;case"y":r=2;break;case"k":r=3;break}break;default:throw new Error(`Unexpected color model: ${e.colorModel}`)}if(r==="a"){if(!e.alpha)throw new Error("validateChannel : the image does not contain alpha channel");r=e.components}if(typeof r=="string")throw new Error(`validateChannel : undefined channel: ${r}`)}if(r>=e.channels)throw new RangeError(`validateChannel : the channel has to be >=0 and <${e.channels}`);if(!t&&r>=e.components)throw new RangeError("validateChannel : alpha channel may not be selected");return r}function medianFilter(e={}){let{radius:r=1,border:t="copy",channels:n}=e;if(this.checkProcessable("medianFilter",{bitDepth:[8,16]}),r<1)throw new Error("radius must be greater than 0");n=validateArrayOfChannels(this,n);let a=r,s=r,o=Image$1.createFrom(this),l=(a*2+1)*(s*2+1),f=new Array(l);for(let h=0;h<n.length;h++){let c=n[h];for(let u=s;u<this.height-s;u++)for(let d=a;d<this.width-a;d++){let g=0;for(let w=-s;w<=s;w++)for(let v=-a;v<=a;v++){let x=((u+w)*this.width+d+v)*this.channels+c;f[g++]=this.data[x]}let m=(u*this.width+d)*this.channels+c;o.data[m]=quickSelectMedian(f)}}if(this.alpha&&!n.includes(this.channels))for(let h=this.components;h<this.data.length;h=h+this.channels)o.data[h]=this.data[h];return o.setBorder({size:[a,s],algorithm:t}),o}function gaussianFilter(e={}){let{radius:r=1,sigma:t,channels:n,border:a="copy"}=e;this.checkProcessable("gaussian",{bitDepth:[8,16]});const s=getKernel(r,t);return this.convolution([s,s],{border:a,channels:n,algorithm:"separable"})}function getKernel(e,r){const t=e*2+1,n=new Array(t),a=r||((t-1)*.5-1)*.3+.8,s=-.5/(a*a);let o=0;for(let l=0;l<t;l++){const f=l-e,h=Math.exp(s*f*f);n[l]=h,o+=h}for(let l=0;l<t;l++)n[l]/=o;return n}const SOBEL_X=[[-1,0,1],[-2,0,2],[-1,0,1]],SOBEL_Y=[[-1,-2,-1],[0,0,0],[1,2,1]],SCHARR_X=[[3,0,-3],[10,0,-10],[3,0,-3]],SCHARR_Y=[[3,10,3],[0,0,0],[-3,-10,-3]];var src$3={},fftlib={};(function(e){(function(){var r;r=e;var t={release:"0.3.0",date:"2013-03"};r.toString=function(){return"version "+t.release+", released "+t.date};for(var n=0,a=null,s=null,o={init:function(h){if(h!==0&&(h&h-1)===0)n=h,o._initArray(),o._makeBitReversalTable(),o._makeCosSinTable();else throw new Error("init: radix-2 required")},fft1d:function(h,c){o.fft(h,c,1)},ifft1d:function(h,c){var u=1/n;o.fft(h,c,-1);for(var d=0;d<n;d++)h[d]*=u,c[d]*=u},bt1d:function(h,c){o.fft(h,c,-1)},fft2d:function(h,c){for(var u=[],d=[],g=0,m=0;m<n;m++){g=m*n;for(var w=0;w<n;w++)u[w]=h[w+g],d[w]=c[w+g];o.fft1d(u,d);for(var v=0;v<n;v++)h[v+g]=u[v],c[v+g]=d[v]}for(var x=0;x<n;x++){for(var S=0;S<n;S++)g=x+S*n,u[S]=h[g],d[S]=c[g];o.fft1d(u,d);for(var y=0;y<n;y++)g=x+y*n,h[g]=u[y],c[g]=d[y]}},ifft2d:function(h,c){for(var u=[],d=[],g=0,m=0;m<n;m++){g=m*n;for(var w=0;w<n;w++)u[w]=h[w+g],d[w]=c[w+g];o.ifft1d(u,d);for(var v=0;v<n;v++)h[v+g]=u[v],c[v+g]=d[v]}for(var x=0;x<n;x++){for(var S=0;S<n;S++)g=x+S*n,u[S]=h[g],d[S]=c[g];o.ifft1d(u,d);for(var y=0;y<n;y++)g=x+y*n,h[g]=u[y],c[g]=d[y]}},fft:function(h,c,u){for(var d,g,m,w,v,x,S,y,_,E=n>>2,R=0;R<n;R++)w=a[R],R<w&&(v=h[R],h[R]=h[w],h[w]=v,v=c[R],c[R]=c[w],c[w]=v);for(var T=1;T<n;T<<=1){g=0,d=n/(T<<1);for(var M=0;M<T;M++){x=s[g+E],S=u*s[g];for(var I=M;I<n;I+=T<<1)m=I+T,y=x*h[m]+S*c[m],_=x*c[m]-S*h[m],h[m]=h[I]-y,h[I]+=y,c[m]=c[I]-_,c[I]+=_;g+=d}}},_initArray:function(){typeof Uint32Array<"u"?a=new Uint32Array(n):a=[],typeof Float64Array<"u"?s=new Float64Array(n*1.25):s=[]},_paddingZero:function(){},_makeBitReversalTable:function(){var h=0,c=0,u=0;for(a[0]=0;++h<n;){for(u=n>>1;u<=c;)c-=u,u>>=1;c+=u,a[h]=c}},_makeCosSinTable:function(){var h=n>>1,c=n>>2,u=n>>3,d=h+c,g=Math.sin(Math.PI/n),m=2*g*g,w=Math.sqrt(m*(2-m)),v=s[c]=1,x=s[0]=0;g=2*m;for(var S=1;S<u;S++)v-=m,m+=g*v,x+=w,w-=g*x,s[S]=x,s[c-S]=v;u!==0&&(s[u]=Math.sqrt(.5));for(var y=0;y<c;y++)s[h-y]=s[y];for(var _=0;_<d;_++)s[_+h]=-s[_]}},l=["init","fft1d","ifft1d","fft2d","ifft2d"],f=0;f<l.length;f++)r[l[f]]=o[l[f]];return r.bt=o.bt1d,r.fft=o.fft1d,r.ifft=o.ifft1d,r}).call(commonjsGlobal)})(fftlib);var FFT=fftlib,FFTUtils$1={DEBUG:!1,ifft2DArray:function(e,r,t){var n=new Array(r*t),a=r/2,s=(t-1)*2;FFT.init(a);for(var o={re:new Array(a),im:new Array(a)},l=0;l<t;l++){for(var f=a-1;f>=0;f--)o.re[f]=e[f*2*t+l],o.im[f]=e[(f*2+1)*t+l];FFT.bt(o.re,o.im);for(var f=a-1;f>=0;f--)n[f*2*t+l]=o.re[f],n[(f*2+1)*t+l]=o.im[f]}var h=new Array(a*s);FFT.init(s);for(var c={re:new Array(s),im:new Array(s)},u=s*a,f=0;f<r;f+=2){c.re[0]=n[f*t],c.im[0]=n[(f+1)*t];for(var l=1;l<t;l++)c.re[l]=n[f*t+l],c.im[l]=n[(f+1)*t+l],c.re[s-l]=n[f*t+l],c.im[s-l]=-n[(f+1)*t+l];FFT.bt(c.re,c.im);for(var d=f/2*s,l=s-1;l>=0;l--)h[d+l]=c.re[l]/u}return h},fft2DArray:function(e,r,t,n){Object.assign({},{inplace:!0});var a=t/2+1,s=r*2,o=new Array(s*a);FFT.init(t);for(var l={re:new Array(t),im:new Array(t)},f={re:new Array(t),im:new Array(t)},h={re:new Array(t),im:new Array(t)},c,u,d,g,m,w=0;w<r/2;w++){c=w*2*t,l.re=e.slice(c,c+t),c=(w*2+1)*t,l.im=e.slice(c,c+t),FFT.fft1d(l.re,l.im),this.reconstructTwoRealFFT(l,f,h),u=w*4*a,d=(w*4+1)*a,g=(w*4+2)*a,m=(w*4+3)*a;for(var v=a-1;v>=0;v--)o[u+v]=f.re[v],o[d+v]=f.im[v],o[g+v]=h.re[v],o[m+v]=h.im[v]}f=null,h=null;var x=new Array(s*a);FFT.init(r);for(var S={re:new Array(r),im:new Array(r)},y=a-1;y>=0;y--){for(var w=r-1;w>=0;w--)S.re[w]=o[w*2*a+y],S.im[w]=o[(w*2+1)*a+y],isNaN(S.re[w])&&(S.re[w]=0),isNaN(S.im[w])&&(S.im[w]=0);FFT.fft1d(S.re,S.im);for(var w=r-1;w>=0;w--)x[w*2*a+y]=S.re[w],x[(w*2+1)*a+y]=S.im[w]}return x},reconstructTwoRealFFT:function(e,r,t){var n=e.re.length;r.re[0]=e.re[0],r.im[0]=0,t.re[0]=e.im[0],t.im[0]=0;for(var a,s,o,l,f,h=n/2;h>0;h--)f=n-h,a=.5*(e.re[h]-e.re[f]),s=.5*(e.re[h]+e.re[f]),o=.5*(e.im[h]-e.im[f]),l=.5*(e.im[h]+e.im[f]),r.re[h]=s,r.im[h]=o,r.re[f]=s,r.im[f]=-o,t.re[h]=l,t.im[h]=-a,t.re[f]=l,t.im[f]=a},convolute2DI:function(e,r,t,n){for(var a,s,o=0;o<t/2;o++)for(var l=0;l<n;l++)a=e[o*2*n+l]*r[o*2*n+l]-e[(o*2+1)*n+l]*r[(o*2+1)*n+l],s=e[o*2*n+l]*r[(o*2+1)*n+l]+e[(o*2+1)*n+l]*r[o*2*n+l],e[o*2*n+l]=a,e[(o*2+1)*n+l]=s},convolute:function(e,r,t,n,a){for(var s=new Array(n*t),o=0;o<t*n;o++)s[o]=e[o];s=this.fft2DArray(s,t,n);for(var l=r.length,f=r[0].length,h=new Array(n*t),o=0;o<n*t;o++)h[o]=0;for(var c,u,d=Math.floor((l-1)/2),g=Math.floor((f-1)/2),m=0;m<l;m++){c=(m-d+t)%t;for(var w=0;w<f;w++)u=(w-g+n)%n,h[c*n+u]=r[m][w]}h=this.fft2DArray(h,t,n);var v=t*2,x=n/2+1;return this.convolute2DI(s,h,v,x),this.ifft2DArray(s,v,x)},toRadix2:function(e,r,t){var n,a,s,o,l=t,f=r;if(!(t!==0&&(t&t-1)===0)){for(l=0;t>>++l!=0;);l=1<<l}if(!(r!==0&&(r&r-1)===0)){for(f=0;r>>++f!=0;);f=1<<f}if(f==r&&l==t)return{data:e,rows:r,cols:t};var h=new Array(f*l),c=Math.floor((f-r)/2)-r,u=Math.floor((l-t)/2)-t;for(n=0;n<f;n++)for(s=n*l,o=(n-c)%r*t,a=0;a<l;a++)h[s+a]=e[o+(a-u)%t];return{data:h,rows:f,cols:l}},crop:function(e,r,t,n,a,s){if(r==n&&t==a)return e;Object.assign({},s);var o=new Array(a*n),l=Math.floor((r-n)/2),f=Math.floor((t-a)/2),h,c,u,d;for(u=0;u<n;u++)for(h=u*a,c=(u+l)*t,d=0;d<a;d++)o[h+d]=e[c+(d+f)];return o}},FFTUtils_1=FFTUtils$1;src$3.FFTUtils=FFTUtils_1;src$3.FFT=fftlib;var FFTUtils=src$3.FFTUtils;function convolutionFFT(e,r,t){var n=matrix2Array(e),a=n.data,s=Object.assign({normalize:!1,divisor:1,rows:n.rows,cols:n.cols},t),o,l;if(s.rows&&s.cols)o=s.rows,l=s.cols;else throw new Error("Invalid number of rows or columns "+o+" "+l);var f=s.divisor,h,c,u=r.length,d=r[0].length;if(s.normalize)for(f=0,h=0;h<u;h++)for(c=0;c<d;c++)f+=r[h][c];if(f===0)throw new RangeError("convolution: The divisor is equal to zero");var g=FFTUtils.toRadix2(a,o,l),m=FFTUtils.convolute(g.data,r,g.rows,g.cols);if(m=FFTUtils.crop(m,g.rows,g.cols,o,l),f!=0&&f!=1)for(h=0;h<m.length;h++)m[h]/=f;return m}function convolutionDirect(e,r,t){var n=matrix2Array(e),a=n.data,s=Object.assign({normalize:!1,divisor:1,rows:n.rows,cols:n.cols},t),o,l;if(s.rows&&s.cols)o=s.rows,l=s.cols;else throw new Error("Invalid number of rows or columns "+o+" "+l);var f=s.divisor,h=r.length,c=r[0].length,u,d,g,m,w,v,x,S,y;if(s.normalize)for(f=0,u=0;u<h;u++)for(d=0;d<c;d++)f+=r[u][d];if(f===0)throw new RangeError("convolution: The divisor is equal to zero");var _=new Array(o*l),E=Math.floor(h/2),R=Math.floor(c/2);for(m=0;m<o;m++)for(g=0;g<l;g++){for(v=0,d=0;d<h;d++)for(u=0;u<c;u++)x=r[h-d-1][c-u-1],S=(m+d-E+o)%o,y=(g+u-R+l)%l,w=S*l+y,v+=a[w]*x;w=m*l+g,_[w]=v/f}return _}function LoG(e,r,t){var n=1e3;t&&t.factor&&(n=t.factor);var a=new Array(r),s,o,l,f;n*=-1;var h=(r-1)/2,c=2*e*e;for(s=0;s<r;s++)for(a[s]=new Array(r),f=(s-h)*(s-h),o=0;o<r;o++)l=-((o-h)*(o-h)+f)/c,a[s][o]=Math.round(n*(1+l)*Math.exp(l));return a}function matrix2Array(e){var r=e,t,n;if(typeof e[0]!="number"){t=e.length,n=e[0].length,r=new Array(t*n);for(var a=0;a<t;a++)for(var s=0;s<n;s++)r[a*n+s]=e[a][s]}else{var o=Math.sqrt(e.length);Number.isInteger(o)&&(t=o,n=o)}return{data:r,rows:t,cols:n}}var src$2={fft:convolutionFFT,direct:convolutionDirect,kernelFactory:{LoG},matrix2Array},_isFinite=Number.isFinite||function(e){return!(typeof e!="number"||e!==e||e===1/0||e===-1/0)},isFinite$1=_isFinite,isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite$1(e)&&Math.floor(e)===e};function validateKernel(e){let r,t;if(Array.isArray(e))if(Array.isArray(e[0])){if((e.length&1)===0||(e[0].length&1)===0)throw new RangeError("validateKernel: Kernel rows and columns should be odd numbers");r=Math.floor(e.length/2),t=Math.floor(e[0].length/2)}else{let n=Math.sqrt(e.length);if(isInteger(n))t=r=Math.floor(Math.sqrt(e.length)/2);else throw new RangeError("validateKernel: Kernel array should be a square");let a=new Array(n);for(let s=0;s<n;s++){a[s]=new Array(n);for(let o=0;o<n;o++)a[s][o]=e[s*n+o]}e=a}else throw new Error(`validateKernel: Invalid Kernel: ${e}`);return{kernel:e,kWidth:t,kHeight:r}}function clamp(e,r){return Math.round(Math.min(Math.max(e,0),r.maxValue))}function directConvolution(e,r,t){if(t===void 0){const s=e.length+r.length-1;t=new Array(s)}fill(t);for(var n=0;n<e.length;n++)for(var a=0;a<r.length;a++)t[n+a]+=e[n]*r[a];return t}function fill(e){for(var r=0;r<e.length;r++)e[r]=0}function convolutionSeparable(e,r,t,n){const a=new Array(e.length);let s,o,l,f;f=r[1],l=(f.length-1)/2,o=new Array(t+f.length-1),s=new Array(t);for(let h=0;h<n;h++){for(let c=0;c<t;c++)s[c]=e[h*t+c];directConvolution(s,f,o);for(let c=0;c<t;c++)a[h*t+c]=o[l+c]}f=r[0],l=(f.length-1)/2,o=new Array(n+f.length-1),s=new Array(n);for(let h=0;h<t;h++){for(let c=0;c<n;c++)s[c]=a[c*t+h];directConvolution(s,f,o);for(let c=0;c<n;c++)a[c*t+h]=o[l+c]}return a}const toString$1=Object.prototype.toString;function isAnyArray(e){return toString$1.call(e).endsWith("Array]")}function max$1(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!isAnyArray(e))throw new TypeError("input must be an array");if(e.length===0)throw new TypeError("input must not be empty");var t=r.fromIndex,n=t===void 0?0:t,a=r.toIndex,s=a===void 0?e.length:a;if(n<0||n>=e.length||!Number.isInteger(n))throw new Error("fromIndex must be a positive integer smaller than length");if(s<=n||s>e.length||!Number.isInteger(s))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var o=e[n],l=n+1;l<s;l++)e[l]>o&&(o=e[l]);return o}function min$1(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!isAnyArray(e))throw new TypeError("input must be an array");if(e.length===0)throw new TypeError("input must not be empty");var t=r.fromIndex,n=t===void 0?0:t,a=r.toIndex,s=a===void 0?e.length:a;if(n<0||n>=e.length||!Number.isInteger(n))throw new Error("fromIndex must be a positive integer smaller than length");if(s<=n||s>e.length||!Number.isInteger(s))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var o=e[n],l=n+1;l<s;l++)e[l]<o&&(o=e[l]);return o}function rescale(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(isAnyArray(e)){if(e.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var t;if(r.output!==void 0){if(!isAnyArray(r.output))throw new TypeError("output option must be an array if specified");t=r.output}else t=new Array(e.length);var n=min$1(e),a=max$1(e);if(n===a)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var s=r.min,o=s===void 0?r.autoMinMax?n:0:s,l=r.max,f=l===void 0?r.autoMinMax?a:1:l;if(o>=f)throw new RangeError("min option must be smaller than max option");for(var h=(f-o)/(a-n),c=0;c<e.length;c++)t[c]=(e[c]-n)*h+o;return t}const indent=" ".repeat(2),indentData=" ".repeat(4);function inspectMatrix(){return inspectMatrixWithOptions(this)}function inspectMatrixWithOptions(e,r={}){const{maxRows:t=15,maxColumns:n=10,maxNumSize:a=8,padMinus:s="auto"}=r;return`${e.constructor.name} {
${indent}[
${indentData}${inspectData(e,t,n,a,s)}
${indent}]
${indent}rows: ${e.rows}
${indent}columns: ${e.columns}
}`}function inspectData(e,r,t,n,a){const{rows:s,columns:o}=e,l=Math.min(s,r),f=Math.min(o,t),h=[];if(a==="auto"){a=!1;e:for(let c=0;c<l;c++)for(let u=0;u<f;u++)if(e.get(c,u)<0){a=!0;break e}}for(let c=0;c<l;c++){let u=[];for(let d=0;d<f;d++)u.push(formatNumber(e.get(c,d),n,a));h.push(`${u.join(" ")}`)}return f!==o&&(h[h.length-1]+=` ... ${o-t} more columns`),l!==s&&h.push(`... ${s-r} more rows`),h.join(`
${indentData}`)}function formatNumber(e,r,t){return(e>=0&&t?` ${formatNumber2(e,r-1)}`:formatNumber2(e,r)).padEnd(r)}function formatNumber2(e,r){let t=e.toString();if(t.length<=r)return t;let n=e.toFixed(r);if(n.length>r&&(n=e.toFixed(Math.max(0,r-(n.length-r)))),n.length<=r&&!n.startsWith("0.000")&&!n.startsWith("-0.000"))return n;let a=e.toExponential(r);return a.length>r&&(a=e.toExponential(Math.max(0,r-(a.length-r)))),a.slice(0)}function installMathOperations(e,r){e.prototype.add=function(n){return typeof n=="number"?this.addS(n):this.addM(n)},e.prototype.addS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)+n);return this},e.prototype.addM=function(n){if(n=r.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)+n.get(a,s));return this},e.add=function(n,a){return new r(n).add(a)},e.prototype.sub=function(n){return typeof n=="number"?this.subS(n):this.subM(n)},e.prototype.subS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)-n);return this},e.prototype.subM=function(n){if(n=r.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)-n.get(a,s));return this},e.sub=function(n,a){return new r(n).sub(a)},e.prototype.subtract=e.prototype.sub,e.prototype.subtractS=e.prototype.subS,e.prototype.subtractM=e.prototype.subM,e.subtract=e.sub,e.prototype.mul=function(n){return typeof n=="number"?this.mulS(n):this.mulM(n)},e.prototype.mulS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)*n);return this},e.prototype.mulM=function(n){if(n=r.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)*n.get(a,s));return this},e.mul=function(n,a){return new r(n).mul(a)},e.prototype.multiply=e.prototype.mul,e.prototype.multiplyS=e.prototype.mulS,e.prototype.multiplyM=e.prototype.mulM,e.multiply=e.mul,e.prototype.div=function(n){return typeof n=="number"?this.divS(n):this.divM(n)},e.prototype.divS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)/n);return this},e.prototype.divM=function(n){if(n=r.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)/n.get(a,s));return this},e.div=function(n,a){return new r(n).div(a)},e.prototype.divide=e.prototype.div,e.prototype.divideS=e.prototype.divS,e.prototype.divideM=e.prototype.divM,e.divide=e.div,e.prototype.mod=function(n){return typeof n=="number"?this.modS(n):this.modM(n)},e.prototype.modS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)%n);return this},e.prototype.modM=function(n){if(n=r.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)%n.get(a,s));return this},e.mod=function(n,a){return new r(n).mod(a)},e.prototype.modulus=e.prototype.mod,e.prototype.modulusS=e.prototype.modS,e.prototype.modulusM=e.prototype.modM,e.modulus=e.mod,e.prototype.and=function(n){return typeof n=="number"?this.andS(n):this.andM(n)},e.prototype.andS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)&n);return this},e.prototype.andM=function(n){if(n=r.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)&n.get(a,s));return this},e.and=function(n,a){return new r(n).and(a)},e.prototype.or=function(n){return typeof n=="number"?this.orS(n):this.orM(n)},e.prototype.orS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)|n);return this},e.prototype.orM=function(n){if(n=r.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)|n.get(a,s));return this},e.or=function(n,a){return new r(n).or(a)},e.prototype.xor=function(n){return typeof n=="number"?this.xorS(n):this.xorM(n)},e.prototype.xorS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)^n);return this},e.prototype.xorM=function(n){if(n=r.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)^n.get(a,s));return this},e.xor=function(n,a){return new r(n).xor(a)},e.prototype.leftShift=function(n){return typeof n=="number"?this.leftShiftS(n):this.leftShiftM(n)},e.prototype.leftShiftS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)<<n);return this},e.prototype.leftShiftM=function(n){if(n=r.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)<<n.get(a,s));return this},e.leftShift=function(n,a){return new r(n).leftShift(a)},e.prototype.signPropagatingRightShift=function(n){return typeof n=="number"?this.signPropagatingRightShiftS(n):this.signPropagatingRightShiftM(n)},e.prototype.signPropagatingRightShiftS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)>>n);return this},e.prototype.signPropagatingRightShiftM=function(n){if(n=r.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)>>n.get(a,s));return this},e.signPropagatingRightShift=function(n,a){return new r(n).signPropagatingRightShift(a)},e.prototype.rightShift=function(n){return typeof n=="number"?this.rightShiftS(n):this.rightShiftM(n)},e.prototype.rightShiftS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)>>>n);return this},e.prototype.rightShiftM=function(n){if(n=r.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,this.get(a,s)>>>n.get(a,s));return this},e.rightShift=function(n,a){return new r(n).rightShift(a)},e.prototype.zeroFillRightShift=e.prototype.rightShift,e.prototype.zeroFillRightShiftS=e.prototype.rightShiftS,e.prototype.zeroFillRightShiftM=e.prototype.rightShiftM,e.zeroFillRightShift=e.rightShift,e.prototype.not=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,~this.get(n,a));return this},e.not=function(n){return new r(n).not()},e.prototype.abs=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.abs(this.get(n,a)));return this},e.abs=function(n){return new r(n).abs()},e.prototype.acos=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.acos(this.get(n,a)));return this},e.acos=function(n){return new r(n).acos()},e.prototype.acosh=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.acosh(this.get(n,a)));return this},e.acosh=function(n){return new r(n).acosh()},e.prototype.asin=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.asin(this.get(n,a)));return this},e.asin=function(n){return new r(n).asin()},e.prototype.asinh=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.asinh(this.get(n,a)));return this},e.asinh=function(n){return new r(n).asinh()},e.prototype.atan=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.atan(this.get(n,a)));return this},e.atan=function(n){return new r(n).atan()},e.prototype.atanh=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.atanh(this.get(n,a)));return this},e.atanh=function(n){return new r(n).atanh()},e.prototype.cbrt=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.cbrt(this.get(n,a)));return this},e.cbrt=function(n){return new r(n).cbrt()},e.prototype.ceil=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.ceil(this.get(n,a)));return this},e.ceil=function(n){return new r(n).ceil()},e.prototype.clz32=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.clz32(this.get(n,a)));return this},e.clz32=function(n){return new r(n).clz32()},e.prototype.cos=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.cos(this.get(n,a)));return this},e.cos=function(n){return new r(n).cos()},e.prototype.cosh=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.cosh(this.get(n,a)));return this},e.cosh=function(n){return new r(n).cosh()},e.prototype.exp=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.exp(this.get(n,a)));return this},e.exp=function(n){return new r(n).exp()},e.prototype.expm1=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.expm1(this.get(n,a)));return this},e.expm1=function(n){return new r(n).expm1()},e.prototype.floor=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.floor(this.get(n,a)));return this},e.floor=function(n){return new r(n).floor()},e.prototype.fround=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.fround(this.get(n,a)));return this},e.fround=function(n){return new r(n).fround()},e.prototype.log=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.log(this.get(n,a)));return this},e.log=function(n){return new r(n).log()},e.prototype.log1p=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.log1p(this.get(n,a)));return this},e.log1p=function(n){return new r(n).log1p()},e.prototype.log10=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.log10(this.get(n,a)));return this},e.log10=function(n){return new r(n).log10()},e.prototype.log2=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.log2(this.get(n,a)));return this},e.log2=function(n){return new r(n).log2()},e.prototype.round=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.round(this.get(n,a)));return this},e.round=function(n){return new r(n).round()},e.prototype.sign=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.sign(this.get(n,a)));return this},e.sign=function(n){return new r(n).sign()},e.prototype.sin=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.sin(this.get(n,a)));return this},e.sin=function(n){return new r(n).sin()},e.prototype.sinh=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.sinh(this.get(n,a)));return this},e.sinh=function(n){return new r(n).sinh()},e.prototype.sqrt=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.sqrt(this.get(n,a)));return this},e.sqrt=function(n){return new r(n).sqrt()},e.prototype.tan=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.tan(this.get(n,a)));return this},e.tan=function(n){return new r(n).tan()},e.prototype.tanh=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.tanh(this.get(n,a)));return this},e.tanh=function(n){return new r(n).tanh()},e.prototype.trunc=function(){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.set(n,a,Math.trunc(this.get(n,a)));return this},e.trunc=function(n){return new r(n).trunc()},e.pow=function(n,a){return new r(n).pow(a)},e.prototype.pow=function(n){return typeof n=="number"?this.powS(n):this.powM(n)},e.prototype.powS=function(n){for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,Math.pow(this.get(a,s),n));return this},e.prototype.powM=function(n){if(n=r.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)this.set(a,s,Math.pow(this.get(a,s),n.get(a,s)));return this}}function checkRowIndex(e,r,t){let n=t?e.rows:e.rows-1;if(r<0||r>n)throw new RangeError("Row index out of range")}function checkColumnIndex(e,r,t){let n=t?e.columns:e.columns-1;if(r<0||r>n)throw new RangeError("Column index out of range")}function checkRowVector(e,r){if(r.to1DArray&&(r=r.to1DArray()),r.length!==e.columns)throw new RangeError("vector size must be the same as the number of columns");return r}function checkColumnVector(e,r){if(r.to1DArray&&(r=r.to1DArray()),r.length!==e.rows)throw new RangeError("vector size must be the same as the number of rows");return r}function checkRowIndices(e,r){if(!isAnyArray(r))throw new TypeError("row indices must be an array");for(let t=0;t<r.length;t++)if(r[t]<0||r[t]>=e.rows)throw new RangeError("row indices are out of range")}function checkColumnIndices(e,r){if(!isAnyArray(r))throw new TypeError("column indices must be an array");for(let t=0;t<r.length;t++)if(r[t]<0||r[t]>=e.columns)throw new RangeError("column indices are out of range")}function checkRange(e,r,t,n,a){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(checkNumber("startRow",r),checkNumber("endRow",t),checkNumber("startColumn",n),checkNumber("endColumn",a),r>t||n>a||r<0||r>=e.rows||t<0||t>=e.rows||n<0||n>=e.columns||a<0||a>=e.columns)throw new RangeError("Submatrix indices are out of range")}function newArray$1(e,r=0){let t=[];for(let n=0;n<e;n++)t.push(r);return t}function checkNumber(e,r){if(typeof r!="number")throw new TypeError(`${e} must be a number`)}function checkNonEmpty(e){if(e.isEmpty())throw new Error("Empty matrix has no elements to index")}function sumByRow(e){let r=newArray$1(e.rows);for(let t=0;t<e.rows;++t)for(let n=0;n<e.columns;++n)r[t]+=e.get(t,n);return r}function sumByColumn(e){let r=newArray$1(e.columns);for(let t=0;t<e.rows;++t)for(let n=0;n<e.columns;++n)r[n]+=e.get(t,n);return r}function sumAll(e){let r=0;for(let t=0;t<e.rows;t++)for(let n=0;n<e.columns;n++)r+=e.get(t,n);return r}function productByRow(e){let r=newArray$1(e.rows,1);for(let t=0;t<e.rows;++t)for(let n=0;n<e.columns;++n)r[t]*=e.get(t,n);return r}function productByColumn(e){let r=newArray$1(e.columns,1);for(let t=0;t<e.rows;++t)for(let n=0;n<e.columns;++n)r[n]*=e.get(t,n);return r}function productAll(e){let r=1;for(let t=0;t<e.rows;t++)for(let n=0;n<e.columns;n++)r*=e.get(t,n);return r}function varianceByRow(e,r,t){const n=e.rows,a=e.columns,s=[];for(let o=0;o<n;o++){let l=0,f=0,h=0;for(let c=0;c<a;c++)h=e.get(o,c)-t[o],l+=h,f+=h*h;r?s.push((f-l*l/a)/(a-1)):s.push((f-l*l/a)/a)}return s}function varianceByColumn(e,r,t){const n=e.rows,a=e.columns,s=[];for(let o=0;o<a;o++){let l=0,f=0,h=0;for(let c=0;c<n;c++)h=e.get(c,o)-t[o],l+=h,f+=h*h;r?s.push((f-l*l/n)/(n-1)):s.push((f-l*l/n)/n)}return s}function varianceAll(e,r,t){const n=e.rows,a=e.columns,s=n*a;let o=0,l=0,f=0;for(let h=0;h<n;h++)for(let c=0;c<a;c++)f=e.get(h,c)-t,o+=f,l+=f*f;return r?(l-o*o/s)/(s-1):(l-o*o/s)/s}function centerByRow(e,r){for(let t=0;t<e.rows;t++)for(let n=0;n<e.columns;n++)e.set(t,n,e.get(t,n)-r[t])}function centerByColumn(e,r){for(let t=0;t<e.rows;t++)for(let n=0;n<e.columns;n++)e.set(t,n,e.get(t,n)-r[n])}function centerAll(e,r){for(let t=0;t<e.rows;t++)for(let n=0;n<e.columns;n++)e.set(t,n,e.get(t,n)-r)}function getScaleByRow(e){const r=[];for(let t=0;t<e.rows;t++){let n=0;for(let a=0;a<e.columns;a++)n+=Math.pow(e.get(t,a),2)/(e.columns-1);r.push(Math.sqrt(n))}return r}function scaleByRow(e,r){for(let t=0;t<e.rows;t++)for(let n=0;n<e.columns;n++)e.set(t,n,e.get(t,n)/r[t])}function getScaleByColumn(e){const r=[];for(let t=0;t<e.columns;t++){let n=0;for(let a=0;a<e.rows;a++)n+=Math.pow(e.get(a,t),2)/(e.rows-1);r.push(Math.sqrt(n))}return r}function scaleByColumn(e,r){for(let t=0;t<e.rows;t++)for(let n=0;n<e.columns;n++)e.set(t,n,e.get(t,n)/r[n])}function getScaleAll(e){const r=e.size-1;let t=0;for(let n=0;n<e.columns;n++)for(let a=0;a<e.rows;a++)t+=Math.pow(e.get(a,n),2)/r;return Math.sqrt(t)}function scaleAll(e,r){for(let t=0;t<e.rows;t++)for(let n=0;n<e.columns;n++)e.set(t,n,e.get(t,n)/r)}class AbstractMatrix{static from1DArray(r,t,n){if(r*t!==n.length)throw new RangeError("data length does not match given dimensions");let s=new Matrix$2(r,t);for(let o=0;o<r;o++)for(let l=0;l<t;l++)s.set(o,l,n[o*t+l]);return s}static rowVector(r){let t=new Matrix$2(1,r.length);for(let n=0;n<r.length;n++)t.set(0,n,r[n]);return t}static columnVector(r){let t=new Matrix$2(r.length,1);for(let n=0;n<r.length;n++)t.set(n,0,r[n]);return t}static zeros(r,t){return new Matrix$2(r,t)}static ones(r,t){return new Matrix$2(r,t).fill(1)}static rand(r,t,n={}){if(typeof n!="object")throw new TypeError("options must be an object");const{random:a=Math.random}=n;let s=new Matrix$2(r,t);for(let o=0;o<r;o++)for(let l=0;l<t;l++)s.set(o,l,a());return s}static randInt(r,t,n={}){if(typeof n!="object")throw new TypeError("options must be an object");const{min:a=0,max:s=1e3,random:o=Math.random}=n;if(!Number.isInteger(a))throw new TypeError("min must be an integer");if(!Number.isInteger(s))throw new TypeError("max must be an integer");if(a>=s)throw new RangeError("min must be smaller than max");let l=s-a,f=new Matrix$2(r,t);for(let h=0;h<r;h++)for(let c=0;c<t;c++){let u=a+Math.round(o()*l);f.set(h,c,u)}return f}static eye(r,t,n){t===void 0&&(t=r),n===void 0&&(n=1);let a=Math.min(r,t),s=this.zeros(r,t);for(let o=0;o<a;o++)s.set(o,o,n);return s}static diag(r,t,n){let a=r.length;t===void 0&&(t=a),n===void 0&&(n=t);let s=Math.min(a,t,n),o=this.zeros(t,n);for(let l=0;l<s;l++)o.set(l,l,r[l]);return o}static min(r,t){r=this.checkMatrix(r),t=this.checkMatrix(t);let n=r.rows,a=r.columns,s=new Matrix$2(n,a);for(let o=0;o<n;o++)for(let l=0;l<a;l++)s.set(o,l,Math.min(r.get(o,l),t.get(o,l)));return s}static max(r,t){r=this.checkMatrix(r),t=this.checkMatrix(t);let n=r.rows,a=r.columns,s=new this(n,a);for(let o=0;o<n;o++)for(let l=0;l<a;l++)s.set(o,l,Math.max(r.get(o,l),t.get(o,l)));return s}static checkMatrix(r){return AbstractMatrix.isMatrix(r)?r:new Matrix$2(r)}static isMatrix(r){return r!=null&&r.klass==="Matrix"}get size(){return this.rows*this.columns}apply(r){if(typeof r!="function")throw new TypeError("callback must be a function");for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)r.call(this,t,n);return this}to1DArray(){let r=[];for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)r.push(this.get(t,n));return r}to2DArray(){let r=[];for(let t=0;t<this.rows;t++){r.push([]);for(let n=0;n<this.columns;n++)r[t].push(this.get(t,n))}return r}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let r=0;r<this.rows;r++)for(let t=0;t<=r;t++)if(this.get(r,t)!==this.get(t,r))return!1;return!0}return!1}isEchelonForm(){let r=0,t=0,n=-1,a=!0,s=!1;for(;r<this.rows&&a;){for(t=0,s=!1;t<this.columns&&s===!1;)this.get(r,t)===0?t++:this.get(r,t)===1&&t>n?(s=!0,n=t):(a=!1,s=!0);r++}return a}isReducedEchelonForm(){let r=0,t=0,n=-1,a=!0,s=!1;for(;r<this.rows&&a;){for(t=0,s=!1;t<this.columns&&s===!1;)this.get(r,t)===0?t++:this.get(r,t)===1&&t>n?(s=!0,n=t):(a=!1,s=!0);for(let o=t+1;o<this.rows;o++)this.get(r,o)!==0&&(a=!1);r++}return a}echelonForm(){let r=this.clone(),t=0,n=0;for(;t<r.rows&&n<r.columns;){let a=t;for(let s=t;s<r.rows;s++)r.get(s,n)>r.get(a,n)&&(a=s);if(r.get(a,n)===0)n++;else{r.swapRows(t,a);let s=r.get(t,n);for(let o=n;o<r.columns;o++)r.set(t,o,r.get(t,o)/s);for(let o=t+1;o<r.rows;o++){let l=r.get(o,n)/r.get(t,n);r.set(o,n,0);for(let f=n+1;f<r.columns;f++)r.set(o,f,r.get(o,f)-r.get(t,f)*l)}t++,n++}}return r}reducedEchelonForm(){let r=this.echelonForm(),t=r.columns,n=r.rows,a=n-1;for(;a>=0;)if(r.maxRow(a)===0)a--;else{let s=0,o=!1;for(;s<n&&o===!1;)r.get(a,s)===1?o=!0:s++;for(let l=0;l<a;l++){let f=r.get(l,s);for(let h=s;h<t;h++){let c=r.get(l,h)-f*r.get(a,h);r.set(l,h,c)}}a--}return r}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(r={}){if(typeof r!="object")throw new TypeError("options must be an object");const{rows:t=1,columns:n=1}=r;if(!Number.isInteger(t)||t<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(n)||n<=0)throw new TypeError("columns must be a positive integer");let a=new Matrix$2(this.rows*t,this.columns*n);for(let s=0;s<t;s++)for(let o=0;o<n;o++)a.setSubMatrix(this,this.rows*s,this.columns*o);return a}fill(r){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,r);return this}neg(){return this.mulS(-1)}getRow(r){checkRowIndex(this,r);let t=[];for(let n=0;n<this.columns;n++)t.push(this.get(r,n));return t}getRowVector(r){return Matrix$2.rowVector(this.getRow(r))}setRow(r,t){checkRowIndex(this,r),t=checkRowVector(this,t);for(let n=0;n<this.columns;n++)this.set(r,n,t[n]);return this}swapRows(r,t){checkRowIndex(this,r),checkRowIndex(this,t);for(let n=0;n<this.columns;n++){let a=this.get(r,n);this.set(r,n,this.get(t,n)),this.set(t,n,a)}return this}getColumn(r){checkColumnIndex(this,r);let t=[];for(let n=0;n<this.rows;n++)t.push(this.get(n,r));return t}getColumnVector(r){return Matrix$2.columnVector(this.getColumn(r))}setColumn(r,t){checkColumnIndex(this,r),t=checkColumnVector(this,t);for(let n=0;n<this.rows;n++)this.set(n,r,t[n]);return this}swapColumns(r,t){checkColumnIndex(this,r),checkColumnIndex(this,t);for(let n=0;n<this.rows;n++){let a=this.get(n,r);this.set(n,r,this.get(n,t)),this.set(n,t,a)}return this}addRowVector(r){r=checkRowVector(this,r);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)+r[n]);return this}subRowVector(r){r=checkRowVector(this,r);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)-r[n]);return this}mulRowVector(r){r=checkRowVector(this,r);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)*r[n]);return this}divRowVector(r){r=checkRowVector(this,r);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)/r[n]);return this}addColumnVector(r){r=checkColumnVector(this,r);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)+r[t]);return this}subColumnVector(r){r=checkColumnVector(this,r);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)-r[t]);return this}mulColumnVector(r){r=checkColumnVector(this,r);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)*r[t]);return this}divColumnVector(r){r=checkColumnVector(this,r);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)/r[t]);return this}mulRow(r,t){checkRowIndex(this,r);for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)*t);return this}mulColumn(r,t){checkColumnIndex(this,r);for(let n=0;n<this.rows;n++)this.set(n,r,this.get(n,r)*t);return this}max(r){if(this.isEmpty())return NaN;switch(r){case"row":{const t=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.get(n,a)>t[n]&&(t[n]=this.get(n,a));return t}case"column":{const t=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.get(n,a)>t[a]&&(t[a]=this.get(n,a));return t}case void 0:{let t=this.get(0,0);for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.get(n,a)>t&&(t=this.get(n,a));return t}default:throw new Error(`invalid option: ${r}`)}}maxIndex(){checkNonEmpty(this);let r=this.get(0,0),t=[0,0];for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.get(n,a)>r&&(r=this.get(n,a),t[0]=n,t[1]=a);return t}min(r){if(this.isEmpty())return NaN;switch(r){case"row":{const t=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.get(n,a)<t[n]&&(t[n]=this.get(n,a));return t}case"column":{const t=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.get(n,a)<t[a]&&(t[a]=this.get(n,a));return t}case void 0:{let t=this.get(0,0);for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.get(n,a)<t&&(t=this.get(n,a));return t}default:throw new Error(`invalid option: ${r}`)}}minIndex(){checkNonEmpty(this);let r=this.get(0,0),t=[0,0];for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)this.get(n,a)<r&&(r=this.get(n,a),t[0]=n,t[1]=a);return t}maxRow(r){if(checkRowIndex(this,r),this.isEmpty())return NaN;let t=this.get(r,0);for(let n=1;n<this.columns;n++)this.get(r,n)>t&&(t=this.get(r,n));return t}maxRowIndex(r){checkRowIndex(this,r),checkNonEmpty(this);let t=this.get(r,0),n=[r,0];for(let a=1;a<this.columns;a++)this.get(r,a)>t&&(t=this.get(r,a),n[1]=a);return n}minRow(r){if(checkRowIndex(this,r),this.isEmpty())return NaN;let t=this.get(r,0);for(let n=1;n<this.columns;n++)this.get(r,n)<t&&(t=this.get(r,n));return t}minRowIndex(r){checkRowIndex(this,r),checkNonEmpty(this);let t=this.get(r,0),n=[r,0];for(let a=1;a<this.columns;a++)this.get(r,a)<t&&(t=this.get(r,a),n[1]=a);return n}maxColumn(r){if(checkColumnIndex(this,r),this.isEmpty())return NaN;let t=this.get(0,r);for(let n=1;n<this.rows;n++)this.get(n,r)>t&&(t=this.get(n,r));return t}maxColumnIndex(r){checkColumnIndex(this,r),checkNonEmpty(this);let t=this.get(0,r),n=[0,r];for(let a=1;a<this.rows;a++)this.get(a,r)>t&&(t=this.get(a,r),n[0]=a);return n}minColumn(r){if(checkColumnIndex(this,r),this.isEmpty())return NaN;let t=this.get(0,r);for(let n=1;n<this.rows;n++)this.get(n,r)<t&&(t=this.get(n,r));return t}minColumnIndex(r){checkColumnIndex(this,r),checkNonEmpty(this);let t=this.get(0,r),n=[0,r];for(let a=1;a<this.rows;a++)this.get(a,r)<t&&(t=this.get(a,r),n[0]=a);return n}diag(){let r=Math.min(this.rows,this.columns),t=[];for(let n=0;n<r;n++)t.push(this.get(n,n));return t}norm(r="frobenius"){let t=0;if(r==="max")return this.max();if(r==="frobenius"){for(let n=0;n<this.rows;n++)for(let a=0;a<this.columns;a++)t=t+this.get(n,a)*this.get(n,a);return Math.sqrt(t)}else throw new RangeError(`unknown norm type: ${r}`)}cumulativeSum(){let r=0;for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)r+=this.get(t,n),this.set(t,n,r);return this}dot(r){AbstractMatrix.isMatrix(r)&&(r=r.to1DArray());let t=this.to1DArray();if(t.length!==r.length)throw new RangeError("vectors do not have the same size");let n=0;for(let a=0;a<t.length;a++)n+=t[a]*r[a];return n}mmul(r){r=Matrix$2.checkMatrix(r);let t=this.rows,n=this.columns,a=r.columns,s=new Matrix$2(t,a),o=new Float64Array(n);for(let l=0;l<a;l++){for(let f=0;f<n;f++)o[f]=r.get(f,l);for(let f=0;f<t;f++){let h=0;for(let c=0;c<n;c++)h+=this.get(f,c)*o[c];s.set(f,l,h)}}return s}strassen2x2(r){r=Matrix$2.checkMatrix(r);let t=new Matrix$2(2,2);const n=this.get(0,0),a=r.get(0,0),s=this.get(0,1),o=r.get(0,1),l=this.get(1,0),f=r.get(1,0),h=this.get(1,1),c=r.get(1,1),u=(n+h)*(a+c),d=(l+h)*a,g=n*(o-c),m=h*(f-a),w=(n+s)*c,v=(l-n)*(a+o),x=(s-h)*(f+c),S=u+m-w+x,y=g+w,_=d+m,E=u-d+g+v;return t.set(0,0,S),t.set(0,1,y),t.set(1,0,_),t.set(1,1,E),t}strassen3x3(r){r=Matrix$2.checkMatrix(r);let t=new Matrix$2(3,3);const n=this.get(0,0),a=this.get(0,1),s=this.get(0,2),o=this.get(1,0),l=this.get(1,1),f=this.get(1,2),h=this.get(2,0),c=this.get(2,1),u=this.get(2,2),d=r.get(0,0),g=r.get(0,1),m=r.get(0,2),w=r.get(1,0),v=r.get(1,1),x=r.get(1,2),S=r.get(2,0),y=r.get(2,1),_=r.get(2,2),E=(n+a+s-o-l-c-u)*v,R=(n-o)*(-g+v),T=l*(-d+g+w-v-x-S+_),M=(-n+o+l)*(d-g+v),I=(o+l)*(-d+g),b=n*d,k=(-n+h+c)*(d-m+x),D=(-n+h)*(m-x),$=(h+c)*(-d+m),P=(n+a+s-l-f-h-c)*x,O=c*(-d+m+w-v-x-S+y),ee=(-s+c+u)*(v+S-y),q=(s-u)*(v-y),z=s*S,W=(c+u)*(-S+y),H=(-s+l+f)*(x+S-_),se=(s-f)*(x-_),N=(l+f)*(-S+_),Y=a*w,L=f*y,U=o*m,G=h*g,te=u*_,de=b+z+Y,Z=E+M+I+b+ee+z+W,ge=b+k+$+P+z+H+N,ce=R+T+M+b+z+H+se,ve=R+M+I+b+L,be=z+H+se+N+U,K=b+k+D+O+ee+q+z,V=ee+q+z+W+G,pe=b+k+D+$+te;return t.set(0,0,de),t.set(0,1,Z),t.set(0,2,ge),t.set(1,0,ce),t.set(1,1,ve),t.set(1,2,be),t.set(2,0,K),t.set(2,1,V),t.set(2,2,pe),t}mmulStrassen(r){r=Matrix$2.checkMatrix(r);let t=this.clone(),n=t.rows,a=t.columns,s=r.rows,o=r.columns;a!==s&&console.warn(`Multiplying ${n} x ${a} and ${s} x ${o} matrix: dimensions do not match.`);function l(u,d,g){let m=u.rows,w=u.columns;if(m===d&&w===g)return u;{let v=AbstractMatrix.zeros(d,g);return v=v.setSubMatrix(u,0,0),v}}let f=Math.max(n,s),h=Math.max(a,o);t=l(t,f,h),r=l(r,f,h);function c(u,d,g,m){if(g<=512||m<=512)return u.mmul(d);g%2===1&&m%2===1?(u=l(u,g+1,m+1),d=l(d,g+1,m+1)):g%2===1?(u=l(u,g+1,m),d=l(d,g+1,m)):m%2===1&&(u=l(u,g,m+1),d=l(d,g,m+1));let w=parseInt(u.rows/2,10),v=parseInt(u.columns/2,10),x=u.subMatrix(0,w-1,0,v-1),S=d.subMatrix(0,w-1,0,v-1),y=u.subMatrix(0,w-1,v,u.columns-1),_=d.subMatrix(0,w-1,v,d.columns-1),E=u.subMatrix(w,u.rows-1,0,v-1),R=d.subMatrix(w,d.rows-1,0,v-1),T=u.subMatrix(w,u.rows-1,v,u.columns-1),M=d.subMatrix(w,d.rows-1,v,d.columns-1),I=c(AbstractMatrix.add(x,T),AbstractMatrix.add(S,M),w,v),b=c(AbstractMatrix.add(E,T),S,w,v),k=c(x,AbstractMatrix.sub(_,M),w,v),D=c(T,AbstractMatrix.sub(R,S),w,v),$=c(AbstractMatrix.add(x,y),M,w,v),P=c(AbstractMatrix.sub(E,x),AbstractMatrix.add(S,_),w,v),O=c(AbstractMatrix.sub(y,T),AbstractMatrix.add(R,M),w,v),ee=AbstractMatrix.add(I,D);ee.sub($),ee.add(O);let q=AbstractMatrix.add(k,$),z=AbstractMatrix.add(b,D),W=AbstractMatrix.sub(I,b);W.add(k),W.add(P);let H=AbstractMatrix.zeros(2*ee.rows,2*ee.columns);return H=H.setSubMatrix(ee,0,0),H=H.setSubMatrix(q,ee.rows,0),H=H.setSubMatrix(z,0,ee.columns),H=H.setSubMatrix(W,ee.rows,ee.columns),H.subMatrix(0,g-1,0,m-1)}return c(t,r,f,h)}scaleRows(r={}){if(typeof r!="object")throw new TypeError("options must be an object");const{min:t=0,max:n=1}=r;if(!Number.isFinite(t))throw new TypeError("min must be a number");if(!Number.isFinite(n))throw new TypeError("max must be a number");if(t>=n)throw new RangeError("min must be smaller than max");let a=new Matrix$2(this.rows,this.columns);for(let s=0;s<this.rows;s++){const o=this.getRow(s);o.length>0&&rescale(o,{min:t,max:n,output:o}),a.setRow(s,o)}return a}scaleColumns(r={}){if(typeof r!="object")throw new TypeError("options must be an object");const{min:t=0,max:n=1}=r;if(!Number.isFinite(t))throw new TypeError("min must be a number");if(!Number.isFinite(n))throw new TypeError("max must be a number");if(t>=n)throw new RangeError("min must be smaller than max");let a=new Matrix$2(this.rows,this.columns);for(let s=0;s<this.columns;s++){const o=this.getColumn(s);o.length&&rescale(o,{min:t,max:n,output:o}),a.setColumn(s,o)}return a}flipRows(){const r=Math.ceil(this.columns/2);for(let t=0;t<this.rows;t++)for(let n=0;n<r;n++){let a=this.get(t,n),s=this.get(t,this.columns-1-n);this.set(t,n,s),this.set(t,this.columns-1-n,a)}return this}flipColumns(){const r=Math.ceil(this.rows/2);for(let t=0;t<this.columns;t++)for(let n=0;n<r;n++){let a=this.get(n,t),s=this.get(this.rows-1-n,t);this.set(n,t,s),this.set(this.rows-1-n,t,a)}return this}kroneckerProduct(r){r=Matrix$2.checkMatrix(r);let t=this.rows,n=this.columns,a=r.rows,s=r.columns,o=new Matrix$2(t*a,n*s);for(let l=0;l<t;l++)for(let f=0;f<n;f++)for(let h=0;h<a;h++)for(let c=0;c<s;c++)o.set(a*l+h,s*f+c,this.get(l,f)*r.get(h,c));return o}kroneckerSum(r){if(r=Matrix$2.checkMatrix(r),!this.isSquare()||!r.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let t=this.rows,n=r.rows,a=this.kroneckerProduct(Matrix$2.eye(n,n)),s=Matrix$2.eye(t,t).kroneckerProduct(r);return a.add(s)}transpose(){let r=new Matrix$2(this.columns,this.rows);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)r.set(n,t,this.get(t,n));return r}sortRows(r=compareNumbers){for(let t=0;t<this.rows;t++)this.setRow(t,this.getRow(t).sort(r));return this}sortColumns(r=compareNumbers){for(let t=0;t<this.columns;t++)this.setColumn(t,this.getColumn(t).sort(r));return this}subMatrix(r,t,n,a){checkRange(this,r,t,n,a);let s=new Matrix$2(t-r+1,a-n+1);for(let o=r;o<=t;o++)for(let l=n;l<=a;l++)s.set(o-r,l-n,this.get(o,l));return s}subMatrixRow(r,t,n){if(t===void 0&&(t=0),n===void 0&&(n=this.columns-1),t>n||t<0||t>=this.columns||n<0||n>=this.columns)throw new RangeError("Argument out of range");let a=new Matrix$2(r.length,n-t+1);for(let s=0;s<r.length;s++)for(let o=t;o<=n;o++){if(r[s]<0||r[s]>=this.rows)throw new RangeError(`Row index out of range: ${r[s]}`);a.set(s,o-t,this.get(r[s],o))}return a}subMatrixColumn(r,t,n){if(t===void 0&&(t=0),n===void 0&&(n=this.rows-1),t>n||t<0||t>=this.rows||n<0||n>=this.rows)throw new RangeError("Argument out of range");let a=new Matrix$2(n-t+1,r.length);for(let s=0;s<r.length;s++)for(let o=t;o<=n;o++){if(r[s]<0||r[s]>=this.columns)throw new RangeError(`Column index out of range: ${r[s]}`);a.set(o-t,s,this.get(o,r[s]))}return a}setSubMatrix(r,t,n){if(r=Matrix$2.checkMatrix(r),r.isEmpty())return this;let a=t+r.rows-1,s=n+r.columns-1;checkRange(this,t,a,n,s);for(let o=0;o<r.rows;o++)for(let l=0;l<r.columns;l++)this.set(t+o,n+l,r.get(o,l));return this}selection(r,t){checkRowIndices(this,r),checkColumnIndices(this,t);let n=new Matrix$2(r.length,t.length);for(let a=0;a<r.length;a++){let s=r[a];for(let o=0;o<t.length;o++){let l=t[o];n.set(a,o,this.get(s,l))}}return n}trace(){let r=Math.min(this.rows,this.columns),t=0;for(let n=0;n<r;n++)t+=this.get(n,n);return t}clone(){let r=new Matrix$2(this.rows,this.columns);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)r.set(t,n,this.get(t,n));return r}sum(r){switch(r){case"row":return sumByRow(this);case"column":return sumByColumn(this);case void 0:return sumAll(this);default:throw new Error(`invalid option: ${r}`)}}product(r){switch(r){case"row":return productByRow(this);case"column":return productByColumn(this);case void 0:return productAll(this);default:throw new Error(`invalid option: ${r}`)}}mean(r){const t=this.sum(r);switch(r){case"row":{for(let n=0;n<this.rows;n++)t[n]/=this.columns;return t}case"column":{for(let n=0;n<this.columns;n++)t[n]/=this.rows;return t}case void 0:return t/this.size;default:throw new Error(`invalid option: ${r}`)}}variance(r,t={}){if(typeof r=="object"&&(t=r,r=void 0),typeof t!="object")throw new TypeError("options must be an object");const{unbiased:n=!0,mean:a=this.mean(r)}=t;if(typeof n!="boolean")throw new TypeError("unbiased must be a boolean");switch(r){case"row":{if(!isAnyArray(a))throw new TypeError("mean must be an array");return varianceByRow(this,n,a)}case"column":{if(!isAnyArray(a))throw new TypeError("mean must be an array");return varianceByColumn(this,n,a)}case void 0:{if(typeof a!="number")throw new TypeError("mean must be a number");return varianceAll(this,n,a)}default:throw new Error(`invalid option: ${r}`)}}standardDeviation(r,t){typeof r=="object"&&(t=r,r=void 0);const n=this.variance(r,t);if(r===void 0)return Math.sqrt(n);for(let a=0;a<n.length;a++)n[a]=Math.sqrt(n[a]);return n}center(r,t={}){if(typeof r=="object"&&(t=r,r=void 0),typeof t!="object")throw new TypeError("options must be an object");const{center:n=this.mean(r)}=t;switch(r){case"row":{if(!isAnyArray(n))throw new TypeError("center must be an array");return centerByRow(this,n),this}case"column":{if(!isAnyArray(n))throw new TypeError("center must be an array");return centerByColumn(this,n),this}case void 0:{if(typeof n!="number")throw new TypeError("center must be a number");return centerAll(this,n),this}default:throw new Error(`invalid option: ${r}`)}}scale(r,t={}){if(typeof r=="object"&&(t=r,r=void 0),typeof t!="object")throw new TypeError("options must be an object");let n=t.scale;switch(r){case"row":{if(n===void 0)n=getScaleByRow(this);else if(!isAnyArray(n))throw new TypeError("scale must be an array");return scaleByRow(this,n),this}case"column":{if(n===void 0)n=getScaleByColumn(this);else if(!isAnyArray(n))throw new TypeError("scale must be an array");return scaleByColumn(this,n),this}case void 0:{if(n===void 0)n=getScaleAll(this);else if(typeof n!="number")throw new TypeError("scale must be a number");return scaleAll(this,n),this}default:throw new Error(`invalid option: ${r}`)}}toString(r){return inspectMatrixWithOptions(this,r)}}AbstractMatrix.prototype.klass="Matrix";typeof Symbol<"u"&&(AbstractMatrix.prototype[Symbol.for("nodejs.util.inspect.custom")]=inspectMatrix);function compareNumbers(e,r){return e-r}function isArrayOfNumbers(e){return e.every(r=>typeof r=="number")}AbstractMatrix.random=AbstractMatrix.rand;AbstractMatrix.randomInt=AbstractMatrix.randInt;AbstractMatrix.diagonal=AbstractMatrix.diag;AbstractMatrix.prototype.diagonal=AbstractMatrix.prototype.diag;AbstractMatrix.identity=AbstractMatrix.eye;AbstractMatrix.prototype.negate=AbstractMatrix.prototype.neg;AbstractMatrix.prototype.tensorProduct=AbstractMatrix.prototype.kroneckerProduct;class Matrix$2 extends AbstractMatrix{constructor(r,t){if(super(),Matrix$2.isMatrix(r))return r.clone();if(Number.isInteger(r)&&r>=0)if(this.data=[],Number.isInteger(t)&&t>=0)for(let n=0;n<r;n++)this.data.push(new Float64Array(t));else throw new TypeError("nColumns must be a positive integer");else if(isAnyArray(r)){const n=r;if(r=n.length,t=r?n[0].length:0,typeof t!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let a=0;a<r;a++){if(n[a].length!==t)throw new RangeError("Inconsistent array dimensions");if(!isArrayOfNumbers(n[a]))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(n[a]))}}else throw new TypeError("First argument must be a positive number or an array");this.rows=r,this.columns=t}set(r,t,n){return this.data[r][t]=n,this}get(r,t){return this.data[r][t]}removeRow(r){return checkRowIndex(this,r),this.data.splice(r,1),this.rows-=1,this}addRow(r,t){return t===void 0&&(t=r,r=this.rows),checkRowIndex(this,r,!0),t=Float64Array.from(checkRowVector(this,t)),this.data.splice(r,0,t),this.rows+=1,this}removeColumn(r){checkColumnIndex(this,r);for(let t=0;t<this.rows;t++){const n=new Float64Array(this.columns-1);for(let a=0;a<r;a++)n[a]=this.data[t][a];for(let a=r+1;a<this.columns;a++)n[a-1]=this.data[t][a];this.data[t]=n}return this.columns-=1,this}addColumn(r,t){typeof t>"u"&&(t=r,r=this.columns),checkColumnIndex(this,r,!0),t=checkColumnVector(this,t);for(let n=0;n<this.rows;n++){const a=new Float64Array(this.columns+1);let s=0;for(;s<r;s++)a[s]=this.data[n][s];for(a[s++]=t[n];s<this.columns+1;s++)a[s]=this.data[n][s-1];this.data[n]=a}return this.columns+=1,this}}installMathOperations(AbstractMatrix,Matrix$2);class BaseView extends AbstractMatrix{constructor(r,t,n){super(),this.matrix=r,this.rows=t,this.columns=n}}class MatrixColumnView extends BaseView{constructor(r,t){checkColumnIndex(r,t),super(r,r.rows,1),this.column=t}set(r,t,n){return this.matrix.set(r,this.column,n),this}get(r){return this.matrix.get(r,this.column)}}class MatrixColumnSelectionView extends BaseView{constructor(r,t){checkColumnIndices(r,t),super(r,r.rows,t.length),this.columnIndices=t}set(r,t,n){return this.matrix.set(r,this.columnIndices[t],n),this}get(r,t){return this.matrix.get(r,this.columnIndices[t])}}class MatrixFlipColumnView extends BaseView{constructor(r){super(r,r.rows,r.columns)}set(r,t,n){return this.matrix.set(r,this.columns-t-1,n),this}get(r,t){return this.matrix.get(r,this.columns-t-1)}}class MatrixFlipRowView extends BaseView{constructor(r){super(r,r.rows,r.columns)}set(r,t,n){return this.matrix.set(this.rows-r-1,t,n),this}get(r,t){return this.matrix.get(this.rows-r-1,t)}}class MatrixRowView extends BaseView{constructor(r,t){checkRowIndex(r,t),super(r,1,r.columns),this.row=t}set(r,t,n){return this.matrix.set(this.row,t,n),this}get(r,t){return this.matrix.get(this.row,t)}}class MatrixRowSelectionView extends BaseView{constructor(r,t){checkRowIndices(r,t),super(r,t.length,r.columns),this.rowIndices=t}set(r,t,n){return this.matrix.set(this.rowIndices[r],t,n),this}get(r,t){return this.matrix.get(this.rowIndices[r],t)}}class MatrixSelectionView extends BaseView{constructor(r,t,n){checkRowIndices(r,t),checkColumnIndices(r,n),super(r,t.length,n.length),this.rowIndices=t,this.columnIndices=n}set(r,t,n){return this.matrix.set(this.rowIndices[r],this.columnIndices[t],n),this}get(r,t){return this.matrix.get(this.rowIndices[r],this.columnIndices[t])}}class MatrixSubView extends BaseView{constructor(r,t,n,a,s){checkRange(r,t,n,a,s),super(r,n-t+1,s-a+1),this.startRow=t,this.startColumn=a}set(r,t,n){return this.matrix.set(this.startRow+r,this.startColumn+t,n),this}get(r,t){return this.matrix.get(this.startRow+r,this.startColumn+t)}}class MatrixTransposeView$1 extends BaseView{constructor(r){super(r,r.columns,r.rows)}set(r,t,n){return this.matrix.set(t,r,n),this}get(r,t){return this.matrix.get(t,r)}}class WrapperMatrix1D extends AbstractMatrix{constructor(r,t={}){const{rows:n=1}=t;if(r.length%n!==0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=n,this.columns=r.length/n,this.data=r}set(r,t,n){let a=this._calculateIndex(r,t);return this.data[a]=n,this}get(r,t){let n=this._calculateIndex(r,t);return this.data[n]}_calculateIndex(r,t){return r*this.columns+t}}class WrapperMatrix2D extends AbstractMatrix{constructor(r){super(),this.data=r,this.rows=r.length,this.columns=r[0].length}set(r,t,n){return this.data[r][t]=n,this}get(r,t){return this.data[r][t]}}function wrap(e,r){if(isAnyArray(e))return e[0]&&isAnyArray(e[0])?new WrapperMatrix2D(e):new WrapperMatrix1D(e,r);throw new Error("the argument is not an array")}class LuDecomposition{constructor(r){r=WrapperMatrix2D.checkMatrix(r);let t=r.clone(),n=t.rows,a=t.columns,s=new Float64Array(n),o=1,l,f,h,c,u,d,g,m,w;for(l=0;l<n;l++)s[l]=l;for(m=new Float64Array(n),f=0;f<a;f++){for(l=0;l<n;l++)m[l]=t.get(l,f);for(l=0;l<n;l++){for(w=Math.min(l,f),u=0,h=0;h<w;h++)u+=t.get(l,h)*m[h];m[l]-=u,t.set(l,f,m[l])}for(c=f,l=f+1;l<n;l++)Math.abs(m[l])>Math.abs(m[c])&&(c=l);if(c!==f){for(h=0;h<a;h++)d=t.get(c,h),t.set(c,h,t.get(f,h)),t.set(f,h,d);g=s[c],s[c]=s[f],s[f]=g,o=-o}if(f<n&&t.get(f,f)!==0)for(l=f+1;l<n;l++)t.set(l,f,t.get(l,f)/t.get(f,f))}this.LU=t,this.pivotVector=s,this.pivotSign=o}isSingular(){let r=this.LU,t=r.columns;for(let n=0;n<t;n++)if(r.get(n,n)===0)return!0;return!1}solve(r){r=Matrix$2.checkMatrix(r);let t=this.LU;if(t.rows!==r.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let a=r.columns,s=r.subMatrixRow(this.pivotVector,0,a-1),o=t.columns,l,f,h;for(h=0;h<o;h++)for(l=h+1;l<o;l++)for(f=0;f<a;f++)s.set(l,f,s.get(l,f)-s.get(h,f)*t.get(l,h));for(h=o-1;h>=0;h--){for(f=0;f<a;f++)s.set(h,f,s.get(h,f)/t.get(h,h));for(l=0;l<h;l++)for(f=0;f<a;f++)s.set(l,f,s.get(l,f)-s.get(h,f)*t.get(l,h))}return s}get determinant(){let r=this.LU;if(!r.isSquare())throw new Error("Matrix must be square");let t=this.pivotSign,n=r.columns;for(let a=0;a<n;a++)t*=r.get(a,a);return t}get lowerTriangularMatrix(){let r=this.LU,t=r.rows,n=r.columns,a=new Matrix$2(t,n);for(let s=0;s<t;s++)for(let o=0;o<n;o++)s>o?a.set(s,o,r.get(s,o)):s===o?a.set(s,o,1):a.set(s,o,0);return a}get upperTriangularMatrix(){let r=this.LU,t=r.rows,n=r.columns,a=new Matrix$2(t,n);for(let s=0;s<t;s++)for(let o=0;o<n;o++)s<=o?a.set(s,o,r.get(s,o)):a.set(s,o,0);return a}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function hypotenuse$1(e,r){let t=0;return Math.abs(e)>Math.abs(r)?(t=r/e,Math.abs(e)*Math.sqrt(1+t*t)):r!==0?(t=e/r,Math.abs(r)*Math.sqrt(1+t*t)):0}class QrDecomposition{constructor(r){r=WrapperMatrix2D.checkMatrix(r);let t=r.clone(),n=r.rows,a=r.columns,s=new Float64Array(a),o,l,f,h;for(f=0;f<a;f++){let c=0;for(o=f;o<n;o++)c=hypotenuse$1(c,t.get(o,f));if(c!==0){for(t.get(f,f)<0&&(c=-c),o=f;o<n;o++)t.set(o,f,t.get(o,f)/c);for(t.set(f,f,t.get(f,f)+1),l=f+1;l<a;l++){for(h=0,o=f;o<n;o++)h+=t.get(o,f)*t.get(o,l);for(h=-h/t.get(f,f),o=f;o<n;o++)t.set(o,l,t.get(o,l)+h*t.get(o,f))}}s[f]=-c}this.QR=t,this.Rdiag=s}solve(r){r=Matrix$2.checkMatrix(r);let t=this.QR,n=t.rows;if(r.rows!==n)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let a=r.columns,s=r.clone(),o=t.columns,l,f,h,c;for(h=0;h<o;h++)for(f=0;f<a;f++){for(c=0,l=h;l<n;l++)c+=t.get(l,h)*s.get(l,f);for(c=-c/t.get(h,h),l=h;l<n;l++)s.set(l,f,s.get(l,f)+c*t.get(l,h))}for(h=o-1;h>=0;h--){for(f=0;f<a;f++)s.set(h,f,s.get(h,f)/this.Rdiag[h]);for(l=0;l<h;l++)for(f=0;f<a;f++)s.set(l,f,s.get(l,f)-s.get(h,f)*t.get(l,h))}return s.subMatrix(0,o-1,0,a-1)}isFullRank(){let r=this.QR.columns;for(let t=0;t<r;t++)if(this.Rdiag[t]===0)return!1;return!0}get upperTriangularMatrix(){let r=this.QR,t=r.columns,n=new Matrix$2(t,t),a,s;for(a=0;a<t;a++)for(s=0;s<t;s++)a<s?n.set(a,s,r.get(a,s)):a===s?n.set(a,s,this.Rdiag[a]):n.set(a,s,0);return n}get orthogonalMatrix(){let r=this.QR,t=r.rows,n=r.columns,a=new Matrix$2(t,n),s,o,l,f;for(l=n-1;l>=0;l--){for(s=0;s<t;s++)a.set(s,l,0);for(a.set(l,l,1),o=l;o<n;o++)if(r.get(l,l)!==0){for(f=0,s=l;s<t;s++)f+=r.get(s,l)*a.get(s,o);for(f=-f/r.get(l,l),s=l;s<t;s++)a.set(s,o,a.get(s,o)+f*r.get(s,l))}}return a}}class SingularValueDecomposition{constructor(r,t={}){if(r=WrapperMatrix2D.checkMatrix(r),r.isEmpty())throw new Error("Matrix must be non-empty");let n=r.rows,a=r.columns;const{computeLeftSingularVectors:s=!0,computeRightSingularVectors:o=!0,autoTranspose:l=!1}=t;let f=Boolean(s),h=Boolean(o),c=!1,u;if(n<a)if(!l)u=r.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{u=r.transpose(),n=u.rows,a=u.columns,c=!0;let b=f;f=h,h=b}else u=r.clone();let d=Math.min(n,a),g=Math.min(n+1,a),m=new Float64Array(g),w=new Matrix$2(n,d),v=new Matrix$2(a,a),x=new Float64Array(a),S=new Float64Array(n),y=new Float64Array(g);for(let b=0;b<g;b++)y[b]=b;let _=Math.min(n-1,a),E=Math.max(0,Math.min(a-2,n)),R=Math.max(_,E);for(let b=0;b<R;b++){if(b<_){m[b]=0;for(let k=b;k<n;k++)m[b]=hypotenuse$1(m[b],u.get(k,b));if(m[b]!==0){u.get(b,b)<0&&(m[b]=-m[b]);for(let k=b;k<n;k++)u.set(k,b,u.get(k,b)/m[b]);u.set(b,b,u.get(b,b)+1)}m[b]=-m[b]}for(let k=b+1;k<a;k++){if(b<_&&m[b]!==0){let D=0;for(let $=b;$<n;$++)D+=u.get($,b)*u.get($,k);D=-D/u.get(b,b);for(let $=b;$<n;$++)u.set($,k,u.get($,k)+D*u.get($,b))}x[k]=u.get(b,k)}if(f&&b<_)for(let k=b;k<n;k++)w.set(k,b,u.get(k,b));if(b<E){x[b]=0;for(let k=b+1;k<a;k++)x[b]=hypotenuse$1(x[b],x[k]);if(x[b]!==0){x[b+1]<0&&(x[b]=0-x[b]);for(let k=b+1;k<a;k++)x[k]/=x[b];x[b+1]+=1}if(x[b]=-x[b],b+1<n&&x[b]!==0){for(let k=b+1;k<n;k++)S[k]=0;for(let k=b+1;k<n;k++)for(let D=b+1;D<a;D++)S[k]+=x[D]*u.get(k,D);for(let k=b+1;k<a;k++){let D=-x[k]/x[b+1];for(let $=b+1;$<n;$++)u.set($,k,u.get($,k)+D*S[$])}}if(h)for(let k=b+1;k<a;k++)v.set(k,b,x[k])}}let T=Math.min(a,n+1);if(_<a&&(m[_]=u.get(_,_)),n<T&&(m[T-1]=0),E+1<T&&(x[E]=u.get(E,T-1)),x[T-1]=0,f){for(let b=_;b<d;b++){for(let k=0;k<n;k++)w.set(k,b,0);w.set(b,b,1)}for(let b=_-1;b>=0;b--)if(m[b]!==0){for(let k=b+1;k<d;k++){let D=0;for(let $=b;$<n;$++)D+=w.get($,b)*w.get($,k);D=-D/w.get(b,b);for(let $=b;$<n;$++)w.set($,k,w.get($,k)+D*w.get($,b))}for(let k=b;k<n;k++)w.set(k,b,-w.get(k,b));w.set(b,b,1+w.get(b,b));for(let k=0;k<b-1;k++)w.set(k,b,0)}else{for(let k=0;k<n;k++)w.set(k,b,0);w.set(b,b,1)}}if(h)for(let b=a-1;b>=0;b--){if(b<E&&x[b]!==0)for(let k=b+1;k<a;k++){let D=0;for(let $=b+1;$<a;$++)D+=v.get($,b)*v.get($,k);D=-D/v.get(b+1,b);for(let $=b+1;$<a;$++)v.set($,k,v.get($,k)+D*v.get($,b))}for(let k=0;k<a;k++)v.set(k,b,0);v.set(b,b,1)}let M=T-1,I=Number.EPSILON;for(;T>0;){let b,k;for(b=T-2;b>=-1&&b!==-1;b--){const D=Number.MIN_VALUE+I*Math.abs(m[b]+Math.abs(m[b+1]));if(Math.abs(x[b])<=D||Number.isNaN(x[b])){x[b]=0;break}}if(b===T-2)k=4;else{let D;for(D=T-1;D>=b&&D!==b;D--){let $=(D!==T?Math.abs(x[D]):0)+(D!==b+1?Math.abs(x[D-1]):0);if(Math.abs(m[D])<=I*$){m[D]=0;break}}D===b?k=3:D===T-1?k=1:(k=2,b=D)}switch(b++,k){case 1:{let D=x[T-2];x[T-2]=0;for(let $=T-2;$>=b;$--){let P=hypotenuse$1(m[$],D),O=m[$]/P,ee=D/P;if(m[$]=P,$!==b&&(D=-ee*x[$-1],x[$-1]=O*x[$-1]),h)for(let q=0;q<a;q++)P=O*v.get(q,$)+ee*v.get(q,T-1),v.set(q,T-1,-ee*v.get(q,$)+O*v.get(q,T-1)),v.set(q,$,P)}break}case 2:{let D=x[b-1];x[b-1]=0;for(let $=b;$<T;$++){let P=hypotenuse$1(m[$],D),O=m[$]/P,ee=D/P;if(m[$]=P,D=-ee*x[$],x[$]=O*x[$],f)for(let q=0;q<n;q++)P=O*w.get(q,$)+ee*w.get(q,b-1),w.set(q,b-1,-ee*w.get(q,$)+O*w.get(q,b-1)),w.set(q,$,P)}break}case 3:{const D=Math.max(Math.abs(m[T-1]),Math.abs(m[T-2]),Math.abs(x[T-2]),Math.abs(m[b]),Math.abs(x[b])),$=m[T-1]/D,P=m[T-2]/D,O=x[T-2]/D,ee=m[b]/D,q=x[b]/D,z=((P+$)*(P-$)+O*O)/2,W=$*O*($*O);let H=0;(z!==0||W!==0)&&(z<0?H=0-Math.sqrt(z*z+W):H=Math.sqrt(z*z+W),H=W/(z+H));let se=(ee+$)*(ee-$)+H,N=ee*q;for(let Y=b;Y<T-1;Y++){let L=hypotenuse$1(se,N);L===0&&(L=Number.MIN_VALUE);let U=se/L,G=N/L;if(Y!==b&&(x[Y-1]=L),se=U*m[Y]+G*x[Y],x[Y]=U*x[Y]-G*m[Y],N=G*m[Y+1],m[Y+1]=U*m[Y+1],h)for(let te=0;te<a;te++)L=U*v.get(te,Y)+G*v.get(te,Y+1),v.set(te,Y+1,-G*v.get(te,Y)+U*v.get(te,Y+1)),v.set(te,Y,L);if(L=hypotenuse$1(se,N),L===0&&(L=Number.MIN_VALUE),U=se/L,G=N/L,m[Y]=L,se=U*x[Y]+G*m[Y+1],m[Y+1]=-G*x[Y]+U*m[Y+1],N=G*x[Y+1],x[Y+1]=U*x[Y+1],f&&Y<n-1)for(let te=0;te<n;te++)L=U*w.get(te,Y)+G*w.get(te,Y+1),w.set(te,Y+1,-G*w.get(te,Y)+U*w.get(te,Y+1)),w.set(te,Y,L)}x[T-2]=se;break}case 4:{if(m[b]<=0&&(m[b]=m[b]<0?-m[b]:0,h))for(let D=0;D<=M;D++)v.set(D,b,-v.get(D,b));for(;b<M&&!(m[b]>=m[b+1]);){let D=m[b];if(m[b]=m[b+1],m[b+1]=D,h&&b<a-1)for(let $=0;$<a;$++)D=v.get($,b+1),v.set($,b+1,v.get($,b)),v.set($,b,D);if(f&&b<n-1)for(let $=0;$<n;$++)D=w.get($,b+1),w.set($,b+1,w.get($,b)),w.set($,b,D);b++}T--;break}}}if(c){let b=v;v=w,w=b}this.m=n,this.n=a,this.s=m,this.U=w,this.V=v}solve(r){let t=r,n=this.threshold,a=this.s.length,s=Matrix$2.zeros(a,a);for(let d=0;d<a;d++)Math.abs(this.s[d])<=n?s.set(d,d,0):s.set(d,d,1/this.s[d]);let o=this.U,l=this.rightSingularVectors,f=l.mmul(s),h=l.rows,c=o.rows,u=Matrix$2.zeros(h,c);for(let d=0;d<h;d++)for(let g=0;g<c;g++){let m=0;for(let w=0;w<a;w++)m+=f.get(d,w)*o.get(g,w);u.set(d,g,m)}return u.mmul(t)}solveForDiagonal(r){return this.solve(Matrix$2.diag(r))}inverse(){let r=this.V,t=this.threshold,n=r.rows,a=r.columns,s=new Matrix$2(n,this.s.length);for(let c=0;c<n;c++)for(let u=0;u<a;u++)Math.abs(this.s[u])>t&&s.set(c,u,r.get(c,u)/this.s[u]);let o=this.U,l=o.rows,f=o.columns,h=new Matrix$2(n,l);for(let c=0;c<n;c++)for(let u=0;u<l;u++){let d=0;for(let g=0;g<f;g++)d+=s.get(c,g)*o.get(u,g);h.set(c,u,d)}return h}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let r=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,t=0,n=this.s;for(let a=0,s=n.length;a<s;a++)n[a]>r&&t++;return t}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return Matrix$2.diag(this.s)}}function inverse(e,r=!1){return e=WrapperMatrix2D.checkMatrix(e),r?new SingularValueDecomposition(e).inverse():solve(e,Matrix$2.eye(e.rows))}function solve(e,r,t=!1){return e=WrapperMatrix2D.checkMatrix(e),r=WrapperMatrix2D.checkMatrix(r),t?new SingularValueDecomposition(e).solve(r):e.isSquare()?new LuDecomposition(e).solve(r):new QrDecomposition(e).solve(r)}function determinant(e){if(e=Matrix$2.checkMatrix(e),e.isSquare()){if(e.columns===0)return 1;let r,t,n,a;if(e.columns===2)return r=e.get(0,0),t=e.get(0,1),n=e.get(1,0),a=e.get(1,1),r*a-t*n;if(e.columns===3){let s,o,l;return s=new MatrixSelectionView(e,[1,2],[1,2]),o=new MatrixSelectionView(e,[1,2],[0,2]),l=new MatrixSelectionView(e,[1,2],[0,1]),r=e.get(0,0),t=e.get(0,1),n=e.get(0,2),r*determinant(s)-t*determinant(o)+n*determinant(l)}else return new LuDecomposition(e).determinant}else throw Error("determinant can only be calculated for a square matrix")}function xrange(e,r){let t=[];for(let n=0;n<e;n++)n!==r&&t.push(n);return t}function dependenciesOneRow(e,r,t,n=1e-9,a=1e-9){if(e>a)return new Array(r.rows+1).fill(0);{let s=r.addRow(t,[0]);for(let o=0;o<s.rows;o++)Math.abs(s.get(o,0))<n&&s.set(o,0,0);return s.to1DArray()}}function linearDependencies(e,r={}){const{thresholdValue:t=1e-9,thresholdError:n=1e-9}=r;e=Matrix$2.checkMatrix(e);let a=e.rows,s=new Matrix$2(a,a);for(let o=0;o<a;o++){let l=Matrix$2.columnVector(e.getRow(o)),f=e.subMatrixRow(xrange(a,o)).transpose(),c=new SingularValueDecomposition(f).solve(l),u=Matrix$2.sub(l,f.mmul(c)).abs().max();s.setRow(o,dependenciesOneRow(u,c,o,t,n))}return s}function pseudoInverse(e,r=Number.EPSILON){if(e=Matrix$2.checkMatrix(e),e.isEmpty())return e.transpose();let t=new SingularValueDecomposition(e,{autoTranspose:!0}),n=t.leftSingularVectors,a=t.rightSingularVectors,s=t.diagonal;for(let o=0;o<s.length;o++)Math.abs(s[o])>r?s[o]=1/s[o]:s[o]=0;return a.mmul(Matrix$2.diag(s).mmul(n.transpose()))}function covariance(e,r=e,t={}){e=new Matrix$2(e);let n=!1;if(typeof r=="object"&&!Matrix$2.isMatrix(r)&&!isAnyArray(r)?(t=r,r=e,n=!0):r=new Matrix$2(r),e.rows!==r.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:a=!0}=t;a&&(e=e.center("column"),n||(r=r.center("column")));const s=e.transpose().mmul(r);for(let o=0;o<s.rows;o++)for(let l=0;l<s.columns;l++)s.set(o,l,s.get(o,l)*(1/(e.rows-1)));return s}function correlation(e,r=e,t={}){e=new Matrix$2(e);let n=!1;if(typeof r=="object"&&!Matrix$2.isMatrix(r)&&!isAnyArray(r)?(t=r,r=e,n=!0):r=new Matrix$2(r),e.rows!==r.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:a=!0,scale:s=!0}=t;a&&(e.center("column"),n||r.center("column")),s&&(e.scale("column"),n||r.scale("column"));const o=e.standardDeviation("column",{unbiased:!0}),l=n?o:r.standardDeviation("column",{unbiased:!0}),f=e.transpose().mmul(r);for(let h=0;h<f.rows;h++)for(let c=0;c<f.columns;c++)f.set(h,c,f.get(h,c)*(1/(o[h]*l[c]))*(1/(e.rows-1)));return f}class EigenvalueDecomposition{constructor(r,t={}){const{assumeSymmetric:n=!1}=t;if(r=WrapperMatrix2D.checkMatrix(r),!r.isSquare())throw new Error("Matrix is not a square matrix");if(r.isEmpty())throw new Error("Matrix must be non-empty");let a=r.columns,s=new Matrix$2(a,a),o=new Float64Array(a),l=new Float64Array(a),f=r,h,c,u=!1;if(n?u=!0:u=r.isSymmetric(),u){for(h=0;h<a;h++)for(c=0;c<a;c++)s.set(h,c,f.get(h,c));tred2(a,l,o,s),tql2(a,l,o,s)}else{let d=new Matrix$2(a,a),g=new Float64Array(a);for(c=0;c<a;c++)for(h=0;h<a;h++)d.set(h,c,f.get(h,c));orthes(a,d,g,s),hqr2(a,l,o,s,d)}this.n=a,this.e=l,this.d=o,this.V=s}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let r=this.n,t=this.e,n=this.d,a=new Matrix$2(r,r),s,o;for(s=0;s<r;s++){for(o=0;o<r;o++)a.set(s,o,0);a.set(s,s,n[s]),t[s]>0?a.set(s,s+1,t[s]):t[s]<0&&a.set(s,s-1,t[s])}return a}}function tred2(e,r,t,n){let a,s,o,l,f,h,c,u;for(f=0;f<e;f++)t[f]=n.get(e-1,f);for(l=e-1;l>0;l--){for(u=0,o=0,h=0;h<l;h++)u=u+Math.abs(t[h]);if(u===0)for(r[l]=t[l-1],f=0;f<l;f++)t[f]=n.get(l-1,f),n.set(l,f,0),n.set(f,l,0);else{for(h=0;h<l;h++)t[h]/=u,o+=t[h]*t[h];for(a=t[l-1],s=Math.sqrt(o),a>0&&(s=-s),r[l]=u*s,o=o-a*s,t[l-1]=a-s,f=0;f<l;f++)r[f]=0;for(f=0;f<l;f++){for(a=t[f],n.set(f,l,a),s=r[f]+n.get(f,f)*a,h=f+1;h<=l-1;h++)s+=n.get(h,f)*t[h],r[h]+=n.get(h,f)*a;r[f]=s}for(a=0,f=0;f<l;f++)r[f]/=o,a+=r[f]*t[f];for(c=a/(o+o),f=0;f<l;f++)r[f]-=c*t[f];for(f=0;f<l;f++){for(a=t[f],s=r[f],h=f;h<=l-1;h++)n.set(h,f,n.get(h,f)-(a*r[h]+s*t[h]));t[f]=n.get(l-1,f),n.set(l,f,0)}}t[l]=o}for(l=0;l<e-1;l++){if(n.set(e-1,l,n.get(l,l)),n.set(l,l,1),o=t[l+1],o!==0){for(h=0;h<=l;h++)t[h]=n.get(h,l+1)/o;for(f=0;f<=l;f++){for(s=0,h=0;h<=l;h++)s+=n.get(h,l+1)*n.get(h,f);for(h=0;h<=l;h++)n.set(h,f,n.get(h,f)-s*t[h])}}for(h=0;h<=l;h++)n.set(h,l+1,0)}for(f=0;f<e;f++)t[f]=n.get(e-1,f),n.set(e-1,f,0);n.set(e-1,e-1,1),r[0]=0}function tql2(e,r,t,n){let a,s,o,l,f,h,c,u,d,g,m,w,v,x,S,y;for(o=1;o<e;o++)r[o-1]=r[o];r[e-1]=0;let _=0,E=0,R=Number.EPSILON;for(h=0;h<e;h++){for(E=Math.max(E,Math.abs(t[h])+Math.abs(r[h])),c=h;c<e&&!(Math.abs(r[c])<=R*E);)c++;if(c>h)do{for(a=t[h],u=(t[h+1]-a)/(2*r[h]),d=hypotenuse$1(u,1),u<0&&(d=-d),t[h]=r[h]/(u+d),t[h+1]=r[h]*(u+d),g=t[h+1],s=a-t[h],o=h+2;o<e;o++)t[o]-=s;for(_=_+s,u=t[c],m=1,w=m,v=m,x=r[h+1],S=0,y=0,o=c-1;o>=h;o--)for(v=w,w=m,y=S,a=m*r[o],s=m*u,d=hypotenuse$1(u,r[o]),r[o+1]=S*d,S=r[o]/d,m=u/d,u=m*t[o]-S*a,t[o+1]=s+S*(m*a+S*t[o]),f=0;f<e;f++)s=n.get(f,o+1),n.set(f,o+1,S*n.get(f,o)+m*s),n.set(f,o,m*n.get(f,o)-S*s);u=-S*y*v*x*r[h]/g,r[h]=S*u,t[h]=m*u}while(Math.abs(r[h])>R*E);t[h]=t[h]+_,r[h]=0}for(o=0;o<e-1;o++){for(f=o,u=t[o],l=o+1;l<e;l++)t[l]<u&&(f=l,u=t[l]);if(f!==o)for(t[f]=t[o],t[o]=u,l=0;l<e;l++)u=n.get(l,o),n.set(l,o,n.get(l,f)),n.set(l,f,u)}}function orthes(e,r,t,n){let a=0,s=e-1,o,l,f,h,c,u,d;for(u=a+1;u<=s-1;u++){for(d=0,h=u;h<=s;h++)d=d+Math.abs(r.get(h,u-1));if(d!==0){for(f=0,h=s;h>=u;h--)t[h]=r.get(h,u-1)/d,f+=t[h]*t[h];for(l=Math.sqrt(f),t[u]>0&&(l=-l),f=f-t[u]*l,t[u]=t[u]-l,c=u;c<e;c++){for(o=0,h=s;h>=u;h--)o+=t[h]*r.get(h,c);for(o=o/f,h=u;h<=s;h++)r.set(h,c,r.get(h,c)-o*t[h])}for(h=0;h<=s;h++){for(o=0,c=s;c>=u;c--)o+=t[c]*r.get(h,c);for(o=o/f,c=u;c<=s;c++)r.set(h,c,r.get(h,c)-o*t[c])}t[u]=d*t[u],r.set(u,u-1,d*l)}}for(h=0;h<e;h++)for(c=0;c<e;c++)n.set(h,c,h===c?1:0);for(u=s-1;u>=a+1;u--)if(r.get(u,u-1)!==0){for(h=u+1;h<=s;h++)t[h]=r.get(h,u-1);for(c=u;c<=s;c++){for(l=0,h=u;h<=s;h++)l+=t[h]*n.get(h,c);for(l=l/t[u]/r.get(u,u-1),h=u;h<=s;h++)n.set(h,c,n.get(h,c)+l*t[h])}}}function hqr2(e,r,t,n,a){let s=e-1,o=0,l=e-1,f=Number.EPSILON,h=0,c=0,u=0,d=0,g=0,m=0,w=0,v=0,x,S,y,_,E,R,T,M,I,b,k,D,$,P,O;for(x=0;x<e;x++)for((x<o||x>l)&&(t[x]=a.get(x,x),r[x]=0),S=Math.max(x-1,0);S<e;S++)c=c+Math.abs(a.get(x,S));for(;s>=o;){for(_=s;_>o&&(m=Math.abs(a.get(_-1,_-1))+Math.abs(a.get(_,_)),m===0&&(m=c),!(Math.abs(a.get(_,_-1))<f*m));)_--;if(_===s)a.set(s,s,a.get(s,s)+h),t[s]=a.get(s,s),r[s]=0,s--,v=0;else if(_===s-1){if(T=a.get(s,s-1)*a.get(s-1,s),u=(a.get(s-1,s-1)-a.get(s,s))/2,d=u*u+T,w=Math.sqrt(Math.abs(d)),a.set(s,s,a.get(s,s)+h),a.set(s-1,s-1,a.get(s-1,s-1)+h),M=a.get(s,s),d>=0){for(w=u>=0?u+w:u-w,t[s-1]=M+w,t[s]=t[s-1],w!==0&&(t[s]=M-T/w),r[s-1]=0,r[s]=0,M=a.get(s,s-1),m=Math.abs(M)+Math.abs(w),u=M/m,d=w/m,g=Math.sqrt(u*u+d*d),u=u/g,d=d/g,S=s-1;S<e;S++)w=a.get(s-1,S),a.set(s-1,S,d*w+u*a.get(s,S)),a.set(s,S,d*a.get(s,S)-u*w);for(x=0;x<=s;x++)w=a.get(x,s-1),a.set(x,s-1,d*w+u*a.get(x,s)),a.set(x,s,d*a.get(x,s)-u*w);for(x=o;x<=l;x++)w=n.get(x,s-1),n.set(x,s-1,d*w+u*n.get(x,s)),n.set(x,s,d*n.get(x,s)-u*w)}else t[s-1]=M+u,t[s]=M+u,r[s-1]=w,r[s]=-w;s=s-2,v=0}else{if(M=a.get(s,s),I=0,T=0,_<s&&(I=a.get(s-1,s-1),T=a.get(s,s-1)*a.get(s-1,s)),v===10){for(h+=M,x=o;x<=s;x++)a.set(x,x,a.get(x,x)-M);m=Math.abs(a.get(s,s-1))+Math.abs(a.get(s-1,s-2)),M=I=.75*m,T=-.4375*m*m}if(v===30&&(m=(I-M)/2,m=m*m+T,m>0)){for(m=Math.sqrt(m),I<M&&(m=-m),m=M-T/((I-M)/2+m),x=o;x<=s;x++)a.set(x,x,a.get(x,x)-m);h+=m,M=I=T=.964}for(v=v+1,E=s-2;E>=_&&(w=a.get(E,E),g=M-w,m=I-w,u=(g*m-T)/a.get(E+1,E)+a.get(E,E+1),d=a.get(E+1,E+1)-w-g-m,g=a.get(E+2,E+1),m=Math.abs(u)+Math.abs(d)+Math.abs(g),u=u/m,d=d/m,g=g/m,!(E===_||Math.abs(a.get(E,E-1))*(Math.abs(d)+Math.abs(g))<f*(Math.abs(u)*(Math.abs(a.get(E-1,E-1))+Math.abs(w)+Math.abs(a.get(E+1,E+1))))));)E--;for(x=E+2;x<=s;x++)a.set(x,x-2,0),x>E+2&&a.set(x,x-3,0);for(y=E;y<=s-1&&(P=y!==s-1,y!==E&&(u=a.get(y,y-1),d=a.get(y+1,y-1),g=P?a.get(y+2,y-1):0,M=Math.abs(u)+Math.abs(d)+Math.abs(g),M!==0&&(u=u/M,d=d/M,g=g/M)),M!==0);y++)if(m=Math.sqrt(u*u+d*d+g*g),u<0&&(m=-m),m!==0){for(y!==E?a.set(y,y-1,-m*M):_!==E&&a.set(y,y-1,-a.get(y,y-1)),u=u+m,M=u/m,I=d/m,w=g/m,d=d/u,g=g/u,S=y;S<e;S++)u=a.get(y,S)+d*a.get(y+1,S),P&&(u=u+g*a.get(y+2,S),a.set(y+2,S,a.get(y+2,S)-u*w)),a.set(y,S,a.get(y,S)-u*M),a.set(y+1,S,a.get(y+1,S)-u*I);for(x=0;x<=Math.min(s,y+3);x++)u=M*a.get(x,y)+I*a.get(x,y+1),P&&(u=u+w*a.get(x,y+2),a.set(x,y+2,a.get(x,y+2)-u*g)),a.set(x,y,a.get(x,y)-u),a.set(x,y+1,a.get(x,y+1)-u*d);for(x=o;x<=l;x++)u=M*n.get(x,y)+I*n.get(x,y+1),P&&(u=u+w*n.get(x,y+2),n.set(x,y+2,n.get(x,y+2)-u*g)),n.set(x,y,n.get(x,y)-u),n.set(x,y+1,n.get(x,y+1)-u*d)}}}if(c!==0){for(s=e-1;s>=0;s--)if(u=t[s],d=r[s],d===0)for(_=s,a.set(s,s,1),x=s-1;x>=0;x--){for(T=a.get(x,x)-u,g=0,S=_;S<=s;S++)g=g+a.get(x,S)*a.get(S,s);if(r[x]<0)w=T,m=g;else if(_=x,r[x]===0?a.set(x,s,T!==0?-g/T:-g/(f*c)):(M=a.get(x,x+1),I=a.get(x+1,x),d=(t[x]-u)*(t[x]-u)+r[x]*r[x],R=(M*m-w*g)/d,a.set(x,s,R),a.set(x+1,s,Math.abs(M)>Math.abs(w)?(-g-T*R)/M:(-m-I*R)/w)),R=Math.abs(a.get(x,s)),f*R*R>1)for(S=x;S<=s;S++)a.set(S,s,a.get(S,s)/R)}else if(d<0)for(_=s-1,Math.abs(a.get(s,s-1))>Math.abs(a.get(s-1,s))?(a.set(s-1,s-1,d/a.get(s,s-1)),a.set(s-1,s,-(a.get(s,s)-u)/a.get(s,s-1))):(O=cdiv(0,-a.get(s-1,s),a.get(s-1,s-1)-u,d),a.set(s-1,s-1,O[0]),a.set(s-1,s,O[1])),a.set(s,s-1,0),a.set(s,s,1),x=s-2;x>=0;x--){for(b=0,k=0,S=_;S<=s;S++)b=b+a.get(x,S)*a.get(S,s-1),k=k+a.get(x,S)*a.get(S,s);if(T=a.get(x,x)-u,r[x]<0)w=T,g=b,m=k;else if(_=x,r[x]===0?(O=cdiv(-b,-k,T,d),a.set(x,s-1,O[0]),a.set(x,s,O[1])):(M=a.get(x,x+1),I=a.get(x+1,x),D=(t[x]-u)*(t[x]-u)+r[x]*r[x]-d*d,$=(t[x]-u)*2*d,D===0&&$===0&&(D=f*c*(Math.abs(T)+Math.abs(d)+Math.abs(M)+Math.abs(I)+Math.abs(w))),O=cdiv(M*g-w*b+d*k,M*m-w*k-d*b,D,$),a.set(x,s-1,O[0]),a.set(x,s,O[1]),Math.abs(M)>Math.abs(w)+Math.abs(d)?(a.set(x+1,s-1,(-b-T*a.get(x,s-1)+d*a.get(x,s))/M),a.set(x+1,s,(-k-T*a.get(x,s)-d*a.get(x,s-1))/M)):(O=cdiv(-g-I*a.get(x,s-1),-m-I*a.get(x,s),w,d),a.set(x+1,s-1,O[0]),a.set(x+1,s,O[1]))),R=Math.max(Math.abs(a.get(x,s-1)),Math.abs(a.get(x,s))),f*R*R>1)for(S=x;S<=s;S++)a.set(S,s-1,a.get(S,s-1)/R),a.set(S,s,a.get(S,s)/R)}for(x=0;x<e;x++)if(x<o||x>l)for(S=x;S<e;S++)n.set(x,S,a.get(x,S));for(S=e-1;S>=o;S--)for(x=o;x<=l;x++){for(w=0,y=o;y<=Math.min(S,l);y++)w=w+n.get(x,y)*a.get(y,S);n.set(x,S,w)}}}function cdiv(e,r,t,n){let a,s;return Math.abs(t)>Math.abs(n)?(a=n/t,s=t+a*n,[(e+a*r)/s,(r-a*e)/s]):(a=t/n,s=n+a*t,[(a*e+r)/s,(a*r-e)/s])}class CholeskyDecomposition{constructor(r){if(r=WrapperMatrix2D.checkMatrix(r),!r.isSymmetric())throw new Error("Matrix is not symmetric");let t=r,n=t.rows,a=new Matrix$2(n,n),s=!0,o,l,f;for(l=0;l<n;l++){let h=0;for(f=0;f<l;f++){let c=0;for(o=0;o<f;o++)c+=a.get(f,o)*a.get(l,o);c=(t.get(l,f)-c)/a.get(f,f),a.set(l,f,c),h=h+c*c}for(h=t.get(l,l)-h,s&=h>0,a.set(l,l,Math.sqrt(Math.max(h,0))),f=l+1;f<n;f++)a.set(l,f,0)}this.L=a,this.positiveDefinite=Boolean(s)}isPositiveDefinite(){return this.positiveDefinite}solve(r){r=WrapperMatrix2D.checkMatrix(r);let t=this.L,n=t.rows;if(r.rows!==n)throw new Error("Matrix dimensions do not match");if(this.isPositiveDefinite()===!1)throw new Error("Matrix is not positive definite");let a=r.columns,s=r.clone(),o,l,f;for(f=0;f<n;f++)for(l=0;l<a;l++){for(o=0;o<f;o++)s.set(f,l,s.get(f,l)-s.get(o,l)*t.get(f,o));s.set(f,l,s.get(f,l)/t.get(f,f))}for(f=n-1;f>=0;f--)for(l=0;l<a;l++){for(o=f+1;o<n;o++)s.set(f,l,s.get(f,l)-s.get(o,l)*t.get(o,f));s.set(f,l,s.get(f,l)/t.get(f,f))}return s}get lowerTriangularMatrix(){return this.L}}class nipals{constructor(r,t={}){r=WrapperMatrix2D.checkMatrix(r);let{Y:n}=t;const{scaleScores:a=!1,maxIterations:s=1e3,terminationCriteria:o=1e-10}=t;let l;if(n){if(isAnyArray(n)&&typeof n[0]=="number"?n=Matrix$2.columnVector(n):n=WrapperMatrix2D.checkMatrix(n),n.rows!==r.rows)throw new Error("Y should have the same number of rows as X");l=n.getColumnVector(0)}else l=r.getColumnVector(0);let f=1,h,c,u,d;for(let g=0;g<s&&f>o;g++)u=r.transpose().mmul(l).div(l.transpose().mmul(l).get(0,0)),u=u.div(u.norm()),h=r.mmul(u).div(u.transpose().mmul(u).get(0,0)),g>0&&(f=h.clone().sub(d).pow(2).sum()),d=h.clone(),n?(c=n.transpose().mmul(h).div(h.transpose().mmul(h).get(0,0)),c=c.div(c.norm()),l=n.mmul(c).div(c.transpose().mmul(c).get(0,0))):l=h;if(n){let g=r.transpose().mmul(h).div(h.transpose().mmul(h).get(0,0));g=g.div(g.norm());let m=r.clone().sub(h.clone().mmul(g.transpose())),w=l.transpose().mmul(h).div(h.transpose().mmul(h).get(0,0)),v=n.clone().sub(h.clone().mulS(w.get(0,0)).mmul(c.transpose()));this.t=h,this.p=g.transpose(),this.w=u.transpose(),this.q=c,this.u=l,this.s=h.transpose().mmul(h),this.xResidual=m,this.yResidual=v,this.betas=w}else this.w=u.transpose(),this.s=h.transpose().mmul(h).sqrt(),a?this.t=h.clone().div(this.s.get(0,0)):this.t=h,this.xResidual=r.sub(h.mmul(u.transpose()))}}const src$1=Object.freeze(Object.defineProperty({__proto__:null,AbstractMatrix,default:Matrix$2,Matrix:Matrix$2,wrap,WrapperMatrix1D,WrapperMatrix2D,solve,inverse,determinant,linearDependencies,pseudoInverse,covariance,correlation,SingularValueDecomposition,SVD:SingularValueDecomposition,EigenvalueDecomposition,EVD:EigenvalueDecomposition,CholeskyDecomposition,CHO:CholeskyDecomposition,LuDecomposition,LU:LuDecomposition,QrDecomposition,QR:QrDecomposition,Nipals:nipals,NIPALS:nipals,MatrixColumnView,MatrixColumnSelectionView,MatrixFlipColumnView,MatrixFlipRowView,MatrixRowView,MatrixRowSelectionView,MatrixSelectionView,MatrixSubView,MatrixTransposeView:MatrixTransposeView$1},Symbol.toStringTag,{value:"Module"}));function getSeparatedKernel(e){const r=new SingularValueDecomposition(e,{autoTranspose:!0});if(r.rank!==1)return null;const t=Math.sqrt(r.s[0]),n=r.U.to2DArray().map(s=>s[0]*t),a=r.V.to2DArray().map(s=>s[0]*t);return[n,a]}function convolution(e,r={}){let{channels:t,bitDepth:n,normalize:a=!1,divisor:s=1,border:o="copy",algorithm:l="auto"}=r,f={};n&&(f.bitDepth=n);let h=Image$1.createFrom(this,f);if(t=validateArrayOfChannels(this,t),l!=="separable")({kernel:e}=validateKernel(e));else if(!Array.isArray(e)||e.length!==2)throw new RangeError("separable convolution requires two arrays of numbers to represent the kernel");if(l==="auto"){let _=getSeparatedKernel(e);_!==null?(l="separable",e=_):(e.length>9||e[0].length>9)&&this.width<=4096&&this.height<=4096?l="fft":l="direct"}let c,u;l==="separable"?(c=Math.floor(e[0].length/2),u=Math.floor(e[1].length/2)):(c=Math.floor(e.length/2),u=Math.floor(e[0].length/2));let d=h.isClamped,g=new Array(this.height*this.width),m,w,v,x,S,y;for(x=0;x<t.length;x++){for(S=t[x],v=0;v<this.height;v++)for(w=0;w<this.width;w++)m=v*this.width+w,g[m]=this.data[m*this.channels+S];if(l==="direct")y=src$2.direct(g,e,{rows:this.height,cols:this.width,normalize:a,divisor:s});else if(l==="separable"){if(y=convolutionSeparable(g,e,this.width,this.height),a){s=0;for(let _=0;_<e[0].length;_++)for(let E=0;E<e[1].length;E++)s+=e[0][_]*e[1][E]}if(s!==1)for(let _=0;_<y.length;_++)y[_]/=s}else y=src$2.fft(g,e,{rows:this.height,cols:this.width,normalize:a,divisor:s});for(v=0;v<this.height;v++)for(w=0;w<this.width;w++)m=v*this.width+w,d?h.data[m*this.channels+S]=clamp(y[m],h):h.data[m*this.channels+S]=y[m]}if(this.alpha&&!t.includes(this.channels))for(w=this.components;w<this.data.length;w=w+this.channels)h.data[w]=this.data[w];return o!=="periodic"&&h.setBorder({size:[u,c],algorithm:o}),h}function gradientFilter(e={}){let{direction:r="xy",border:t="copy",kernelX:n,kernelY:a,channels:s,bitDepth:o=this.bitDepth}=e;switch(this.checkProcessable("gradientFilter",{bitDepth:[8,16]}),r){case"x":if(!n)throw new Error("kernelX option is missing");return convolution.call(this,n,{channels:s,border:t,bitDepth:o});case"y":if(!a)throw new Error("kernelY option is missing");return convolution.call(this,a,{channels:s,border:t,bitDepth:o});case"xy":{if(!n)throw new Error("kernelX option is missing");if(!a)throw new Error("kernelY option is missing");const l=convolution.call(this,n,{channels:s,border:t,bitDepth:32}),f=convolution.call(this,a,{channels:s,border:t,bitDepth:32});return l.hypotenuse(f,{bitDepth:o,channels:s})}default:throw new Error(`Unknown parameter direction: ${r}`)}}function sobelFilter(e){return gradientFilter.call(this,Object.assign({},e,{kernelX:SOBEL_X,kernelY:SOBEL_Y}))}function scharrFilter(e){return gradientFilter.call(this,Object.assign({},e,{kernelX:SCHARR_X,kernelY:SCHARR_Y}))}var newArray_1=newArray;function newArray(e,r){e=e||0;for(var t=new Array(e),n=0;n<e;n++)t[n]=r;return t}function level(e={}){let{algorithm:r="range",channels:t,min:n=this.min,max:a=this.max}=e;switch(this.checkProcessable("level",{bitDepth:[8,16,32]}),t=validateArrayOfChannels(this,{channels:t}),t.length!==this.channel&&(Array.isArray(n)&&n.length===this.channels&&(n=n.filter((s,o)=>t.includes(o))),Array.isArray(a)&&a.length===this.channels&&(a=a.filter((s,o)=>t.includes(o)))),r){case"range":n<0&&(n=0),a>this.maxValue&&(a=this.maxValue),Array.isArray(n)||(n=newArray_1(t.length,n)),Array.isArray(a)||(a=newArray_1(t.length,a)),processImage(this,n,a,t);break;default:throw new Error(`level: algorithm not implement: ${r}`)}return this}function processImage(e,r,t,n){let a=1e-5,s=new Array(n.length);for(let o=0;o<n.length;o++)r[o]===0&&t[o]===e.maxValue||t[o]===r[o]?s[o]=0:s[o]=(e.maxValue+1-a)/(t[o]-r[o]),r[o]+=(.5-a/2)/s[o];for(let o=0;o<n.length;o++){let l=n[o];if(s[o]!==0)for(let f=0;f<e.data.length;f+=e.channels)e.data[f+l]=Math.min(Math.max(0,(e.data[f+l]-r[o])*s[o]+.5|0),e.maxValue)}}var toString=Object.prototype.toString,isArrayType=function e(r){return toString.call(r).substr(-6,5)==="Array"};function checkNumberArray(e){if(isNaN(e)){if(e instanceof Image$1)return e.data;if(!isArrayType(e))throw new Error("checkNumberArray: the value should be either a number, array or Image");return e}else{if(e<=0)throw new Error("checkNumberArray: the value must be greater than 0");return e}}function add(e,r={}){let{channels:t}=r;if(this.checkProcessable("add",{bitDepth:[8,16]}),t=validateArrayOfChannels(this,{channels:t}),e=checkNumberArray(e),isNaN(e)){if(this.data.length!==e.length)throw new Error("add: the data size is different");for(let n=0;n<t.length;n++){let a=t[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+a]=Math.max(0,Math.min(this.maxValue,this.data[s+a]+e[s+a]>>0))}}else for(let n=0;n<t.length;n++){let a=t[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+a]=Math.min(this.maxValue,this.data[s+a]+e>>0)}return this}function subtract(e,r={}){let{channels:t}=r;if(this.checkProcessable("subtract",{bitDepth:[8,16]}),t=validateArrayOfChannels(this,{channels:t}),e=checkNumberArray(e),isNaN(e)){if(this.data.length!==e.length)throw new Error("subtract: the data size is different");for(let n=0;n<t.length;n++){let a=t[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+a]=Math.max(0,Math.min(this.maxValue,this.data[s+a]-e[s+a]>>0))}}else for(let n=0;n<t.length;n++){let a=t[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+a]=Math.max(0,this.data[s+a]-e>>0)}return this}function subtractImage(e,r={}){let{channels:t,absolute:n=!1}=r;if(this.checkProcessable("subtractImage",{bitDepth:[8,16]}),this.width!==e.width||this.height!==e.height)throw new Error("subtractImage: both images must have the same size");if(this.alpha!==e.alpha||this.bitDepth!==e.bitDepth)throw new Error("subtractImage: both images must have the same alpha and bitDepth");if(this.channels!==e.channels)throw new Error("subtractImage: both images must have the same number of channels");let a=this.clone();t=validateArrayOfChannels(this,{channels:t});for(let s=0;s<t.length;s++){let o=t[s];for(let l=o;l<this.data.length;l+=this.channels){let f=this.data[l]-e.data[l];n?a.data[l]=Math.abs(f):a.data[l]=Math.max(f,0)}}return a}function hypotenuse(e,r={}){let{bitDepth:t=this.bitDepth,channels:n}=r;if(this.checkProcessable("hypotenuse",{bitDepth:[8,16,32]}),this.width!==e.width||this.height!==e.height)throw new Error("hypotenuse: both images must have the same size");if(this.alpha!==e.alpha||this.bitDepth!==e.bitDepth)throw new Error("hypotenuse: both images must have the same alpha and bitDepth");if(this.channels!==e.channels)throw new Error("hypotenuse: both images must have the same number of channels");let a=Image$1.createFrom(this,{bitDepth:t});n=validateArrayOfChannels(this,{channels:n});let s=a.isClamped;for(let o=0;o<n.length;o++){let l=n[o];for(let f=l;f<this.data.length;f+=this.channels){let h=Math.hypot(this.data[f],e.data[f]);s?a.data[f]=Math.min(Math.max(Math.round(h),0),a.maxValue):a.data[f]=h}}return a}function multiply(e,r={}){let{channels:t}=r;if(this.checkProcessable("multiply",{bitDepth:[8,16]}),e<=0)throw new Error("multiply: the value must be greater than 0");if(t=validateArrayOfChannels(this,{channels:t}),e=checkNumberArray(e),isNaN(e)){if(this.data.length!==e.length)throw new Error("multiply: the data size is different");for(let n=0;n<t.length;n++){let a=t[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+a]=Math.max(0,Math.min(this.maxValue,this.data[s+a]*e[s+a]>>0))}}else for(let n=0;n<t.length;n++){let a=t[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+a]=Math.min(this.maxValue,this.data[s+a]*e>>0)}return this}function divide(e,r={}){let{channels:t}=r;if(this.checkProcessable("divide",{bitDepth:[8,16]}),t=validateArrayOfChannels(this,{channels:t}),e=checkNumberArray(e),isNaN(e)){if(this.data.length!==e.length)throw new Error("divide: the: the data size is different");for(let n=0;n<t.length;n++){let a=t[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+a]=Math.max(0,Math.min(this.maxValue,this.data[s+a]/e[s+a]>>0))}}else for(let n=0;n<t.length;n++){let a=t[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+a]=Math.min(this.maxValue,this.data[s+a]/e>>0)}return this}class BaseRegression{constructor(){if(new.target===BaseRegression)throw new Error("BaseRegression must be subclassed")}predict(r){if(typeof r=="number")return this._predict(r);if(isAnyArray(r)){const t=[];for(let n=0;n<r.length;n++)t.push(this._predict(r[n]));return t}else throw new TypeError("x must be a number or array")}_predict(){throw new Error("_predict must be implemented")}train(){}toString(){return""}toLaTeX(){return""}score(r,t){if(!isAnyArray(r)||!isAnyArray(t)||r.length!==t.length)throw new Error("x and y must be arrays of the same length");const n=r.length,a=new Array(n);for(let g=0;g<n;g++)a[g]=this._predict(r[g]);let s=0,o=0,l=0,f=0,h=0,c=0,u=0;for(let g=0;g<n;g++)s+=a[g],o+=t[g],h+=a[g]*a[g],c+=t[g]*t[g],u+=a[g]*t[g],t[g]!==0&&(l+=(t[g]-a[g])*(t[g]-a[g])/t[g]),f+=(t[g]-a[g])*(t[g]-a[g]);const d=(n*u-s*o)/Math.sqrt((n*h-s*s)*(n*c-o*o));return{r:d,r2:d*d,chi2:l,rmsd:Math.sqrt(f/n)}}}const require$$0$1=getAugmentedNamespace(src$1);function squaredEuclidean$4(e,r){let t=0;for(let n=0;n<e.length;n++)t+=(e[n]-r[n])*(e[n]-r[n]);return t}function euclidean$2(e,r){return Math.sqrt(squaredEuclidean$4(e,r))}const euclidean$3=Object.freeze(Object.defineProperty({__proto__:null,squaredEuclidean:squaredEuclidean$4,euclidean:euclidean$2},Symbol.toStringTag,{value:"Module"})),require$$0=getAugmentedNamespace(euclidean$3),{squaredEuclidean:squaredEuclidean$3}=require$$0,defaultOptions$b={sigma:1};class GaussianKernel$1{constructor(r){r=Object.assign({},defaultOptions$b,r),this.sigma=r.sigma,this.divisor=2*r.sigma*r.sigma}compute(r,t){const n=squaredEuclidean$3(r,t);return Math.exp(-n/this.divisor)}}var gaussianKernel=GaussianKernel$1;const defaultOptions$a={degree:1,constant:1,scale:1};class PolynomialKernel$1{constructor(r){r=Object.assign({},defaultOptions$a,r),this.degree=r.degree,this.constant=r.constant,this.scale=r.scale}compute(r,t){for(var n=0,a=0;a<r.length;a++)n+=r[a]*t[a];return Math.pow(this.scale*n+this.constant,this.degree)}}var polynomialKernel=PolynomialKernel$1;const defaultOptions$9={alpha:.01,constant:-Math.E};class SigmoidKernel$1{constructor(r){r=Object.assign({},defaultOptions$9,r),this.alpha=r.alpha,this.constant=r.constant}compute(r,t){for(var n=0,a=0;a<r.length;a++)n+=r[a]*t[a];return Math.tanh(this.alpha*n+this.constant)}}var sigmoidKernel=SigmoidKernel$1;const defaultOptions$8={sigma:1,degree:1};class ANOVAKernel$1{constructor(r){r=Object.assign({},defaultOptions$8,r),this.sigma=r.sigma,this.degree=r.degree}compute(r,t){for(var n=0,a=Math.min(r.length,t.length),s=1;s<=a;++s)n+=Math.pow(Math.exp(-this.sigma*Math.pow(Math.pow(r[s-1],s)-Math.pow(t[s-1],s),2)),this.degree);return n}}var anovaKernel=ANOVAKernel$1;const{squaredEuclidean:squaredEuclidean$2}=require$$0,defaultOptions$7={sigma:1};class CauchyKernel$1{constructor(r){r=Object.assign({},defaultOptions$7,r),this.sigma=r.sigma}compute(r,t){return 1/(1+squaredEuclidean$2(r,t)/(this.sigma*this.sigma))}}var cauchyKernel=CauchyKernel$1;const{euclidean:euclidean$1}=require$$0,defaultOptions$6={sigma:1};class ExponentialKernel$1{constructor(r){r=Object.assign({},defaultOptions$6,r),this.sigma=r.sigma,this.divisor=2*r.sigma*r.sigma}compute(r,t){const n=euclidean$1(r,t);return Math.exp(-n/this.divisor)}}var exponentialKernel=ExponentialKernel$1;class HistogramIntersectionKernel{compute(r,t){for(var n=Math.min(r.length,t.length),a=0,s=0;s<n;++s)a+=Math.min(r[s],t[s]);return a}}var histogramIntersectionKernel=HistogramIntersectionKernel;const{euclidean}=require$$0,defaultOptions$5={sigma:1};class LaplacianKernel$1{constructor(r){r=Object.assign({},defaultOptions$5,r),this.sigma=r.sigma}compute(r,t){const n=euclidean(r,t);return Math.exp(-n/this.sigma)}}var laplacianKernel=LaplacianKernel$1;const{squaredEuclidean:squaredEuclidean$1}=require$$0,defaultOptions$4={constant:1};class MultiquadraticKernel$1{constructor(r){r=Object.assign({},defaultOptions$4,r),this.constant=r.constant}compute(r,t){return Math.sqrt(squaredEuclidean$1(r,t)+this.constant*this.constant)}}var multiquadraticKernel=MultiquadraticKernel$1;const{squaredEuclidean}=require$$0,defaultOptions$3={constant:1};class RationalQuadraticKernel{constructor(r){r=Object.assign({},defaultOptions$3,r),this.constant=r.constant}compute(r,t){const n=squaredEuclidean(r,t);return 1-n/(n+this.constant)}}var rationalQuadraticKernel=RationalQuadraticKernel;const{Matrix:Matrix$1,MatrixTransposeView}=require$$0$1,GaussianKernel=gaussianKernel,PolynomialKernel=polynomialKernel,SigmoidKernel=sigmoidKernel,ANOVAKernel=anovaKernel,CauchyKernel=cauchyKernel,ExponentialKernel=exponentialKernel,HistogramKernel=histogramIntersectionKernel,LaplacianKernel=laplacianKernel,MultiquadraticKernel=multiquadraticKernel,RationalKernel=rationalQuadraticKernel,kernelType={gaussian:GaussianKernel,rbf:GaussianKernel,polynomial:PolynomialKernel,poly:PolynomialKernel,anova:ANOVAKernel,cauchy:CauchyKernel,exponential:ExponentialKernel,histogram:HistogramKernel,min:HistogramKernel,laplacian:LaplacianKernel,multiquadratic:MultiquadraticKernel,rational:RationalKernel,sigmoid:SigmoidKernel,mlp:SigmoidKernel};class Kernel{constructor(r,t){if(this.kernelType=r,r!=="linear")if(typeof r=="string"){r=r.toLowerCase();var n=kernelType[r];if(n)this.kernelFunction=new n(t);else throw new Error(`unsupported kernel type: ${r}`)}else if(typeof r=="object"&&typeof r.compute=="function")this.kernelFunction=r;else throw new TypeError("first argument must be a valid kernel type or instance")}compute(r,t){if(r=Matrix$1.checkMatrix(r),t===void 0?t=r:t=Matrix$1.checkMatrix(t),this.kernelType==="linear")return r.mmul(new MatrixTransposeView(t));const n=new Matrix$1(r.rows,t.rows);if(r===t)for(let a=0;a<r.rows;a++)for(let s=a;s<r.rows;s++){const o=this.kernelFunction.compute(r.getRow(a),r.getRow(s));n.set(a,s,o),n.set(s,a,o)}else for(let a=0;a<r.rows;a++)for(let s=0;s<t.rows;s++)n.set(a,s,this.kernelFunction.compute(r.getRow(a),t.getRow(s)));return n}}var kernel=Kernel;const defaultOptions$2={lambda:.1,kernelType:"gaussian",kernelOptions:{},computeCoefficient:!1};class KernelRidgeRegression extends BaseRegression{constructor(r,t,n){if(super(),r===!0)this.alpha=t.alpha,this.inputs=t.inputs,this.kernelType=t.kernelType,this.kernelOptions=t.kernelOptions,this.kernel=new kernel(t.kernelType,t.kernelOptions);else{r=Matrix$2.checkMatrix(r),n=Object.assign({},defaultOptions$2,n);const a=new kernel(n.kernelType,n.kernelOptions),s=a.compute(r),o=r.rows;s.add(Matrix$2.eye(o,o).mul(n.lambda)),this.alpha=solve(s,t),this.inputs=r,this.kernelType=n.kernelType,this.kernelOptions=n.kernelOptions,this.kernel=a}}_predict(r){return this.kernel.compute([r],this.inputs).mmul(this.alpha).getRow(0)}toJSON(){return{name:"kernelRidgeRegression",alpha:this.alpha,inputs:this.inputs,kernelType:this.kernelType,kernelOptions:this.kernelOptions}}static load(r){if(r.name!=="kernelRidgeRegression")throw new TypeError("not a KRR model");return new KernelRidgeRegression(!0,r)}}function background$1(e,r,t){const n=new KernelRidgeRegression(e,r,t),a=new Array(this.size);for(let l=0;l<this.width;l++)for(let f=0;f<this.height;f++)a[f*this.width+l]=[l,f];const s=n.predict(a),o=Image$1.createFrom(this);for(let l=0;l<this.size;l++)o.data[l]=Math.min(this.maxValue,Math.max(0,s[l][0]));return o}function dilate(e={}){let{kernel:r=[[1,1,1],[1,1,1],[1,1,1]],iterations:t=1}=e;if(this.checkProcessable("dilate",{bitDepth:[1,8,16],components:1,alpha:0}),r.columns%2===0||r.rows%2===0)throw new TypeError("dilate: The number of rows and columns of the kernel must be odd");let n=!0;e:for(const s of r)for(const o of s)if(o!==1){n=!1;break e}let a=this;for(let s=0;s<t;s++)if(this.bitDepth===1)if(n){const o=a.clone();a=dilateOnceBinaryOnlyOnes(a,o,r.length,r[0].length)}else{const o=Image$1.createFrom(a);a=dilateOnceBinary(a,o,r)}else if(n){const o=Image$1.createFrom(a);a=dilateOnceGreyOnlyOnes(a,o,r.length,r[0].length)}else{const o=Image$1.createFrom(a);a=dilateOnceGrey(a,o,r)}return a}function dilateOnceGrey(e,r,t){const n=t.length,a=t[0].length;let s=(n-1)/2,o=(a-1)/2;for(let l=0;l<e.height;l++)for(let f=0;f<e.width;f++){let h=0;for(let c=0;c<a;c++)for(let u=0;u<n;u++){if(t[u][c]!==1)continue;let d=u-s+f,g=c-o+l;if(d<0||g<0||d>=e.width||g>=e.height)continue;const m=e.getValueXY(d,g,0);m>h&&(h=m)}r.setValueXY(f,l,0,h)}return r}function dilateOnceGreyOnlyOnes(e,r,t,n){const a=(t-1)/2,s=(n-1)/2,o=[];for(let l=0;l<e.width;l++)o.push(0);for(let l=0;l<e.height;l++){for(let f=0;f<e.width;f++){let h=0;for(let c=Math.max(0,l-s);c<Math.min(e.height,l+s+1);c++){const u=e.getValueXY(f,c,0);u>h&&(h=u)}o[f]=h}for(let f=0;f<e.width;f++){let h=0;for(let c=Math.max(0,f-a);c<Math.min(e.width,f+a+1);c++)o[c]>h&&(h=o[c]);r.setValueXY(f,l,0,h)}}return r}function dilateOnceBinary(e,r,t){const n=t.length,a=t[0].length;let s=(n-1)/2,o=(a-1)/2;for(let l=0;l<e.height;l++)for(let f=0;f<e.width;f++){let h=0;e:for(let c=0;c<a;c++)for(let u=0;u<n;u++){if(t[u][c]!==1)continue;let d=u-s+f,g=c-o+l;if(g<0||d<0||d>=e.width||g>=e.height)continue;if(e.getBitXY(d,g)===1){h=1;break e}}h===1&&r.setBitXY(f,l)}return r}function dilateOnceBinaryOnlyOnes(e,r,t,n){const a=(t-1)/2,s=(n-1)/2,o=[];for(let l=0;l<e.width;l++)o.push(1);for(let l=0;l<e.height;l++){for(let f=0;f<e.width;f++){o[f]=0;for(let h=Math.max(0,l-s);h<Math.min(e.height,l+s+1);h++)if(e.getBitXY(f,h)===1){o[f]=1;break}}for(let f=0;f<e.width;f++)if(r.getBitXY(f,l)!==1){for(let h=Math.max(0,f-a);h<Math.min(e.width,f+a+1);h++)if(o[h]===1){r.setBitXY(f,l);break}}}return r}function erode(e={}){let{kernel:r=[[1,1,1],[1,1,1],[1,1,1]],iterations:t=1}=e;if(this.checkProcessable("erode",{bitDepth:[1,8,16],components:1,alpha:0}),r.columns%2===0||r.rows%2===0)throw new TypeError("erode: The number of rows and columns of the kernel must be odd");let n=!0;e:for(const s of r)for(const o of s)if(o!==1){n=!1;break e}let a=this;for(let s=0;s<t;s++)if(this.bitDepth===1)if(n){const o=a.clone();a=erodeOnceBinaryOnlyOnes(a,o,r.length,r[0].length)}else{const o=Image$1.createFrom(a);a=erodeOnceBinary(a,o,r)}else if(n){const o=Image$1.createFrom(a);a=erodeOnceGreyOnlyOnes(a,o,r.length,r[0].length)}else{const o=Image$1.createFrom(a);a=erodeOnceGrey(a,o,r)}return a}function erodeOnceGrey(e,r,t){const n=t.length,a=t[0].length;let s=(n-1)/2,o=(a-1)/2;for(let l=0;l<e.height;l++)for(let f=0;f<e.width;f++){let h=e.maxValue;for(let c=0;c<a;c++)for(let u=0;u<n;u++){if(t[u][c]!==1)continue;let d=u-s+f,g=c-o+l;if(d<0||g<0||d>=e.width||g>=e.height)continue;const m=e.getValueXY(d,g,0);m<h&&(h=m)}r.setValueXY(f,l,0,h)}return r}function erodeOnceGreyOnlyOnes(e,r,t,n){const a=(t-1)/2,s=(n-1)/2,o=[];for(let l=0;l<e.width;l++)o.push(0);for(let l=0;l<e.height;l++){for(let f=0;f<e.width;f++){let h=e.maxValue;for(let c=Math.max(0,l-s);c<Math.min(e.height,l+s+1);c++){const u=e.getValueXY(f,c,0);u<h&&(h=u)}o[f]=h}for(let f=0;f<e.width;f++){let h=e.maxValue;for(let c=Math.max(0,f-a);c<Math.min(e.width,f+a+1);c++)o[c]<h&&(h=o[c]);r.setValueXY(f,l,0,h)}}return r}function erodeOnceBinary(e,r,t){const n=t.length,a=t[0].length;let s=(n-1)/2,o=(a-1)/2;for(let l=0;l<e.height;l++)for(let f=0;f<e.width;f++){let h=1;e:for(let c=0;c<a;c++)for(let u=0;u<n;u++){if(t[u][c]!==1)continue;let d=u-s+f,g=c-o+l;if(g<0||d<0||d>=e.width||g>=e.height)continue;if(e.getBitXY(d,g)===0){h=0;break e}}h===1&&r.setBitXY(f,l)}return r}function erodeOnceBinaryOnlyOnes(e,r,t,n){const a=(t-1)/2,s=(n-1)/2,o=[];for(let l=0;l<e.width;l++)o.push(0);for(let l=0;l<e.height;l++){for(let f=0;f<e.width;f++){o[f]=1;for(let h=Math.max(0,l-s);h<Math.min(e.height,l+s+1);h++)if(e.getBitXY(f,h)===0){o[f]=0;break}}for(let f=0;f<e.width;f++)if(r.getBitXY(f,l)!==0){for(let h=Math.max(0,f-a);h<Math.min(e.width,f+a+1);h++)if(o[h]===0){r.clearBitXY(f,l);break}}}return r}function open(e={}){let{kernel:r=[[1,1,1],[1,1,1],[1,1,1]],iterations:t=1}=e;if(this.checkProcessable("open",{bitDepth:[8,16],components:1,alpha:0}),r.columns%2===0||r.rows%2===0)throw new TypeError("open: The number of rows and columns of the kernel must be odd");let n=this;for(let a=0;a<t;a++)n=n.erode({kernel:r}),n=n.dilate({kernel:r});return n}function close(e={}){let{kernel:r=[[1,1,1],[1,1,1],[1,1,1]],iterations:t=1}=e;if(this.checkProcessable("close",{bitDepth:[1,8,16],components:1,alpha:0}),r.columns%2===0||r.rows%2===0)throw new TypeError("close: The number of rows and columns of the kernel must be odd");let n=this;for(let a=0;a<t;a++)n=n.dilate({kernel:r}).erode({kernel:r});return n}function topHat(e={}){let{kernel:r=[[1,1,1],[1,1,1],[1,1,1]],iterations:t=1}=e;if(this.checkProcessable("topHat",{bitDepth:[8,16],components:1,alpha:0}),r.length%2===0||r[0].length%2===0)throw new TypeError("topHat: The number of rows and columns of the kernel must be odd");let n=this;for(let a=0;a<t;a++)n=n.open({kernel:r}).subtractImage(n,{absolute:!0});return n}function blackHat(e={}){let{kernel:r=[[1,1,1],[1,1,1],[1,1,1]],iterations:t=1}=e;if(this.checkProcessable("blackHat",{bitDepth:[8,16],components:1,alpha:0}),r.columns%2===0||r.rows%2===0)throw new TypeError("blackHat: The number of rows and columns of the kernel must be odd");let n=this;for(let a=0;a<t;a++)n=n.close({kernel:r}).subtractImage(n,{absolute:!0});return n}function morphologicalGradient(e={}){let{kernel:r=[[1,1,1],[1,1,1],[1,1,1]],iterations:t=1}=e;if(this.checkProcessable("morphologicalGradient",{bitDepth:[8,16],components:1,alpha:0}),r.columns%2===0||r.rows%2===0)throw new TypeError("morphologicalGradient: The number of rows and columns of the kernel must be odd");let n=this;for(let a=0;a<t;a++){let s=n.dilate({kernel:r}),o=n.erode({kernel:r});n=s.subtractImage(o,{absolute:!0})}return n}function order4Points(e){let r=0,t=0,n=0,a=0,s=e[0][0],o=0;for(let h=1;h<e.length;h++)e[h][0]<s&&(s=e[h][0],o=h);let l=e[(o+1)%e.length][0],f=(o+1)%e.length;for(let h=1;h<e.length;h++)e[h][0]<l&&h!==o&&(l=e[h][0],f=h);return e[f][1]<e[o][1]?(r=e[f],a=e[o],o!==(f+1)%4?(t=e[(f+1)%4],n=e[(f+2)%4]):(t=e[(f+2)%4],n=e[(f+3)%4])):(a=e[f],r=e[o],f!==(o+1)%4?(t=e[(o+1)%4],n=e[(o+2)%4]):(t=e[(o+2)%4],n=e[(o+3)%4])),[r,t,n,a]}function distance2Points(e,r){return Math.sqrt(Math.pow(e[0]-r[0],2)+Math.pow(e[1]-r[1],2))}function crossVect(e,r){return[e[1]*r[2]-e[2]*r[1],e[2]*r[0]-e[0]*r[2],e[0]*r[1]-e[1]*r[0]]}function dotVect(e,r){return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]}function computeWidthAndHeigth(e,r,t,n,a,s){let o=Math.max(distance2Points(e,r),distance2Points(n,t)),l=Math.max(distance2Points(e,n),distance2Points(r,t)),f=0,h=0,c=Math.ceil(a/2),u=Math.ceil(s/2),d=o/l,g=[e[0],e[1],1],m=[r[0],r[1],1],w=[n[0],n[1],1],v=[t[0],t[1],1],x=dotVect(crossVect(g,v),w)/dotVect(crossVect(m,v),w),S=dotVect(crossVect(g,v),m)/dotVect(crossVect(w,v),m),y=[x*m[0]-g[0],x*m[1]-g[1],x*m[2]-g[2]],_=[S*w[0]-g[0],S*w[1]-g[1],S*w[2]-g[2]],E=y[0],R=y[1],T=y[2],M=_[0],I=_[1],b=_[2],k=1/(T*b)*(E*M-(E*b+T*M)*c+T*b*c*c+(R*I-(R*b+T*I)*u+T*b*u*u));k>=0?k=Math.sqrt(k):k=Math.sqrt(-k);let D=new Matrix$2([[k,0,c],[0,k,u],[0,0,1]]),$=D.transpose(),P=inverse($),O=inverse(D),ee=Matrix$2.rowVector(y),q=Matrix$2.rowVector(_),z=Math.sqrt(dotVect(ee.mmul(P).mmul(O).to1DArray(),y)/dotVect(q.mmul(P).mmul(O).to1DArray(),_));return z===0||d===0?(f=Math.ceil(o),h=Math.ceil(l)):z<d?(f=Math.ceil(o),h=Math.ceil(f/z)):(h=Math.ceil(l),f=Math.ceil(z*h)),[f,h]}function projectionPoint(e,r,t,n,a,s,o,l,f,h,c,u){let[d,g]=[(t*e+n*r+a)/(f*e+h*r+1),(s*e+o*r+l)/(f*e+h*r+1)];return c.getValueXY(Math.floor(d),Math.floor(g),u)}function warpingFourPoints(e,r={}){let{calculateRatio:t=!0}=r;if(e.length!==4)throw new Error(`The array pts must have four elements, which are the four corners. Currently, pts have ${e.length} elements`);let[n,a,s,o]=e,l=[n,a,s,o],[f,h,c,u]=order4Points(l),d,g;t?[d,g]=computeWidthAndHeigth(f,h,c,u,this.width,this.height):(d=Math.ceil(Math.max(distance2Points(f,h),distance2Points(u,c))),g=Math.ceil(Math.max(distance2Points(f,u),distance2Points(h,c))));let m=Image$1.createFrom(this,{width:d,height:g}),[w,v]=f,[x,S]=h,[y,_]=c,[E,R]=u,[T,M]=[0,0],[I,b]=[0,d-1],[k,D]=[g-1,d-1],[$,P]=[g-1,0],O=new Matrix$2([[T,M,1,0,0,0,-T*w,-M*w],[I,b,1,0,0,0,-I*x,-b*x],[k,D,1,0,0,0,-k*y,-M*y],[$,P,1,0,0,0,-$*E,-P*E],[0,0,0,T,M,1,-T*v,-M*v],[0,0,0,I,b,1,-I*S,-b*S],[0,0,0,k,D,1,-k*_,-D*_],[0,0,0,$,P,1,-$*R,-P*R]]),ee=Matrix$2.columnVector([w,x,y,E,v,S,_,R]),z=new SingularValueDecomposition(O).solve(ee),[W,H,se,N,Y,L,U,G]=z.to1DArray(),te=new Matrix$2(g,d);for(let de=0;de<this.channels;de++){for(let Z=0;Z<g;Z++)for(let ge=0;ge<d;ge++)te.set(Z,ge,projectionPoint(Z,ge,W,H,se,N,Y,L,U,G,this,de));m.setMatrix(te,{channel:de})}return m}function crop(e={}){let{x:r=0,y:t=0,width:n=this.width-r,height:a=this.height-t}=e;if(this.checkProcessable("crop",{bitDepth:[1,8,16]}),r=Math.round(r),t=Math.round(t),n=Math.round(n),a=Math.round(a),r>this.width-1||t>this.height-1)throw new RangeError(`crop: origin (x:${r}, y:${t}) out of range (${this.width-1}; ${this.height-1})`);if(n<=0||a<=0)throw new RangeError(`crop: width and height (width:${n}; height:${a}) must be positive numbers`);if(r<0||t<0)throw new RangeError(`crop: x and y (x:${r}, y:${t}) must be positive numbers`);if(n>this.width-r||a>this.height-t)throw new RangeError(`crop: (x: ${r}, y:${t}, width:${n}, height:${a}) size is out of range`);let s=this;if(this.bitDepth===1){const o=new Image$1(n,a,{kind:"BINARY",parent:this});s=cropBinary(this,o,r,t,n,a)}else{const o=Image$1.createFrom(this,{width:n,height:a,position:[r,t]});s=cropDefault(this,o,r,t,n,a)}return s}function cropDefault(e,r,t,n,a,s){let o=a*e.channels,l=n+s,f=0,h=t*e.channels;for(let c=n;c<l;c++){let u=c*e.width*e.channels+h,d=u+o;for(;u<d;u++)r.data[f++]=e.data[u]}return r}function cropBinary(e,r,t,n,a,s){let o=a*e.channels,l=n+s,f=0,h=t*e.channels;for(let c=n;c<l;c++){let u=c*e.width*e.channels+h,d=u+o;for(;u<d;u++)e.getBit(u)&&r.setBit(f),++f}return r}function cropAlpha(e={}){this.checkProcessable("cropAlpha",{alpha:1});const{threshold:r=this.maxValue}=e;let t=findLeft(this,r,this.components);if(t===-1)throw new Error("Could not find new dimensions. Threshold may be too high.");let n=findTop(this,r,this.components,t),a=findBottom(this,r,this.components,t),s=findRight(this,r,this.components,t,n,a);return this.crop({x:t,y:n,width:s-t+1,height:a-n+1})}function findLeft(e,r,t){for(let n=0;n<e.width;n++)for(let a=0;a<e.height;a++)if(e.getValueXY(n,a,t)>=r)return n;return-1}function findTop(e,r,t,n){for(let a=0;a<e.height;a++)for(let s=n;s<e.width;s++)if(e.getValueXY(s,a,t)>=r)return a;return-1}function findBottom(e,r,t,n){for(let a=e.height-1;a>=0;a--)for(let s=n;s<e.width;s++)if(e.getValueXY(s,a,t)>=r)return a;return-1}function findRight(e,r,t,n,a,s){for(let o=e.width-1;o>=n;o--)for(let l=a;l<=s;l++)if(e.getValueXY(o,l,t)>=r)return o;return-1}function getFactor(e){if(typeof e=="string"){const r=e[e.length-1];e=parseFloat(e),r==="%"&&(e/=100)}return e}function getThreshold$1(e,r){if(!r)throw Error("getThreshold : the maxValue should be specified");if(typeof e=="string"){if(e[e.length-1]!=="%")throw Error("getThreshold : if the value is a string it must finish by %");return parseFloat(e)/100*r}else{if(typeof e=="number")return e<1?e*r:e;throw Error("getThreshold : the value is not valid")}}function factorDimensions(e,r,t){e=getFactor(e);let n=Math.round(e*r),a=Math.round(e*t);return n<=0&&(n=1),a<=0&&(a=1),{width:n,height:a}}function checkRow(e,r){if(r<0||r>=e.height)throw new RangeError(`row must be included between 0 and ${e.height-1}. Current value: ${r}`)}function checkColumn(e,r){if(r<0||r>=e.width)throw new RangeError(`column must be included between 0 and ${e.width-1}. Current value: ${r}`)}function checkChannel(e,r){if(r<0||r>=e.channels)throw new RangeError(`channel must be included between 0 and ${e.channels-1}. Current value: ${r}`)}const validInterpolations={nearestneighbor:"nearestNeighbor",nearestneighbour:"nearestNeighbor",bilinear:"bilinear"};function checkInterpolation(e){if(typeof e!="string")throw new TypeError("interpolation must be a string");if(e=e.toLowerCase(),!validInterpolations[e])throw new RangeError(`invalid interpolation algorithm: ${e}`);return validInterpolations[e]}function nearestNeighbor(e,r,t){const n=this.width/r,a=this.height/t;if(this.bitDepth>1)for(let s=0;s<r;s++){const o=Math.floor((s+.5)*n);for(let l=0;l<t;l++){const f=Math.floor((l+.5)*a);for(let h=0;h<this.channels;h++)e.setValueXY(s,l,h,this.getValueXY(o,f,h))}}else for(let s=0;s<r;s++){const o=Math.floor((s+.5)*n);for(let l=0;l<t;l++){const f=Math.floor((l+.5)*a);this.getBitXY(o,f)&&e.setBitXY(s,l)}}}function resize(e={}){const{factor:r=1,interpolation:t=validInterpolations.nearestneighbor,preserveAspectRatio:n=!0}=e,a=checkInterpolation(t);let s=e.width,o=e.height;if(s||(o&&n?s=Math.round(o*(this.width/this.height)):s=this.width),o||(n?o=Math.round(s*(this.height/this.width)):o=this.height),{width:s,height:o}=factorDimensions(r,s,o),s===this.width&&o===this.height){const c=this.clone();return c.position=[0,0],c}let l=Math.round((this.width-s)/2),f=Math.round((this.height-o)/2);const h=Image$1.createFrom(this,{width:s,height:o,position:[l,f]});switch(a){case validInterpolations.nearestneighbor:nearestNeighbor.call(this,h,s,o);break;default:throw new Error(`unsupported resize interpolation: ${a}`)}return h}function hsv(){this.checkProcessable("hsv",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let e=Image$1.createFrom(this,{colorModel:HSV}),r=0,t=this.data;for(let n=0;n<t.length;n+=this.channels){let a=t[n],s=t[n+1],o=t[n+2],l=Math.min(a,s,o),f=Math.max(a,s,o),h=f-l,c=0,u=f===0?0:h/f,d=f;if(f!==l){switch(f){case a:c=(s-o)/h+(s<o?6:0);break;case s:c=(o-a)/h+2;break;case o:c=(a-s)/h+4;break;default:throw new Error("unreachable")}c/=6}e.data[r++]=c*this.maxValue,e.data[r++]=u*this.maxValue,e.data[r++]=d,this.alpha&&(e.data[r++]=t[n+3])}return e}function hsl$1(){this.checkProcessable("hsl",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let e=Image$1.createFrom(this,{colorModel:HSL}),r=Math.floor(this.maxValue/2),t=0,n=this.data;for(let a=0;a<n.length;a+=this.channels){let s=n[a],o=n[a+1],l=n[a+2],f=Math.max(s,o,l),h=Math.min(s,o,l),c=0,u=0,d=(f+h)/2;if(f!==h){let g=f-h;switch(u=d>r?g/(2-f-h):g/(f+h),f){case s:c=(o-l)/g+(o<l?6:0);break;case o:c=(l-s)/g+2;break;case l:c=(s-o)/g+4;break;default:throw new Error("unreachable")}c/=6}e.data[t++]=c*this.maxValue,e.data[t++]=u*this.maxValue,e.data[t++]=d,this.alpha&&(e.data[t++]=n[a+3])}return e}function cmyk(){this.checkProcessable("cmyk",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let e=Image$1.createFrom(this,{components:4,colorModel:CMYK$1}),r=0,t=this.data;for(let n=0;n<t.length;n+=this.channels){let a=t[n],s=t[n+1],o=t[n+2],l=Math.min(this.maxValue-a,this.maxValue-s,this.maxValue-o),f=(this.maxValue-a-l)/(1-l/this.maxValue),h=(this.maxValue-s-l)/(1-l/this.maxValue),c=(this.maxValue-o-l)/(1-l/this.maxValue);e.data[r++]=Math.round(f),e.data[r++]=Math.round(h),e.data[r++]=Math.round(c),e.data[r++]=Math.round(l),this.alpha&&(e.data[r++]=t[n+3])}return e}function rgba8(){return new Image$1(this.width,this.height,this.getRGBAData(),{kind:"RGBA",parent:this})}const methods$1={luma709(e,r,t){return e*6966+r*23436+t*2366>>15},luma601(e,r,t){return e*9798+r*19235+t*3735>>15},maximum(e,r,t){return Math.max(e,r,t)},minimum(e,r,t){return Math.min(e,r,t)},average(e,r,t){return(e+r+t)/3>>0},minmax(e,r,t){return(Math.max(e,r,t)+Math.min(e,r,t))/2},red(e){return e},green(e,r){return r},blue(e,r,t){return t},cyan(e,r,t,n){let a=methods$1.black(e,r,t,n);return(n.maxValue-e-a)/(1-a/n.maxValue)>>0},magenta(e,r,t,n){let a=methods$1.black(e,r,t,n);return(n.maxValue-r-a)/(1-a/n.maxValue)>>0},yellow(e,r,t,n){let a=methods$1.black(e,r,t,n);return(n.maxValue-t-a)/(1-a/n.maxValue)>>0},black(e,r,t,n){return Math.min(n.maxValue-e,n.maxValue-r,n.maxValue-t)},hue(e,r,t,n){let a=methods$1.min(e,r,t),s=methods$1.max(e,r,t);if(s===a)return 0;let o=0,l=s-a;switch(s){case e:o=(r-t)/l+(r<t?6:0);break;case r:o=(t-e)/l+2;break;case t:o=(e-r)/l+4;break;default:throw new Error("unreachable")}return o/6*n.maxValue>>0},saturation(e,r,t,n){let a=methods$1.min(e,r,t),s=methods$1.max(e,r,t),o=s-a;return s===0?0:o/s*n.maxValue},lightness(e,r,t){let n=methods$1.min(e,r,t);return(methods$1.max(e,r,t)+n)/2}};Object.defineProperty(methods$1,"luminosity",{enumerable:!1,value:methods$1.lightness});Object.defineProperty(methods$1,"luminance",{enumerable:!1,value:methods$1.lightness});Object.defineProperty(methods$1,"min",{enumerable:!1,value:methods$1.minimum});Object.defineProperty(methods$1,"max",{enumerable:!1,value:methods$1.maximum});Object.defineProperty(methods$1,"brightness",{enumerable:!1,value:methods$1.maximum});Object.keys(methods$1).forEach(e=>{});function grey(e={}){let{algorithm:r="luma709",keepAlpha:t=!1,mergeAlpha:n=!0}=e;if(typeof r!="string"&&typeof r!="function")throw new TypeError("algorithm must be a string or a function");this.checkProcessable("grey",{bitDepth:[8,16],alpha:[0,1]}),this.components===1&&(r="red"),t&=this.alpha,n&=this.alpha,t&&(n=!1);let a=getOutputImage(this,e,{components:1,alpha:t,colorModel:GREY$1}),s;if(typeof r=="function")s=r;else if(s=methods$1[r.toLowerCase()],!s)throw new Error(`unsupported grey algorithm: ${r}`);let o=0;for(let l=0;l<this.data.length;l+=this.channels)n?a.data[o++]=clamp(s(this.data[l],this.data[l+1],this.data[l+2],this)*this.data[l+this.components]/this.maxValue,this):(a.data[o++]=clamp(s(this.data[l],this.data[l+1],this.data[l+2],this),this),a.alpha&&(a.data[o++]=this.data[l+this.components]));return a}function huang(e){let r=0;for(let c=0;c<e.length;c++)if(e[c]!==0){r=c;break}let t=e.length-1;for(let c=e.length-1;c>=r;c--)if(e[c]!==0){t=c;break}let n=1/(t-r),a=new Array(e.length),s=0,o=0;for(let c=r;c<e.length;c++)s+=c*e[c],o+=e[c],a[c]=s/o;let l=new Array(e.length);s=o=0;for(let c=t;c>0;c--)s+=c*e[c],o+=e[c],l[c-1]=s/o;let f=-1,h=Number.MAX_VALUE;for(let c=0;c<e.length;c++){let u=0,d;for(let g=0;g<=c;g++)d=1/(1+n*Math.abs(g-a[c])),d<1e-6||d>.999999||(u+=e[g]*(-d*Math.log(d)-(1-d)*Math.log(1-d)));for(let g=c+1;g<e.length;g++)d=1/(1+n*Math.abs(g-l[c])),d<1e-6||d>.999999||(u+=e[g]*(-d*Math.log(d)-(1-d)*Math.log(1-d)));u<h&&(h=u,f=c)}return f}function intermodes(e){let r=e.slice(),t=0;for(;!bimodalTest$1(r);){let a=0,s=0,o=r[0];for(let l=0;l<e.length-1;l++)a=s,s=o,o=r[l+1],r[l]=(a+s+o)/3;if(r[e.length-1]=(s+o)/3,t++,t>1e4)throw new Error("Intermodes Threshold not found after 10000 iterations")}let n=0;for(let a=1;a<e.length-1;a++)r[a-1]<r[a]&&r[a+1]<r[a]&&(n+=a);return Math.floor(n/2)}function bimodalTest$1(e){let r=!1,t=0;for(let n=1;n<e.length-1;n++)if(e[n-1]<e[n]&&e[n+1]<e[n]&&(t++,t>2))return!1;return t===2&&(r=!0),r}function isodata(e){let r,t,n,a,s=0;for(let o=1;o<e.length;o++)if(e[o]>0){s=o+1;break}for(;;){r=0,n=0;for(let o=0;o<s;o++)n=n+e[o],r=r+e[o]*o;a=0,t=0;for(let o=s+1;o<e.length;o++)t+=e[o],a+=e[o]*o;if(n>0&&t>0&&(r/=n,a/=t,s===Math.round((r+a)/2)))break;if(s++,s>e.length-2)throw new Error("Threshold not found")}return s}function li(e,r){let t,n,a,s,o,l,f,h,c,u,d,g;d=.5,u=0;for(let m=0;m<e.length;m++)u+=m*e[m];u/=r,f=u;do{l=f,t=l+.5|0,n=0,s=0;for(let m=0;m<=t;m++)n+=m*e[m],s+=e[m];h=s===0?0:n/s,a=0,o=0;for(let m=t+1;m<e.length;m++)a+=m*e[m],o+=e[m];c=o===0?0:a/o,g=(h-c)/(Math.log(h)-Math.log(c)),g<-Number.EPSILON?f=g-.5|0:f=g+.5|0}while(Math.abs(f-l)>d);return t}function maxEntropy(e,r){let t=new Array(e.length);for(let d=0;d<e.length;d++)t[d]=e[d]/r;let n=new Array(e.length),a=new Array(e.length);n[0]=t[0],a[0]=1-n[0];for(let d=1;d<e.length;d++)n[d]=n[d-1]+t[d],a[d]=1-n[d];let s=0;for(let d=0;d<e.length;d++)if(Math.abs(n[d])>=Number.EPSILON){s=d;break}let o=e.length-1;for(let d=e.length-1;d>=s;d--)if(Math.abs(a[d])>=Number.EPSILON){o=d;break}let l=-1,f,h=Number.MIN_VALUE,c,u;for(let d=s;d<=o;d++){c=0;for(let g=0;g<=d;g++)e[g]!==0&&(c-=t[g]/n[d]*Math.log(t[g]/n[d]));u=0;for(let g=d+1;g<e.length;g++)e[g]!==0&&(u-=t[g]/a[d]*Math.log(t[g]/a[d]));f=c+u,h<f&&(h=f,l=d)}return l}function mean$1(e,r){let t=0;for(let n=0;n<e.length;n++)t+=n*e[n];return Math.floor(t/r)}function minError(e,r){let t,n=-2,a,s,o,l,f,h,c,u,d,g,m,w=0;for(let v=0;v<e.length;v++)w+=v*e[v];for(w/=r,t=w;t!==n;){let v=sumA(e,t),x=sumA(e,e.length-1),S=sumB(e,t),y=sumB(e,e.length-1),_=sumC(e,t),E=sumC(e,e.length-1);if(a=S/v,s=(y-S)/(x-v),o=v/x,l=(x-v)/x,f=_/v-a*a,h=(E-_)/(x-v)-s*s,c=1/f-1/h,u=a/f-s/h,d=a*a/f-s*s/h+Math.log10(f*(l*l)/(h*(o*o))),g=u*u-c*d,g<0)return t;n=t,m=(u+Math.sqrt(g))/c,isNaN(m)?t=n:t=Math.floor(m)}return t}function sumA(e,r){let t=0;for(let n=0;n<=r;n++)t+=e[n];return t}function sumB(e,r){let t=0;for(let n=0;n<=r;n++)t+=n*e[n];return t}function sumC(e,r){let t=0;for(let n=0;n<=r;n++)t+=n*n*e[n];return t}function minimum(e){if(e.length<2)return 0;let r=0,t=-1,n=-1,a=new Array(e.length);for(let s=0;s<e.length;s++)a[s]=e[s],e[s]>0&&(n=s);for(;!bimodalTest(a);)if(a=smoothed(a),r++,r>1e4)return t;return t=minimumBetweenPeeks(a,n),t}function smoothed(e){let r=new Array(e.length);for(let t=1;t<e.length-1;t++)r[t]=(e[t-1]+e[t]+e[t+1])/3;return r[0]=(e[0]+e[1])/3,r[e.length-1]=(e[e.length-2]+e[e.length-1])/3,r}function minimumBetweenPeeks(e,r){let t;for(let n=1;n<r;n++)if(e[n-1]>e[n]&&e[n+1]>=e[n]){t=n;break}return t}function bimodalTest(e){let r=e.length,t=!1,n=0;for(let a=1;a<r-1;a++)if(e[a-1]<e[a]&&e[a+1]<e[a]&&(n++,n>2))return!1;return n===2&&(t=!0),t}function moments(e,r){let t=1,n=0,a=0,s=0,o=0,l,f,h,c,u,d,g=-1,m=e.length,w=new Array(m);for(let v=0;v<m;v++)w[v]=e[v]/r;for(let v=0;v<m;v++)n+=v*w[v],a+=v*v*w[v],s+=v*v*v*w[v];f=t*a-n*n,h=(-a*a+n*s)/f,c=(t*-s+a*n)/f,u=.5*(-c-Math.sqrt(c*c-4*h)),d=.5*(-c+Math.sqrt(c*c-4*h)),l=(d-n)/(d-u);for(let v=0;v<m;v++)if(o+=w[v],o>l){g=v;break}return g}function otsu(e,r){let t=0,n=0,a=0,s=0,o=0;for(let l=0;l<e.length;l++)o+=l*e[l];for(let l=0;l<e.length;l++){n=n+e[l];const f=r-n;if(n===0||f===0)continue;t=t+l*e[l];const h=(o-t)/f,c=n*f*(t/n-h)*(t/n-h);c>=a&&(s=l,a=c)}return s}function percentile(e){let r=-1,t=.5,n=new Array(e.length),a=partialSum(e,e.length-1),s=1;for(let o=0;o<e.length;o++)n[o]=Math.abs(partialSum(e,o)/a-t),n[o]<s&&(s=n[o],r=o);return r}function partialSum(e,r){let t=0;for(let n=0;n<=r;n++)t+=e[n];return t}function renyiEntropy(e,r){let t,n,a,s=new Array(e.length),o=new Array(e.length),l=new Array(e.length),f=0,h=0,c=0,u=0,d=0,g=0,w=1/(1-.5),x=1/(1-2);for(let E=0;E<e.length;E++)s[E]=e[E]/r;o[0]=s[0],l[0]=1-o[0];for(let E=1;E<e.length;E++)o[E]=o[E-1]+s[E],l[E]=1-o[E];n=0;for(let E=0;E<e.length;E++)if(Math.abs(o[E])>=Number.EPSILON){n=E;break}a=e.length-1;for(let E=e.length-1;E>=n;E--)if(Math.abs(l[E])>=Number.EPSILON){a=E;break}for(let E=n;E<=a;E++){let R=0,T=0,M=0;for(let O=0;O<=E;O++)e[O]!==0&&(R-=s[O]/o[E]*Math.log(s[O]/o[E])),T+=Math.sqrt(s[O]/o[E]),M+=s[O]*s[O]/(o[E]*o[E]);let I=0,b=0,k=0;for(let O=E+1;O<e.length;O++)e[O]!==0&&(I-=s[O]/l[E]*Math.log(s[O]/l[E])),b+=Math.sqrt(s[O]/l[E]),k+=s[O]*s[O]/(l[E]*l[E]);let D=R+I,$=w*(T*b>0?Math.log(T*b):0),P=x*(M*k>0?Math.log(M*k):0);D>u&&(u=D,f=E),$>d&&(d=$,h=E),P>g&&(g=P,c=E)}let S=[f,h,c];S.sort((E,R)=>E-R);let y;Math.abs(S[0]-S[1])<=5?Math.abs(S[1]-S[2])<=5?y=[1,2,1]:y=[0,1,3]:Math.abs(S[1]-S[2])<=5?y=[3,1,0]:y=[1,2,1];let _=o[S[2]]-o[S[0]];return t=Math.round(S[0]*(o[S[0]]+.25*_*y[0])+.25*S[1]*_*y[1]+S[2]*(l[S[2]]+.25*_*y[2])),t}function shanbhag(e,r){let t=new Array(e.length);for(let g=0;g<e.length;g++)t[g]=e[g]/r;let n=new Array(e.length),a=new Array(e.length);n[0]=t[0],a[0]=1-n[0];for(let g=1;g<e.length;g++)n[g]=n[g-1]+t[g],a[g]=1-n[g];let s=0;for(let g=0;g<e.length;g++)if(Math.abs(n[g])>=Number.EPSILON){s=g;break}let o=e.length-1;for(let g=e.length-1;g>=s;g--)if(Math.abs(a[g])>=Number.EPSILON){o=g;break}let l=-1,f=Number.MAX_VALUE,h,c,u,d;for(let g=s;g<=o;g++){u=0,h=.5/n[g];for(let m=1;m<=g;m++)u-=t[m]*Math.log(1-h*n[m-1]);u*=h,d=0,h=.5/a[g];for(let m=g+1;m<e.length;m++)d-=t[m]*Math.log(1-h*a[m]);d*=h,c=Math.abs(u-d),c<f&&(f=c,l=g)}return l}function triangle$1(e){let r=0,t=0,n=0,a=0;for(let u=0;u<e.length;u++)if(e[u]>0){r=u;break}r>0&&r--;for(let u=e.length-1;u>0;u--)if(e[u]>0){a=u;break}a<e.length-1&&a++;for(let u=0;u<e.length;u++)e[u]>t&&(n=u,t=e[u]);let s=!1;if(n-r<a-n){s=!0;let u=0,d=e.length-1;for(;u<d;){let g=e[u];e[u]=e[d],e[d]=g,u++,d--}r=e.length-1-a,n=e.length-1-n}if(r===n)return r;let o,l,f;o=e[n],l=r-n,f=Math.sqrt(o*o+l*l),o/=f,l/=f,f=o*r+l*e[r];let h=r,c=0;for(let u=r+1;u<=n;u++){let d=o*u+l*e[u]-f;d>c&&(h=u,c=d)}if(h--,s){let u=0,d=e.length-1;for(;u<d;){let g=e[u];e[u]=e[d],e[d]=g,u++,d--}return e.length-1-h}else return h}function yen(e,r){let t=new Array(e.length);for(let h=0;h<e.length;h++)t[h]=e[h]/r;let n=new Array(e.length);n[0]=t[0];for(let h=1;h<e.length;h++)n[h]=n[h-1]+t[h];let a=new Array(e.length);a[0]=t[0]*t[0];for(let h=1;h<e.length;h++)a[h]=a[h-1]+t[h]*t[h];let s=new Array(e.length);s[e.length-1]=0;for(let h=e.length-2;h>=0;h--)s[h]=s[h+1]+t[h+1]*t[h+1];let o=-1,l=Number.MIN_VALUE,f;for(let h=0;h<e.length;h++)f=-1*(a[h]*s[h]>0?Math.log(a[h]*s[h]):0)+2*(n[h]*(1-n[h])>0?Math.log(n[h]*(1-n[h])):0),f>l&&(l=f,o=h);return o}const methods={huang,intermodes,isodata,li,maxentropy:maxEntropy,mean:mean$1,minerror:minError,minimum,moments,otsu,percentile,renyientropy:renyiEntropy,shanbhag,triangle:triangle$1,yen},names={};Object.keys(methods).forEach(e=>{names[e]=e});function getThreshold(e={}){let{algorithm:r=names.otsu}=e;this.checkProcessable("getThreshold",{components:1,bitDepth:[8,16]});let t=methods[r.toLowerCase()];if(t){let n=this.getHistogram();return t(n,this.size)}else throw new Error(`unknown thresholding algorithm: ${r}`)}const THRESHOLD="threshold";function mask(e={}){let{algorithm:r=THRESHOLD,threshold:t=.5,useAlpha:n=!0,invert:a=!1}=e;this.checkProcessable("mask",{components:1,bitDepth:[8,16]}),r===THRESHOLD?t=getThreshold$1(t,this.maxValue):t=getThreshold.call(this,e);let s=new Image$1(this.width,this.height,{kind:"BINARY",parent:this}),o=0;if(this.alpha&&n)for(let l=0;l<this.data.length;l+=this.channels){let f=this.data[l]+(this.maxValue-this.data[l])*(this.maxValue-this.data[l+1])/this.maxValue;(a&&f<=t||!a&&f>=t)&&s.setBit(o),o++}else for(let l=0;l<this.data.length;l+=this.channels)(a&&this.data[l]<=t||!a&&this.data[l]>=t)&&s.setBit(o),o++;return s}function copyImage(e,r,t,n){let a=e.width,s=e.height,o=r.width,l=e.channels;for(let f=0;f<a;f++)for(let h=0;h<s;h++)for(let c=0;c<l;c++){let u=(h*a+f)*l+c,d=((n+h)*o+t+f)*l+c;r.data[d]=e.data[u]}}function pad(e={}){let{size:r=0,algorithm:t="copy",color:n}=e;if(this.checkProcessable("pad",{bitDepth:[8,16]}),t==="set"){if(n.length!==this.channels)throw new Error(`pad: the color array must have the same length as the number of channels. Here: ${this.channels}`);for(let f=0;f<n.length;f++)n[f]===0&&(n[f]=.001)}else n=newArray_1(this.channels,null);Array.isArray(r)||(r=[r,r]);let a=this.width+r[0]*2,s=this.height+r[1]*2,o=this.channels,l=Image$1.createFrom(this,{width:a,height:s});copyImage(this,l,r[0],r[1]);for(let f=r[0];f<a-r[0];f++)for(let h=0;h<o;h++){let c=n[h]||l.data[(r[1]*a+f)*o+h];for(let u=0;u<r[1];u++)l.data[(u*a+f)*o+h]=c;c=n[h]||l.data[((s-r[1]-1)*a+f)*o+h];for(let u=s-r[1];u<s;u++)l.data[(u*a+f)*o+h]=c}for(let f=0;f<s;f++)for(let h=0;h<o;h++){let c=n[h]||l.data[(f*a+r[0])*o+h];for(let u=0;u<r[0];u++)l.data[(f*a+u)*o+h]=c;c=n[h]||l.data[(f*a+a-r[0]-1)*o+h];for(let u=a-r[0];u<a;u++)l.data[(f*a+u)*o+h]=c}return l}function colorDepth(e=8){if(this.checkProcessable("colorDepth",{bitDepth:[1,8,16]}),![8,16].includes(e))throw Error("You need to specify the new colorDepth as 8 or 16");if(this.bitDepth===e)return this.clone();let r=Image$1.createFrom(this,{bitDepth:e});switch(e){case 8:if(this.bitDepth===1)for(let t=0;t<this.size;t++)this.getBit(t)&&(r.data[t]=255);else for(let t=0;t<this.data.length;t++)r.data[t]=this.data[t]>>8;break;case 16:if(this.bitDepth===1)for(let t=0;t<this.size;t++)this.getBit(t)&&(r.data[t]=65535);else for(let t=0;t<this.data.length;t++)r.data[t]=this.data[t]<<8|this.data[t];break;default:throw new Error("colorDepth conversion unexpected case")}return r}function rotateFree(e,r={}){const{interpolation:t=validInterpolations.nearestneighbor,width:n=this.width,height:a=this.height}=r;if(typeof e!="number")throw new TypeError("degrees must be a number");const s=checkInterpolation(t),o=e*Math.PI/180,l=Math.floor(Math.abs(n*Math.cos(o))+Math.abs(a*Math.sin(o))),f=Math.floor(Math.abs(a*Math.cos(o))+Math.abs(n*Math.sin(o))),h=Math.cos(-o),c=Math.sin(-o);let u=l/2,d=f/2;l%2===0?(u=u-.5,f%2===0?d=d-.5:d=Math.floor(d)):(u=Math.floor(u),f%2===0?d=d-.5:d=Math.floor(d));const g=Math.floor(n/2-u),m=Math.floor(a/2-d);if(this.bitDepth===1){const w=new Image$1(l,f,{kind:"BINARY",parent:this});switch(s){case validInterpolations.nearestneighbor:return rotateBinaryNearestNeighbor(this,w,g,m,u,d,h,c);case validInterpolations.bilinear:return rotateBinaryBilinear(this,w,g,m,u,d,h,c);default:throw new Error(`unsupported rotate interpolation: ${s}`)}}else{const w=Image$1.createFrom(this,{width:l,height:f});switch(s){case validInterpolations.nearestneighbor:return rotateNearestNeighbor(this,w,g,m,u,d,h,c);case validInterpolations.bilinear:return rotateBilinear(this,w,g,m,u,d,h,c);default:throw new Error(`unsupported rotate interpolation: ${s}`)}}}function rotateNearestNeighbor(e,r,t,n,a,s,o,l){for(let f=0;f<r.width;f+=1)for(let h=0;h<r.height;h+=1)for(let c=0;c<e.channels;c++){let u=Math.round((f-a)*o-(h-s)*l+a)+t,d=Math.round((h-s)*o+(f-a)*l+s)+n;u<0||u>=e.width||d<0||d>=e.height?e.alpha===1&&c===e.channels-1?r.setValueXY(f,h,c,0):r.setValueXY(f,h,c,e.maxValue):r.setValueXY(f,h,c,e.getValueXY(u,d,c))}return r}function rotateBinaryNearestNeighbor(e,r,t,n,a,s,o,l){for(let f=0;f<r.width;f+=1)for(let h=0;h<r.height;h+=1){let c=Math.round((f-a)*o-(h-s)*l+a)+t,u=Math.round((h-s)*o+(f-a)*l+s)+n;(c<0||c>=e.width||u<0||u>=e.height||e.getBitXY(c,u))&&r.setBitXY(f,h)}return r}function rotateBilinear(e,r,t,n,a,s,o,l){let f=e.width*e.channels;for(let h=0;h<r.height;h++)for(let c=0;c<r.width;c++){let u=(c-a)*o-(h-s)*l+a+t,d=(h-s)*o+(c-a)*l+s+n,g=u|0,m=d|0,w=u-g,v=d-m;for(let x=0;x<e.channels;x++)if(u<0||u>=e.width||d<0||d>=e.height)e.alpha===1&&x===e.channels-1?r.setValueXY(c,h,x,0):r.setValueXY(c,h,x,e.maxValue);else{let S=(m*e.width+g)*e.channels+x,y=e.data[S],_=e.data[S+e.channels],E=e.data[S+f],R=e.data[S+f+e.channels],T=y+w*(_-y)+v*(E-y)+w*v*(y-_-E+R)|0;r.setValueXY(c,h,x,T)}}return r}function rotateBinaryBilinear(e,r,t,n,a,s,o,l){let f=e.width;for(let h=0;h<r.height;h++)for(let c=0;c<r.width;c++){let u=(c-a)*o-(h-s)*l+a+t,d=(h-s)*o+(c-a)*l+s+n,g=u|0,m=d|0,w=u-g,v=d-m;if(u<0||u>=e.width||d<0||d>=e.height)r.setBitXY(c,h);else{let x=m*e.width+g,S=e.getBit(x),y=e.getBit(x+1),_=e.getBit(x+f),E=e.getBit(x+1+f);(S|w&y-S|v&_-S|w&v&S-y-_+E)>0&&r.setBitXY(c,h)}}return r}function rotate$1(e,r){if(this.checkProcessable("rotate",{bitDepth:[1,8,16]}),typeof e!="number")throw new TypeError("angle must be a number");switch(e<0&&(e=Math.ceil(-e/360)*360+e),e%360){case 0:return this.clone();case 90:return rotateRight.call(this);case 180:return rotate180.call(this);case 270:return rotateLeft.call(this);default:return rotateFree.call(this,e,r)}}function rotateLeft(){if(this.bitDepth===1){const e=new Image$1(this.height,this.width,{kind:"BINARY",parent:this}),r=e.height-1;for(let t=0;t<this.height;t++)for(let n=0;n<this.width;n++)this.getBitXY(n,t)&&e.setBitXY(t,r-n);return e}else{const e=Image$1.createFrom(this,{width:this.height,height:this.width}),r=e.height-1;for(let t=0;t<this.height;t++)for(let n=0;n<this.width;n++)for(let a=0;a<this.channels;a++)e.setValueXY(t,r-n,a,this.getValueXY(n,t,a));return e}}function rotateRight(){if(this.bitDepth===1){const e=new Image$1(this.height,this.width,{kind:"BINARY",parent:this}),r=e.width-1;for(let t=0;t<this.height;t++)for(let n=0;n<this.width;n++)this.getBitXY(n,t)&&e.setBitXY(r-t,n);return e}else{const e=Image$1.createFrom(this,{width:this.height,height:this.width}),r=e.width-1;for(let t=0;t<this.height;t++)for(let n=0;n<this.width;n++)for(let a=0;a<this.channels;a++)e.setValueXY(r-t,n,a,this.getValueXY(n,t,a));return e}}function rotate180(){if(this.bitDepth===1){const e=new Image$1(this.width,this.height,{kind:"BINARY",parent:this}),r=e.width-1,t=e.height-1;for(let n=0;n<this.height;n++)for(let a=0;a<this.width;a++)this.getBitXY(a,n)&&e.setBitXY(r-a,t-n);return e}else{const e=Image$1.createFrom(this),r=e.width-1,t=e.height-1;for(let n=0;n<this.height;n++)for(let a=0;a<this.width;a++)for(let s=0;s<this.channels;s++)e.setValueXY(r-a,t-n,s,this.getValueXY(a,n,s));return e}}function insert(e,r={}){const t=getImageParameters(e);this.checkProcessable("insert",t);let{x:n=0,y:a=0}=r;const s=getOutputImageOrInPlace(this,r,{copy:!0}),o=Math.min(s.height,a+e.height),l=Math.min(s.width,n+e.width);if(s.bitDepth===1)for(let f=a;f<o;f++)for(let h=n;h<l;h++)e.getBitXY(h-n,f-a)?s.setBitXY(h,f):s.clearBitXY(h,f);else for(let f=a;f<o;f++)for(let h=n;h<l;h++)s.setPixelXY(h,f,e.getPixelXY(h-n,f-a));return s}function setBorder(e={}){let{size:r=0,algorithm:t="copy",color:n}=e;if(this.checkProcessable("setBorder",{bitDepth:[8,16,32,64]}),t==="set"){if(n.length!==this.channels)throw new Error(`setBorder: the color array must have the same length as the number of channels. Here: ${this.channels}`);for(let l=0;l<n.length;l++)n[l]===0&&(n[l]=.001)}else n=newArray_1(this.channels,null);Array.isArray(r)||(r=[r,r]);let a=r[0],s=r[1],o=this.channels;for(let l=a;l<this.width-a;l++)for(let f=0;f<o;f++){let h=n[f]||this.data[(l+this.width*s)*o+f];for(let c=0;c<s;c++)this.data[(c*this.width+l)*o+f]=h;h=n[f]||this.data[(l+this.width*(this.height-s-1))*o+f];for(let c=this.height-s;c<this.height;c++)this.data[(c*this.width+l)*o+f]=h}for(let l=0;l<this.height;l++)for(let f=0;f<o;f++){let h=n[f]||this.data[(l*this.width+a)*o+f];for(let c=0;c<a;c++)this.data[(l*this.width+c)*o+f]=h;h=n[f]||this.data[(l*this.width+this.width-a-1)*o+f];for(let c=this.width-a;c<this.width;c++)this.data[(l*this.width+c)*o+f]=h}return this}function split(e={}){let{preserveAlpha:r=!0}=e;if(this.checkProcessable("split",{bitDepth:[8,16]}),this.components===1)return new Stack([this.clone()]);let t=new Stack,n=this.data;if(this.alpha&&r)for(let a=0;a<this.components;a++){let s=Image$1.createFrom(this,{components:1,alpha:!0,colorModel:GREY$1}),o=0;for(let l=0;l<n.length;l+=this.channels)s.data[o++]=n[l+a],s.data[o++]=n[l+this.components];t.push(s)}else for(let a=0;a<this.channels;a++){let s=Image$1.createFrom(this,{components:1,alpha:!1,colorModel:GREY$1}),o=0;for(let l=0;l<n.length;l+=this.channels)s.data[o++]=n[l+a];t.push(s)}return t}function getChannel(e,r={}){let{keepAlpha:t=!1,mergeAlpha:n=!1}=r;t&=this.alpha,n&=this.alpha,this.checkProcessable("getChannel",{bitDepth:[8,16]}),e=validateChannel(this,e);let a=Image$1.createFrom(this,{components:1,alpha:t,colorModel:GREY$1}),s=0;for(let o=0;o<this.data.length;o+=this.channels)n?a.data[s++]=this.data[o+e]*this.data[o+this.components]/this.maxValue:(a.data[s++]=this.data[o+e],t&&(a.data[s++]=this.data[o+this.components]));return a}function combineChannels(e=defaultCombineMethod,r={}){let{mergeAlpha:t=!1,keepAlpha:n=!1}=r;t&=this.alpha,n&=this.alpha,this.checkProcessable("combineChannels",{bitDepth:[8,16]});let a=Image$1.createFrom(this,{components:1,alpha:n,colorModel:GREY$1}),s=0;for(let o=0;o<this.size;o++){let l=e(this.getPixel(o));t?a.data[s++]=l*this.data[o*this.channels+this.components]/this.maxValue:(a.data[s++]=l,n&&(a.data[s++]=this.data[o*this.channels+this.components]))}return a}function defaultCombineMethod(e){return(e[0]+e[1]+e[2])/3}function setChannel(e,r){if(this.checkProcessable("setChannel",{bitDepth:[8,16]}),r.checkProcessable("setChannel (image parameter check)",{bitDepth:[this.bitDepth],alpha:[0],components:[1]}),r.width!==this.width||r.height!==this.height)throw new Error("Images must have exactly the same width and height");e=validateChannel(this,e);let t=e;for(let n=0;n<r.data.length;n++)this.data[t]=r.data[n],t+=this.channels;return this}function getSimilarity(e,r={}){let{shift:t=[0,0],average:n,channels:a,defaultAlpha:s,normalize:o,border:l=[0,0]}=r;if(this.checkProcessable("getSimilarity",{bitDepth:[8,16]}),Array.isArray(l)||(l=[l,l]),a=validateArrayOfChannels(this,{channels:a,defaultAlpha:s}),this.bitDepth!==e.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==e.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==e.colorModel)throw new Error("Both images must have the same colorModel");typeof n>"u"&&(n=!0);let f=Math.max(l[0],-t[0]),h=Math.min(this.width-l[0],this.width-t[0]),c=Math.max(l[1],-t[1]),u=Math.min(this.height-l[1],this.height-t[1]),d=newArray_1(a.length,0);for(let g=0;g<a.length;g++){let m=a[g],w=o?this.sum[m]:Math.max(this.sum[m],e.sum[m]),v=o?e.sum[m]:Math.max(this.sum[m],e.sum[m]);if(w!==0&&v!==0)for(let x=f;x<h;x++)for(let S=c;S<u;S++){let y=x*this.multiplierX+S*this.multiplierY+m,_=y+t[0]*this.multiplierX+t[1]*this.multiplierY;d[g]+=Math.min(this.data[y]/w,e.data[_]/v)}}return n?d.reduce((g,m)=>g+m)/d.length:d}function getPixelsGrid(e={}){let{sampling:r=[10,10],painted:t=!1,mask:n}=e;this.checkProcessable("getPixelsGrid",{bitDepth:[8,16],channels:1}),Array.isArray(r)||(r=[r,r]);const a=r[0],s=r[1],o=[],l=[],f=this.width/a,h=this.height/s;let c=Math.floor(f/2);for(let d=0;d<a;d++){let g=Math.floor(h/2);for(let m=0;m<s;m++){let w=Math.round(c),v=Math.round(g);(!n||n.getBitXY(w,v))&&(o.push([w,v]),l.push(this.getPixelXY(w,v))),g+=h}c+=f}const u={xyS:o,zS:l};return t&&(u.painted=this.rgba8().paintPoints(o)),u}function Matrix(e,r,t){const n=new Array(e);for(let a=0;a<e;a++)n[a]=new Array(r);if(t)for(let a=0;a<e;a++)for(let s=0;s<r;s++)n[a][s]=t;return n.width=e,n.height=r,Object.setPrototypeOf(n,Matrix.prototype),n}Matrix.prototype.localMin=function(e,r){let t=this[e][r],n=[e,r];for(let a=Math.max(0,e-1);a<Math.min(this.length,e+2);a++)for(let s=Math.max(0,r-1);s<Math.min(this[0].length,r+2);s++)this[a][s]<t&&(t=this[a][s],n=[a,s]);return{position:n,value:t}};Matrix.prototype.localMax=function(e,r){let t=this[e][r],n=[e,r];for(let a=Math.max(0,e-1);a<Math.min(this.length,e+2);a++)for(let s=Math.max(0,r-1);s<Math.min(this[0].length,r+2);s++)this[a][s]>t&&(t=this[a][s],n=[a,s]);return{position:n,value:t}};Matrix.prototype.localSearch=function(e,r,t){let n=[];for(let a=Math.max(0,e-1);a<Math.min(this.length,e+2);a++)for(let s=Math.max(0,r-1);s<Math.min(this[0].length,r+2);s++)this[a][s]===t&&n.push([a,s]);return n};function getBestMatch(e,r={}){let{border:t}=r;if(this.checkProcessable("getChannel",{bitDepth:[8,16]}),this.bitDepth!==e.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==e.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==e.colorModel)throw new Error("Both images must have the same colorModel");let n=new Matrix(e.width,e.height,-1/0),a=Math.floor(e.width/2),s=Math.floor(e.height/2),o=a,l=s,f=!1;for(;!f;){let h=n.localSearch(a,s,-1/0);for(let u=0;u<h.length;u++){let d=h[u],g=this.getSimilarity(e,{border:t,shift:[o-d[0],l-d[1]]});n[d[0]][d[1]]=g}let c=n.localMax(a,s);c.position[0]!==a||c.position[1]!==s?(a=c.position[0],s=c.position[1]):f=!0}return[a-o,s-l]}function getRow(e,r=0){this.checkProcessable("getRow",{bitDepth:[8,16]}),checkRow(this,e),checkChannel(this,r);let t=new Array(this.width),n=0,a=e*this.width*this.channels+r,s=a+this.width*this.channels;for(let o=a;o<s;o+=this.channels)t[n++]=this.data[o];return t}function getColumn(e,r=0){this.checkProcessable("getColumn",{bitDepth:[8,16]}),checkColumn(this,e),checkChannel(this,r);let t=new Array(this.height),n=0,a=this.width*this.channels;for(let s=r+e*this.channels;s<this.data.length;s+=a)t[n++]=this.data[s];return t}function getMatrix(e={}){let{channel:r}=e;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),r===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");r=0}let t=new Matrix$2(this.height,this.width);for(let n=0;n<this.height;n++)for(let a=0;a<this.width;a++)t.set(n,a,this.getValueXY(a,n,r));return t}function setMatrix(e,r={}){e=new Matrix$2(e);let{channel:t}=r;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),t===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");t=0}if(this.width!==e.columns||this.height!==e.rows)throw new RangeError("The size of the matrix must be equal to the size of the image");for(let n=0;n<this.height;n++)for(let a=0;a<this.width;a++)this.setValueXY(a,n,t,e.get(n,a))}function getPixelsArray(){this.checkProcessable("getPixelsArray",{bitDepth:[8,16,32]});let e=new Array(this.size),r=0;for(let t=0;t<this.data.length;t+=this.channels){let n=new Array(this.components);for(let a=0;a<this.components;a++)n[a]=this.data[t+a];e[r++]=n}return e}function getIntersection(e){let r=this,t=r.getClosestCommonParent(e),n=r.getRelativePosition(t,{defaultFurther:!0}),a=getRelativePositionForAllPixels(r,n),s=e.getRelativePosition(t,{defaultFurther:!0}),o=getRelativePositionForAllPixels(e,s),l=getCommonSurface(a,o),f={whitePixelsMask1:[],whitePixelsMask2:[],commonWhitePixels:[]};for(let h=0;h<l.length;h++){let c=l[h],u=[c[0]-n[0],c[1]-n[1]],d=[c[0]-s[0],c[1]-s[1]],g=r.getBitXY(u[0],u[1]),m=e.getBitXY(d[0],d[1]);g===1&&m===1&&f.commonWhitePixels.push(c)}for(let h=0;h<a.length;h++){let c,u;h!==0&&(c=Math.floor(h/r.width),u=h%r.width),r.getBitXY(c,u)===1&&f.whitePixelsMask1.push(a[h])}for(let h=0;h<o.length;h++){let c=0,u=0;h!==0&&(c=Math.floor(h/e.width),u=h%e.width),e.getBitXY(c,u)===1&&f.whitePixelsMask2.push(o[h])}return f}function getRelativePositionForAllPixels(e,r){let t=[];for(let n=0;n<e.height;n++)for(let a=0;a<e.width;a++){let s=[n,a];t.push([s[0]+r[0],s[1]+r[1]])}return t}function getCommonSurface(e,r){let t=0,n=0,a=[];for(;t<e.length&&n<r.length;)e[t][0]===r[n][0]&&e[t][1]===r[n][1]?(a.push(e[t]),t++,n++):e[t][0]<r[n][0]||e[t][0]===r[n][0]&&e[t][1]<r[n][1]?t++:n++;return a}function getClosestCommonParent(e){let r=getDepth(this),t=getDepth(e),n;if(r>=t?n=getFurthestParent(this,r):n=getFurthestParent(e,t),r===0||t===0)return n;let a=this,s=e;for(;r!==t;)if(r>t){if(a=a.parent,a===null)return n;r=r-1}else{if(s=s.parent,s===null)return n;t=t-1}for(;a!==s&&a!==null&&s!==null;)if(a=a.parent,s=s.parent,a===null||s===null)return n;return a!==s?n:a}function getDepth(e){let r=0,t=e;for(;t.parent!=null;)t=t.parent,r++;return r}function getFurthestParent(e,r){let t=e;for(;r>0;)t=t.parent,r=r-1;return t}const defaultOptions$1={lowThreshold:10,highThreshold:30,gaussianBlur:1.1},Gx=[[-1,0,1],[-2,0,2],[-1,0,1]],Gy=[[-1,-2,-1],[0,0,0],[1,2,1]],convOptions={bitDepth:32,mode:"periodic"};function cannyEdgeDetector(e,r){e.checkProcessable("Canny edge detector",{bitDepth:8,channels:1,components:1}),r=Object.assign({},defaultOptions$1,r);const t=e.width,n=e.height,a=e.maxValue,s={sigma:r.gaussianBlur,radius:3},o=e.gaussianFilter(s),l=o.convolution(Gy,convOptions),f=o.convolution(Gx,convOptions),h=f.hypotenuse(l),c=e.constructor,u=new c(t,n,{kind:"GREY",bitDepth:32}),d=new c(t,n,{kind:"GREY",bitDepth:32}),g=new c(t,n,{kind:"GREY"});for(var m=1;m<t-1;m++)for(var w=1;w<n-1;w++){var v=(Math.round(Math.atan2(f.getValueXY(m,w,0),l.getValueXY(m,w,0))*(5/Math.PI))+5)%5;v===0&&(h.getValueXY(m,w,0)<=h.getValueXY(m,w-1,0)||h.getValueXY(m,w,0)<=h.getValueXY(m,w+1,0))||v===1&&(h.getValueXY(m,w,0)<=h.getValueXY(m-1,w+1,0)||h.getValueXY(m,w,0)<=h.getValueXY(m+1,w-1,0))||v===2&&(h.getValueXY(m,w,0)<=h.getValueXY(m-1,w,0)||h.getValueXY(m,w,0)<=h.getValueXY(m+1,w,0))||v===3&&(h.getValueXY(m,w,0)<=h.getValueXY(m-1,w-1,0)||h.getValueXY(m,w,0)<=h.getValueXY(m+1,w+1,0))||u.setValueXY(m,w,0,h.getValueXY(m,w,0))}for(m=0;m<t*n;++m){var x=u.data[m],S=0;x>r.highThreshold&&(S++,g.data[m]=a),x>r.lowThreshold&&S++,d.data[m]=S}var y=[];for(m=1;m<t-1;++m)for(w=1;w<n-1;++w){if(d.getValueXY(m,w,0)!==1)continue;e:for(var _=m-1;_<m+2;++_)for(var E=w-1;E<w+2;++E)if(d.getValueXY(_,E,0)===2){y.push([m,w]),g.setValueXY(m,w,0,a);break e}}for(;y.length>0;){var R=[];for(m=0;m<y.length;++m)for(w=-1;w<2;++w)for(_=-1;_<2;++_)if(!(w===0&&_===0)){var T=y[m][0]+w,M=y[m][1]+_;d.getValueXY(T,M,0)===1&&g.getValueXY(T,M,0)===0&&(R.push([T,M]),g.setValueXY(T,M,0,a))}y=R}return g}function cannyEdge(e){return cannyEdgeDetector(this,e)}function extract(e,r={}){let{position:t}=r;if(this.checkProcessable("extract",{bitDepth:[1,8,16]}),!t&&(t=e.getRelativePosition(this),!t))throw new Error("extract : can not extract an image because the relative position can not be determined, try to specify manually the position as an array of 2 elements [x,y].");if(this.bitDepth>1){let n=Image$1.createFrom(this,{width:e.width,height:e.height,alpha:1,position:t,parent:this});for(let a=0;a<e.width;a++)for(let s=0;s<e.height;s++){for(let o=0;o<this.channels;o++){let l=this.getValueXY(a+t[0],s+t[1],o);n.setValueXY(a,s,o,l)}e.getBitXY(a,s)||n.setValueXY(a,s,this.components,0)}return n}else{let n=Image$1.createFrom(this,{width:e.width,height:e.height,position:t,parent:this});for(let a=0;a<e.height;a++)for(let s=0;s<e.width;s++)e.getBitXY(s,a)&&this.getBitXY(s+t[0],a+t[1])&&n.setBitXY(s,a);return n}}var fastList={exports:{}};(function(e,r){(function(){function t(a,s,o){this.next=o,o&&(o.prev=this),this.prev=s,s&&(s.next=this),this.data=a}function n(){if(!(this instanceof n))return new n;this._head=null,this._tail=null,this.length=0}n.prototype={push:function(a){this._tail=new t(a,this._tail,null),this._head||(this._head=this._tail),this.length++},pop:function(){if(this.length!==0){var a=this._tail;return this._tail=a.prev,a.prev&&(a.prev=this._tail.next=null),this.length--,this.length===1?this._head=this._tail:this.length===0&&(this._head=this._tail=null),a.data}},unshift:function(a){this._head=new t(a,null,this._head),this._tail||(this._tail=this._head),this.length++},shift:function(){if(this.length!==0){var a=this._head;return this._head=a.next,a.next&&(a.next=this._head.prev=null),this.length--,this.length===1?this._tail=this._head:this.length===0&&(this._head=this._tail=null),a.data}},item:function(a){a<0&&(a=this.length+a);for(var s=this._head;a-- >0&&s;)s=s.next;return s?s.data:void 0},slice:function(a,s){if(a||(a=0),s||(s=this.length),s<0&&(s=this.length+s),a<0&&(a=this.length+a),s===a)return[];if(s<a)throw new Error("invalid offset: "+a+","+s+" (length="+this.length+")");for(var o=s-a,l=new Array(o),f=0,h=this._head;a-- >0&&h;)h=h.next;for(;f<o&&h;)l[f++]=h.data,h=h.next;return l},drop:function(){n.call(this)},forEach:function(a,s){for(var o=this._head,l=0,f=this.length;l<f&&o;)a.call(s||this,o.data,l,this),o=o.next,l++},map:function(a,s){var o=new n;return this.forEach(function(l,f,h){o.push(a.call(s||h,l,f,h))}),o},filter:function(a,s){var o=new n;return this.forEach(function(l,f,h){a.call(s||h,l,f,h)&&o.push(l)}),o},reduce:function(a,s,o){var l=0,f=this._head,h=this.length;for(s||(l=1,s=f&&f.data,f=f&&f.next);l<h&&f;)s=a.call(o||this,s,f.data,this),l++,f=f.next;return s}},e.exports=n})()})(fastList);const LinkedList=fastList.exports;function floodFill(e={}){const{x:r=0,y:t=0,inPlace:n=!0}=e,a=n?this:Image$1.createFrom(this);if(this.checkProcessable("floodFill",{bitDepth:1}),this.getBitXY(r,t))return a;const o=new LinkedList;for(o.push(new Node(r,t));o.length>0;){const l=o.shift();a.setBitXY(l.x,l.y);for(let f=l.x+1;f<this.width&&(!a.getBitXY(f,l.y)&&!this.getBitXY(f,l.y));f++)a.setBitXY(f,l.y),l.y+1<this.height&&!this.getBitXY(f,l.y+1)&&o.push(new Node(f,l.y+1)),l.y-1>=0&&!this.getBitXY(f,l.y-1)&&o.push(new Node(f,l.y-1));for(let f=l.x-1;f>=0&&(!a.getBitXY(f,l.y)&&!this.getBitXY(f,l.y));f++)a.setBitXY(f,l.y),l.y+1<this.height&&!this.getBitXY(f,l.y+1)&&o.push(new Node(f,l.y+1)),l.y-1>=0&&!this.getBitXY(f,l.y-1)&&o.push(new Node(f,l.y-1))}return a}function Node(e,r){this.x=e,this.y=r}function _extends(){return _extends=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},_extends.apply(this,arguments)}function hsv2rgb(e,r,t){r=r/100,t=t/100;var n=[],a=t*r,s=e/60,o=a*(1-Math.abs(s%2-1)),l=t-a;return s>=0&&s<1?n=[a,o,0]:s>=1&&s<2?n=[o,a,0]:s>=2&&s<3?n=[0,a,o]:e>=3&&s<4?n=[0,o,a]:e>=4&&s<5?n=[o,0,a]:e>=5&&s<=6?n=[a,0,o]:n=[0,0,0],{r:Math.round(255*(n[0]+l)),g:Math.round(255*(n[1]+l)),b:Math.round(255*(n[2]+l))}}function hsl2hsv(e,r,t){return r*=(t<50?t:100-t)/100,{h:e,s:2*r/(t+r)*100,v:t+r}}function hsl2rgb$1(e,r,t){var n=hsl2hsv(e,r,t);return hsv2rgb(n.h,n.s,n.v)}var colors={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]};function parse(e){return named(e)||hex3(e)||hex6(e)||rgb(e)||rgba$1(e)||hsl(e)||hsla(e)}function named(e){var r=colors[e.toLowerCase()];if(!!r)return{r:r[0],g:r[1],b:r[2],a:100}}function rgb(e){var r=e.match(/rgb\(([^)]+)\)/);if(r){var t=r[1].split(/ *, */).map(Number);return{r:t[0],g:t[1],b:t[2],a:100}}}function rgba$1(e){var r=e.match(/rgba\(([^)]+)\)/);if(r){var t=r[1].split(/ *, */).map(Number);return{r:t[0],g:t[1],b:t[2],a:t[3]*100}}}function hex6(e){if(e[0]==="#"&&e.length===7)return{r:parseInt(e.slice(1,3),16),g:parseInt(e.slice(3,5),16),b:parseInt(e.slice(5,7),16),a:100}}function hex3(e){if(e[0]==="#"&&e.length===4)return{r:parseInt(e[1]+e[1],16),g:parseInt(e[2]+e[2],16),b:parseInt(e[3]+e[3],16),a:100}}function hsl(e){var r=e.match(/hsl\(([^)]+)\)/);if(r){var t=r[1].split(/ *, */),n=parseInt(t[0],10),a=parseInt(t[1],10),s=parseInt(t[2],10),o=hsl2rgb$1(n,a,s);return _extends({},o,{a:100})}}function hsla(e){var r=e.match(/hsla\(([^)]+)\)/);if(r){var t=r[1].split(/ *, */),n=parseInt(t[0],10),a=parseInt(t[1],10),s=parseInt(t[2],10),o=parseInt(parseFloat(t[3])*100,10),l=hsl2rgb$1(n,a,s);return _extends({},l,{a:o})}}function css2array(e){let r=parse(e);return[r.r,r.g,r.b,Math.round(r.a*255/100)]}function hue2rgb(e,r,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?e+(r-e)*6*t:t<1/2?r:t<2/3?e+(r-e)*(2/3-t)*6:e}function hsl2rgb(e,r,t){let n,a,s,o,l,f;return r/=100,t/=100,r===0?o=l=f=t*255:(t<=.5?a=t*(r+1):a=t+r-t*r,n=t*2-a,s=e/360,o=hue2rgb(n,a,s+1/3),l=hue2rgb(n,a,s),f=hue2rgb(n,a,s-1/3)),{r:o,g:l,b:f}}function getDistinctColors(e){let r=new Array(e),t=0;for(let n=0;n<360;n+=360/e){t++;let a=hsl2rgb(n,100,30+t%4*15);r[t-1]=[Math.round(a.r*255),Math.round(a.g*255),Math.round(a.b*255)]}return r}function getRandomColor(){return[Math.floor(Math.random()*256),Math.floor(Math.random()*256),Math.floor(Math.random()*256)]}function getColors(e){let{color:r,colors:t,randomColors:n,numberColors:a=50}=e;if(r&&!Array.isArray(r)&&(r=css2array(r)),r)return[r];if(t)return t=t.map(function(s){return Array.isArray(s)?s:css2array(s)}),t;if(n){t=new Array(a);for(let s=0;s<a;s++)t[s]=getRandomColor()}return getDistinctColors(a)}function paintLabels(e,r,t={}){let{color:n="blue",colors:a,font:s="12px Helvetica",rotate:o=0}=t;if(this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:RGB$1}),!Array.isArray(e))throw Error("paintLabels: labels must be an array");if(!Array.isArray(r))throw Error("paintLabels: positions must be an array");if(n&&!Array.isArray(n)&&(n=css2array(n)),a?a=a.map(function(h){return Array.isArray(h)?h:css2array(h)}):a=[n],e.length!==r.length)throw Error("paintLabels: positions and labels must be arrays from the same size");Array.isArray(s)||(s=[s]),Array.isArray(o)||(o=[o]);let f=this.getCanvas().getContext("2d");for(let h=0;h<e.length;h++){f.save();let c=a[h%a.length];f.fillStyle=`rgba(${c[0]},${c[1]},${c[2]},${c[3]/this.maxValue})`,f.font=s[h%s.length];let u=r[h];f.translate(u[0],u[1]),f.rotate(o[h%o.length]/180*Math.PI),f.fillText(e[h],0,0),f.restore()}return this.data=Uint8Array.from(f.getImageData(0,0,this.width,this.height).data),this}function paintMasks(e,r={}){let{alpha:t=255,labels:n=[],labelsPosition:a=[],labelColor:s="blue",labelFont:o="12px Helvetica"}=r;this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:RGB$1});let l=getColors(Object.assign({},r,{numberColors:e.length}));Array.isArray(e)||(e=[e]);for(let f=0;f<e.length;f++){let h=e[f],c=l[f%l.length];for(let u=0;u<h.width;u++)for(let d=0;d<h.height;d++)if(h.getBitXY(u,d))for(let g=0;g<Math.min(this.components,c.length);g++)if(t===255)this.setValueXY(u+h.position[0],d+h.position[1],g,c[g]);else{let m=this.getValueXY(u+h.position[0],d+h.position[1],g);m=Math.round((m*(255-t)+c[g]*t)/255),this.setValueXY(u+h.position[0],d+h.position[1],g,m)}}if(Array.isArray(n)&&n.length>0){let h=this.getCanvas().getContext("2d");h.fillStyle=s,h.font=o;for(let c=0;c<Math.min(e.length,n.length);c++){let u=a[c]?a[c]:e[c].position;h.fillText(n[c],u[0],u[1])}this.data=Uint8Array.from(h.getImageData(0,0,this.width,this.height).data)}return this}function zerosMatrix(e,r){let t=new Array(e);for(let n=0;n<e;n++)t[n]=new Array(r).fill(0);return t}const cross=[[0,0,1,0,0],[0,0,1,0,0],[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0]],smallCross=[[0,1,0],[1,1,1],[0,1,0]];class Shape{constructor(r={}){let{kind:t="cross",shape:n,size:a,width:s,height:o,filled:l=!0}=r;if(a&&(s=a,o=a),n)switch(n.toLowerCase()){case"square":case"rectangle":this.matrix=rectangle(s,o,{filled:l});break;case"circle":case"ellipse":this.matrix=ellipse(s,o,{filled:l});break;case"triangle":this.matrix=triangle(s,o,{filled:l});break;default:throw new Error(`Shape: unexpected shape: ${n}`)}else if(t)switch(t.toLowerCase()){case"cross":this.matrix=cross;break;case"smallcross":this.matrix=smallCross;break;default:throw new Error(`Shape: unexpected kind: ${t}`)}else throw new Error("Shape: expected a kind or a shape option");this.height=this.matrix.length,this.width=this.matrix[0].length,this.halfHeight=this.height/2>>0,this.halfWidth=this.width/2>>0}getPoints(){let r=this.matrix,t=[];for(let n=0;n<r.length;n++)for(let a=0;a<r[0].length;a++)r[n][a]&&t.push([a-this.halfWidth,n-this.halfHeight]);return t}getMask(){let r=new Image$1(this.width,this.height,{kind:BINARY});for(let t=0;t<this.matrix.length;t++)for(let n=0;n<this.matrix[0].length;n++)this.matrix[t][n]&&r.setBitXY(n,t);return r}}function rectangle(e,r,t){const n=zerosMatrix(r,e);if(t.filled)for(let a=0;a<r;a++)for(let s=0;s<e;s++)n[a][s]=1;else{for(let a of[0,r-1])for(let s=0;s<e;s++)n[a][s]=1;for(let a=0;a<r;a++)for(let s of[0,e-1])n[a][s]=1}return n}function ellipse(e,r,t){const n=zerosMatrix(r,e);let a=1-r%2,s=1-e%2,o=Math.floor((e-1)/2),l=Math.floor((r-1)/2),f=o*o,h=l*l;if(t.filled)for(let c=0;c<=l;c++){let u=Math.floor(Math.sqrt(f-f*c*c/h));for(let d=o-u;d<=o;d++)n[l-c][d]=1,n[l+c+a][d]=1,n[l-c][e-d-1]=1,n[l+c+a][e-d-1]=1}else{for(let c=0;c<=l;c++){let u=Math.floor(Math.sqrt(f-f*c*c/h)),d=o-u;n[l-c][d]=1,n[l+c+a][d]=1,n[l-c][e-d-1]=1,n[l+c+a][e-d-1]=1}for(let c=0;c<=o;c++){let u=Math.floor(Math.sqrt(h-h*c*c/f)),d=l-u;n[d][o-c]=1,n[d][o+c+s]=1,n[r-d-1][o-c]=1,n[r-d-1][o+c+s]=1}}return n}function triangle(e,r,t){if(!t.filled)throw new Error("Non filled triangle is not implemented");const n=zerosMatrix(r,e);for(let a=0;a<r;a++){let s=Math.floor((1-a/r)*e/2);for(let o=s;o<e-s;o++)n[a][o]=1}return n}function paintPoints(e,r={}){let{shape:t}=r;this.checkProcessable("paintPoints",{bitDepth:[8,16]});let n=getColors(Object.assign({},r,{numberColors:e.length})),a=new Shape(t).getPoints(),s=Math.min(this.channels,n[0].length);for(let o=0;o<e.length;o++){let l=n[o%n.length],f=e[o][0],h=e[o][1];for(let c=0;c<a.length;c++){let u=a[c][0],d=a[c][1];if(f+u>=0&&h+d>=0&&f+u<this.width&&h+d<this.height){let g=(f+u+(h+d)*this.width)*this.channels;for(let m=0;m<s;m++)this.data[g+m]=l[m]}}}return this}function paintPolyline(e,r={}){let{color:t=[this.maxValue,0,0],closed:n=!1}=r;this.checkProcessable("paintPoints",{bitDepth:[1,8,16]});let a=Math.min(this.channels,t.length);for(let s=0;s<e.length-1+n;s++){let o=e[s],l=e[(s+1)%e.length],f=l[0]-o[0],h=l[1]-o[1],c=Math.max(Math.abs(f),Math.abs(h)),u=f/c,d=h/c,g=o[0],m=o[1];for(let w=0;w<=c;w++){let v=Math.round(g),x=Math.round(m);if(v>=0&&x>=0&&v<this.width&&x<this.height)if(this.bitDepth===1)this.setBitXY(v,x);else{let S=(v+x*this.width)*this.channels;for(let y=0;y<a;y++)this.data[S+y]=t[y]}g=g+u,m=m+d}}return this}function paintPolylines(e,r={}){let t=Object.assign({},r);this.checkProcessable("paintPolylines",{bitDepth:[8,16]});let n=getColors(Object.assign({},r,{numberColors:e.length}));for(let a=0;a<e.length;a++)t.color=n[a%n.length],this.paintPolyline(e[a],t);return this}function paintPolygon(e,r={}){let{color:t=[this.maxValue,0,0],filled:n=!1}=r;this.checkProcessable("paintPoints",{bitDepth:[1,8,16]}),r.closed=!0;let a=deleteDouble(e);if(n===!1)return this.paintPolyline(e,r);{let s=Array(this.height);for(let o=0;o<this.height;o++){s[o]=[];for(let l=0;l<this.width;l++)s[o].push(0)}for(let o=0;o<a.length;o++){const l=lineBetweenTwoPoints(a[o],a[(o+1)%a.length]);for(let f=0;f<this.height;f++)for(let h=0;h<this.width;h++)isAtTheRightOfTheLine(h,f,l,this.height)&&(s[f][h]=s[f][h]===0?1:0)}for(let o=0;o<this.height;o++)for(let l=0;l<this.width;l++)if(s[o][l]===1)if(this.bitDepth===1)this.setBitXY(l,o);else{let f=Math.min(this.channels,t.length),h=(l+o*this.width)*this.channels;for(let c=0;c<f;c++)this.data[h+c]=t[c]}return this.paintPolyline(e,r)}}function deleteDouble(e){let r=[];for(let t=0;t<e.length;t++)if(!(e[t][0]===e[(t+1)%e.length][0]&&e[t][1]===e[(t+1)%e.length][1])){if(e[t][0]===e[(t-1+e.length)%e.length][0]&&e[t][1]===e[(t-1+e.length)%e.length][1])continue;if(e[(t+1)%e.length][0]===e[(t-1+e.length)%e.length][0]&&e[(t-1+e.length)%e.length][1]===e[(t+1)%e.length][1])continue;r.push(e[t])}return r}function lineBetweenTwoPoints(e,r){if(e[0]===r[0])return{a:0,b:e[0],vertical:!0};{const t=(r[1]-e[1])/(r[0]-e[0]),n=e[1]-t*e[0];return{a:t,b:n,vertical:!1}}}function isAtTheRightOfTheLine(e,r,t,n){if(t.vertical===!0)return t.b<=e;if(t.a===0)return!1;{const a=(r-t.b)/t.a;return a<e&&a>=0&&a<=n}}function paintPolygons(e,r={}){let t=Object.assign({},r);this.checkProcessable("paintPolygons",{bitDepth:[8,16]});let n=getColors(Object.assign({},r,{numberColors:e.length}));for(let a=0;a<e.length;a++)t.color=n[a%n.length],this.paintPolygon(e[a],t);return this}function getHistogram(e={}){let{maxSlots:r=256,channel:t,useAlpha:n=!0}=e;if(this.checkProcessable("getHistogram",{bitDepth:[1,8,16]}),t===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");t=0}return getChannelHistogram.call(this,t,{useAlpha:n,maxSlots:r})}function getHistograms(e={}){const{maxSlots:r=256,useAlpha:t=!0}=e;this.checkProcessable("getHistograms",{bitDepth:[8,16]});let n=new Array(t?this.components:this.channels);for(let a=0;a<n.length;a++)n[a]=getChannelHistogram.call(this,a,{useAlpha:t,maxSlots:r});return n}function getChannelHistogram(e,r){let{useAlpha:t,maxSlots:n}=r;if(this.bitDepth===1){let f=[0,0];for(let h=0;h<this.height;h++)for(let c=0;c<this.width;c++){let u=this.getBitXY(h,c);u===0?f[0]+=1:u===1&&(f[1]+=1)}return f}let a=Math.log2(n);if(!isInteger(a))throw new RangeError("maxSlots must be a power of 2, for example: 64, 256, 1024");let s=0;this.bitDepth>a&&(s=this.bitDepth-a);let o=this.data,l=newArray_1(Math.pow(2,Math.min(this.bitDepth,a)),0);if(t&&this.alpha){let f=this.channels-e-1;for(let h=e;h<o.length;h+=this.channels)l[o[h]>>s]+=o[h+f]/this.maxValue}else for(let f=e;f<o.length;f+=this.channels)l[o[f]>>s]++;return l}function getColorHistogram(e={}){let{useAlpha:r=!0,nbSlots:t=512}=e;this.checkProcessable("getColorHistogram",{bitDepth:[8,16],components:[3]});let n=Math.log(t)/Math.log(8);if(n!==Math.floor(n))throw new RangeError("nbSlots must be a power of 8. Usually 8, 64, 512 or 4096");let a=this.bitDepth-n,s=this.data,o=newArray_1(Math.pow(8,n),0),l=Math.pow(2,n*2),f=Math.pow(2,n);for(let h=0;h<s.length;h+=this.channels){let c=(s[h]>>a)*l+(s[h+1]>>a)*f+(s[h+2]>>a);r&&this.alpha?o[c]+=s[h+this.channels-1]/this.maxValue:o[c]++}return o}function min(){this.checkProcessable("min",{bitDepth:[8,16,32]});let e=newArray_1(this.channels,1/0);for(let r=0;r<this.data.length;r+=this.channels)for(let t=0;t<this.channels;t++)this.data[r+t]<e[t]&&(e[t]=this.data[r+t]);return e}function max(){this.checkProcessable("max",{bitDepth:[8,16,32]});let e=newArray_1(this.channels,-1/0);for(let r=0;r<this.data.length;r+=this.channels)for(let t=0;t<this.channels;t++)this.data[r+t]>e[t]&&(e[t]=this.data[r+t]);return e}function sum(){this.checkProcessable("sum",{bitDepth:[8,16]});let e=newArray_1(this.channels,0);for(let r=0;r<this.data.length;r+=this.channels)for(let t=0;t<this.channels;t++)e[t]+=this.data[r+t];return e}function getMoment(e=0,r=0){this.checkProcessable("getMoment",{bitDepth:[1]});let t=0;for(let n=0;n<this.width;n++)for(let a=0;a<this.height;a++)this.getBitXY(n,a)===1&&(t+=n**e*a**r);return t}function localMaxima(e={}){let{mask:r,region:t=3,removeClosePoints:n=0,invert:a=!1,maxEquals:s=2}=e,o=this;this.checkProcessable("localMaxima",{bitDepth:[8,16],components:1}),t*=4;let l=a?0:1,f=[1,0,-1,0,1,1,-1,-1,2,0,-2,0,2,2,-2,-2],h=[0,1,0,-1,1,-1,1,-1,0,2,0,-2,2,-2,2,-2],c=t<=8?1:2,u=[];for(let d=c;d<o.height-c;d++)for(let g=c;g<o.width-c;g++){if(r&&r.getBitXY(g,d)!==l)continue;let m=0,w=0,v=o.data[g+d*o.width];for(let x=0;x<t;x++)a?o.data[g+f[x]+(d+h[x])*o.width]>v&&m++:o.data[g+f[x]+(d+h[x])*o.width]<v&&m++,o.data[g+f[x]+(d+h[x])*o.width]===v&&w++;m+w===t&&w<=s&&u.push([g,d])}if(n>0)for(let d=0;d<u.length;d++)for(let g=d+1;g<u.length;g++)Math.sqrt(Math.pow(u[d][0]-u[g][0],2)+Math.pow(u[d][1]-u[g][1],2))<n&&(u[d][0]=u[d][0]+u[g][0]>>1,u[d][1]=u[d][1]+u[g][1]>>1,u.splice(g,1),g--);return u}function mean(){let e=this.getHistograms({maxSlots:this.maxValue+1}),r=new Array(e.length);for(let t=0;t<e.length;t++){let n=e[t];r[t]=mean$2(n)}return r}function median(){let e=this.getHistograms({maxSlots:this.maxValue+1}),r=new Array(e.length);for(let t=0;t<e.length;t++){let n=e[t];r[t]=median$2(n)}return r}function points(){this.checkProcessable("points",{bitDepth:[1]});const e=[];for(let r=0;r<this.width;r++)for(let t=0;t<this.height;t++)this.getBitXY(r,t)===1&&e.push([r,t]);return e}function extendedPoints(){this.checkProcessable("extendedPoints",{bitDepth:[1]});const e=[];for(let r=0;r<this.height;r++)for(let t=0;t<this.width;t++)if(this.getBitXY(t,r)===1)for(e.push([t,r]),this.getBitXY(t+1,r)!==1?(e.push([t+1,r]),e.push([t+1,r+1]),this.getBitXY(t,r+1)!==1&&e.push([t,r+1])):this.getBitXY(t,r+1)!==1&&(e.push([t,r+1]),e.push([t+1,r+1]));t<this.width-2&&this.getBitXY(t+1,r)===1&&this.getBitXY(t+2,r)===1;)t++;return e}function getRelativePosition(e,r={}){if(this===e)return[0,0];let t=[0,0],n=this;for(;n;){if(n===e)return t;n.position&&(t[0]+=n.position[0],t[1]+=n.position[1]),n=n.parent}return r.defaultFurther?t:!1}function countAlphaPixels(e={}){let{alpha:r=1}=e;this.checkProcessable("countAlphaPixels",{bitDepth:[8,16],alpha:1});let t=0;if(r!==void 0){for(let n=this.components;n<this.data.length;n+=this.channels)this.data[n]===r&&t++;return t}else return this.size}function monotoneChainConvexHull$1(e,r={}){const{sorted:t}=r;t||(e=e.slice().sort(byXThenY));const n=e.length,a=new Array(n*2);let s=0;for(let l=0;l<n;l++){const f=e[l];for(;s>=2&&cw(a[s-2],a[s-1],f)<=0;)s--;a[s++]=f}const o=s+1;for(let l=n-2;l>=0;l--){const f=e[l];for(;s>=o&&cw(a[s-2],a[s-1],f)<=0;)s--;a[s++]=f}return a.slice(0,s-1)}function cw(e,r,t){return(r[1]-e[1])*(t[0]-e[0])-(r[0]-e[0])*(t[1]-e[1])}function byXThenY(e,r){return e[0]===r[0]?e[1]-r[1]:e[0]-r[0]}function monotoneChainConvexHull(){return monotoneChainConvexHull$1(this.extendedPoints,{sorted:!1})}function round(e){for(let r=0;r<e.length;r++)e[r][0]=Math.round(e[r][0]),e[r][1]=Math.round(e[r][1]);return e}function difference(e,r){return[e[0]-r[0],e[1]-r[1]]}function normalize(e){let r=Math.sqrt(e[0]**2+e[1]**2);return[e[0]/r,e[1]/r]}function rotate(e,r,t){t===void 0&&(t=new Array(r.length));let n=Math.cos(e),a=Math.sin(e);for(let s=0;s<t.length;++s)t[s]=[n*r[s][0]-a*r[s][1],a*r[s][0]+n*r[s][1]];return t}function perimeter(e){let r=0;for(let t=0;t<e.length;t++){let n=e[t][0],a=e[t][1],s=e[t===e.length-1?0:t+1][0],o=e[t===e.length-1?0:t+1][1];r+=Math.sqrt((s-n)**2+(o-a)**2)}return r}function surface(e){let r=0;for(let t=0;t<e.length;t++){let n=e[t][0],a=e[t===e.length-1?0:t+1][1],s=e[t===e.length-1?0:t+1][0],o=e[t][1];r+=n*a*.5,r-=s*o*.5}return Math.abs(r)}function minMax(e){let r=1/0,t=1/0,n=-1/0,a=-1/0;for(let s=0;s<e.length;s++)e[s][0]<r&&(r=e[s][0]),e[s][0]>n&&(n=e[s][0]),e[s][1]<t&&(t=e[s][1]),e[s][1]>a&&(a=e[s][1]);return[[r,t],[n,a]]}function moveToZeroZero(e,r){r===void 0&&(r=new Array(e.length).fill(0).map(()=>[]));let t=minMax(e),n=t[0][0],a=t[0][1];for(let s=0;s<e.length;s++)r[s][0]=e[s][0]-n,r[s][1]=e[s][1]-a;return r}function minimalBoundingRectangle(e={}){const{originalPoints:r=monotoneChainConvexHull.call(this)}=e;if(r.length===0)return[];if(r.length===1)return[r[0],r[0],r[0],r[0]];const t=new Array(r.length);let n=1/0,a=0,s;for(let o=0;o<t.length;o++){let l=getAngle$1(r[o],r[(o+1)%t.length]);rotate(-l,r,t);let f=t[o][0],h=t[o][1],c=t[(o+1)%t.length][0],u=t[(o+1)%t.length][1],d=!0,g=0,m=0,w=0;for(let y=0;y<t.length;y++){let _=t[y][0],E=t[y][1],R=(_-f)/(c-f);d===!0?(d=!1,g=R,m=R):(R<g&&(g=R),R>m&&(m=R));let T=(-(c-f)*E+c*h-u*f)/(c-f);Math.abs(T)>Math.abs(w)&&(w=T)}let v=[f+g*(c-f),h],x=[f+m*(c-f),h],S=Math.abs(w*(g-m)*(c-f));S<n&&(a=l,n=S,s=[v,x,[x[0],x[1]-w],[v[0],v[1]-w]])}return rotate(a,s,s),s}function getAngle$1(e,r){let t=difference(r,e),n=normalize(t),a=Math.acos(n[0]);return n[1]<0?-a:a}function extend$1(e){let r={inPlace:!0};e.extendMethod("invert",invert),e.extendMethod("abs",abs),e.extendMethod("level",level,r),e.extendMethod("add",add,r),e.extendMethod("subtract",subtract,r),e.extendMethod("subtractImage",subtractImage),e.extendMethod("multiply",multiply,r),e.extendMethod("divide",divide,r),e.extendMethod("hypotenuse",hypotenuse),e.extendMethod("background",background$1),e.extendMethod("flipX",flipX),e.extendMethod("flipY",flipY),e.extendMethod("blurFilter",blurFilter),e.extendMethod("medianFilter",medianFilter),e.extendMethod("gaussianFilter",gaussianFilter),e.extendMethod("sobelFilter",sobelFilter),e.extendMethod("gradientFilter",gradientFilter),e.extendMethod("scharrFilter",scharrFilter),e.extendMethod("dilate",dilate),e.extendMethod("erode",erode),e.extendMethod("open",open),e.extendMethod("close",close),e.extendMethod("topHat",topHat),e.extendMethod("blackHat",blackHat),e.extendMethod("morphologicalGradient",morphologicalGradient),e.extendMethod("warpingFourPoints",warpingFourPoints),e.extendMethod("crop",crop),e.extendMethod("cropAlpha",cropAlpha),e.extendMethod("resize",resize).extendMethod("scale",resize),e.extendMethod("hsv",hsv),e.extendMethod("hsl",hsl$1),e.extendMethod("cmyk",cmyk),e.extendMethod("rgba8",rgba8),e.extendMethod("grey",grey).extendMethod("gray",grey),e.extendMethod("mask",mask),e.extendMethod("pad",pad),e.extendMethod("colorDepth",colorDepth),e.extendMethod("setBorder",setBorder,r),e.extendMethod("rotate",rotate$1),e.extendMethod("rotateLeft",rotateLeft),e.extendMethod("rotateRight",rotateRight),e.extendMethod("insert",insert),e.extendMethod("getRow",getRow),e.extendMethod("getColumn",getColumn),e.extendMethod("getMatrix",getMatrix),e.extendMethod("setMatrix",setMatrix),e.extendMethod("getPixelsArray",getPixelsArray),e.extendMethod("getIntersection",getIntersection),e.extendMethod("getClosestCommonParent",getClosestCommonParent),e.extendMethod("getThreshold",getThreshold),e.extendMethod("split",split),e.extendMethod("getChannel",getChannel),e.extendMethod("combineChannels",combineChannels),e.extendMethod("setChannel",setChannel),e.extendMethod("getSimilarity",getSimilarity),e.extendMethod("getPixelsGrid",getPixelsGrid),e.extendMethod("getBestMatch",getBestMatch),e.extendMethod("cannyEdge",cannyEdge),e.extendMethod("convolution",convolution),e.extendMethod("extract",extract),e.extendMethod("floodFill",floodFill),e.extendMethod("paintLabels",paintLabels,r),e.extendMethod("paintMasks",paintMasks,r),e.extendMethod("paintPoints",paintPoints,r),e.extendMethod("paintPolyline",paintPolyline,r),e.extendMethod("paintPolylines",paintPolylines,r),e.extendMethod("paintPolygon",paintPolygon,r),e.extendMethod("paintPolygons",paintPolygons,r),e.extendMethod("countAlphaPixels",countAlphaPixels),e.extendMethod("monotoneChainConvexHull",monotoneChainConvexHull),e.extendMethod("minimalBoundingRectangle",minimalBoundingRectangle),e.extendMethod("getHistogram",getHistogram).extendProperty("histogram",getHistogram),e.extendMethod("getHistograms",getHistograms).extendProperty("histograms",getHistograms),e.extendMethod("getColorHistogram",getColorHistogram).extendProperty("colorHistogram",getColorHistogram),e.extendMethod("getMin",min).extendProperty("min",min),e.extendMethod("getMax",max).extendProperty("max",max),e.extendMethod("getSum",sum).extendProperty("sum",sum),e.extendMethod("getMoment",getMoment).extendProperty("moment",getMoment),e.extendMethod("getLocalMaxima",localMaxima),e.extendMethod("getMedian",median).extendProperty("median",median),e.extendMethod("getMean",mean).extendProperty("mean",mean),e.extendMethod("getPoints",points).extendProperty("points",points),e.extendMethod("getExtendedPoints",extendedPoints).extendProperty("extendedPoints",extendedPoints),e.extendMethod("getRelativePosition",getRelativePosition)}var quantities={exports:{}};(function(e,r){(function(t,n){e.exports=n()})(commonjsGlobal,function(){function t(A){return typeof A=="string"||A instanceof String}var n=Number.isFinite||window.isFinite;function a(A){return n(A)}function s(A){return A}function o(A){var C={};return A.filter(function(B){return C.hasOwnProperty(B)?!1:C[B]=!0})}function l(A,C){if(C.length!==A.length)return!1;for(var B=0;B<A.length;B++)if(C[B].compareArray&&!C[B].compareArray(A[B])||C[B]!==A[B])return!1;return!0}function f(A,C){Object.keys(C).forEach(function(B){A[B]=C[B]})}function h(){for(var A=1,C=0,B=0;B<arguments.length;B++){var j=arguments[B];C=C+d(j),A*=j}return C!==0?u(A,C):A}function c(A,C){if(C===0)throw new Error("Divide by zero");var B=Math.pow(10,d(C)),j=B/(B*C);return h(A,j)}function u(A,C){return Math.round(A*Math.pow(10,C))/Math.pow(10,C)}function d(A){if(!isFinite(A))return 0;for(var C=0;A%1!==0;)A*=10,C++;return C}function g(){var A;if(!this)return A=Object.create(g.prototype),g.apply(A,arguments),A;A=Error.apply(this,arguments),this.name="QtyError",this.message=A.message,this.stack=A.stack}g.prototype=Object.create(Error.prototype,{constructor:{value:g}});function m(A,C){throw new g("Incompatible units: "+A+" and "+C)}var w={"<googol>":[["googol"],1e100,"prefix"],"<kibi>":[["Ki","Kibi","kibi"],Math.pow(2,10),"prefix"],"<mebi>":[["Mi","Mebi","mebi"],Math.pow(2,20),"prefix"],"<gibi>":[["Gi","Gibi","gibi"],Math.pow(2,30),"prefix"],"<tebi>":[["Ti","Tebi","tebi"],Math.pow(2,40),"prefix"],"<pebi>":[["Pi","Pebi","pebi"],Math.pow(2,50),"prefix"],"<exi>":[["Ei","Exi","exi"],Math.pow(2,60),"prefix"],"<zebi>":[["Zi","Zebi","zebi"],Math.pow(2,70),"prefix"],"<yebi>":[["Yi","Yebi","yebi"],Math.pow(2,80),"prefix"],"<yotta>":[["Y","Yotta","yotta"],1e24,"prefix"],"<zetta>":[["Z","Zetta","zetta"],1e21,"prefix"],"<exa>":[["E","Exa","exa"],1e18,"prefix"],"<peta>":[["P","Peta","peta"],1e15,"prefix"],"<tera>":[["T","Tera","tera"],1e12,"prefix"],"<giga>":[["G","Giga","giga"],1e9,"prefix"],"<mega>":[["M","Mega","mega"],1e6,"prefix"],"<kilo>":[["k","kilo"],1e3,"prefix"],"<hecto>":[["h","Hecto","hecto"],100,"prefix"],"<deca>":[["da","Deca","deca","deka"],10,"prefix"],"<deci>":[["d","Deci","deci"],.1,"prefix"],"<centi>":[["c","Centi","centi"],.01,"prefix"],"<milli>":[["m","Milli","milli"],.001,"prefix"],"<micro>":[["u","\u03BC","\xB5","Micro","mc","micro"],1e-6,"prefix"],"<nano>":[["n","Nano","nano"],1e-9,"prefix"],"<pico>":[["p","Pico","pico"],1e-12,"prefix"],"<femto>":[["f","Femto","femto"],1e-15,"prefix"],"<atto>":[["a","Atto","atto"],1e-18,"prefix"],"<zepto>":[["z","Zepto","zepto"],1e-21,"prefix"],"<yocto>":[["y","Yocto","yocto"],1e-24,"prefix"],"<1>":[["1","<1>"],1,""],"<meter>":[["m","meter","meters","metre","metres"],1,"length",["<meter>"]],"<inch>":[["in","inch","inches",'"'],.0254,"length",["<meter>"]],"<foot>":[["ft","foot","feet","'"],.3048,"length",["<meter>"]],"<yard>":[["yd","yard","yards"],.9144,"length",["<meter>"]],"<mile>":[["mi","mile","miles"],1609.344,"length",["<meter>"]],"<naut-mile>":[["nmi","naut-mile"],1852,"length",["<meter>"]],"<league>":[["league","leagues"],4828,"length",["<meter>"]],"<furlong>":[["furlong","furlongs"],201.2,"length",["<meter>"]],"<rod>":[["rd","rod","rods"],5.029,"length",["<meter>"]],"<mil>":[["mil","mils"],254e-7,"length",["<meter>"]],"<angstrom>":[["ang","angstrom","angstroms"],1e-10,"length",["<meter>"]],"<fathom>":[["fathom","fathoms"],1.829,"length",["<meter>"]],"<pica>":[["pica","picas"],.00423333333,"length",["<meter>"]],"<point>":[["pt","point","points"],.000352777778,"length",["<meter>"]],"<redshift>":[["z","red-shift","redshift"],1302773e20,"length",["<meter>"]],"<AU>":[["AU","astronomical-unit"],1495979e5,"length",["<meter>"]],"<light-second>":[["ls","light-second"],299792500,"length",["<meter>"]],"<light-minute>":[["lmin","light-minute"],1798755e4,"length",["<meter>"]],"<light-year>":[["ly","light-year"],9460528e9,"length",["<meter>"]],"<parsec>":[["pc","parsec","parsecs"],3085678e10,"length",["<meter>"]],"<datamile>":[["DM","datamile"],1828.8,"length",["<meter>"]],"<kilogram>":[["kg","kilogram","kilograms"],1,"mass",["<kilogram>"]],"<AMU>":[["u","AMU","amu"],1660538921e-36,"mass",["<kilogram>"]],"<dalton>":[["Da","Dalton","Daltons","dalton","daltons"],1660538921e-36,"mass",["<kilogram>"]],"<slug>":[["slug","slugs"],14.5939029,"mass",["<kilogram>"]],"<short-ton>":[["tn","ton","short-ton"],907.18474,"mass",["<kilogram>"]],"<metric-ton>":[["tonne","metric-ton"],1e3,"mass",["<kilogram>"]],"<carat>":[["ct","carat","carats"],2e-4,"mass",["<kilogram>"]],"<pound>":[["lbs","lb","pound","pounds","#"],.45359237,"mass",["<kilogram>"]],"<ounce>":[["oz","ounce","ounces"],.0283495231,"mass",["<kilogram>"]],"<gram>":[["g","gram","grams","gramme","grammes"],.001,"mass",["<kilogram>"]],"<grain>":[["grain","grains","gr"],6479891e-11,"mass",["<kilogram>"]],"<dram>":[["dram","drams","dr"],.0017718452,"mass",["<kilogram>"]],"<stone>":[["stone","stones","st"],6.35029318,"mass",["<kilogram>"]],"<hectare>":[["hectare"],1e4,"area",["<meter>","<meter>"]],"<acre>":[["acre","acres"],4046.85642,"area",["<meter>","<meter>"]],"<sqft>":[["sqft"],1,"area",["<foot>","<foot>"]],"<liter>":[["l","L","liter","liters","litre","litres"],.001,"volume",["<meter>","<meter>","<meter>"]],"<gallon>":[["gal","gallon","gallons"],.0037854118,"volume",["<meter>","<meter>","<meter>"]],"<gallon-imp>":[["galimp","gallon-imp","gallons-imp"],.00454609,"volume",["<meter>","<meter>","<meter>"]],"<quart>":[["qt","quart","quarts"],.00094635295,"volume",["<meter>","<meter>","<meter>"]],"<pint>":[["pt","pint","pints"],.000473176475,"volume",["<meter>","<meter>","<meter>"]],"<pint-imp>":[["ptimp","pint-imp","pints-imp"],.00056826125,"volume",["<meter>","<meter>","<meter>"]],"<cup>":[["cu","cup","cups"],.000236588238,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce>":[["floz","fluid-ounce","fluid-ounces"],295735297e-13,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce-imp>":[["flozimp","floz-imp","fluid-ounce-imp","fluid-ounces-imp"],284130625e-13,"volume",["<meter>","<meter>","<meter>"]],"<tablespoon>":[["tb","tbsp","tbs","tablespoon","tablespoons"],147867648e-13,"volume",["<meter>","<meter>","<meter>"]],"<teaspoon>":[["tsp","teaspoon","teaspoons"],492892161e-14,"volume",["<meter>","<meter>","<meter>"]],"<bushel>":[["bu","bsh","bushel","bushels"],.035239072,"volume",["<meter>","<meter>","<meter>"]],"<oilbarrel>":[["bbl","oilbarrel","oilbarrels","oil-barrel","oil-barrels"],.158987294928,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel>":[["bl","bl-us","beerbarrel","beerbarrels","beer-barrel","beer-barrels"],.1173477658,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel-imp>":[["blimp","bl-imp","beerbarrel-imp","beerbarrels-imp","beer-barrel-imp","beer-barrels-imp"],.16365924,"volume",["<meter>","<meter>","<meter>"]],"<kph>":[["kph"],.277777778,"speed",["<meter>"],["<second>"]],"<mph>":[["mph"],.44704,"speed",["<meter>"],["<second>"]],"<knot>":[["kt","kn","kts","knot","knots"],.514444444,"speed",["<meter>"],["<second>"]],"<fps>":[["fps"],.3048,"speed",["<meter>"],["<second>"]],"<gee>":[["gee"],9.80665,"acceleration",["<meter>"],["<second>","<second>"]],"<Gal>":[["Gal"],.01,"acceleration",["<meter>"],["<second>","<second>"]],"<kelvin>":[["degK","kelvin"],1,"temperature",["<kelvin>"]],"<celsius>":[["degC","celsius","celsius","centigrade"],1,"temperature",["<kelvin>"]],"<fahrenheit>":[["degF","fahrenheit"],5/9,"temperature",["<kelvin>"]],"<rankine>":[["degR","rankine"],5/9,"temperature",["<kelvin>"]],"<temp-K>":[["tempK","temp-K"],1,"temperature",["<temp-K>"]],"<temp-C>":[["tempC","temp-C"],1,"temperature",["<temp-K>"]],"<temp-F>":[["tempF","temp-F"],5/9,"temperature",["<temp-K>"]],"<temp-R>":[["tempR","temp-R"],5/9,"temperature",["<temp-K>"]],"<second>":[["s","sec","secs","second","seconds"],1,"time",["<second>"]],"<minute>":[["min","mins","minute","minutes"],60,"time",["<second>"]],"<hour>":[["h","hr","hrs","hour","hours"],3600,"time",["<second>"]],"<day>":[["d","day","days"],3600*24,"time",["<second>"]],"<week>":[["wk","week","weeks"],7*3600*24,"time",["<second>"]],"<fortnight>":[["fortnight","fortnights"],1209600,"time",["<second>"]],"<year>":[["y","yr","year","years","annum"],31556926,"time",["<second>"]],"<decade>":[["decade","decades"],315569260,"time",["<second>"]],"<century>":[["century","centuries"],3155692600,"time",["<second>"]],"<pascal>":[["Pa","pascal","Pascal"],1,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<bar>":[["bar","bars"],1e5,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<mmHg>":[["mmHg"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inHg>":[["inHg"],3386.3881472,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<torr>":[["torr"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<atm>":[["atm","ATM","atmosphere","atmospheres"],101325,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<psi>":[["psi"],6894.76,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<cmh2o>":[["cmH2O","cmh2o"],98.0638,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inh2o>":[["inH2O","inh2o"],249.082052,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<poise>":[["P","poise"],.1,"viscosity",["<kilogram>"],["<meter>","<second>"]],"<stokes>":[["St","stokes"],1e-4,"viscosity",["<meter>","<meter>"],["<second>"]],"<mole>":[["mol","mole"],1,"substance",["<mole>"]],"<molar>":[["M","molar"],1e3,"concentration",["<mole>"],["<meter>","<meter>","<meter>"]],"<wtpercent>":[["wt%","wtpercent"],10,"concentration",["<kilogram>"],["<meter>","<meter>","<meter>"]],"<katal>":[["kat","katal","Katal"],1,"activity",["<mole>"],["<second>"]],"<unit>":[["U","enzUnit","unit"],16667e-19,"activity",["<mole>"],["<second>"]],"<farad>":[["F","farad","Farad"],1,"capacitance",["<second>","<second>","<second>","<second>","<ampere>","<ampere>"],["<meter>","<meter>","<kilogram>"]],"<coulomb>":[["C","coulomb","Coulomb"],1,"charge",["<ampere>","<second>"]],"<Ah>":[["Ah"],3600,"charge",["<ampere>","<second>"]],"<ampere>":[["A","Ampere","ampere","amp","amps"],1,"current",["<ampere>"]],"<siemens>":[["S","Siemens","siemens"],1,"conductance",["<second>","<second>","<second>","<ampere>","<ampere>"],["<kilogram>","<meter>","<meter>"]],"<henry>":[["H","Henry","henry"],1,"inductance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>","<ampere>"]],"<volt>":[["V","Volt","volt","volts"],1,"potential",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>"]],"<ohm>":[["Ohm","ohm","\u03A9","\u2126"],1,"resistance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>","<ampere>"]],"<weber>":[["Wb","weber","webers"],1,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<tesla>":[["T","tesla","teslas"],1,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<gauss>":[["G","gauss"],1e-4,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<maxwell>":[["Mx","maxwell","maxwells"],1e-8,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<oersted>":[["Oe","oersted","oersteds"],250/Math.PI,"magnetism",["<ampere>"],["<meter>"]],"<joule>":[["J","joule","Joule","joules"],1,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<erg>":[["erg","ergs"],1e-7,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<btu>":[["BTU","btu","BTUs"],1055.056,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<calorie>":[["cal","calorie","calories"],4.184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Calorie>":[["Cal","Calorie","Calories"],4184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<therm-US>":[["th","therm","therms","Therm","therm-US"],105480400,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Wh>":[["Wh"],3600,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<newton>":[["N","Newton","newton"],1,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<dyne>":[["dyn","dyne"],1e-5,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<pound-force>":[["lbf","pound-force"],4.448222,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<hertz>":[["Hz","hertz","Hertz"],1,"frequency",["<1>"],["<second>"]],"<radian>":[["rad","radian","radians"],1,"angle",["<radian>"]],"<degree>":[["deg","degree","degrees"],Math.PI/180,"angle",["<radian>"]],"<gradian>":[["gon","grad","gradian","grads"],Math.PI/200,"angle",["<radian>"]],"<steradian>":[["sr","steradian","steradians"],1,"solid_angle",["<steradian>"]],"<rotation>":[["rotation"],2*Math.PI,"angle",["<radian>"]],"<rpm>":[["rpm"],2*Math.PI/60,"angular_velocity",["<radian>"],["<second>"]],"<byte>":[["B","byte","bytes"],1,"information",["<byte>"]],"<bit>":[["b","bit","bits"],.125,"information",["<byte>"]],"<Bps>":[["Bps"],1,"information_rate",["<byte>"],["<second>"]],"<bps>":[["bps"],.125,"information_rate",["<byte>"],["<second>"]],"<dollar>":[["USD","dollar"],1,"currency",["<dollar>"]],"<cents>":[["cents"],.01,"currency",["<dollar>"]],"<candela>":[["cd","candela"],1,"luminosity",["<candela>"]],"<lumen>":[["lm","lumen"],1,"luminous_power",["<candela>","<steradian>"]],"<lux>":[["lux"],1,"illuminance",["<candela>","<steradian>"],["<meter>","<meter>"]],"<watt>":[["W","watt","watts"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere>":[["VA","volt-ampere"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere-reactive>":[["var","Var","VAr","VAR","volt-ampere-reactive"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<horsepower>":[["hp","horsepower"],745.699872,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<gray>":[["Gy","gray","grays"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<roentgen>":[["R","roentgen"],.00933,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<sievert>":[["Sv","sievert","sieverts"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<becquerel>":[["Bq","becquerel","becquerels"],1,"radiation",["<1>"],["<second>"]],"<curie>":[["Ci","curie","curies"],37e9,"radiation",["<1>"],["<second>"]],"<cpm>":[["cpm"],1/60,"rate",["<count>"],["<second>"]],"<dpm>":[["dpm"],1/60,"rate",["<count>"],["<second>"]],"<bpm>":[["bpm"],1/60,"rate",["<count>"],["<second>"]],"<dot>":[["dot","dots"],1,"resolution",["<each>"]],"<pixel>":[["pixel","px"],1,"resolution",["<each>"]],"<ppi>":[["ppi"],1,"resolution",["<pixel>"],["<inch>"]],"<dpi>":[["dpi"],1,"typography",["<dot>"],["<inch>"]],"<cell>":[["cells","cell"],1,"counting",["<each>"]],"<each>":[["each"],1,"counting",["<each>"]],"<count>":[["count"],1,"counting",["<each>"]],"<base-pair>":[["bp","base-pair"],1,"counting",["<each>"]],"<nucleotide>":[["nt","nucleotide"],1,"counting",["<each>"]],"<molecule>":[["molecule","molecules"],1,"counting",["<1>"]],"<dozen>":[["doz","dz","dozen"],12,"prefix_only",["<each>"]],"<percent>":[["%","percent"],.01,"prefix_only",["<1>"]],"<ppm>":[["ppm"],1e-6,"prefix_only",["<1>"]],"<ppt>":[["ppt"],1e-9,"prefix_only",["<1>"]],"<gross>":[["gr","gross"],144,"prefix_only",["<dozen>","<dozen>"]],"<decibel>":[["dB","decibel","decibels"],1,"logarithmic",["<decibel>"]]},v=["<meter>","<kilogram>","<second>","<mole>","<ampere>","<radian>","<kelvin>","<temp-K>","<byte>","<dollar>","<candela>","<each>","<steradian>","<decibel>"],x="<1>",S=[x];function y(A,C){var B=C[1],j=C[3]||[],J=C[4]||[];if(!a(B))throw new g(A+": Invalid unit definition. 'scalar' must be a number");j.forEach(function(ae){if(w[ae]===void 0)throw new g(A+": Invalid unit definition. Unit "+ae+" in 'numerator' is not recognized")}),J.forEach(function(ae){if(w[ae]===void 0)throw new g(A+": Invalid unit definition. Unit "+ae+" in 'denominator' is not recognized")})}var _={},E={},R={},T={},M={};for(var I in w)if(w.hasOwnProperty(I)){var b=w[I];if(b[2]==="prefix"){_[I]=b[1];for(var k=0;k<b[0].length;k++)E[b[0][k]]=I}else{y(I,b),R[I]={scalar:b[1],numerator:b[3],denominator:b[4]};for(var D=0;D<b[0].length;D++)T[b[0][D]]=I}M[I]=b[0][0]}function $(A){var C,B=[],j=Object.keys(w);if(typeof A>"u")for(C=0;C<j.length;C++)["","prefix"].indexOf(w[j[C]][2])===-1&&B.push(j[C].substr(1,j[C].length-2));else{if(this.getKinds().indexOf(A)===-1)throw new g("Kind not recognized");for(C=0;C<j.length;C++)w[j[C]][2]===A&&B.push(j[C].substr(1,j[C].length-2))}return B.sort(function(J,ae){return J.toLowerCase()<ae.toLowerCase()?-1:J.toLowerCase()>ae.toLowerCase()?1:0})}function P(A){if(!T[A])throw new g("Unit not recognized");return w[T[A]][0]}var O=["length","time","temperature","mass","current","substance","luminosity","currency","information","angle"];function ee(){if(this.signature)return this.signature;for(var A=q.call(this),C=0;C<A.length;C++)A[C]*=Math.pow(20,C);return A.reduce(function(B,j){return B+j},0)}function q(){if(!this.isBase())return q.call(this.toBase());for(var A=new Array(O.length),C=0;C<A.length;C++)A[C]=0;for(var B,j,J=0;J<this.numerator.length;J++)(B=w[this.numerator[J]])&&(j=O.indexOf(B[2]),j>=0&&(A[j]=A[j]+1));for(var ae=0;ae<this.denominator.length;ae++)(B=w[this.denominator[ae]])&&(j=O.indexOf(B[2]),j>=0&&(A[j]=A[j]-1));return A}var z="[+-]",W="\\d+",H=z+"?"+W,se="\\."+W,N="(?:"+W+"(?:"+se+")?)|(?:"+se+")",Y="[Ee]"+H,L="(?:"+N+")(?:"+Y+")?",U=z+"?\\s*"+L,G="("+U+")?\\s*([^/]*)(?:/(.+))?",te=new RegExp("^"+G+"$"),de="\\^|\\*{2}",Z="[01234]",ge=new RegExp("([^ \\*\\d]+?)(?:"+de+")?(-?"+Z+"(?![a-zA-Z]))"),ce=new RegExp("([^ \\*\\d]+?)(?:"+de+")?("+Z+"(?![a-zA-Z]))");function ve(A){t(A)||(A=A.toString()),A=A.trim();var C=te.exec(A);if(!C)throw new g(A+": Quantity not recognized");var B=C[1];B?(B=B.replace(/\s/g,""),this.scalar=parseFloat(B)):this.scalar=1;for(var j=C[2],J=C[3],ae,De,Se;C=ge.exec(j);){if(ae=parseFloat(C[2]),isNaN(ae))throw new g("Unit exponent is not a number");if(ae===0&&!me.test(C[1]))throw new g("Unit not recognized");De=C[1]+" ",Se="";for(var Te=0;Te<Math.abs(ae);Te++)Se+=De;ae>=0?j=j.replace(C[0],Se):(J=J?J+Se:Se,j=j.replace(C[0],""))}for(;C=ce.exec(J);){if(ae=parseFloat(C[2]),isNaN(ae))throw new g("Unit exponent is not a number");if(ae===0&&!me.test(C[1]))throw new g("Unit not recognized");De=C[1]+" ",Se="";for(var Ce=0;Ce<ae;Ce++)Se+=De;J=J.replace(C[0],Se)}j&&(this.numerator=re(j.trim())),J&&(this.denominator=re(J.trim()))}var be=Object.keys(E).sort(function(A,C){return C.length-A.length}).join("|"),K=Object.keys(T).sort(function(A,C){return C.length-A.length}).join("|"),V="\\b|$",pe="("+be+")??("+K+")(?:"+V+")",me=new RegExp("^\\s*("+pe+"[\\s\\*]*)+$"),xe=new RegExp(pe,"g"),F={};function re(A){var C=F[A];if(C)return C;var B,j=[];if(!me.test(A))throw new g("Unit not recognized");for(;B=xe.exec(A);)j.push(B.slice(1));return j=j.map(function(J){return E[J[0]]?[E[J[0]],T[J[1]]]:[T[J[1]]]}),j=j.reduce(function(J,ae){return J.concat(ae)},[]),j=j.filter(function(J){return J}),F[A]=j,j}function fe(A){if(!t(A))throw new g("Argument should be a string");try{return this(A)}catch{return null}}function he(A){return A instanceof X}function X(A,C){if(ke.apply(null,arguments),!he(this))return new X(A,C);if(this.scalar=null,this.baseScalar=null,this.signature=null,this._conversionCache={},this.numerator=S,this.denominator=S,Me(A)?(this.scalar=A.scalar,this.numerator=A.numerator&&A.numerator.length!==0?A.numerator:S,this.denominator=A.denominator&&A.denominator.length!==0?A.denominator:S):C?(ve.call(this,C),this.scalar=A):ve.call(this,A),this.denominator.join("*").indexOf("temp")>=0)throw new g("Cannot divide with temperatures");if(this.numerator.join("*").indexOf("temp")>=0){if(this.numerator.length>1)throw new g("Cannot multiply by temperatures");if(!l(this.denominator,S))throw new g("Cannot divide with temperatures")}if(this.initValue=A,ie.call(this),this.isTemperature()&&this.baseScalar<0)throw new g("Temperatures must not be less than absolute zero")}X.prototype={constructor:X};function ke(A,C){if(C){if(!(a(A)&&t(C)))throw new g("Only number accepted as initialization value when units are explicitly provided")}else if(!(t(A)||a(A)||he(A)||Me(A)))throw new g("Only string, number or quantity accepted as single initialization value")}function Me(A){return A&&typeof A=="object"&&A.hasOwnProperty("scalar")}function ie(){if(this.baseScalar)return this.baseScalar;if(this.isBase())this.baseScalar=this.scalar,this.signature=ee.call(this);else{var A=this.toBase();this.baseScalar=A.scalar,this.signature=A.signature}}var oe={"-312078":"elastance","-312058":"resistance","-312038":"inductance","-152058":"potential","-152040":"magnetism","-152038":"magnetism","-7997":"specific_volume","-79":"snap","-59":"jolt","-39":"acceleration","-38":"radiation","-20":"frequency","-19":"speed","-18":"viscosity","-17":"volumetric_flow","-1":"wavenumber",0:"unitless",1:"length",2:"area",3:"volume",20:"time",400:"temperature",7941:"yank",7942:"power",7959:"pressure",7961:"force",7962:"energy",7979:"viscosity",7981:"momentum",7982:"angular_momentum",7997:"density",7998:"area_density",8e3:"mass",152020:"radiation_exposure",159999:"magnetism",16e4:"current",160020:"charge",312058:"conductance",312078:"capacitance",3199980:"activity",3199997:"molar_concentration",32e5:"substance",63999998:"illuminance",64e6:"luminous_power",128e7:"currency","25599999980":"information_rate","25600000000":"information","511999999980":"angular_velocity","512000000000":"angle"};function ue(){return o(Object.keys(oe).map(function(A){return oe[A]}))}X.prototype.kind=function(){return oe[this.signature.toString()]},f(X.prototype,{isDegrees:function(){return(this.signature===null||this.signature===400)&&this.numerator.length===1&&l(this.denominator,S)&&(this.numerator[0].match(/<temp-[CFRK]>/)||this.numerator[0].match(/<(kelvin|celsius|rankine|fahrenheit)>/))},isTemperature:function(){return this.isDegrees()&&this.numerator[0].match(/<temp-[CFRK]>/)}});function ne(A,C){var B=A.units(),j=C.to(B),J=X(le(B));return X({scalar:A.scalar-j.scalar,numerator:J.numerator,denominator:J.denominator})}function we(A,C){var B=C.to(le(A.units()));return X({scalar:A.scalar-B.scalar,numerator:A.numerator,denominator:A.denominator})}function _e(A,C){var B=C.to(le(A.units()));return X({scalar:A.scalar+B.scalar,numerator:A.numerator,denominator:A.denominator})}function le(A){if(A==="tempK")return"degK";if(A==="tempC")return"degC";if(A==="tempF")return"degF";if(A==="tempR")return"degR";throw new g("Unknown type for temp conversion from: "+A)}function Ee(A,C){var B=Q(A),j=C.units(),J;if(j==="degK")J=B.scalar;else if(j==="degC")J=B.scalar;else if(j==="degF")J=B.scalar*9/5;else if(j==="degR")J=B.scalar*9/5;else throw new g("Unknown type for degree conversion to: "+j);return X({scalar:J,numerator:C.numerator,denominator:C.denominator})}function Q(A){var C=A.units(),B;if(C.match(/(deg)[CFRK]/))B=A.baseScalar;else if(C==="tempK")B=A.scalar;else if(C==="tempC")B=A.scalar;else if(C==="tempF")B=A.scalar*5/9;else if(C==="tempR")B=A.scalar*5/9;else throw new g("Unknown type for temp conversion from: "+C);return X({scalar:B,numerator:["<kelvin>"],denominator:S})}function ye(A,C){var B=C.units(),j;if(B==="tempK")j=A.baseScalar;else if(B==="tempC")j=A.baseScalar-273.15;else if(B==="tempF")j=A.baseScalar*9/5-459.67;else if(B==="tempR")j=A.baseScalar*9/5;else throw new g("Unknown type for temp conversion to: "+B);return X({scalar:j,numerator:C.numerator,denominator:C.denominator})}function Ae(A){var C=A.units(),B;if(C.match(/(deg)[CFRK]/))B=A.baseScalar;else if(C==="tempK")B=A.scalar;else if(C==="tempC")B=A.scalar+273.15;else if(C==="tempF")B=(A.scalar+459.67)*5/9;else if(C==="tempR")B=A.scalar*5/9;else throw new g("Unknown type for temp conversion from: "+C);return X({scalar:B,numerator:["<temp-K>"],denominator:S})}f(X.prototype,{to:function(A){var C,B;if(A==null)return this;if(!t(A))return this.to(A.units());if(C=this._conversionCache[A],C)return C;if(B=X(A),B.units()===this.units())return this;if(!this.isCompatible(B))this.isInverse(B)?B=this.inverse().to(A):m(this.units(),B.units());else if(B.isTemperature())B=ye(this,B);else if(B.isDegrees())B=Ee(this,B);else{var j=c(this.baseScalar,B.baseScalar);B=X({scalar:j,numerator:B.numerator,denominator:B.denominator})}return this._conversionCache[A]=B,B},toBase:function(){if(this.isBase())return this;if(this.isTemperature())return Ae(this);var A=Pe[this.units()];return A||(A=Ge(this.numerator,this.denominator),Pe[this.units()]=A),A.mul(this.scalar)},toFloat:function(){if(this.isUnitless())return this.scalar;throw new g("Can't convert to Float unless unitless.  Use Unit#scalar")},toPrec:function(A){if(t(A)&&(A=X(A)),a(A)&&(A=X(A+" "+this.units())),this.isUnitless()?A.isUnitless()||m(this.units(),A.units()):A=A.to(this.units()),A.scalar===0)throw new g("Divide by zero");var C=h(Math.round(this.scalar/A.scalar),A.scalar);return X(C+this.units())}});function Ie(A,C){var B=X(A),j=X(C);if(B.eq(j))return s;var J;return B.isTemperature()?J=function(ae){return B.mul(ae).to(j).scalar}:J=function(ae){return ae*B.baseScalar/j.baseScalar},function(De){var Se,Te,Ce;if(Array.isArray(De)){for(Te=De.length,Ce=[],Se=0;Se<Te;Se++)Ce.push(J(De[Se]));return Ce}else return J(De)}}var Pe={};function Ge(A,C){for(var B=[],j=[],J=1,ae,De=0;De<A.length;De++)ae=A[De],_[ae]?J=h(J,_[ae]):R[ae]&&(J*=R[ae].scalar,R[ae].numerator&&B.push(R[ae].numerator),R[ae].denominator&&j.push(R[ae].denominator));for(var Se=0;Se<C.length;Se++)ae=C[Se],_[ae]?J/=_[ae]:R[ae]&&(J/=R[ae].scalar,R[ae].numerator&&j.push(R[ae].numerator),R[ae].denominator&&B.push(R[ae].denominator));return B=B.reduce(function(Te,Ce){return Te.concat(Ce)},[]),j=j.reduce(function(Te,Ce){return Te.concat(Ce)},[]),X({scalar:J,numerator:B,denominator:j})}X.parse=fe,X.getUnits=$,X.getAliases=P,X.mulSafe=h,X.divSafe=c,X.getKinds=ue,X.swiftConverter=Ie,X.Error=g,f(X.prototype,{add:function(A){if(t(A)&&(A=X(A)),this.isCompatible(A)||m(this.units(),A.units()),this.isTemperature()&&A.isTemperature())throw new g("Cannot add two temperatures");return this.isTemperature()?_e(this,A):A.isTemperature()?_e(A,this):X({scalar:this.scalar+A.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},sub:function(A){if(t(A)&&(A=X(A)),this.isCompatible(A)||m(this.units(),A.units()),this.isTemperature()&&A.isTemperature())return ne(this,A);if(this.isTemperature())return we(this,A);if(A.isTemperature())throw new g("Cannot subtract a temperature from a differential degree unit");return X({scalar:this.scalar-A.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},mul:function(A){if(a(A))return X({scalar:h(this.scalar,A),numerator:this.numerator,denominator:this.denominator});if(t(A)&&(A=X(A)),(this.isTemperature()||A.isTemperature())&&!(this.isUnitless()||A.isUnitless()))throw new g("Cannot multiply by temperatures");var C=this,B=A;C.isCompatible(B)&&C.signature!==400&&(B=B.to(C));var j=He(C.numerator,C.denominator,B.numerator,B.denominator);return X({scalar:h(C.scalar,B.scalar,j[2]),numerator:j[0],denominator:j[1]})},div:function(A){if(a(A)){if(A===0)throw new g("Divide by zero");return X({scalar:this.scalar/A,numerator:this.numerator,denominator:this.denominator})}else t(A)&&(A=X(A));if(A.scalar===0)throw new g("Divide by zero");if(A.isTemperature())throw new g("Cannot divide with temperatures");if(this.isTemperature()&&!A.isUnitless())throw new g("Cannot divide with temperatures");var C=this,B=A;C.isCompatible(B)&&C.signature!==400&&(B=B.to(C));var j=He(C.numerator,C.denominator,B.denominator,B.numerator);return X({scalar:h(C.scalar,j[2])/B.scalar,numerator:j[0],denominator:j[1]})},inverse:function(){if(this.isTemperature())throw new g("Cannot divide with temperatures");if(this.scalar===0)throw new g("Divide by zero");return X({scalar:1/this.scalar,numerator:this.denominator,denominator:this.numerator})}});function He(A,C,B,j){function J($e){return $e!==x}A=A.filter(J),B=B.filter(J),C=C.filter(J),j=j.filter(J);var ae={};function De($e,Oe){for(var Be,Ye,Ze,Le=0;Le<$e.length;Le++)if(_[$e[Le]]?(Be=$e[Le+1],Ye=$e[Le],Ze=_[Ye],Le++):(Be=$e[Le],Ye=null,Ze=1),Be&&Be!==x)if(ae[Be]){ae[Be][0]+=Oe;var qe=ae[Be][2]?_[ae[Be][2]]:1;ae[Be][Oe===1?3:4]*=c(Ze,qe)}else ae[Be]=[Oe,Be,Ye,1,1]}De(A,1),De(C,-1),De(B,1),De(j,-1);var Se=[],Te=[],Ce=1;for(var Ke in ae)if(ae.hasOwnProperty(Ke)){var Re=ae[Ke],Xe;if(Re[0]>0)for(Xe=0;Xe<Re[0];Xe++)Se.push(Re[2]===null?Re[1]:[Re[2],Re[1]]);else if(Re[0]<0)for(Xe=0;Xe<-Re[0];Xe++)Te.push(Re[2]===null?Re[1]:[Re[2],Re[1]]);Ce*=c(Re[3],Re[4])}return Se.length===0&&(Se=S),Te.length===0&&(Te=S),Se=Se.reduce(function($e,Oe){return $e.concat(Oe)},[]),Te=Te.reduce(function($e,Oe){return $e.concat(Oe)},[]),[Se,Te,Ce]}f(X.prototype,{eq:function(A){return this.compareTo(A)===0},lt:function(A){return this.compareTo(A)===-1},lte:function(A){return this.eq(A)||this.lt(A)},gt:function(A){return this.compareTo(A)===1},gte:function(A){return this.eq(A)||this.gt(A)},compareTo:function(A){if(t(A))return this.compareTo(X(A));if(this.isCompatible(A)||m(this.units(),A.units()),this.baseScalar<A.baseScalar)return-1;if(this.baseScalar===A.baseScalar)return 0;if(this.baseScalar>A.baseScalar)return 1},same:function(A){return this.scalar===A.scalar&&this.units()===A.units()}}),f(X.prototype,{isUnitless:function(){return[this.numerator,this.denominator].every(function(A){return l(A,S)})},isCompatible:function(A){return t(A)?this.isCompatible(X(A)):he(A)&&A.signature!==void 0?this.signature===A.signature:!1},isInverse:function(A){return this.inverse().isCompatible(A)},isBase:function(){return this._isBase!==void 0?this._isBase:this.isDegrees()&&this.numerator[0].match(/<(kelvin|temp-K)>/)?(this._isBase=!0,this._isBase):(this.numerator.concat(this.denominator).forEach(function(A){A!==x&&v.indexOf(A)===-1&&(this._isBase=!1)},this),this._isBase===!1?this._isBase:(this._isBase=!0,this._isBase))}});function Fe(){}Fe.prototype.get=function(A){return arguments.length>1&&(A=Array.apply(null,arguments)),A.reduce(function(C,B,j){if(C){var J=C[B];return j===A.length-1?J?J.data:void 0:J}},this)},Fe.prototype.set=function(A,C){return arguments.length>2&&(A=Array.prototype.slice.call(arguments,0,-1),C=arguments[arguments.length-1]),A.reduce(function(B,j,J){var ae=B[j];return ae===void 0&&(ae=B[j]={}),J===A.length-1?(ae.data=C,C):ae},this)};function je(A,C){return(A+" "+C).trim()}X.formatter=je,f(X.prototype,{units:function(){if(this._units!==void 0)return this._units;var A=l(this.numerator,S),C=l(this.denominator,S);if(A&&C)return this._units="",this._units;var B=Ne(this.numerator),j=Ne(this.denominator);return this._units=B+(C?"":"/"+j),this._units},toString:function(A,C){var B;if(a(A))B=this.units(),C=A;else if(t(A))B=A;else if(he(A))return this.toPrec(A).toString(C);var j=this.to(B),J=C!==void 0?u(j.scalar,C):j.scalar;return j=(J+" "+j.units()).trim(),j},format:function(A,C){arguments.length===1&&typeof A=="function"&&(C=A,A=void 0),C=C||X.formatter;var B=this.to(A);return C.call(this,B.scalar,B.units())}});var Ue=new Fe;function Ne(A){var C=Ue.get(A);if(C)return C;var B=l(A,S);return B?C="1":C=Ve(ze(A)).join("*"),Ue.set(A,C),C}function ze(A){for(var C=[],B,j,J=0;J<A.length;J++)B=A[J],j=A[J+1],_[B]?(C.push(M[B]+M[j]),J++):C.push(M[B]);return C}function Ve(A){var C=A.reduce(function(B,j){var J=B[j];return J||B.push(J=B[j]=[j,0]),J[1]++,B},[]);return C.map(function(B){return B[0]+(B[1]>1?B[1]:"")})}return X.version="1.7.6",X})})(quantities);const Qty=quantities.exports;function deepValue(e,r=""){let t=r.split(".");for(let n of t){if(e[n]===void 0)return;e=e[n]}return e}var orientation={exports:{}},twoProduct_1=twoProduct$1,SPLITTER=+(Math.pow(2,27)+1);function twoProduct$1(e,r,t){var n=e*r,a=SPLITTER*e,s=a-e,o=a-s,l=e-o,f=SPLITTER*r,h=f-r,c=f-h,u=r-c,d=n-o*c,g=d-l*c,m=g-o*u,w=l*u-m;return t?(t[0]=w,t[1]=n,t):[w,n]}var robustSum=linearExpansionSum;function scalarScalar$1(e,r){var t=e+r,n=t-e,a=t-n,s=r-n,o=e-a,l=o+s;return l?[l,t]:[t]}function linearExpansionSum(e,r){var t=e.length|0,n=r.length|0;if(t===1&&n===1)return scalarScalar$1(e[0],r[0]);var a=t+n,s=new Array(a),o=0,l=0,f=0,h=Math.abs,c=e[l],u=h(c),d=r[f],g=h(d),m,w;u<g?(w=c,l+=1,l<t&&(c=e[l],u=h(c))):(w=d,f+=1,f<n&&(d=r[f],g=h(d))),l<t&&u<g||f>=n?(m=c,l+=1,l<t&&(c=e[l],u=h(c))):(m=d,f+=1,f<n&&(d=r[f],g=h(d)));for(var v=m+w,x=v-m,S=w-x,y=S,_=v,E,R,T,M,I;l<t&&f<n;)u<g?(m=c,l+=1,l<t&&(c=e[l],u=h(c))):(m=d,f+=1,f<n&&(d=r[f],g=h(d))),w=y,v=m+w,x=v-m,S=w-x,S&&(s[o++]=S),E=_+v,R=E-_,T=E-R,M=v-R,I=_-T,y=I+M,_=E;for(;l<t;)m=c,w=y,v=m+w,x=v-m,S=w-x,S&&(s[o++]=S),E=_+v,R=E-_,T=E-R,M=v-R,I=_-T,y=I+M,_=E,l+=1,l<t&&(c=e[l]);for(;f<n;)m=d,w=y,v=m+w,x=v-m,S=w-x,S&&(s[o++]=S),E=_+v,R=E-_,T=E-R,M=v-R,I=_-T,y=I+M,_=E,f+=1,f<n&&(d=r[f]);return y&&(s[o++]=y),_&&(s[o++]=_),o||(s[o++]=0),s.length=o,s}var twoSum$1=fastTwoSum;function fastTwoSum(e,r,t){var n=e+r,a=n-e,s=n-a,o=r-a,l=e-s;return t?(t[0]=l+o,t[1]=n,t):[l+o,n]}var twoProduct=twoProduct_1,twoSum=twoSum$1,robustScale=scaleLinearExpansion;function scaleLinearExpansion(e,r){var t=e.length;if(t===1){var n=twoProduct(e[0],r);return n[0]?n:[n[1]]}var a=new Array(2*t),s=[.1,.1],o=[.1,.1],l=0;twoProduct(e[0],r,s),s[0]&&(a[l++]=s[0]);for(var f=1;f<t;++f){twoProduct(e[f],r,o);var h=s[1];twoSum(h,o[0],s),s[0]&&(a[l++]=s[0]);var c=o[1],u=s[1],d=c+u,g=d-c,m=u-g;s[1]=d,m&&(a[l++]=m)}return s[1]&&(a[l++]=s[1]),l===0&&(a[l++]=0),a.length=l,a}var robustDiff=robustSubtract;function scalarScalar(e,r){var t=e+r,n=t-e,a=t-n,s=r-n,o=e-a,l=o+s;return l?[l,t]:[t]}function robustSubtract(e,r){var t=e.length|0,n=r.length|0;if(t===1&&n===1)return scalarScalar(e[0],-r[0]);var a=t+n,s=new Array(a),o=0,l=0,f=0,h=Math.abs,c=e[l],u=h(c),d=-r[f],g=h(d),m,w;u<g?(w=c,l+=1,l<t&&(c=e[l],u=h(c))):(w=d,f+=1,f<n&&(d=-r[f],g=h(d))),l<t&&u<g||f>=n?(m=c,l+=1,l<t&&(c=e[l],u=h(c))):(m=d,f+=1,f<n&&(d=-r[f],g=h(d)));for(var v=m+w,x=v-m,S=w-x,y=S,_=v,E,R,T,M,I;l<t&&f<n;)u<g?(m=c,l+=1,l<t&&(c=e[l],u=h(c))):(m=d,f+=1,f<n&&(d=-r[f],g=h(d))),w=y,v=m+w,x=v-m,S=w-x,S&&(s[o++]=S),E=_+v,R=E-_,T=E-R,M=v-R,I=_-T,y=I+M,_=E;for(;l<t;)m=c,w=y,v=m+w,x=v-m,S=w-x,S&&(s[o++]=S),E=_+v,R=E-_,T=E-R,M=v-R,I=_-T,y=I+M,_=E,l+=1,l<t&&(c=e[l]);for(;f<n;)m=d,w=y,v=m+w,x=v-m,S=w-x,S&&(s[o++]=S),E=_+v,R=E-_,T=E-R,M=v-R,I=_-T,y=I+M,_=E,f+=1,f<n&&(d=-r[f]);return y&&(s[o++]=y),_&&(s[o++]=_),o||(s[o++]=0),s.length=o,s}(function(e){var r=twoProduct_1,t=robustSum,n=robustScale,a=robustDiff,s=5,o=11102230246251565e-32,l=(3+16*o)*o,f=(7+56*o)*o;function h(y,_,E,R){return function(M,I,b){var k=y(y(_(I[1],b[0]),_(-b[1],I[0])),y(_(M[1],I[0]),_(-I[1],M[0]))),D=y(_(M[1],b[0]),_(-b[1],M[0])),$=R(k,D);return $[$.length-1]}}function c(y,_,E,R){return function(M,I,b,k){var D=y(y(E(y(_(b[1],k[0]),_(-k[1],b[0])),I[2]),y(E(y(_(I[1],k[0]),_(-k[1],I[0])),-b[2]),E(y(_(I[1],b[0]),_(-b[1],I[0])),k[2]))),y(E(y(_(I[1],k[0]),_(-k[1],I[0])),M[2]),y(E(y(_(M[1],k[0]),_(-k[1],M[0])),-I[2]),E(y(_(M[1],I[0]),_(-I[1],M[0])),k[2])))),$=y(y(E(y(_(b[1],k[0]),_(-k[1],b[0])),M[2]),y(E(y(_(M[1],k[0]),_(-k[1],M[0])),-b[2]),E(y(_(M[1],b[0]),_(-b[1],M[0])),k[2]))),y(E(y(_(I[1],b[0]),_(-b[1],I[0])),M[2]),y(E(y(_(M[1],b[0]),_(-b[1],M[0])),-I[2]),E(y(_(M[1],I[0]),_(-I[1],M[0])),b[2])))),P=R(D,$);return P[P.length-1]}}function u(y,_,E,R){return function(M,I,b,k,D){var $=y(y(y(E(y(E(y(_(k[1],D[0]),_(-D[1],k[0])),b[2]),y(E(y(_(b[1],D[0]),_(-D[1],b[0])),-k[2]),E(y(_(b[1],k[0]),_(-k[1],b[0])),D[2]))),I[3]),y(E(y(E(y(_(k[1],D[0]),_(-D[1],k[0])),I[2]),y(E(y(_(I[1],D[0]),_(-D[1],I[0])),-k[2]),E(y(_(I[1],k[0]),_(-k[1],I[0])),D[2]))),-b[3]),E(y(E(y(_(b[1],D[0]),_(-D[1],b[0])),I[2]),y(E(y(_(I[1],D[0]),_(-D[1],I[0])),-b[2]),E(y(_(I[1],b[0]),_(-b[1],I[0])),D[2]))),k[3]))),y(E(y(E(y(_(b[1],k[0]),_(-k[1],b[0])),I[2]),y(E(y(_(I[1],k[0]),_(-k[1],I[0])),-b[2]),E(y(_(I[1],b[0]),_(-b[1],I[0])),k[2]))),-D[3]),y(E(y(E(y(_(k[1],D[0]),_(-D[1],k[0])),I[2]),y(E(y(_(I[1],D[0]),_(-D[1],I[0])),-k[2]),E(y(_(I[1],k[0]),_(-k[1],I[0])),D[2]))),M[3]),E(y(E(y(_(k[1],D[0]),_(-D[1],k[0])),M[2]),y(E(y(_(M[1],D[0]),_(-D[1],M[0])),-k[2]),E(y(_(M[1],k[0]),_(-k[1],M[0])),D[2]))),-I[3])))),y(y(E(y(E(y(_(I[1],D[0]),_(-D[1],I[0])),M[2]),y(E(y(_(M[1],D[0]),_(-D[1],M[0])),-I[2]),E(y(_(M[1],I[0]),_(-I[1],M[0])),D[2]))),k[3]),y(E(y(E(y(_(I[1],k[0]),_(-k[1],I[0])),M[2]),y(E(y(_(M[1],k[0]),_(-k[1],M[0])),-I[2]),E(y(_(M[1],I[0]),_(-I[1],M[0])),k[2]))),-D[3]),E(y(E(y(_(b[1],k[0]),_(-k[1],b[0])),I[2]),y(E(y(_(I[1],k[0]),_(-k[1],I[0])),-b[2]),E(y(_(I[1],b[0]),_(-b[1],I[0])),k[2]))),M[3]))),y(E(y(E(y(_(b[1],k[0]),_(-k[1],b[0])),M[2]),y(E(y(_(M[1],k[0]),_(-k[1],M[0])),-b[2]),E(y(_(M[1],b[0]),_(-b[1],M[0])),k[2]))),-I[3]),y(E(y(E(y(_(I[1],k[0]),_(-k[1],I[0])),M[2]),y(E(y(_(M[1],k[0]),_(-k[1],M[0])),-I[2]),E(y(_(M[1],I[0]),_(-I[1],M[0])),k[2]))),b[3]),E(y(E(y(_(I[1],b[0]),_(-b[1],I[0])),M[2]),y(E(y(_(M[1],b[0]),_(-b[1],M[0])),-I[2]),E(y(_(M[1],I[0]),_(-I[1],M[0])),b[2]))),-k[3]))))),P=y(y(y(E(y(E(y(_(k[1],D[0]),_(-D[1],k[0])),b[2]),y(E(y(_(b[1],D[0]),_(-D[1],b[0])),-k[2]),E(y(_(b[1],k[0]),_(-k[1],b[0])),D[2]))),M[3]),E(y(E(y(_(k[1],D[0]),_(-D[1],k[0])),M[2]),y(E(y(_(M[1],D[0]),_(-D[1],M[0])),-k[2]),E(y(_(M[1],k[0]),_(-k[1],M[0])),D[2]))),-b[3])),y(E(y(E(y(_(b[1],D[0]),_(-D[1],b[0])),M[2]),y(E(y(_(M[1],D[0]),_(-D[1],M[0])),-b[2]),E(y(_(M[1],b[0]),_(-b[1],M[0])),D[2]))),k[3]),E(y(E(y(_(b[1],k[0]),_(-k[1],b[0])),M[2]),y(E(y(_(M[1],k[0]),_(-k[1],M[0])),-b[2]),E(y(_(M[1],b[0]),_(-b[1],M[0])),k[2]))),-D[3]))),y(y(E(y(E(y(_(b[1],D[0]),_(-D[1],b[0])),I[2]),y(E(y(_(I[1],D[0]),_(-D[1],I[0])),-b[2]),E(y(_(I[1],b[0]),_(-b[1],I[0])),D[2]))),M[3]),E(y(E(y(_(b[1],D[0]),_(-D[1],b[0])),M[2]),y(E(y(_(M[1],D[0]),_(-D[1],M[0])),-b[2]),E(y(_(M[1],b[0]),_(-b[1],M[0])),D[2]))),-I[3])),y(E(y(E(y(_(I[1],D[0]),_(-D[1],I[0])),M[2]),y(E(y(_(M[1],D[0]),_(-D[1],M[0])),-I[2]),E(y(_(M[1],I[0]),_(-I[1],M[0])),D[2]))),b[3]),E(y(E(y(_(I[1],b[0]),_(-b[1],I[0])),M[2]),y(E(y(_(M[1],b[0]),_(-b[1],M[0])),-I[2]),E(y(_(M[1],I[0]),_(-I[1],M[0])),b[2]))),-D[3])))),O=R($,P);return O[O.length-1]}}function d(y){var _=y===3?h:y===4?c:u;return _(t,r,n,a)}var g=d(3),m=d(4),w=[function(){return 0},function(){return 0},function(_,E){return E[0]-_[0]},function(_,E,R){var T=(_[1]-R[1])*(E[0]-R[0]),M=(_[0]-R[0])*(E[1]-R[1]),I=T-M,b;if(T>0){if(M<=0)return I;b=T+M}else if(T<0){if(M>=0)return I;b=-(T+M)}else return I;var k=l*b;return I>=k||I<=-k?I:g(_,E,R)},function(_,E,R,T){var M=_[0]-T[0],I=E[0]-T[0],b=R[0]-T[0],k=_[1]-T[1],D=E[1]-T[1],$=R[1]-T[1],P=_[2]-T[2],O=E[2]-T[2],ee=R[2]-T[2],q=I*$,z=b*D,W=b*k,H=M*$,se=M*D,N=I*k,Y=P*(q-z)+O*(W-H)+ee*(se-N),L=(Math.abs(q)+Math.abs(z))*Math.abs(P)+(Math.abs(W)+Math.abs(H))*Math.abs(O)+(Math.abs(se)+Math.abs(N))*Math.abs(ee),U=f*L;return Y>U||-Y>U?Y:m(_,E,R,T)}];function v(y){var _=w[y.length];return _||(_=w[y.length]=d(y.length)),_.apply(void 0,y)}function x(y,_,E,R,T,M,I){return function(k,D,$,P,O){switch(arguments.length){case 0:case 1:return 0;case 2:return R(k,D);case 3:return T(k,D,$);case 4:return M(k,D,$,P);case 5:return I(k,D,$,P,O)}for(var ee=new Array(arguments.length),q=0;q<arguments.length;++q)ee[q]=arguments[q];return y(ee)}}function S(){for(;w.length<=s;)w.push(d(w.length));e.exports=x.apply(void 0,[v].concat(w));for(var y=0;y<=s;++y)e.exports[y]=w[y]}S()})(orientation);var robustPnp=robustPointInPolygon,orient=orientation.exports;function robustPointInPolygon(e,r){for(var t=r[0],n=r[1],a=e.length,s=1,o=a,l=0,f=a-1;l<o;f=l++){var h=e[l],c=e[f],u=h[1],d=c[1];if(d<u){if(d<n&&n<u){var g=orient(h,c,r);if(g===0)return 0;s^=0<g|0}else if(n===u){var m=e[(l+1)%a],w=m[1];if(u<w){var g=orient(h,c,r);if(g===0)return 0;s^=0<g|0}}}else if(u<d){if(u<n&&n<d){var g=orient(h,c,r);if(g===0)return 0;s^=g<0|0}else if(n===u){var m=e[(l+1)%a],w=m[1];if(w<u){var g=orient(h,c,r);if(g===0)return 0;s^=g<0|0}}}else if(n===u){var v=Math.min(h[0],c[0]),x=Math.max(h[0],c[0]);if(l===0){for(;f>0;){var S=(f+a-1)%a,y=e[S];if(y[1]!==n)break;var _=y[0];v=Math.min(v,_),x=Math.max(x,_),f=S}if(f===0)return v<=t&&t<=x?0:1;o=f+1}for(var E=e[(f+a-1)%a][1];l+1<o;){var y=e[l+1];if(y[1]!==n)break;var _=y[0];v=Math.min(v,_),x=Math.max(x,_),l+=1}if(v<=t&&t<=x)return 0;var R=e[(l+1)%a][1];t<v&&E<n!=R<n&&(s^=1)}}return 2*s-1}const robustPointInPolygon$1=robustPnp;function feretDiameters(e={}){const{originalPoints:r=monotoneChainConvexHull.call(this)}=e;if(r.length===0)return{min:0,max:0,minLine:[],maxLine:[],aspectRatio:1};if(r.length===1)return{min:1,max:1,minLine:[r[0],r[0]],maxLine:[r[0],r[0]],aspectRatio:1};const t=new Array(r.length);let n=1/0,a=0,s=[];for(let h=0;h<r.length;h++){let c=getAngle(r[h],r[(h+1)%r.length]);rotate(-c,r,t);let u=0,d=[];for(let g=0;g<r.length;g++){let m=Math.abs(t[h][1]-t[g][1]);m>u&&(u=m,d=[],d.push([t[g][0],t[h][1]],[t[g][0],t[g][1]]))}u<n&&(n=u,a=c,s=d)}rotate(a,s,s);let o=0,l=[],f=0;for(let h=0;h<r.length-1;h++)for(let c=h+1;c<r.length;c++){let u=(r[h][0]-r[c][0])**2+(r[h][1]-r[c][1])**2;u>f&&(f=u,o=Math.sqrt(u),l=[r[h],r[c]])}return{min:n,minLine:s,max:o,maxLine:l,aspectRatio:n/o}}function getAngle(e,r){let t=difference(r,e),n=normalize(t),a=Math.acos(n[0]);return n[1]<0?-a:a}class Roi{constructor(r,t){this.map=r,this.id=t,this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY,this.meanX=0,this.meanY=0,this.surface=0,this.computed={}}getMask(r={}){const{scale:t=1,kind:n=""}=r;let a;switch(n){case"contour":a=this.contourMask;break;case"box":a=this.boxMask;break;case"filled":a=this.filledMask;break;case"center":a=this.centerMask;break;case"mbr":a=this.mbrFilledMask;break;case"hull":a=this.convexHullFilledMask;break;case"hullContour":a=this.convexHullMask;break;case"mbrContour":a=this.mbrMask;break;case"feret":a=this.feretMask;break;default:a=this.mask}return t<1&&(a=a.resize({factor:t}),a.parent=this.mask.parent,a.position[0]+=this.minX,a.position[1]+=this.minY),a}get mean(){throw new Error("Roi mean not implemented yet")}get center(){return this.computed.center||(this.computed.center=[this.width/2>>0,this.height/2>>0]),this.computed.center}get ratio(){return this.width/this.height}get width(){return this.maxX-this.minX+1}get height(){return this.maxY-this.minY+1}_computExternalIDs(){let r=this.borderIDs,t=this.borderLengths;this.computed.externalIDs=[],this.computed.externalLengths=[];let n=this.internalIDs;for(let a=0;a<r.length;a++)n.includes(r[a])||(this.computed.externalIDs.push(r[a]),this.computed.externalLengths.push(t[a]))}get externalIDs(){return this.computed.externalIDs?this.computed.externalIDs:(this._computExternalIDs(),this.computed.externalIDs)}get externalLengths(){return this.computed.externalLengths?this.computed.externalLengths:(this._computExternalIDs(),this.computed.externalLengths)}_computeBorderIDs(){let r=getBorders(this);this.computed.borderIDs=r.ids,this.computed.borderLengths=r.lengths}get borderIDs(){return this.computed.borderIDs?this.computed.borderIDs:(this._computeBorderIDs(),this.computed.borderIDs)}get borderLengths(){return this.computed.borderLengths?this.computed.borderLengths:(this._computeBorderIDs(),this.computed.borderLengths)}get boxIDs(){return this.computed.boxIDs||(this.computed.boxIDs=getBoxIDs(this)),this.computed.boxIDs}get internalIDs(){return this.computed.internalIDs||(this.computed.internalIDs=getInternalIDs(this)),this.computed.internalIDs}get box(){return this.computed.box||(this.computed.box=getBox(this)),this.computed.box}get external(){return this.computed.external||(this.computed.external=getExternal(this)),this.computed.external}get holesInfo(){return this.computed.holesInfo||(this.computed.holesInfo=getHolesInfo(this)),this.computed.holesInfo}get border(){return this.computed.border||(this.computed.border=getBorder(this)),this.computed.border}get contourMask(){if(!this.computed.contourMask){let r=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let t=0;t<this.width;t++)for(let n=0;n<this.height;n++)this.map.data[t+this.minX+(n+this.minY)*this.map.width]===this.id&&(t>0&&t<this.width-1&&n>0&&n<this.height-1?(this.map.data[t-1+this.minX+(n+this.minY)*this.map.width]!==this.id||this.map.data[t+1+this.minX+(n+this.minY)*this.map.width]!==this.id||this.map.data[t+this.minX+(n-1+this.minY)*this.map.width]!==this.id||this.map.data[t+this.minX+(n+1+this.minY)*this.map.width]!==this.id)&&r.setBitXY(t,n):r.setBitXY(t,n));this.computed.contourMask=r}return this.computed.contourMask}get boxMask(){if(!this.computed.boxMask){let r=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let t=0;t<this.width;t++)r.setBitXY(t,0),r.setBitXY(t,this.height-1);for(let t=0;t<this.height;t++)r.setBitXY(0,t),r.setBitXY(this.width-1,t);this.computed.boxMask=r}return this.computed.boxMask}get mask(){if(!this.computed.mask){let r=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let t=0;t<this.width;t++)for(let n=0;n<this.height;n++)this.map.data[t+this.minX+(n+this.minY)*this.map.width]===this.id&&r.setBitXY(t,n);this.computed.mask=r}return this.computed.mask}get filledMask(){if(!this.computed.filledMask){let r=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let t=0;t<this.width;t++)for(let n=0;n<this.height;n++){let a=t+this.minX+(n+this.minY)*this.map.width;this.internalIDs.includes(this.map.data[a])&&r.setBitXY(t,n)}this.computed.filledMask=r}return this.computed.filledMask}get centerMask(){if(!this.computed.centerMask){let r=new Shape({kind:"smallCross"}).getMask();r.parent=this.map.parent,r.position=[this.minX+this.center[0]-1,this.minY+this.center[1]-1],this.computed.centerMask=r}return this.computed.centerMask}get convexHull(){if(!this.computed.convexHull){const r=[];for(let n=0;n<this.width;n++)for(let a=0;a<this.height;a++)this.map.data[n+this.minX+(a+this.minY)*this.map.width]===this.id&&(n>0&&n<this.width-1&&a>0&&a<this.height-1?(this.map.data[n-1+this.minX+(a+this.minY)*this.map.width]!==this.id||this.map.data[n+1+this.minX+(a+this.minY)*this.map.width]!==this.id||this.map.data[n+this.minX+(a-1+this.minY)*this.map.width]!==this.id||this.map.data[n+this.minX+(a+1+this.minY)*this.map.width]!==this.id)&&(r.push([n,a]),r.push([n+1,a]),r.push([n,a+1]),r.push([n+1,a+1])):(r.push([n,a]),r.push([n+1,a]),r.push([n,a+1]),r.push([n+1,a+1])));const t=monotoneChainConvexHull$1(r);this.computed.convexHull={polyline:t,surface:surface(t),perimeter:perimeter(t)}}return this.computed.convexHull}get convexHullMask(){if(!this.computed.convexHullMask){const r=this.convexHull,t=new Image$1(this.width+1,this.height+1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});t.paintPolyline(r.polyline,{closed:!0}),this.computed.convexHullMask=t}return this.computed.convexHullMask}get convexHullFilledMask(){if(!this.computed.convexHullFilledMask){const r=this.convexHull,t=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let n=0;n<this.width;n++)for(let a=0;a<this.height;a++)robustPointInPolygon$1(r.polyline,[n,a])!==1&&t.setBitXY(n,a);this.computed.convexHullFilledMask=t}return this.computed.convexHullFilledMask}get mbr(){if(!this.computed.mbr){let r=minimalBoundingRectangle({originalPoints:this.convexHull.polyline});if(r.length===0)this.computed.mbr={width:0,height:0,surface:0,perimeter:0,rectangle:r};else{let t=r[0],n=r[1],a=r[2],s=Math.sqrt((t[0]-n[0])**2+(t[1]-n[1])**2),o=Math.sqrt((a[0]-n[0])**2+(a[1]-n[1])**2);this.computed.mbr={width:s,height:o,elongation:1-s/o,aspectRatio:s/o,surface:s*o,perimeter:(s+o)*2,rectangle:r}}}return this.computed.mbr}get fillRatio(){return this.surface/(this.surface+this.holesInfo.surface)}get feretDiameters(){return this.computed.feretDiameters||(this.computed.feretDiameters=feretDiameters({originalPoints:this.convexHull.polyline})),this.computed.feretDiameters}get eqpc(){return this.computed.eqpc||(this.computed.eqpc=2*Math.sqrt(this.surface/Math.PI)),this.computed.eqpc}get perimeterInfo(){return this.computed.perimeterInfo||(this.computed.perimeterInfo=getPerimeterInfo(this)),this.computed.perimeterInfo}get perimeter(){let r=this.perimeterInfo,t=2-Math.sqrt(2);return r.one+r.two*2+r.three*3+r.four*4-t*(r.two+r.three*2+r.four)}get ped(){return this.computed.ped||(this.computed.ped=this.perimeter/Math.PI),this.computed.ped}get feretMask(){if(!this.computed.feretMask){const r=new Image$1(this.width+1,this.height+1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});r.paintPolyline(this.feretDiameters.minLine),r.paintPolyline(this.feretDiameters.maxLine),this.computed.feretMask=r}return this.computed.feretMask}get mbrMask(){if(!this.computed.mbrMask){let r=round(this.mbr.rectangle);if(r.length>0){const t=minMax(r),n=new Image$1(t[1][0]-t[0][0]+1,t[1][1]-t[0][1]+1,{kind:BINARY,position:[this.minX+t[0][0],this.minY+t[0][1]],parent:this.map.parent});r=moveToZeroZero(r),n.paintPolyline(r,{closed:!0}),this.computed.mbrMask=n}else this.computed.mbrMask=new Image$1(1,1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent})}return this.computed.mbrMask}get mbrFilledMask(){if(!this.computed.mbrFilledMask){const r=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent}),t=this.mask.minimalBoundingRectangle();for(let n=0;n<this.width;n++)for(let a=0;a<this.height;a++)robustPointInPolygon$1(t,[n,a])!==1&&r.setBitXY(n,a);this.computed.mbrFilledMask=r}return this.computed.mbrFilledMask}get points(){if(!this.computed.points){let r=[];for(let t=0;t<this.height;t++)for(let n=0;n<this.width;n++){let a=(t+this.minY)*this.map.width+n+this.minX;this.map.data[a]===this.id&&r.push([n,t])}this.computed.points=r}return this.computed.points}get maxLengthPoints(){if(!this.computed.maxLengthPoints){let r=0,t;const n=this.points;for(let a=0;a<n.length;a++)for(let s=a+1;s<n.length;s++){let o=Math.pow(n[a][0]-n[s][0],2)+Math.pow(n[a][1]-n[s][1],2);o>=r&&(r=o,t=[n[a],n[s]])}this.computed.maxLengthPoints=t}return this.computed.maxLengthPoints}get maxLength(){if(!this.computed.maxLength){let r=Math.sqrt(Math.pow(this.maxLengthPoints[0][0]-this.maxLengthPoints[1][0],2)+Math.pow(this.maxLengthPoints[0][1]-this.maxLengthPoints[1][1],2));this.computed.maxLength=r}return this.computed.maxLength}get roundness(){return 4*this.surface/(Math.PI*this.feretDiameters.max**2)}get sphericity(){return 2*Math.sqrt(this.surface*Math.PI)/this.perimeter}get solidity(){return this.surface/this.convexHull.surface}get angle(){if(!this.computed.angle){let r=this.maxLengthPoints,t=-Math.atan2(r[0][1]-r[1][1],r[0][0]-r[1][0])*180/Math.PI;this.computed.angle=t}return this.computed.angle}toJSON(){return{id:this.id,minX:this.minX,maxX:this.maxX,minY:this.minY,maxY:this.maxY,meanX:this.meanX,meanY:this.meanY,height:this.height,width:this.width,surface:this.surface,mbrWidth:this.mbr.width,mbrHeight:this.mbr.height,mbrSurface:this.mbr.surface,eqpc:this.eqpc,ped:this.ped,feretDiameterMin:this.feretDiameters.min,feretDiameterMax:this.feretDiameters.max,aspectRatio:this.feretDiameters.aspectRatio,fillRatio:this.fillRatio,sphericity:this.sphericity,roundness:this.roundness,solidity:this.solidity,perimeter:this.perimeter}}}function getBorders(e){let r=e.map,t=r.data,n=new Set,a=new Map,s=new Set,o=[1,0,-1,0],l=[0,1,0,-1];for(let c=e.minX;c<=e.maxX;c++)for(let u=e.minY;u<=e.maxY;u++){let d=c+u*r.width;if(t[d]===e.id)for(let g=0;g<4;g++){let m=c+o[g],w=u+l[g];if(m>=0&&w>=0&&m<r.width&&w<r.height){let v=m+w*r.width;if(t[v]!==e.id&&!s.has(v)){s.add(v),n.add(t[v]);let x=a.get(t[v]);x?a.set(t[v],++x):a.set(t[v],1)}}}}let f=Array.from(n),h=f.map(function(c){return a.get(c)});return{ids:f,lengths:h}}function getBoxIDs(e){let r=new Set,t=e.map,n=t.data;for(let a of[0,e.height-1])for(let s=0;s<e.width;s++){let o=(a+e.minY)*t.width+s+e.minX;if(s-e.minX>0&&n[o]===e.id&&n[o-1]!==e.id){let l=n[o-1];r.add(l)}if(t.width-s-e.minX>1&&n[o]===e.id&&n[o+1]!==e.id){let l=n[o+1];r.add(l)}}for(let a of[0,e.width-1])for(let s=0;s<e.height;s++){let o=(s+e.minY)*t.width+a+e.minX;if(s-e.minY>0&&n[o]===e.id&&n[o-t.width]!==e.id){let l=n[o-t.width];r.add(l)}if(t.height-s-e.minY>1&&n[o]===e.id&&n[o+t.width]!==e.id){let l=n[o+t.width];r.add(l)}}return Array.from(r)}function getBox(e){let r=0,t=e.map,n=t.data,a=[0];e.height>1&&(a[1]=e.height-1);for(let o of a)for(let l=1;l<e.width-1;l++){let f=(o+e.minY)*t.width+l+e.minX;n[f]===e.id&&r++}let s=[0];e.width>1&&(s[1]=e.width-1);for(let o of s)for(let l=0;l<e.height;l++){let f=(l+e.minY)*t.width+o+e.minX;n[f]===e.id&&r++}return r}function getBorder(e){let r=0,t=e.map,n=t.data;for(let a=1;a<e.width-1;a++)for(let s=1;s<e.height-1;s++){let o=(s+e.minY)*t.width+a+e.minX;n[o]===e.id&&(n[o-1]!==e.id||n[o+1]!==e.id||n[o-t.width]!==e.id||n[o+t.width]!==e.id)&&r++}return r+e.box}function getPerimeterInfo(e){let r=e.map,t=r.data,n=0,a=0,s=0,o=0;for(let l=0;l<e.width;l++)for(let f=0;f<e.height;f++){let h=(f+e.minY)*r.width+l+e.minX;if(t[h]===e.id){let c=0;switch((l===0||e.externalIDs.includes(t[h-1]))&&c++,(l===e.width-1||e.externalIDs.includes(t[h+1]))&&c++,(f===0||e.externalIDs.includes(t[h-r.width]))&&c++,(f===e.height-1||e.externalIDs.includes(t[h+r.width]))&&c++,c){case 1:n++;break;case 2:a++;break;case 3:s++;break;case 4:o++;break}}}return{one:n,two:a,three:s,four:o}}function getExternal(e){let r=0,t=e.map,n=t.data;for(let a=1;a<e.width-1;a++)for(let s=1;s<e.height-1;s++){let o=(s+e.minY)*t.width+a+e.minX;n[o]===e.id&&(e.externalIDs.includes(n[o-1])||e.externalIDs.includes(n[o+1])||e.externalIDs.includes(n[o-t.width])||e.externalIDs.includes(n[o+t.width]))&&r++}return r+e.box}function getHolesInfo(e){let r=0,t=e.map.width,n=e.map.data;for(let a=1;a<e.width-1;a++)for(let s=1;s<e.height-1;s++){let o=(s+e.minY)*t+a+e.minX;e.internalIDs.includes(n[o])&&n[o]!==e.id&&r++}return{number:e.internalIDs.length-1,surface:r}}function getInternalIDs(e){let r=[e.id],t=e.map,n=t.data;if(e.height>2)for(let s=0;s<e.width;s++){let o=e.minY*t.width+s+e.minX;if(r.includes(n[o])){let l=n[o+t.width];!r.includes(l)&&!e.boxIDs.includes(l)&&r.push(l)}}let a=new Array(4);for(let s=1;s<e.width-1;s++)for(let o=1;o<e.height-1;o++){let l=(o+e.minY)*t.width+s+e.minX;if(r.includes(n[l])){a[0]=n[l-1],a[1]=n[l+1],a[2]=n[l-t.width],a[3]=n[l+t.width];for(let f=0;f<4;f++){let h=a[f];!r.includes(h)&&!e.boxIDs.includes(h)&&r.push(h)}}}return r}class RoiLayer{constructor(r,t){this.roiMap=r,this.options=t,this.roi=this.createRoi()}createRoi(){let r=this.roiMap.data,t={};this.roiMap.positive=0,this.roiMap.negative=0;for(let l=0;l<r.length;l++)r[l]&&!t[r[l]]&&(t[r[l]]=!0,r[l]>0?this.roiMap.positive++:this.roiMap.negative++);let n={};for(let l in t)n[l]=new Roi(this.roiMap,l*1);let a=this.roiMap.width,s=this.roiMap.height;for(let l=0;l<s;l++)for(let f=0;f<a;f++){let h=l*a+f;if(r[h]!==0){const c=r[h],u=n[c];f<u.minX&&(u.minX=f),f>u.maxX&&(u.maxX=f),l<u.minY&&(u.minY=l),l>u.maxY&&(u.maxY=l),u.meanX+=f,u.meanY+=l,u.surface++}}let o=[];for(let l in t)n[l].meanX/=n[l].surface,n[l].meanY/=n[l].surface,o.push(n[l]);return o}}function commonBorderLength(e){let r=e.data,t=[1,0,-1,0],n=[0,1,0,-1],a=e.minMax,s=-a.min,o=a.max+s,l=[];for(let h=0;h<=o;h++)l.push(Object.create(null));for(let h=0;h<e.width;h++)for(let c=0;c<e.height;c++){let u=h+c*e.width,d=r[u];if(d!==0){let g=Object.create(null),m=!1;for(let w=0;w<4;w++){let v=h+t[w],x=c+n[w];if(v>=0&&x>=0&&v<e.width&&x<e.height){let S=r[v+x*e.width];d!==S&&(m=!0,S!==0&&g[S]===void 0&&(g[S]=!0,l[S+s][d]?l[S+s][d]++:l[S+s][d]=1))}else m=!0}m&&(l[d+s][d]?l[d+s][d]++:l[d+s][d]=1)}}let f={};for(let h=0;h<l.length;h++)Object.keys(l[h]).length>0&&(f[h-s]=l[h]);return f}function mergeRoi(e={}){const{algorithm:r="commonBorderLength",minCommonBorderLength:t=5,maxCommonBorderLength:n=100,minCommonBorderRatio:a=.3,maxCommonBorderRatio:s=1}=e;let o=function(v,x,S){return v[S]>=t&&v[S]<=n};typeof r=="function"&&(o=r),r.toLowerCase()==="commonborderratio"&&(o=function(v,x,S){let y=Math.min(v[S]/v[x],1);return y>=a&&y<=s});const l=this,f=l.commonBorderLength;let h={},c={};for(let v of Object.keys(f)){let x=f[v],S=Object.keys(x);for(let y of S)if(y!==v&&o(x,v,y)){let _=y;c[y]&&(_=c[y]);let E=v;if(c[v]&&(E=c[v]),Number(_)!==E){let R=Math.min(_,E),T=Math.max(_,E);if(h[R]||(h[R]={}),h[R][T]=!0,c[T]=R,h[T]){for(let M of Object.keys(h[T]))h[R][M]=!0,c[M]=R;delete h[T]}}}}let u=l.minMax,d=-u.min,g=u.max+d,m=new Array(g+1).fill(0);for(let v of Object.keys(c))m[Number(v)+d]=c[v];let w=l.data;for(let v=0;v<w.length;v++){let x=w[v];if(x!==0){let S=m[x+d];S!==0&&(w[v]=S)}}return l.computed={},l}class RoiMap{constructor(r,t){this.parent=r,this.width=r.width,this.height=r.height,this.data=t,this.negative=0,this.positive=0}get total(){return this.negative+this.positive}get minMax(){let r=Number.MAX_SAFE_INTEGER,t=Number.MIN_SAFE_INTEGER;for(let n=0;n<this.data.length;n++)this.data[n]<r&&(r=this.data[n]),this.data[n]>t&&(t=this.data[n]);return{min:r,max:t}}get commonBorderLength(){return commonBorderLength(this)}mergeRoi(r={}){return mergeRoi.call(this,r)}mergeRois(r){const t=r[0],n=r.slice(1);for(let a=0;a<this.data.length;a++)n.includes(this.data[a])&&(this.data[a]=t)}rowsInfo(){let r=new Array(this.height),t=0;for(let n=0;n<this.data.length;n+=this.width){let a={row:t,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};r[t++]=a;let s={},o={},l=[],f=this.data[n],h=0;for(let c=n;c<n+this.width;c++){let u=this.data[c];f!==u&&(f=u,l.push(h),h=0),h++,u>0?(a.positivePixel++,s[u]||(s[u]=!0)):u<0?(a.negativePixel++,o[u]||(o[u]=!0)):a.zeroPixel++}l.push(h),a.medianChange=l.sort((c,u)=>c-u)[Math.floor(l.length/2)],a.positiveRoiIDs=Object.keys(s),a.negativeRoiIDs=Object.keys(o),a.positiveRoi=a.positiveRoiIDs.length,a.negativeRoi=a.negativeRoiIDs.length}return r}colsInfo(){let r=new Array(this.width),t=0;for(let n=0;n<this.width;n++){let a={col:t,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};r[t++]=a;let s={},o={},l=[],f=this.data[n],h=0;for(let c=n;c<n+this.data.length;c+=this.width){let u=this.data[c];f!==u&&(f=u,l.push(h),h=0),h++,u>0?(a.positivePixel++,s[u]||(s[u]=!0)):u<0?(a.negativePixel++,o[u]||(o[u]=!0)):a.zeroPixel++}l.push(h),a.medianChange=l.sort((c,u)=>c-u)[Math.floor(l.length/2)],a.positiveRoiIDs=Object.keys(s),a.negativeRoiIDs=Object.keys(o),a.positiveRoi=a.positiveRoiIDs.length,a.negativeRoi=a.negativeRoiIDs.length}return r}}function fromMask(e,r={}){const{allowCorners:t=!1}=r,n=65535;let a=new Int16Array(e.size),s=0,o=0,l=new Uint16Array(n+1),f=new Uint16Array(n+1);for(let c=0;c<e.width;c++)for(let u=0;u<e.height;u++)a[u*e.width+c]===0&&h(c,u);function h(c,u){let d=0,g=0,m=e.getBitXY(c,u),w=m?++s:--o;if(s>32767||o<-32768)throw new Error("Too many regions of interest");for(l[0]=c,f[0]=u;d<=g;){let v=l[d&n],x=f[d&n];if(a[x*e.width+v]=w,v>0&&a[x*e.width+v-1]===0&&e.getBitXY(v-1,x)===m&&(g++,l[g&n]=v-1,f[g&n]=x,a[x*e.width+v-1]=-32768),x>0&&a[(x-1)*e.width+v]===0&&e.getBitXY(v,x-1)===m&&(g++,l[g&n]=v,f[g&n]=x-1,a[(x-1)*e.width+v]=-32768),v<e.width-1&&a[x*e.width+v+1]===0&&e.getBitXY(v+1,x)===m&&(g++,l[g&n]=v+1,f[g&n]=x,a[x*e.width+v+1]=-32768),x<e.height-1&&a[(x+1)*e.width+v]===0&&e.getBitXY(v,x+1)===m&&(g++,l[g&n]=v,f[g&n]=x+1,a[(x+1)*e.width+v]=-32768),t&&(v>0&&x>0&&a[(x-1)*e.width+v-1]===0&&e.getBitXY(v-1,x-1)===m&&(g++,l[g&n]=v-1,f[g&n]=x-1,a[(x-1)*e.width+v-1]=-32768),v<e.width-1&&x>0&&a[(x-1)*e.width+v+1]===0&&e.getBitXY(v+1,x-1)===m&&(g++,l[g&n]=v+1,f[g&n]=x-1,a[(x-1)*e.width+v+1]=-32768),v>0&&x<e.height-1&&a[(x+1)*e.width+v-1]===0&&e.getBitXY(v-1,x+1)===m&&(g++,l[g&n]=v-1,f[g&n]=x+1,a[(x+1)*e.width+v-1]=-32768),v<e.width-1&&x<e.height-1&&a[(x+1)*e.width+v+1]===0&&e.getBitXY(v+1,x+1)===m&&(g++,l[g&n]=v+1,f[g&n]=x+1,a[(x+1)*e.width+v+1]=-32768)),d++,g-d>n)throw new Error("analyseMask can not finish, the array to manage internal data is not big enough.You could improve mask by changing MAX_ARRAY")}}return new RoiMap(e,a)}class DisjointSet{constructor(){this.nodes=new Map}add(r){var t=this.nodes.get(r);return t||(t=new DisjointSetNode(r),this.nodes.set(r,t)),t}union(r,t){const n=this.find(r),a=this.find(t);n!==a&&(n.rank<a.rank?n.parent=a:n.rank>a.rank?a.parent=n:(a.parent=n,n.rank++))}find(r){for(var t=r;t.parent!==null;)t=t.parent;for(var n=r;n.parent!==null;){var a=n;n=n.parent,a.parent=t}return t}connected(r,t){return this.find(r)===this.find(t)}}var DisjointSet_1=DisjointSet;function DisjointSetNode(e){this.value=e,this.parent=null,this.rank=0}const DisjointSet$1=DisjointSet_1,direction4X=[-1,0],direction4Y=[0,-1],neighbours4=[null,null],direction8X=[-1,-1,0,1],direction8Y=[0,-1,-1,-1],neighbours8=[null,null,null,null];function fromMaskConnectedComponentLabelingAlgorithm(e,r={}){const{allowCorners:t=!1}=r;let n=4;t&&(n=8);let a,s,o;if(n===8)a=direction8X,s=direction8Y,o=neighbours8;else if(n===4)a=direction4X,s=direction4Y,o=neighbours4;else throw new RangeError(`unsupported neighbours count: ${n}`);const l=e.size,f=e.width,h=e.height,c=new Array(l),u=new Uint32Array(l),d=new DisjointSet$1;let g=1;for(let m=0;m<h;m++)for(let w=0;w<f;w++){const v=w+m*f;if(e.getBit(v)){let x=null;for(let S=0;S<o.length;S++){const y=w+a[S],_=m+s[S];if(y>=0&&_>=0&&y<f&&_<h){const E=y+_*f;let R=c[E];R?(o[S]=R,(!x||o[S].value<x.value)&&(x=o[S])):o[S]=null}}if(!x)c[v]=d.add(g++);else{c[v]=x;for(let S=0;S<o.length;S++)o[S]&&o[S]!==x&&d.union(x,o[S])}}}for(let m=0;m<h;m++)for(let w=0;w<f;w++){const v=w+m*f;e.getBit(v)&&(u[v]=d.find(c[v]).value)}return new RoiMap(e,u)}function fromMaxima(e={}){let{allowCorner:r=!0,onlyTop:t=!1,invert:n=!1}=e,a=this;a.checkProcessable("fromMaxima",{components:[1]});const s=1,o=2;let l=0,f=0,h=new Int16Array(a.size),c=new Int8Array(a.size),u=new Float32Array(a.size),d=1048575,g=new Uint16Array(d+1),m=new Uint16Array(d+1),w=0,v=0,x=new Uint16Array(d+1),S=new Uint16Array(d+1),y=0,_=0;for(E(a);w<v;){let M=g[w&d],I=m[w&d];T(M,I,o),w++}return new RoiMap(a,h);function E({maxima:M=!0}){for(let I=1;I<a.height-1;I++)for(let b=1;b<a.width-1;b++){let k=b+I*a.width;if(c[k]===0){let D=M?a.data[k]:-a.data[b+I*a.width];if(a.data[I*a.width+b-1]>D||a.data[I*a.width+b+1]>D||a.data[(I-1)*a.width+b]>D||a.data[(I+1)*a.width+b]>D||r&&(a.data[(I-1)*a.width+b-1]>D||a.data[(I-1)*a.width+b+1]>D||a.data[(I+1)*a.width+b-1]>D||a.data[(I+1)*a.width+b+1]>D))continue;h[k]=M?++l:--f,R(b,I)||(M?--l:++f)}}}function R(M,I){let b=v;y=0,_=1,x[0]=M,S[0]=I;let k=!0;for(;y<_;){let D=x[y&d],$=S[y&d];k&=T(D,$,s),y++}if(!k){for(let D=0;D<_;D++){let $=x[D&d],O=S[D&d]*a.width+$;h[O]=0}v=b}return k}function T(M,I,b){let k=h[I*a.width+M],D=a.data[I*a.width+M];for(let $=I-1;$<=I+1;$++)for(let P=M-1;P<=M+1;P++){let O=$*a.width+P;if(c[O]===0)switch(c[O]=1,u[O]=a.data[O]-D,b){case s:if(u[O]===0){if(P===0||$===0||P===a.width-1||$===a.height-1)return!1;h[O]=k,x[_&d]=P,S[_&d]=$,_++}else{if(u[O]>0)return!1;t||(h[O]=k,g[v&d]=P,m[v&d]=$,v++)}break;case o:u[O]<=0&&(h[O]=k,g[v&d]=P,m[v&d]=$,v++);break;default:throw new Error("unreachable")}}return!0}}function fromPoints(e,r={}){let t=new Shape(r),n=new Int16Array(this.size),a=0,s=t.getPoints();for(let o=0;o<e.length;o++){a++;let l=e[o][0],f=e[o][1];for(let h=0;h<s.length;h++){let c=s[h][0],u=s[h][1];l+c>=0&&f+u>=0&&l+c<this.width&&f+u<this.height&&(n[l+c+(f+u)*this.width]=a)}}return new RoiMap(this,n)}function commonjsRequire(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var priorityQueue={exports:{}};(function(e,r){(function(t){e.exports=t()})(function(){return function t(n,a,s){function o(h,c){if(!a[h]){if(!n[h]){var u=typeof commonjsRequire=="function"&&commonjsRequire;if(!c&&u)return u(h,!0);if(l)return l(h,!0);var d=new Error("Cannot find module '"+h+"'");throw d.code="MODULE_NOT_FOUND",d}var g=a[h]={exports:{}};n[h][0].call(g.exports,function(m){var w=n[h][1][m];return o(w||m)},g,g.exports,t,n,a,s)}return a[h].exports}for(var l=typeof commonjsRequire=="function"&&commonjsRequire,f=0;f<s.length;f++)o(s[f]);return o}({1:[function(t,n,a){var s,o,l,f,h,c=function(d,g){for(var m in g)u.call(g,m)&&(d[m]=g[m]);function w(){this.constructor=d}return w.prototype=g.prototype,d.prototype=new w,d.__super__=g.prototype,d},u={}.hasOwnProperty;s=t("./PriorityQueue/AbstractPriorityQueue"),o=t("./PriorityQueue/ArrayStrategy"),f=t("./PriorityQueue/BinaryHeapStrategy"),l=t("./PriorityQueue/BHeapStrategy"),h=function(d){c(g,d);function g(m){m||(m={}),m.strategy||(m.strategy=f),m.comparator||(m.comparator=function(w,v){return(w||0)-(v||0)}),g.__super__.constructor.call(this,m)}return g}(s),h.ArrayStrategy=o,h.BinaryHeapStrategy=f,h.BHeapStrategy=l,n.exports=h},{"./PriorityQueue/AbstractPriorityQueue":2,"./PriorityQueue/ArrayStrategy":3,"./PriorityQueue/BHeapStrategy":4,"./PriorityQueue/BinaryHeapStrategy":5}],2:[function(t,n,a){n.exports=function(){function s(o){var l;if((o!=null?o.strategy:void 0)==null)throw"Must pass options.strategy, a strategy";if((o!=null?o.comparator:void 0)==null)throw"Must pass options.comparator, a comparator";this.priv=new o.strategy(o),this.length=(o!=null&&(l=o.initialValues)!=null?l.length:void 0)||0}return s.prototype.queue=function(o){this.length++,this.priv.queue(o)},s.prototype.dequeue=function(o){if(!this.length)throw"Empty queue";return this.length--,this.priv.dequeue()},s.prototype.peek=function(o){if(!this.length)throw"Empty queue";return this.priv.peek()},s.prototype.clear=function(){return this.length=0,this.priv.clear()},s}()},{}],3:[function(t,n,a){var s;s=function(o,l,f){var h,c,u;for(c=0,h=o.length;c<h;)u=c+h>>>1,f(o[u],l)>=0?c=u+1:h=u;return c},n.exports=function(){function o(l){var f;this.options=l,this.comparator=this.options.comparator,this.data=((f=this.options.initialValues)!=null?f.slice(0):void 0)||[],this.data.sort(this.comparator).reverse()}return o.prototype.queue=function(l){var f;f=s(this.data,l,this.comparator),this.data.splice(f,0,l)},o.prototype.dequeue=function(){return this.data.pop()},o.prototype.peek=function(){return this.data[this.data.length-1]},o.prototype.clear=function(){this.data.length=0},o}()},{}],4:[function(t,n,a){n.exports=function(){function s(o){var l,f,h,c,u,d,g,m;for(this.comparator=(o!=null?o.comparator:void 0)||function(w,v){return w-v},this.pageSize=(o!=null?o.pageSize:void 0)||512,this.length=0,g=0;1<<g<this.pageSize;)g+=1;if(1<<g!==this.pageSize)throw"pageSize must be a power of two";for(this._shift=g,this._emptyMemoryPageTemplate=l=[],f=0,u=this.pageSize;0<=u?f<u:f>u;0<=u?++f:--f)l.push(null);if(this._memory=[],this._mask=this.pageSize-1,o.initialValues)for(d=o.initialValues,h=0,c=d.length;h<c;h++)m=d[h],this.queue(m)}return s.prototype.queue=function(o){this.length+=1,this._write(this.length,o),this._bubbleUp(this.length,o)},s.prototype.dequeue=function(){var o,l;return o=this._read(1),l=this._read(this.length),this.length-=1,this.length>0&&(this._write(1,l),this._bubbleDown(1,l)),o},s.prototype.peek=function(){return this._read(1)},s.prototype.clear=function(){this.length=0,this._memory.length=0},s.prototype._write=function(o,l){var f;for(f=o>>this._shift;f>=this._memory.length;)this._memory.push(this._emptyMemoryPageTemplate.slice(0));return this._memory[f][o&this._mask]=l},s.prototype._read=function(o){return this._memory[o>>this._shift][o&this._mask]},s.prototype._bubbleUp=function(o,l){var f,h,c,u;for(f=this.comparator;o>1&&(h=o&this._mask,o<this.pageSize||h>3?c=o&~this._mask|h>>1:h<2?(c=o-this.pageSize>>this._shift,c+=c&~(this._mask>>1),c|=this.pageSize>>1):c=o-2,u=this._read(c),!(f(u,l)<0));)this._write(c,l),this._write(o,u),o=c},s.prototype._bubbleDown=function(o,l){var f,h,c,u,d;for(d=this.comparator;o<this.length;)if(o>this._mask&&!(o&this._mask-1)?f=h=o+2:o&this.pageSize>>1?(f=(o&~this._mask)>>1,f|=o&this._mask>>1,f=f+1<<this._shift,h=f+1):(f=o+(o&this._mask),h=f+1),f!==h&&h<=this.length)if(c=this._read(f),u=this._read(h),d(c,l)<0&&d(c,u)<=0)this._write(f,l),this._write(o,c),o=f;else if(d(u,l)<0)this._write(h,l),this._write(o,u),o=h;else break;else if(f<=this.length)if(c=this._read(f),d(c,l)<0)this._write(f,l),this._write(o,c),o=f;else break;else break},s}()},{}],5:[function(t,n,a){n.exports=function(){function s(o){var l;this.comparator=(o!=null?o.comparator:void 0)||function(f,h){return f-h},this.length=0,this.data=((l=o.initialValues)!=null?l.slice(0):void 0)||[],this._heapify()}return s.prototype._heapify=function(){var o,l,f;if(this.data.length>0)for(o=l=1,f=this.data.length;1<=f?l<f:l>f;o=1<=f?++l:--l)this._bubbleUp(o)},s.prototype.queue=function(o){this.data.push(o),this._bubbleUp(this.data.length-1)},s.prototype.dequeue=function(){var o,l;return l=this.data[0],o=this.data.pop(),this.data.length>0&&(this.data[0]=o,this._bubbleDown(0)),l},s.prototype.peek=function(){return this.data[0]},s.prototype.clear=function(){this.length=0,this.data.length=0},s.prototype._bubbleUp=function(o){for(var l,f;o>0&&(l=o-1>>>1,this.comparator(this.data[o],this.data[l])<0);)f=this.data[l],this.data[l]=this.data[o],this.data[o]=f,o=l},s.prototype._bubbleDown=function(o){var l,f,h,c,u;for(l=this.data.length-1;f=(o<<1)+1,c=f+1,h=o,f<=l&&this.comparator(this.data[f],this.data[h])<0&&(h=f),c<=l&&this.comparator(this.data[c],this.data[h])<0&&(h=c),h!==o;)u=this.data[h],this.data[h]=this.data[o],this.data[o]=u,o=h},s}()},{}]},{},[1])(1)})})(priorityQueue);const PriorityQueue=priorityQueue.exports,dxs=[1,0,-1,0,1,1,-1,-1],dys=[0,1,0,-1,1,-1,1,-1];function fromWaterShed(e={}){let{points:r,mask:t,image:n,fillMaxValue:a=this.maxValue,invert:s=!1}=e,o=n||this;o.checkProcessable("fromWaterShed",{bitDepth:[8,16],components:1}),s=!s,r||(r=o.getLocalMaxima({invert:s,mask:t}));let l=s?0:1,f=new Int16Array(o.size),h=o.width,c=o.height,u=new PriorityQueue({comparator:(d,g)=>d[2]-g[2],strategy:PriorityQueue.BinaryHeapStrategy});for(let d=0;d<r.length;d++){let g=r[d][0]+r[d][1]*h;f[g]=d+1;let m=o.data[g];(s&&m<=a||!s&&m>=a)&&u.queue([r[d][0],r[d][1],m])}for(;u.length>0;){let d=u.dequeue(),g=d[0]+d[1]*h;for(let m=0;m<4;m++){let w=d[0]+dxs[m],v=d[1]+dys[m];if(w>=0&&v>=0&&w<h&&v<c){let x=w+v*h;if(!t||t.getBit(x)===l){let S=o.data[x];(s&&S<=a||!s&&S>=a)&&f[x]===0&&(f[x]=f[g],u.queue([d[0]+dxs[m],d[1]+dys[m],S]))}}}}return new RoiMap(o,f)}class RoiManager{constructor(r,t={}){this._image=r,this._options=t,this._options.label||(this._options.label="default"),this._layers={},this._painted=null}fromMaxima(r={}){let t=Object.assign({},this._options,r),n=fromMaxima.call(this._image,r);this._layers[t.label]=new RoiLayer(n,t)}fromPoints(r,t={}){let n=Object.assign({},this._options,t),a=fromPoints.call(this._image,r,t);return this._layers[n.label]=new RoiLayer(a,n),this}putMap(r,t={}){let n=new RoiMap(this._image,r),a=Object.assign({},this._options,t);return this._layers[a.label]=new RoiLayer(n,a),this}fromWaterShed(r={}){let t=Object.assign({},this._options,r),n=fromWaterShed.call(this._image,r);this._layers[t.label]=new RoiLayer(n,t)}fromMask(r,t={}){let n=Object.assign({},this._options,t),a=fromMask.call(this._image,r,t);return this._layers[n.label]=new RoiLayer(a,n),this}fromMaskConnectedComponentLabelingAlgorithm(r,t={}){let n=Object.assign({},this._options,t),a=fromMaskConnectedComponentLabelingAlgorithm.call(this._image,r,t);return this._layers[n.label]=new RoiLayer(a,n),this}getMap(r={}){let t=Object.assign({},this._options,r);return this._assertLayerWithLabel(t.label),this._layers[t.label].roiMap}rowsInfo(r={}){return this.getMap(r).rowsInfo()}colsInfo(r={}){return this.getMap(r).rowsInfo()}getRoiIds(r={}){let t=this.getRois(r);if(t){let n=new Array(t.length);for(let a=0;a<t.length;a++)n[a]=t[a].id;return n}throw new Error("ROIs not found")}getRois(r={}){let{label:t=this._options.label,positive:n=!0,negative:a=!0,minSurface:s=0,maxSurface:o=Number.POSITIVE_INFINITY,minWidth:l=0,maxWidth:f=Number.POSITIVE_INFINITY,minHeight:h=0,maxHeight:c=Number.POSITIVE_INFINITY,minRatio:u=0,maxRatio:d=Number.POSITIVE_INFINITY}=r;if(!this._layers[t])throw new Error(`this Roi layer (${t}) does not exist`);const g=this._layers[t].roi,m=[];for(const w of g)(w.id<0&&a||w.id>0&&n)&&w.surface>=s&&w.surface<=o&&w.width>=l&&w.width<=f&&w.height>=h&&w.height<=c&&w.ratio>=u&&w.ratio<=d&&m.push(w);return m}getRoi(r,t={}){const{label:n=this._options.label}=t;if(!this._layers[n])throw new Error(`this Roi layer (${n}) does not exist`);const a=this._layers[n].roi.find(s=>s.id===r);if(!a)throw new Error(`found no Roi with id ${r}`);return a}getMasks(r={}){let t=this.getRois(r),n=new Array(t.length);for(let a=0;a<t.length;a++)n[a]=t[a].getMask(r);return n}getAnalysisMasks(r={}){const{analysisProperty:t}=r;let n=`${t}Mask`,a=this.getRois(r);return a.length===0||!a[0][n]?[]:a.map(s=>s[n])}getData(r={}){let t=Object.assign({},this._options,r);return this._assertLayerWithLabel(t.label),this._layers[t.label].roiMap.data}paint(r={}){let{labelProperty:t,analysisProperty:n}=r;this._painted||(this._painted=this._image.rgba8());let a=this.getMasks(r);if(t){const s=this.getRois(r);r.labels=s.map(h=>deepValue(h,t));const o=Math.max(...r.labels);let l=!1,f=!1;if(t.includes("surface")?l=!0:/(?:perimeter|min|max|external|width|height|length)/.test(t)&&(f=!0),isFinite(o)){let h="";if(r.unit!=="pixel"&&r.pixelSize&&(f||l)){h=l?`${r.unit}^2`:r.unit;let c=l?"m^2":"m",u=l?r.pixelSize**2:r.pixelSize;const d=Qty.swiftConverter(c,h);r.labels=r.labels.map(g=>d(u*g))}o>50?r.labels=r.labels.map(c=>Math.round(c)+h):o>10?r.labels=r.labels.map(c=>c.toFixed(1)+h):r.labels=r.labels.map(c=>c.toFixed(2)+h)}r.labelsPosition=s.map(h=>[h.meanX,h.meanY])}if(this._painted.paintMasks(a,r),n){let s=this.getAnalysisMasks(r);this._painted.paintMasks(s,{color:r.analysisColor,alpha:r.analysisAlpha})}return this._painted}getMask(r={}){let t=new Image$1(this._image.width,this._image.height,{kind:"BINARY"}),n=this.getMasks(r);for(let a=0;a<n.length;a++){let s=n[a];for(let o=0;o<s.width;o++)for(let l=0;l<s.height;l++)s.getBitXY(o,l)&&t.setBitXY(o+s.position[0],l+s.position[1])}return t}resetPainted(r={}){const{image:t}=r;t?this._painted=this.image.rgba8():this._painted=this._image.rgba8()}mergeRoi(r={}){const t=this.getMap(r);return t.mergeRoi(r),this.putMap(t.data,r),this}mergeRois(r,t={}){if(!Array.isArray(r)||r.some(a=>!Number.isInteger(a)))throw new Error("Roi ids must be an array of integers");if(r.length<2)throw new Error("Roi ids must have at least two elements");if(new Set(r).size!==r.length)throw new Error("Roi ids must be all different");r.forEach(a=>this.getRoi(a));const n=this.getMap(t);return n.mergeRois(r),this.putMap(n.data,t),this}findCorrespondingRoi(r,t={}){let n=this.getRois(t),a=[];for(let s=0;s<n.length;s++){let o=n[s],l=o.minX,f=o.minY,h=o.points,c=Math.sign(o.id),u=correspondingRoisInformation(l,f,h,r,c);a.push(u)}return a}_assertLayerWithLabel(r){if(!this._layers[r])throw new Error(`no layer with label ${r}`)}}function correspondingRoisInformation(e,r,t,n,a){let s={id:[],surface:[],roiSurfaceCovered:[],same:0,opposite:0,total:0};for(let o=0;o<t.length;o++){let l=t[o],f=l[0],h=l[1],c=f+e+(h+r)*n.width,u=n.data[c];(u>0||u<0)&&(s.id.includes(u)?s.surface[s.id.indexOf(u)]+=1:(s.id.push(u),s.surface.push(1)))}for(let o=0;o<s.id.length;o++)Math.sign(s.id[o])===a?s.same+=s.surface[o]:s.opposite+=s.surface[o],s.roiSurfaceCovered[o]=s.surface[o]/t.length;return s.total=s.opposite+s.same,s}const objectToString=Object.prototype.toString;class Image$1{constructor(r,t,n,a){if(arguments.length===1?(a=r,{width:r,height:t,data:n}=a):n&&!n.length&&(a=n,{data:n}=a),r===void 0&&(r=1),t===void 0&&(t=1),a===void 0&&(a={}),typeof a!="object"||a===null)throw new TypeError("options must be an object");if(!Number.isInteger(r)||r<=0)throw new RangeError("width must be a positive integer");if(!Number.isInteger(t)||t<=0)throw new RangeError("height must be a positive integer");const{kind:s=RGBA}=a;if(typeof s!="string")throw new TypeError("kind must be a string");const o=getKind(s),l=Object.assign({},a);for(const w in o)l[w]===void 0&&(l[w]=o[w]);verifyKindDefinition(l);const{components:f,bitDepth:h,colorModel:c}=l,u=l.alpha+0,d=r*t,g=f+u,m=h===32?Number.MAX_VALUE:2**h-1;if(n===void 0)n=createPixelArray(d,f,u,g,h,m);else{const w=getTheoreticalPixelArraySize(d,g,h);if(n.length!==w)throw new RangeError(`incorrect data size: ${n.length}. Should be ${w}`)}this.width=r,this.height=t,this.data=n,this.size=d,this.components=f,this.alpha=u,this.bitDepth=h,this.maxValue=m,this.colorModel=c,this.channels=g,this.meta=a.meta||{},Object.defineProperty(this,"parent",{enumerable:!1,writable:!0,configurable:!0,value:a.parent||null}),this.position=a.position||[0,0],this.computed=null,this.sizes=[this.width,this.height],this.multiplierX=this.channels,this.multiplierY=this.channels*this.width,this.isClamped=this.bitDepth<32,this.borderSizes=[0,0]}get[Symbol.toStringTag](){return"IJSImage"}static isImage(r){return objectToString.call(r)==="[object IJSImage]"}static fromCanvas(r){const n=r.getContext("2d").getImageData(0,0,r.width,r.height);return new Image$1(n.width,n.height,n.data)}static createFrom(r,t){const n=getImageParameters(r);return Object.assign(n,{parent:r,position:[0,0]},t),new Image$1(n)}getRoiManager(r){return new RoiManager(this,r)}clone(){const r=this.data.slice();return new Image$1(this.width,this.height,r,this)}apply(r){for(let t=0;t<this.height;t++)for(let n=0;n<this.width;n++){let a=(t*this.width+n)*this.channels;r.call(this,a)}}}setValueMethods(Image$1);setBitMethods(Image$1);setExportMethods(Image$1);Image$1.prototype.checkProcessable=checkProcessable;Image$1.prototype.getRGBAData=getRGBAData;Image$1.load=load$1;Image$1.extendMethod=extendMethod;Image$1.extendProperty=extendProperty;extend$1(Image$1);var workerTemplate$1={},worker$1=function(){self.window=self;function e(){this._listeners={}}e.prototype.on=function(t,n){if(this._listeners[t])throw new RangeError("there is already a listener for "+t);if(typeof n!="function")throw new TypeError("callback argument must be a function");this._listeners[t]=n},e.prototype._send=function(t,n,a){a===void 0?a=[]:Array.isArray(a)||(a=[a]),self.postMessage({id:t,data:n},a)},e.prototype._trigger=function(t,n){if(!this._listeners[t])throw new Error("event "+t+" is not defined");this._listeners[t].apply(null,n)};var r=new e;self.onmessage=function(t){switch(t.data.action){case"exec":t.data.args.unshift(function(n,a){r._send(t.data.id,n,a)}),r._trigger(t.data.event,t.data.args);break;case"ping":r._send(t.data.id,"pong");break;default:throw new Error("unexpected action: "+t.data.action)}}},workerStr=worker$1.toString().split('"CODE";');workerTemplate$1.newWorkerURL=function e(r,t){var n=new Blob(["(",workerStr[0],"importScripts.apply(self, "+JSON.stringify(t)+`);
`,"(",r,")();",workerStr[1],")();"],{type:"application/javascript"});return URL.createObjectURL(n)};var workerTemplate=workerTemplate$1,CORES=navigator.hardwareConcurrency||1;function WorkerManager(e,r){if(typeof e!="string"&&typeof e!="function")throw new TypeError("func argument must be a function");if(r===void 0&&(r={}),typeof r!="object"||r===null)throw new TypeError("options argument must be an object");this._workerCode=e.toString(),r.maxWorkers===void 0||r.maxWorkers==="auto"?this._numWorkers=Math.min(CORES-1,1):r.maxWorkers>0?this._numWorkers=Math.min(r.maxWorkers,CORES):this._numWorkers=CORES,this._workers=new Map,this._timeout=r.timeout||0,this._terminateOnError=!!r.terminateOnError;var t=r.deps;typeof t=="string"&&(t=[t]),Array.isArray(t)||(t=void 0),this._id=0,this._terminated=!1,this._working=0,this._waiting=[],this._init(t)}WorkerManager.prototype._init=function(e){for(var r=workerTemplate.newWorkerURL(this._workerCode,e),t=0;t<this._numWorkers;t++){var n=new Worker(r);n.onmessage=this._onmessage.bind(this,n),n.onerror=this._onerror.bind(this,n),n.running=!1,n.id=t,this._workers.set(n,null)}URL.revokeObjectURL(r)};WorkerManager.prototype._onerror=function(e,r){if(!this._terminated){this._working--,e.running=!1;var t=this._workers.get(e);t&&t[1](r.message),this._workers.set(e,null),this._terminateOnError?this.terminate():this._exec()}};WorkerManager.prototype._onmessage=function(e,r){if(!this._terminated){this._working--,e.running=!1;var t=this._workers.get(e);t&&t[0](r.data.data),this._workers.set(e,null),this._exec()}};WorkerManager.prototype._exec=function(){for(var e of this._workers.keys()){if(this._working===this._numWorkers||this._waiting.length===0)return;if(!e.running)for(var r=0;r<this._waiting.length;r++){var t=this._waiting[r];if(!(typeof t[4]=="number"&&t[4]!==e.id)){this._waiting.splice(r,1),e.postMessage({action:"exec",event:t[0],args:t[1]},t[2]),e.running=!0,e.time=Date.now(),this._workers.set(e,t[3]),this._working++;break}}}};WorkerManager.prototype.terminate=function(){if(!this._terminated){for(var e of this._workers)e[0].terminate(),e[1]&&e[1][1](new Error("Terminated"));this._workers.clear(),this._waiting=[],this._working=0,this._terminated=!0}};WorkerManager.prototype.postAll=function(e,r){if(this._terminated)throw new Error("Cannot post (terminated)");var t=[];for(var n of this._workers.keys())t.push(this.post(e,r,[],n.id));return Promise.all(t)};WorkerManager.prototype.post=function(e,r,t,n){r===void 0&&(r=[]),t===void 0&&(t=[]),Array.isArray(r)||(r=[r]),Array.isArray(t)||(t=[t]);var a=this;return new Promise(function(s,o){if(a._terminated)throw new Error("Cannot post (terminated)");a._waiting.push([e,r,t,[s,o],n]),a._exec()})};var src=WorkerManager;const defaultOptions={regression:{kernelType:"polynomial",kernelOptions:{degree:2,constant:1}},threshold:.02,roi:{minSurface:100,positive:!1},sampling:20,include:[]};function run(e,r,t){r=Object.assign({},defaultOptions,r);const n=this.manager;return Array.isArray(e)?Promise.all(e.map(function(a){const s=runOnce(n,a,r);return typeof t=="function"&&s.then(t),s})):runOnce(n,e,r)}function runOnce(e,r,t){return e.post("data",[r,t]).then(function(n){for(let a in n)n[a]=new Image$1(n[a]);return n})}function work(){worker.on("data",function(e,r,t){r=new IJS(r);const n={},a=[],s=r.grey(),o=s.sobelFilter();g("sobel",o);const l=o.level().mask({threshold:t.threshold});g("mask",l);const f=o.getRoiManager();f.fromMask(l);const h=f.getMask(t.roi);g("realMask",h);const c=s.getPixelsGrid({sampling:t.sampling,mask:h}),u=r.getBackground(c.xyS,c.zS,t.regression);g("background",u);const d=r.subtract(u);n.result=d,a.push(d.data.buffer),e(n,a);function g(m,w){t.include.includes(m)&&(n[m]=w,a.push(w.data.buffer))}})}const background={run,work};function extend(e){e.extendMethod("background",background)}class Worker$1{constructor(){this._url=null,this._deps=[null]}checkUrl(){if(this._url===null)throw new Error("image worker must be initialized with an URL")}get url(){return this._url}set url(r){if(typeof r!="string")throw new TypeError("worker URL must be a string");this._url=r,this._deps[0]=r}static extendMethod(r,t){let n,a,s={};function o(...l){return n||(this.checkUrl(),a=this.url,n=new src(t.work,{deps:a}),s.manager=n),t.run.call(s,...l)}o.reset=function(){n&&(n.terminate(),n=new src(t.work,{deps:a}),s.manager=n)},Worker$1.prototype[r]=o}}extend(Worker$1);new Worker$1;let wasm;const heap=new Array(32).fill(void 0);heap.push(void 0,null,!0,!1);function getObject(e){return heap[e]}let heap_next=heap.length;function dropObject(e){e<36||(heap[e]=heap_next,heap_next=e)}function takeObject(e){const r=getObject(e);return dropObject(e),r}const cachedTextDecoder=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});cachedTextDecoder.decode();let cachedUint8Memory0;function getUint8Memory0(){return cachedUint8Memory0.byteLength===0&&(cachedUint8Memory0=new Uint8Array(wasm.memory.buffer)),cachedUint8Memory0}function getStringFromWasm0(e,r){return cachedTextDecoder.decode(getUint8Memory0().subarray(e,e+r))}let WASM_VECTOR_LEN=0;function passArray8ToWasm0(e,r){const t=r(e.length*1);return getUint8Memory0().set(e,t/1),WASM_VECTOR_LEN=e.length,t}let cachedInt32Memory0;function getInt32Memory0(){return cachedInt32Memory0.byteLength===0&&(cachedInt32Memory0=new Int32Array(wasm.memory.buffer)),cachedInt32Memory0}let cachedUint32Memory0;function getUint32Memory0(){return cachedUint32Memory0.byteLength===0&&(cachedUint32Memory0=new Uint32Array(wasm.memory.buffer)),cachedUint32Memory0}function getArrayU32FromWasm0(e,r){return getUint32Memory0().subarray(e/4,e/4+r)}let cachedFloat64Memory0;function getFloat64Memory0(){return cachedFloat64Memory0.byteLength===0&&(cachedFloat64Memory0=new Float64Array(wasm.memory.buffer)),cachedFloat64Memory0}function passArrayF64ToWasm0(e,r){const t=r(e.length*8);return getFloat64Memory0().set(e,t/8),WASM_VECTOR_LEN=e.length,t}function getArrayF64FromWasm0(e,r){return getFloat64Memory0().subarray(e/8,e/8+r)}function addHeapObject(e){heap_next===heap.length&&heap.push(heap.length+1);const r=heap_next;return heap_next=heap[r],heap[r]=e,r}const cachedTextEncoder=new TextEncoder("utf-8"),encodeString=typeof cachedTextEncoder.encodeInto=="function"?function(e,r){return cachedTextEncoder.encodeInto(e,r)}:function(e,r){const t=cachedTextEncoder.encode(e);return r.set(t),{read:e.length,written:t.length}};function passStringToWasm0(e,r,t){if(t===void 0){const l=cachedTextEncoder.encode(e),f=r(l.length);return getUint8Memory0().subarray(f,f+l.length).set(l),WASM_VECTOR_LEN=l.length,f}let n=e.length,a=r(n);const s=getUint8Memory0();let o=0;for(;o<n;o++){const l=e.charCodeAt(o);if(l>127)break;s[a+o]=l}if(o!==n){o!==0&&(e=e.slice(o)),a=t(a,n,n=o+e.length*3);const l=getUint8Memory0().subarray(a+o,a+n);o+=encodeString(e,l).written}return WASM_VECTOR_LEN=o,a}class Network{static __wrap(r){const t=Object.create(Network.prototype);return t.ptr=r,t}__destroy_into_raw(){const r=this.ptr;return this.ptr=0,r}free(){const r=this.__destroy_into_raw();wasm.__wbg_network_free(r)}constructor(r){const t=passArray8ToWasm0(r,wasm.__wbindgen_malloc),n=WASM_VECTOR_LEN,a=wasm.network_new(t,n);return Network.__wrap(a)}get shape(){try{const a=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.network_shape(a,this.ptr);var r=getInt32Memory0()[a/4+0],t=getInt32Memory0()[a/4+1],n=getArrayU32FromWasm0(r,t).slice();return wasm.__wbindgen_free(r,t*4),n}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}feed_forward(r){try{const s=wasm.__wbindgen_add_to_stack_pointer(-16),o=passArrayF64ToWasm0(r,wasm.__wbindgen_malloc),l=WASM_VECTOR_LEN;wasm.network_feed_forward(s,this.ptr,o,l);var t=getInt32Memory0()[s/4+0],n=getInt32Memory0()[s/4+1],a=getArrayF64FromWasm0(t,n).slice();return wasm.__wbindgen_free(t,n*8),a}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}}async function load(e,r){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,r)}catch(n){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await e.arrayBuffer();return await WebAssembly.instantiate(t,r)}else{const t=await WebAssembly.instantiate(e,r);return t instanceof WebAssembly.Instance?{instance:t,module:e}:t}}function getImports(){const e={};return e.wbg={},e.wbg.__wbg_new_693216e109162396=function(){const r=new Error;return addHeapObject(r)},e.wbg.__wbg_stack_0ddaca5d1abfb52f=function(r,t){const n=getObject(t).stack,a=passStringToWasm0(n,wasm.__wbindgen_malloc,wasm.__wbindgen_realloc),s=WASM_VECTOR_LEN;getInt32Memory0()[r/4+1]=s,getInt32Memory0()[r/4+0]=a},e.wbg.__wbg_error_09919627ac0992f5=function(r,t){try{console.error(getStringFromWasm0(r,t))}finally{wasm.__wbindgen_free(r,t)}},e.wbg.__wbindgen_object_drop_ref=function(r){takeObject(r)},e.wbg.__wbindgen_throw=function(r,t){throw new Error(getStringFromWasm0(r,t))},e}function finalizeInit(e,r){return wasm=e.exports,init.__wbindgen_wasm_module=r,cachedFloat64Memory0=new Float64Array(wasm.memory.buffer),cachedInt32Memory0=new Int32Array(wasm.memory.buffer),cachedUint32Memory0=new Uint32Array(wasm.memory.buffer),cachedUint8Memory0=new Uint8Array(wasm.memory.buffer),wasm.__wbindgen_start(),wasm}async function init(e){typeof e>"u"&&(e=new URL("/neural-rs/neural-emnist/assets/neural_web_bg.669b708d.wasm",self.location));const r=getImports();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:t,module:n}=await load(await e,r);return finalizeInit(t,n)}function create_fragment$1(e){let r,t;return{c(){r=element("canvas"),attr(r,"width",e[0]),attr(r,"height",e[1]),attr(r,"style",t=`border: 1px solid lightgray; cursor: ${e[2]?"crosshair":"not-allowed"};`)},m(n,a){insert$1(n,r,a),e[9](r)},p(n,[a]){a&1&&attr(r,"width",n[0]),a&2&&attr(r,"height",n[1]),a&4&&t!==(t=`border: 1px solid lightgray; cursor: ${n[2]?"crosshair":"not-allowed"};`)&&attr(r,"style",t)},i:noop,o:noop,d(n){n&&detach(r),e[9](null)}}}const LINE_WIDTH=20;function scaleCharacter(e,r,t){var a,s,o,l,f,h,c,u,d,g,m,w;let n=Array(t).fill(null).map(()=>[]);for(let v=0;v<t;v++)for(let x=0;x<t;x++){let S=x*((r-1)/(t-1)),y=v*((r-1)/(t-1)),_=Math.floor(S),E=Math.ceil(S),R=Math.floor(y),T=Math.ceil(y),M,I,b;if(_==E?(I=(s=(a=e[R])==null?void 0:a[_])!=null?s:0,b=(l=(o=e[T])==null?void 0:o[_])!=null?l:0):(I=(S-_)*((h=(f=e[R])==null?void 0:f[E])!=null?h:0)+(E-S)*((u=(c=e[R])==null?void 0:c[_])!=null?u:0),b=(S-_)*((g=(d=e[T])==null?void 0:d[E])!=null?g:0)+(E-S)*((w=(m=e[T])==null?void 0:m[_])!=null?w:0)),R==T?M=I:M=(y-R)*b+(T-y)*I,Number.isNaN(M)||M==null){console.error("Bilinear interpolation error: Intesity is NaN or undefined.");debugger}n[v][x]=M}return n}function instance$1(e,r,t){let{width:n}=r,{height:a}=r,{characterSide:s}=r,{debug:o}=r,{editable:l}=r,f,h,c=!1,u=0,d=0,g=0,m=0,w,v;onMount(()=>{h=f.getContext("2d"),h.lineWidth=LINE_WIDTH,f.addEventListener("mousedown",M=>x(M.clientX,M.clientY)),f.addEventListener("mousemove",M=>y(M.clientX,M.clientY)),f.addEventListener("mouseup",S),f.addEventListener("mouseleave",S),f.addEventListener("touchstart",M=>{M.preventDefault(),x(M.touches[0].clientX,M.touches[0].clientY)}),f.addEventListener("touchmove",M=>{M.preventDefault(),y(M.touches[0].clientX,M.touches[0].clientY)}),f.addEventListener("touchend",S),f.addEventListener("touchcancel",S),u=n,d=a});function x(M,I){c=!0,y(M,I)}function S(){c=!1,w=null,v=null}function y(M,I){if(!c||!l)return;let b=f.getBoundingClientRect(),k=M-b.left,D=I-b.top;k-LINE_WIDTH/2<=u&&(u=k-LINE_WIDTH/2),k+LINE_WIDTH/2>=g&&(g=k+LINE_WIDTH/2),D-LINE_WIDTH/2<=d&&(d=D-LINE_WIDTH/2),D+LINE_WIDTH/2>=m&&(m=D+LINE_WIDTH/2),w!=null&&v!=null&&(h.beginPath(),h.moveTo(w,v),h.lineTo(k,D),h.stroke(),h.closePath()),h.beginPath(),h.arc(k,D,LINE_WIDTH/2,0,2*Math.PI),h.fill(),h.closePath(),w=k,v=D}const _=M=>{let I=Math.max(M.width/n,M.height/a);t(3,f.width=M.width/I,f),t(3,f.height=M.height/I,f),u=0,d=0,g=f.width,m=f.height,h.drawImage(M,0,0,f.width,f.height),h.lineWidth=LINE_WIDTH},E=()=>{let M=h.getImageData(u,d,g-u,m-d),I=Array(M.height).fill(null).map(()=>[]);for(let $=0;$<M.data.length/4;$++){let P=(M.data[$*4]+M.data[$*4+1]+M.data[$*4+2])/3/255,O=M.data[$*4+3]/255;I[Math.floor($/M.width)][$%M.width]=Math.round((1-P)*O)}let b=[],k;for(let $=0;$<I.length;$++)I[$].some(P=>P>0)?k==null&&(k=$):k!=null&&(b.push([k,$]),k=null);k!=null&&b.push([k,I.length]);let D=[];for(let[$,P]of b){o&&(h.lineWidth=2,h.strokeStyle="red",h.beginPath(),h.moveTo(0,$+d),h.lineTo(f.width,$+d),h.moveTo(0,P+d),h.lineTo(f.width,P+d),h.closePath(),h.stroke(),h.strokeStyle="black",h.lineWidth=LINE_WIDTH);let O=I.slice($,P),ee=O[0].length,q=[],z,W;for(let se=0;se<ee;se++)O.map(N=>N[se]).some(N=>N>0)?z==null&&(z=se):z!=null&&(W!=null&&(se-W)/(W-z)>.05?(q.push([z,W]),z=null,W=null):W==null&&(W=se));z!=null&&q.push([z,ee]);let H=[];for(let[se,[N,Y]]of q.entries()){o&&(h.lineWidth=2,h.strokeStyle="blue",h.beginPath(),h.moveTo(N+u,$+d),h.lineTo(N+u,P+d),h.moveTo(Y+u,$+d),h.lineTo(Y+u,P+d),h.closePath(),h.stroke(),h.strokeStyle="black",h.lineWidth=LINE_WIDTH);let L=O.map(K=>K.filter((V,pe)=>pe>=N&&pe<Y)),U=0,G=L.length-1;for(;L[0].every(K=>K==0);)L.shift(),U++;for(;L[L.length-1].every(K=>K==0);)L.pop(),G--;o&&(h.lineWidth=2,h.strokeStyle="green",h.beginPath(),h.moveTo(N+u,U+$+d),h.lineTo(Y+u,U+$+d),h.moveTo(N+u,G+$+d),h.lineTo(Y+u,G+$+d),h.closePath(),h.stroke(),h.strokeStyle="black",h.lineWidth=LINE_WIDTH);let te=L[0].length,de=L.length,Z=Math.max(te,de);if(Z*=1.2,Z=Math.round(Z),te>Z||de>Z){console.error(`Invalid side lengths: ${te}, ${de} should be less than square ${Z}`);return}let ge=Z-te,ce=Z-de;L=L.map(K=>[...Array(Math.ceil(ge/2)).fill(0),...K,...Array(Math.floor(ge/2)).fill(0)]),L=[...Array(Math.ceil(ce/2)).fill(Array(Z).fill(0)),...L,...Array(Math.floor(ce/2)).fill(Array(Z).fill(0))];let ve=scaleCharacter(L,Z,s);H.push(ve);let be=q[se+1];be!=null&&H.push(be[0]-Y)}D.push(H)}return D},R=()=>{t(3,f.width=n,f),t(3,f.height=a,f),h.clearRect(0,0,f.width,f.height),h.fillStyle="black",h.strokeStyle="black",h.lineWidth=LINE_WIDTH,u=n,d=a,g=0,m=0};function T(M){binding_callbacks[M?"unshift":"push"](()=>{f=M,t(3,f)})}return e.$$set=M=>{"width"in M&&t(0,n=M.width),"height"in M&&t(1,a=M.height),"characterSide"in M&&t(4,s=M.characterSide),"debug"in M&&t(5,o=M.debug),"editable"in M&&t(2,l=M.editable)},[n,a,l,f,s,o,_,E,R,T]}class DrawCanvas extends SvelteComponent{constructor(r){super(),init$1(this,r,instance$1,create_fragment$1,safe_not_equal,{width:0,height:1,characterSide:4,debug:5,editable:2,drawImage:6,getLines:7,clear:8})}get drawImage(){return this.$$.ctx[6]}get getLines(){return this.$$.ctx[7]}get clear(){return this.$$.ctx[8]}}const defaultNetworkPath="/neural-rs/neural-emnist/assets/default.0e7958bf.nn64",App_svelte_svelte_type_style_lang="";function get_each_context(e,r,t){const n=e.slice();return n[35]=r[t],n[37]=t,n}function get_each_context_1(e,r,t){const n=e.slice();return n[38]=r[t],n}function create_else_block(e){let r=e[12]?"Klik op 'Herken' om de tekst te herkennen":"Press detect to recognize the text",t;return{c(){t=text(r)},m(n,a){insert$1(n,t,a)},p(n,a){a[0]&4096&&r!==(r=n[12]?"Klik op 'Herken' om de tekst te herkennen":"Press detect to recognize the text")&&set_data(t,r)},d(n){n&&detach(t)}}}function create_if_block_1(e){let r=e[12]?"Resultaat":"Result",t,n,a=e[7].map(e[24]).join("")+"",s;return{c(){t=text(r),n=text(": "),s=text(a)},m(o,l){insert$1(o,t,l),insert$1(o,n,l),insert$1(o,s,l)},p(o,l){l[0]&4096&&r!==(r=o[12]?"Resultaat":"Result")&&set_data(t,r),l[0]&192&&a!==(a=o[7].map(o[24]).join("")+"")&&set_data(s,a)},d(o){o&&detach(t),o&&detach(n),o&&detach(s)}}}function create_if_block(e){let r,t,n,a,s,o,l=e[7].filter(func_1),f=[];for(let u=0;u<l.length;u+=1)f[u]=create_each_block_1(get_each_context_1(e,l,u));let h=e[7].filter(func_2),c=[];for(let u=0;u<h.length;u+=1)c[u]=create_each_block(get_each_context(e,h,u));return{c(){r=element("table"),t=element("thead"),n=element("tr");for(let u=0;u<f.length;u+=1)f[u].c();a=space(),s=element("tbody"),o=element("tr");for(let u=0;u<c.length;u+=1)c[u].c();attr(n,"class","svelte-wboubd"),attr(t,"class","svelte-wboubd"),attr(o,"class","svelte-wboubd"),attr(s,"class","svelte-wboubd"),attr(r,"class","svelte-wboubd")},m(u,d){insert$1(u,r,d),append(r,t),append(t,n);for(let g=0;g<f.length;g+=1)f[g].m(n,null);append(r,a),append(r,s),append(s,o);for(let g=0;g<c.length;g+=1)c[g].m(o,null)},p(u,d){if(d[0]&128){l=u[7].filter(func_1);let g;for(g=0;g<l.length;g+=1){const m=get_each_context_1(u,l,g);f[g]?f[g].p(m,d):(f[g]=create_each_block_1(m),f[g].c(),f[g].m(n,null))}for(;g<f.length;g+=1)f[g].d(1);f.length=l.length}if(d[0]&384){h=u[7].filter(func_2);let g;for(g=0;g<h.length;g+=1){const m=get_each_context(u,h,g);c[g]?c[g].p(m,d):(c[g]=create_each_block(m),c[g].c(),c[g].m(o,null))}for(;g<c.length;g+=1)c[g].d(1);c.length=h.length}},d(u){u&&detach(r),destroy_each(f,u),destroy_each(c,u)}}}function create_each_block_1(e){let r,t=e[38]+"",n;return{c(){r=element("th"),n=text(t),attr(r,"class","svelte-wboubd")},m(a,s){insert$1(a,r,s),append(r,n)},p(a,s){s[0]&128&&t!==(t=a[38]+"")&&set_data(n,t)},d(a){a&&detach(r)}}}function create_each_block(e){let r,t=Math.round(e[8][e[37]]*100)/100+"",n;return{c(){r=element("td"),n=text(t),attr(r,"class","svelte-wboubd")},m(a,s){insert$1(a,r,s),append(r,n)},p(a,s){s[0]&256&&t!==(t=Math.round(a[8][a[37]]*100)/100+"")&&set_data(n,t)},d(a){a&&detach(r)}}}function create_fragment(e){var Ee;let r,t,n,a,s,o,l=((Ee=e[3])!=null?Ee:"Default network")+"",f,h,c,u,d,g,m,w,v,x,S,y,_,E,R,T,M=e[12]?"Afbeelding uploaden":"Upload image",I,b,k,D=e[12]?"Herken":"Detect",$,P,O,ee,q,z,W,H,se,N,Y,L,U,G,te,de,Z,ge,ce,ve,be,K,V,pe,me,xe,F,re,fe,he,X,ke;function Me(Q){e[21](Q)}function ie(Q){e[22](Q)}function oe(Q){e[23](Q)}let ue={width:1280,height:720,characterSide:28,debug:e[10],editable:e[11]};e[0]!==void 0&&(ue.getLines=e[0]),e[1]!==void 0&&(ue.drawImage=e[1]),e[2]!==void 0&&(ue.clear=e[2]),w=new DrawCanvas({props:ue}),binding_callbacks.push(()=>bind(w,"getLines",Me)),binding_callbacks.push(()=>bind(w,"drawImage",ie)),binding_callbacks.push(()=>bind(w,"clear",oe));function ne(Q,ye){return Q[7]!=null?create_if_block_1:create_else_block}let we=ne(e),_e=we(e),le=e[10]&&e[7]!=null&&create_if_block(e);return{c(){r=element("div"),t=element("div"),t.innerHTML=`<h2 style="font-size: 64px; font-weight: 600; margin: 0; margin-bottom: 12px;" class="svelte-wboubd">Demo</h2> 
        <div style="width: 96px; height: 7px; background-color: #3C79F5;" class="svelte-wboubd"></div>`,n=space(),a=element("div"),s=element("div"),o=element("p"),f=text(l),h=space(),c=element("button"),c.textContent="Upload custom",u=space(),d=element("input"),g=space(),m=element("div"),create_component(w.$$.fragment),y=space(),_=element("p"),_e.c(),E=space(),R=element("div"),T=element("button"),I=text(M),b=space(),k=element("button"),$=text(D),P=space(),O=element("button"),O.textContent="Reset",ee=space(),q=element("input"),z=space(),le&&le.c(),W=space(),H=element("div"),se=space(),N=element("div"),Y=element("div"),L=space(),U=element("div"),G=text("Kerning multiplier: "),te=text(e[6]),de=space(),Z=element("input"),ge=space(),ce=element("div"),ve=element("input"),be=space(),K=element("label"),K.textContent="Debug",V=space(),pe=element("input"),me=space(),xe=element("label"),xe.textContent="Demo",F=space(),re=element("div"),re.textContent="Demo sluiten",attr(t,"class","demo-header svelte-wboubd"),set_style(t,"display","none"),set_style(t,"padding","128px 128px 64px"),set_style(t,"width","calc(100% - 256px)"),set_style(o,"float","left"),set_style(o,"margin","0"),attr(o,"class","svelte-wboubd"),set_style(c,"float","right"),attr(c,"class","svelte-wboubd"),attr(d,"type","file"),set_style(d,"display","none"),attr(d,"class","svelte-wboubd"),set_style(s,"margin","8px 0"),attr(s,"class","svelte-wboubd"),attr(m,"class","canvas svelte-wboubd"),attr(_,"class","info svelte-wboubd"),set_style(_,"width","100%"),set_style(_,"margin","16px 0"),set_style(_,"text-align","center"),set_style(_,"white-space","pre-line"),attr(T,"class","button svelte-wboubd"),attr(k,"class","button svelte-wboubd"),attr(O,"class","button svelte-wboubd"),attr(R,"class","buttons svelte-wboubd"),set_style(R,"display","flex"),set_style(R,"justify-content","center"),set_style(R,"width","100%"),set_style(R,"margin-top","8px"),set_style(R,"margin-bottom","16px"),set_style(R,"gap","8px"),attr(q,"type","file"),attr(q,"accept",".jpg,.jpeg,.png"),set_style(q,"display","none"),attr(q,"class","svelte-wboubd"),attr(H,"class","svelte-wboubd"),attr(a,"class","main svelte-wboubd"),set_style(a,"display","flex"),set_style(a,"flex-direction","column"),set_style(a,"width","1282px"),attr(Y,"class","svelte-wboubd"),attr(Z,"type","range"),attr(Z,"min",1),attr(Z,"max",5),attr(Z,"step",.1),attr(Z,"class","svelte-wboubd"),set_style(U,"display","flex"),set_style(U,"gap","8px"),attr(U,"class","svelte-wboubd"),attr(ve,"type","checkbox"),attr(ve,"id","debug"),attr(ve,"class","svelte-wboubd"),attr(K,"for","debug"),attr(K,"class","svelte-wboubd"),attr(pe,"type","checkbox"),attr(pe,"id","demo"),attr(pe,"class","svelte-wboubd"),attr(xe,"for","demo"),attr(xe,"class","svelte-wboubd"),set_style(ce,"display","flex"),set_style(ce,"gap","8px"),attr(ce,"class","svelte-wboubd"),attr(N,"class","tools svelte-wboubd"),set_style(N,"display","flex"),set_style(N,"justify-content","space-between"),set_style(N,"align-items","center"),set_style(N,"position","absolute"),set_style(N,"left","0"),set_style(N,"right","0"),set_style(N,"bottom","0"),set_style(N,"padding","8px"),set_style(N,"gap","24px"),attr(re,"class","exit-demo svelte-wboubd"),set_style(re,"display","none"),set_style(re,"position","absolute"),set_style(re,"right","2px"),set_style(re,"bottom","2px"),set_style(re,"cursor","pointer"),set_style(re,"opacity","0.3"),attr(r,"class",fe=null_to_empty(`container ${e[12]?"demo":""}`)+" svelte-wboubd"),set_style(r,"display","flex"),set_style(r,"flex-direction","column"),set_style(r,"justify-content","flex-start")},m(Q,ye){insert$1(Q,r,ye),append(r,t),append(r,n),append(r,a),append(a,s),append(s,o),append(o,f),append(s,h),append(s,c),append(s,u),append(s,d),e[20](d),append(a,g),append(a,m),mount_component(w,m,null),append(a,y),append(a,_),_e.m(_,null),append(a,E),append(a,R),append(R,T),append(T,I),append(R,b),append(R,k),append(k,$),append(R,P),append(R,O),append(a,ee),append(a,q),e[25](q),append(a,z),le&&le.m(a,null),append(a,W),append(a,H),e[26](H),append(r,se),append(r,N),append(N,Y),append(N,L),append(N,U),append(U,G),append(U,te),append(U,de),append(U,Z),set_input_value(Z,e[6]),append(N,ge),append(N,ce),append(ce,ve),ve.checked=e[10],append(ce,be),append(ce,K),append(ce,V),append(ce,pe),pe.checked=e[12],append(ce,me),append(ce,xe),append(r,F),append(r,re),he=!0,X||(ke=[listen(c,"click",e[13]),listen(d,"change",e[14]),listen(T,"click",e[15]),listen(k,"click",e[17]),listen(O,"click",e[19]),listen(q,"change",e[16]),listen(Z,"change",e[27]),listen(Z,"input",e[27]),listen(ve,"change",e[28]),listen(pe,"change",e[29]),listen(re,"click",e[30])],X=!0)},p(Q,ye){var Ie;(!he||ye[0]&8)&&l!==(l=((Ie=Q[3])!=null?Ie:"Default network")+"")&&set_data(f,l);const Ae={};ye[0]&1024&&(Ae.debug=Q[10]),ye[0]&2048&&(Ae.editable=Q[11]),!v&&ye[0]&1&&(v=!0,Ae.getLines=Q[0],add_flush_callback(()=>v=!1)),!x&&ye[0]&2&&(x=!0,Ae.drawImage=Q[1],add_flush_callback(()=>x=!1)),!S&&ye[0]&4&&(S=!0,Ae.clear=Q[2],add_flush_callback(()=>S=!1)),w.$set(Ae),we===(we=ne(Q))&&_e?_e.p(Q,ye):(_e.d(1),_e=we(Q),_e&&(_e.c(),_e.m(_,null))),(!he||ye[0]&4096)&&M!==(M=Q[12]?"Afbeelding uploaden":"Upload image")&&set_data(I,M),(!he||ye[0]&4096)&&D!==(D=Q[12]?"Herken":"Detect")&&set_data($,D),Q[10]&&Q[7]!=null?le?le.p(Q,ye):(le=create_if_block(Q),le.c(),le.m(a,W)):le&&(le.d(1),le=null),(!he||ye[0]&64)&&set_data(te,Q[6]),ye[0]&64&&set_input_value(Z,Q[6]),ye[0]&1024&&(ve.checked=Q[10]),ye[0]&4096&&(pe.checked=Q[12]),(!he||ye[0]&4096&&fe!==(fe=null_to_empty(`container ${Q[12]?"demo":""}`)+" svelte-wboubd"))&&attr(r,"class",fe)},i(Q){he||(transition_in(w.$$.fragment,Q),he=!0)},o(Q){transition_out(w.$$.fragment,Q),he=!1},d(Q){Q&&detach(r),e[20](null),destroy_component(w),_e.d(),e[25](null),le&&le.d(),e[26](null),X=!1,run_all(ke)}}}const func_1=e=>typeof e=="string",func_2=e=>typeof e=="string";function instance(e,r,t){let n,a,s,o,l,f,h=new FileReader,c,u=2.5,d,g,m,w=!1,v=!0,x=!0;onMount(async()=>{h.addEventListener("load",_),await init(),fetch(defaultNetworkPath).then(N=>N.arrayBuffer()).then(N=>l=new Network(new Uint8Array(N))).catch(N=>console.error(`Error while loading default network: ${N}`))});function S(){f.click()}function y(){let N=f.files[0];t(3,o=N.name),h.readAsArrayBuffer(N)}function _(N){let Y=N.target.result,L=new Uint8Array(Y);l=new Network(L)}function E(){c.click()}async function R(){let N=c.files[0];N.type!="image/jpeg"&&N.type!="image/png"&&console.warn(`Unknown image type: ${N.type}`);let Y=await Image$1.load(URL.createObjectURL(N));Y=Y.grey({algorithm:"black"}).mask().invert();let L=new Image;L.onload=()=>{console.log(L),a(L),t(11,v=!1)},L.src=Y.toDataURL(),console.log("pre",L)}function T(N){for(let Y of N){let L=document.createElement("div");for(let U of Y)if(typeof U=="number"){let G=document.createElement("p");G.innerText=`${U}`,G.style.opacity="50%",G.style.display="inline-block",L.appendChild(G)}else{let G=document.createElement("canvas");G.width=140,G.height=140;let te=G.getContext("2d");for(let de=0;de<U.length;de++){let Z=U[de];for(let ge=0;ge<Z.length;ge++)if(Z[ge]>0){let ce=Math.round(255*(1-Z[ge]));te.fillStyle=`rgb(${ce}, ${ce}, ${ce})`,te.fillRect(ge*5,de*5,5,5)}}L.appendChild(G)}m.appendChild(L)}}function M(){t(7,d=[]),t(8,g=[]);let N=n();w&&T(N);for(let Y of N){for(let L of Y)if(typeof L!="number"){let U=L,G=U.map((Z,ge)=>U.map(ce=>ce[ge])),de=Array.from(l.feed_forward(new Float64Array(G.flat())).entries()).sort(([,Z],[,ge])=>ge-Z)[0];d.push(String.fromCharCode(de[0]+96)),g.push(de[1])}else d.push(L);d.push(1/0)}}function I(){let N=d.filter(L=>typeof L=="number").sort(),Y=Math.floor(N.length/2);return N.length%2==0?(N[Y-1]+N[Y])/2:N[Y]}function b(){s(),t(11,v=!0),t(7,d=null),t(9,m.innerHTML="",m)}function k(N){binding_callbacks[N?"unshift":"push"](()=>{f=N,t(4,f)})}function D(N){n=N,t(0,n)}function $(N){a=N,t(1,a)}function P(N){s=N,t(2,s)}const O=N=>typeof N=="number"?N!=1/0?N>I()*u?" ":"":`
`:N;function ee(N){binding_callbacks[N?"unshift":"push"](()=>{c=N,t(5,c)})}function q(N){binding_callbacks[N?"unshift":"push"](()=>{m=N,t(9,m)})}function z(){u=to_number(this.value),t(6,u)}function W(){w=this.checked,t(10,w)}function H(){x=this.checked,t(12,x)}return[n,a,s,o,f,c,u,d,g,m,w,v,x,S,y,E,R,M,I,b,k,D,$,P,O,ee,q,z,W,H,()=>t(12,x=!1)]}class App extends SvelteComponent{constructor(r){super(),init$1(this,r,instance,create_fragment,safe_not_equal,{},null,[-1,-1])}}const main="";new App({target:document.getElementById("app")});
